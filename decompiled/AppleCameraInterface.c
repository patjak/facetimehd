/* This file has been generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2014 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

__int64 __fastcall AppleCamIn::MetaClass::MetaClass(AppleCamIn::MetaClass *__hidden this); // idb
__int64 __fastcall AppleCamIn::MetaClass::~MetaClass(AppleCamIn::MetaClass *__hidden this); // idb
__int64 __fastcall AppleCamIn::AppleCamIn(__int64 a1);
__int64 __fastcall AppleCamIn::AppleCamIn(__int64 a1);
__int64 __fastcall AppleCamIn::~AppleCamIn(AppleCamIn *__hidden this); // idb
__int64 __fastcall AppleCamIn::~AppleCamIn(AppleCamIn *__hidden this); // idb
void __fastcall AppleCamIn::~AppleCamIn(AppleCamIn *this);
__int64 __fastcall AppleCamIn::getMetaClass(AppleCamIn *__hidden this); // idb
__int64 __fastcall AppleCamIn::MetaClass::MetaClass(AppleCamIn::MetaClass *__hidden this); // idb
__int64 __fastcall AppleCamIn::MetaClass::alloc(AppleCamIn::MetaClass *this, unsigned __int64 a2);
__int64 __fastcall AppleCamIn::AppleCamIn(__int64 a1);
__int64 __fastcall AppleCamIn::AppleCamIn(__int64 a1);
int __fastcall AppleCamIn::init(AppleCamIn *this, OSDictionary *a2);
__int64 __fastcall AppleCamIn::initACPI(AppleCamIn *__hidden this); // idb
__int64 __fastcall AppleCamIn::enableASPM(AppleCamIn *__hidden this); // idb
__int64 __fastcall AppleCamIn::disableASPM(AppleCamIn *__hidden this); // idb
__int64 __fastcall AppleCamIn::acpiControlS2ChipPower(AppleCamIn *this, unsigned int a2, unsigned int a3);
char __fastcall AppleCamIn::start(AppleCamIn *this, IOService *a2);
__int64 __fastcall AppleCamIn::init_s2_pcie_link(AppleCamIn *__hidden this); // idb
__int64 __fastcall AppleCamIn::s2_init_ddr_controller_soc(AppleCamIn *this); // idb
__int64 __fastcall AppleCamIn::do_shmoo(AppleCamIn *this); // idb
__int64 __fastcall AppleCamIn::save_ddr_phy_regs(AppleCamIn *__hidden this); // idb
__int64 __fastcall AppleCamIn::ispInterruptHandler(AppleCamIn *this); // idb
char AppleCamIn::ispInterruptHandlerFilter();
__int64 __fastcall AppleCamIn::power_off_hardware(AppleCamIn *this, char *a2);
int __fastcall AppleCamIn::initForPM(AppleCamIn *this, IOService *a2);
__int64 __fastcall AppleCamIn::systemWakeCall(AppleCamIn *this, void *a2, void *a3, __int64 a4, IOService *a5, void *a6);
int __fastcall AppleCamIn::wakeEventHandlerThread(AppleCamIn *this, void *a2);
__int64 __fastcall AppleCamIn::handleWakeEvent_gated(AppleCamIn *this); // idb
int __fastcall AppleCamIn::free(AppleCamIn *this);
int __fastcall AppleCamIn::probe(AppleCamIn *this, IOService *a2, int *a3);
int __fastcall AppleCamIn::message(AppleCamIn *this, unsigned int a2, IOService *a3, void *a4);
int __fastcall AppleCamIn::finalize(AppleCamIn *this, unsigned int a2);
__int64 __fastcall AppleCamIn::getWorkLoop(AppleCamIn *__hidden this); // idb
__int64 __fastcall AppleCamIn::newUserClient(AppleCamIn *this, task *a2, void *a3, __int64 a4, IOUserClient **a5);
__int64 __fastcall AppleCamIn::EnableS2Chip(AppleCamIn *this, __int64 a2, unsigned int a3);
__int64 __fastcall AppleCamIn::DisableS2Chip(AppleCamIn *this); // idb
unsigned __int64 __fastcall AppleCamIn::bcopy_with_PCI_throttle(AppleCamIn *this, const void *a2, void *a3, unsigned __int64 a4);
// unsigned int __usercall AppleCamIn::power_on_hardware@<eax>(AppleCamIn *this@<rdi>, __int64 a2@<rsi>, void *a3@<r12>);
int __fastcall AppleCamIn::EnableSensor(AppleCamIn *this);
int __fastcall AppleCamIn::DisableSensor(AppleCamIn *this);
__int64 __fastcall AppleCamIn::VerifyMemory(AppleCamIn *this, int a2);
__int64 __fastcall AppleCamIn::restore_ddr_phy_regs(AppleCamIn *__hidden this); // idb
__int64 __fastcall AppleCamIn::ddr40_phy_rewrite_mode_registers(AppleCamIn *__hidden this); // idb
// __int64 __usercall AppleCamIn::ISP_Init@<rax>(AppleCamIn *this@<rdi>, void *a2@<r12>);
__int64 __fastcall AppleCamIn::ISP_deInit(AppleCamIn *this, char *a2);
__int64 __fastcall AppleCamIn::DisableFHSi(AppleCamIn *this); // idb
__int64 __fastcall AppleCamIn::initialPowerStateForDomainState(AppleCamIn *this);
// __int64 __usercall AppleCamIn::setPowerStateGated@<rax>(AppleCamIn *this@<rdi>, IOService *a2@<rdx>, __int64 a3@<rsi>, void *a4@<r12>);
int __fastcall AppleCamIn::setPowerState(AppleCamIn *this, __int64 a2, IOService *a3);
int __fastcall AppleCamIn::ISP_PowerOnCamera(AppleCamIn *this, unsigned int a2, void *a3);
__int64 __fastcall AppleCamIn::ISP_PowerOnCamera_gated(AppleCamIn *__hidden this, unsigned int, void *); // idb
int __fastcall AppleCamIn::ISP_PowerOffCamera(AppleCamIn *this, unsigned int a2, void *a3);
__int64 __fastcall AppleCamIn::ISP_PowerOffCamera_gated(AppleCamIn *__hidden this, unsigned int, void *); // idb
int __fastcall AppleCamIn::ISP_SendCommand(AppleCamIn *this, unsigned __int8 *a2, int a3, int a4, int a5, task *a6);
__int64 __fastcall AppleCamIn::ISP_SendCommand_gated(AppleCamIn *this, __int64 a2, __int64 a3, __int64 a4, task *a5);
__int64 __fastcall AppleCamIn::ispCmdSend(AppleCamIn *this, void *a2, int a3, unsigned int *a4, int a5, char a6, unsigned int a7, unsigned int a8);
__int64 __fastcall AppleCamIn::ISP_I2CInit(AppleCamIn *this, int a2);
// __int64 __usercall AppleCamIn::ISP_I2CWrite@<rax>(AppleCamIn *this@<rdi>, __int64 a2@<rax>, int a3@<edx>, int a4@<ecx>, int a5@<esi>, unsigned int a6@<r8d>, unsigned int a7@<r9d>, unsigned int a8);
int __fastcall AppleCamIn::ISP_EnableSensorPower(AppleCamIn *this, unsigned int a2, unsigned __int8 a3);
__int64 __fastcall AppleCamIn::ISP_EnableSensorPower_gated(AppleCamIn *this, unsigned int a2, char a3);
__int64 __fastcall AppleCamIn::GenerateTagForClientBufferArgsDataPointer(AppleCamIn *this, OSData *a2);
__int64 __fastcall AppleCamIn::GenerateClientBufferArgsDataPointerFromTag(AppleCamIn *this, __int64 a2);
int __fastcall AppleCamIn::ISP_SetFullStatsMode(AppleCamIn *this, unsigned int a2);
__int64 __fastcall AppleCamIn::ISP_SetFullStatsMode_gated(AppleCamIn *this, int a2);
__int64 __fastcall AppleCamIn::ISP_MapIOSurfaceWithIOMMU(__int64 a1, __int64 a2, __int64 a3, __int64 a4);
int __fastcall AppleCamIn::ISP_SendBuffers(__int64 a1, __int64 a2, unsigned int a3, __int64 a4, __int64 a5);
signed __int64 __fastcall AppleCamIn::ISP_SendBuffers_gated(__int64 a1, __int64 a2, unsigned int a3, __int64 a4, const void *a5);
__int64 __fastcall AppleCamIn::AllocateDeviceMemory(__int64 a1, int a2, __int64 a3, char a4);
__int64 __fastcall AppleCamIn::S2DeviceMemoryHostVirtualAddressToISPAddress(AppleCamIn *__hidden this, void *); // idb
int __fastcall AppleCamIn::ISP_GetCameraTime(__int64 a1, __int64 a2);
signed __int64 __fastcall AppleCamIn::ISP_GetCameraTime_gated(__int64 a1, __int64 a2);
int __fastcall AppleCamIn::ISP_LoadFirmware(AppleCamIn *this, void *a2, unsigned int a3, unsigned int a4, task *a5);
__int64 __fastcall AppleCamIn::ISP_LoadFirmware_gated(AppleCamIn *this, void *a2, __int64 a3, int a4, task *a5);
// __int64 __usercall AppleCamIn::ISP_InitialSensorDetection@<rax>(AppleCamIn *this@<rdi>, void *a2@<r12>);
int __fastcall AppleCamIn::ISP_GetModuleParams(__int64 a1, __int64 a2);
signed __int64 __fastcall AppleCamIn::ISP_GetModuleParams_gated(__int64 a1, void *a2);
int __fastcall AppleCamIn::ISP_GetSensorConfigInfo(__int64 a1, unsigned int a2, unsigned int a3, __int64 a4);
signed __int64 __fastcall AppleCamIn::ISP_GetSensorConfigInfo_gated(__int64 a1, __int64 a2, unsigned int a3, void *a4);
int __fastcall AppleCamIn::ISP_ReadS2MemoryBlock(AppleCamIn *this, void *a2, unsigned int a3, unsigned int a4, task *a5);
__int64 __fastcall AppleCamIn::ISP_ReadS2MemoryBlock_gated(AppleCamIn *this, void *a2, int a3, unsigned int a4, task *a5);
int __fastcall AppleCamIn::ISP_WriteS2MemoryBlock(AppleCamIn *this, void *a2, unsigned int a3, unsigned int a4, task *a5);
__int64 __fastcall AppleCamIn::ISP_WriteS2MemoryBlock_gated(AppleCamIn *this, void *a2, int a3, unsigned int a4, task *a5);
int __fastcall AppleCamIn::ISP_SetRequiredMaxBusStall(AppleCamIn *this, unsigned int a2);
__int64 __fastcall AppleCamIn::ISP_SetRequiredMaxBusStall_gated(AppleCamIn *this, unsigned int); // idb
int __fastcall AppleCamIn::ISP_GetDDRParams(__int64 a1, __int64 a2);
__int64 __fastcall AppleCamIn::ISP_GetDDRParams_gated(__int64 a1, void *a2);
int __fastcall AppleCamIn::ISP_LoadSetfile(AppleCamIn *this, void *a2, unsigned int a3, task *a4, unsigned int a5);
__int64 __fastcall AppleCamIn::ISP_LoadSetfile_gated(AppleCamIn *this, IOMemoryDescriptor *this, OSNumber *this, task *, unsigned int); // idb
int __fastcall AppleCamIn::ISP_GetSetfileSurfaceID(AppleCamIn *this, unsigned int a2, unsigned int *a3);
__int64 __fastcall AppleCamIn::ISP_GetSetfileSurfaceID_gated(AppleCamIn *__hidden this, unsigned int, unsigned int *); // idb
__int64 __fastcall AppleCamIn::doorBellRing0(AppleCamIn *__hidden this, void *); // idb
__int64 __fastcall AppleCamIn::doorBellRing1(AppleCamIn *__hidden this, void *); // idb
__int64 __fastcall AppleCamIn::doorBellRing2(AppleCamIn *__hidden this, void *); // idb
__int64 __fastcall AppleCamIn::doorBellRing3(AppleCamIn *__hidden this, void *); // idb
__int64 __fastcall AppleCamIn::channelNameToIndex(AppleCamIn *this, char *a2, unsigned int *a3);
__int64 __fastcall AppleCamIn::S2ISPAddressToDeviceMemoryHostVirtualAddress(AppleCamIn *__hidden this, unsigned int); // idb
__int64 __fastcall MyCalloc(__int64 a1, __int64 a2);
void __fastcall MyFree(void *a1);
__int64 __fastcall AppleCamIn::FreeDeviceMemoryAllocation(__int64 a1, __int64 a2);
int __fastcall AppleCamIn::ISP_ForgetFirmware(AppleCamIn *this);
__int64 __fastcall AppleCamIn::ISP_ForgetFirmware_gated(AppleCamIn *__hidden this); // idb
// __int64 __usercall AppleCamIn::processSharedMallocRequest@<rax>(AppleCamIn *this@<rdi>, __int64 a2@<rax>, int a3@<edx>, int a4@<esi>);
__int64 __fastcall AppleCamIn::FreeDeviceMemoryAllocation(AppleCamIn *this, int a2);
__int64 __fastcall AppleCamIn::processTargetToHostIOCommand(AppleCamIn *this, int a2, int a3, int a4);
__int64 __fastcall AppleCamIn::processDebugLoggingRequest(AppleCamIn *this, unsigned int a2, __int64 a3, int a4);
__int64 __fastcall AppleCamIn::processCommandResponse(AppleCamIn *this, unsigned int a2);
__int64 __fastcall AppleCamIn::processHostToTargetBufferResponse(AppleCamIn *this, unsigned int a2);
__int64 __fastcall AppleCamIn::processTargetToHostBufferNotification(AppleCamIn *this, __int64 a2, __int64 a3, int a4, unsigned int a5);
__int64 __fastcall S2CamIn_bcopy_WriteCombine(const void *a1, void *a2, int a3);
int __fastcall AppleCamIn::ISP_ProcessRawImagePrepare(__int64 a1, __int64 a2);
__int64 __fastcall AppleCamIn::ISP_ProcessRawImagePrepare_gated(AppleCamIn *this, unsigned int *a2);
int __fastcall AppleCamIn::ISP_ProcessRawImageGo(AppleCamIn *this);
__int64 __fastcall AppleCamIn::ISP_ProcessRawImageGo_gated(AppleCamIn *this); // idb
int __fastcall AppleCamIn::ISP_SetDriverLoggingFlags(AppleCamIn *this, unsigned int a2);
__int64 __fastcall AppleCamIn::ISP_SetDriverLoggingFlags_gated(AppleCamIn *this, int a2);
int __fastcall AppleCamIn::ISP_GetDriverLoggingFlags(AppleCamIn *this, unsigned int *a2);
__int64 __fastcall AppleCamIn::ISP_GetDriverLoggingFlags_gated(AppleCamIn *__hidden this, unsigned int *); // idb
int __fastcall AppleCamIn::ISP_SetISPCPUCommandTimeout(AppleCamIn *this, unsigned int a2);
__int64 __fastcall AppleCamIn::ISP_SetISPCPUCommandTimeout_gated(AppleCamIn *this);
int __fastcall AppleCamIn::ISP_ShowSharedMemoryAllocations(AppleCamIn *this);
__int64 __fastcall AppleCamIn::ISP_ShowSharedMemoryAllocations_gated(AppleCamIn *__hidden this); // idb
int __fastcall AppleCamIn::ISP_GetFirmwareLoggingSurfaceID(AppleCamIn *this, unsigned int *a2);
__int64 __fastcall AppleCamIn::ISP_GetFirmwareLoggingSurfaceID_gated(AppleCamIn *__hidden this, unsigned int *); // idb
__int64 __fastcall AppleCamIn::ISP_I2CRead(AppleCamIn *this, int a2, int a3, int a4, unsigned int a5, unsigned int *a6, unsigned int a7);
int __fastcall AppleCamIn::s2_pll_reset(AppleCamIn *this);
__int64 __fastcall AppleCamIn::s2_pll_init(AppleCamIn *this, int); // idb
__int64 __fastcall AppleCamIn::PutRandomPatternInMemory(AppleCamIn *this, int a2, int a3, int a4, void *a5);
__int64 __fastcall AppleCamIn::GetRandomPatternInMemory(AppleCamIn *this, int a2, int a3, int a4, void *a5);
__int64 __fastcall AppleCamIn::all_shmoo_rd_data_dly_FIFO(AppleCamIn *this, int a2, int a3);
__int64 __fastcall AppleCamIn::all_shmoo_RE_byte_FIFO(AppleCamIn *this, int a2, int a3);
__int64 __fastcall AppleCamIn::generic_shmoo_calib_rd_dqs(AppleCamIn *this, int a2, __int64 a3);
__int64 __fastcall AppleCamIn::generic_shmoo_calib_wr_dq(AppleCamIn *this, int a2, int a3);
__int64 __fastcall AppleCamIn::generic_shmoo_calib_wr_dm(AppleCamIn *this, int a2);
__int64 __fastcall AppleCamIn::generic_shmoo_calib_addr(AppleCamIn *this, int a2);
__int64 __fastcall AppleCamIn::one_shmoo_RE_FIFO(AppleCamIn *this, unsigned int *a2, unsigned int *a3, int a4, int a5);
__int64 __fastcall AppleCamIn::calib_wr_dq(AppleCamIn *this, int *a2, unsigned int *a3, unsigned int *a4, int a5);
// AppleCamIn *__usercall AppleCamIn::create_ddr_calibration_result@<rax>(AppleCamIn *this@<rdi>, const char *a2@<rsi>, int *a3@<rdx>, unsigned int *a4@<rcx>, __int64 a5@<rax>, __int64 a6@<r8>, int a7@<r9d>, int a8);
__int64 __fastcall AppleCamIn::generic_shmoo_rd_dqs(AppleCamIn *this, int *a2, __int64 a3, int a4, unsigned int a5);
__int64 __fastcall AppleCamIn::calib_rd_dqs(AppleCamIn *__hidden this, int *, unsigned int *, unsigned int *); // idb
__int64 __fastcall AppleCamIn::wr_dqs_setting(AppleCamIn *this, int *a2, unsigned int *a3, unsigned int *a4, int a5, int a6, int a7, int a8);
__int64 __fastcall AppleCamIn::MetaClass::~MetaClass(AppleCamIn::MetaClass *__hidden this); // idb
__int64 __fastcall inflate_alloc(void *a1, __int64 a2, __int64 a3);
void __fastcall inflate_free(void *a1, void *a2);
__int64 `global constructor keyed to'_a();
__int64 `global destructor keyed to'_a();
__int64 __fastcall AppleCamInUserClient::MetaClass::MetaClass(AppleCamInUserClient::MetaClass *__hidden this); // idb
__int64 __fastcall AppleCamInUserClient::MetaClass::~MetaClass(AppleCamInUserClient::MetaClass *__hidden this); // idb
__int64 __fastcall AppleCamInUserClient::AppleCamInUserClient(__int64 a1);
__int64 __fastcall AppleCamInUserClient::AppleCamInUserClient(__int64 a1);
__int64 __fastcall AppleCamInUserClient::~AppleCamInUserClient(AppleCamInUserClient *__hidden this); // idb
__int64 __fastcall AppleCamInUserClient::~AppleCamInUserClient(AppleCamInUserClient *__hidden this); // idb
void __fastcall AppleCamInUserClient::~AppleCamInUserClient(AppleCamInUserClient *this);
__int64 __fastcall AppleCamInUserClient::getMetaClass(AppleCamInUserClient *__hidden this); // idb
__int64 __fastcall AppleCamInUserClient::MetaClass::MetaClass(AppleCamInUserClient::MetaClass *__hidden this); // idb
__int64 __fastcall AppleCamInUserClient::MetaClass::alloc(AppleCamInUserClient::MetaClass *this, unsigned __int64 a2);
__int64 __fastcall AppleCamInUserClient::AppleCamInUserClient(__int64 a1);
__int64 __fastcall AppleCamInUserClient::AppleCamInUserClient(__int64 a1);
__int64 __fastcall AppleCamInUserClient::_ISP_DeviceOpen(__int64 a1);
signed __int64 __fastcall AppleCamInUserClient::_ISP_DeviceClose(__int64 a1);
signed __int64 AppleCamInUserClient::_ISP_ReadISPRegister();
signed __int64 AppleCamInUserClient::_ISP_WriteISPRegister();
__int64 __fastcall AppleCamInUserClient::_ISP_IsPowered(__int64 a1, __int64 a2, __int64 a3);
int __fastcall AppleCamInUserClient::_ISP_SendBuffers(__int64 a1, __int64 a2, __int64 a3);
signed __int64 AppleCamInUserClient::_abort_captures();
signed __int64 AppleCamInUserClient::_ISP_ResetParams();
int __fastcall AppleCamInUserClient::_ISP_LoadFirmware(__int64 a1, __int64 a2, __int64 a3);
int __fastcall AppleCamInUserClient::_ISP_LoadSetfile(__int64 a1, __int64 a2, __int64 a3);
int __fastcall AppleCamInUserClient::_ISP_ForgetFirmware(__int64 a1);
int __fastcall AppleCamInUserClient::_ISP_SendCommand(__int64 a1, __int64 a2, __int64 a3);
int __fastcall AppleCamInUserClient::_ISP_PowerOnCamera(void *a1, __int64 a2, __int64 a3);
int __fastcall AppleCamInUserClient::_ISP_PowerOffCamera(void *a1, __int64 a2, __int64 a3);
int __fastcall AppleCamInUserClient::_ISP_GetCameraTime(__int64 a1, __int64 a2, __int64 a3);
int __fastcall AppleCamInUserClient::_ISP_GetModuleParams(__int64 a1, __int64 a2, __int64 a3);
signed __int64 AppleCamInUserClient::_ISP_GetCameraStatus();
int __fastcall AppleCamInUserClient::_ISP_SetDriverLoggingFlags(__int64 a1, __int64 a2, __int64 a3);
int __fastcall AppleCamInUserClient::_ISP_ShowSharedMemoryAllocations(__int64 a1);
int __fastcall AppleCamInUserClient::_ISP_ProcessRawImagePrepare(__int64 a1, __int64 a2, __int64 a3);
int __fastcall AppleCamInUserClient::_ISP_ProcessRawImageGo(__int64 a1);
int __fastcall AppleCamInUserClient::_ISP_GetSetfileSurfaceID(__int64 a1, __int64 a2, __int64 a3);
signed __int64 AppleCamInUserClient::_ISP_LoadFullResLensShadingTable();
int __fastcall AppleCamInUserClient::_ISP_EnableSensorPower(__int64 a1, __int64 a2, __int64 a3);
int __fastcall AppleCamInUserClient::_ISP_SetFullStatsMode(__int64 a1, __int64 a2, __int64 a3);
signed __int64 AppleCamInUserClient::_ISP_DetectFaces();
signed __int64 AppleCamInUserClient::_ISP_StartPerformanceCounters();
signed __int64 AppleCamInUserClient::_ISP_ReadPerformanceCounters();
signed __int64 AppleCamInUserClient::_ISP_StopPerformanceCounters();
signed __int64 AppleCamInUserClient::_ISP_ReadS2Register();
signed __int64 AppleCamInUserClient::_ISP_WriteS2Register();
signed __int64 AppleCamInUserClient::_ISP_ReadS2Memory();
signed __int64 AppleCamInUserClient::_ISP_WriteS2Memory();
int __fastcall AppleCamInUserClient::_ISP_GetDDRParams(__int64 a1, __int64 a2, __int64 a3);
int __fastcall AppleCamInUserClient::_ISP_SetISPCPUCommandTimeout(__int64 a1, __int64 a2, __int64 a3);
int __fastcall AppleCamInUserClient::_ISP_GetSensorConfigInfo(__int64 a1, __int64 a2, __int64 a3);
signed __int64 AppleCamInUserClient::_ISP_ReadS2MemoryBlock();
signed __int64 AppleCamInUserClient::_ISP_WriteS2MemoryBlock();
int __fastcall AppleCamInUserClient::_ISP_GetFirmwareLoggingSurfaceID(__int64 a1, __int64 a2, __int64 a3);
int __fastcall AppleCamInUserClient::_ISP_GetDriverLoggingFlags(__int64 a1, __int64 a2, __int64 a3);
int __fastcall AppleCamInUserClient::_ISP_SetRequiredMaxBusStall(__int64 a1, __int64 a2, __int64 a3);
int __fastcall AppleCamInUserClient::init(AppleCamInUserClient *this, task *a2, OSDictionary *a3);
int __fastcall AppleCamInUserClient::free(AppleCamInUserClient *this);
char __fastcall AppleCamInUserClient::start(AppleCamInUserClient *this, IOService *a2);
int __fastcall AppleCamInUserClient::stop(AppleCamInUserClient *this, IOService *a2);
// __int64 __usercall AppleCamInUserClient::clientDied@<rax>(AppleCamInUserClient *this@<rdi>, __int64 a2@<rax>);
__int64 __fastcall AppleCamInUserClient::clientClose(AppleCamInUserClient *this); // idb
__int64 __fastcall AppleCamInUserClient::ISP_DeviceClose(AppleCamInUserClient *__hidden this); // idb
__int64 __fastcall AppleCamInUserClient::registerNotificationPort(__int64 a1, __int64 a2, __int64 a3, int a4);
int AppleCamInUserClient::externalMethod();
__int64 __fastcall AppleCamInUserClient::ISP_DeviceOpen(AppleCamInUserClient *this);
__int64 __fastcall AppleCamInUserClient::ISP_ReadISPRegister(AppleCamInUserClient *this, __int64 a2, unsigned int *a3);
__int64 __fastcall AppleCamInUserClient::ISP_WriteISPRegister(AppleCamInUserClient *this);
__int64 __fastcall AppleCamInUserClient::ISP_IsPowered(AppleCamInUserClient *__hidden this, unsigned int *); // idb
__int64 __fastcall AppleCamInUserClient::ISP_ResetParams(AppleCamInUserClient *__hidden this); // idb
int __fastcall AppleCamInUserClient::ISP_GetModuleParams(__int64 a1, __int64 a2);
int __fastcall AppleCamInUserClient::ISP_GetSensorConfigInfo(__int64 a1, unsigned int a2, unsigned int a3, __int64 a4);
int __fastcall AppleCamInUserClient::ISP_GetDDRParams(__int64 a1, __int64 a2);
int __fastcall AppleCamInUserClient::ISP_LoadFirmware(AppleCamInUserClient *this, void *a2, unsigned int a3, unsigned int a4);
int __fastcall AppleCamInUserClient::ISP_ForgetFirmware(AppleCamInUserClient *this);
int __fastcall AppleCamInUserClient::ISP_LoadSetfile(AppleCamInUserClient *this, void *a2, unsigned int a3, unsigned int a4);
int __fastcall AppleCamInUserClient::ISP_SendCommand(AppleCamInUserClient *this, unsigned __int8 *a2, int a3, int a4, int a5);
__int64 __fastcall AppleCamInUserClient::sendAsyncResult64(AppleCamInUserClient *__hidden this, unsigned __int64 *, int, unsigned __int64 *, unsigned int); // idb
int AppleCamInUserClient::setAsyncReference64();
int __fastcall AppleCamInUserClient::ISP_SendBuffers(__int64 a1, __int64 a2, __int64 a3, __int64 a4, __int64 a5);
int __fastcall AppleCamInUserClient::ISP_PowerOnCamera(AppleCamInUserClient *this, unsigned int a2);
int __fastcall AppleCamInUserClient::ISP_PowerOffCamera(AppleCamInUserClient *this, unsigned int a2);
__int64 __fastcall AppleCamInUserClient::abort_captures(AppleCamInUserClient *__hidden this); // idb
int __fastcall AppleCamInUserClient::ISP_GetCameraTime(__int64 a1, __int64 a2);
signed __int64 AppleCamInUserClient::ISP_GetCameraStatus();
int __fastcall AppleCamInUserClient::ISP_SetDriverLoggingFlags(AppleCamInUserClient *this, unsigned int a2);
int __fastcall AppleCamInUserClient::ISP_GetDriverLoggingFlags(AppleCamInUserClient *this, unsigned int *a2);
int __fastcall AppleCamInUserClient::ISP_ShowSharedMemoryAllocations(AppleCamInUserClient *this);
int __fastcall AppleCamInUserClient::ISP_ProcessRawImagePrepare(__int64 a1, __int64 a2);
int __fastcall AppleCamInUserClient::ISP_ProcessRawImageGo(AppleCamInUserClient *this);
int __fastcall AppleCamInUserClient::ISP_GetSetfileSurfaceID(AppleCamInUserClient *this, unsigned int a2, unsigned int *a3);
int __fastcall AppleCamInUserClient::ISP_GetFirmwareLoggingSurfaceID(AppleCamInUserClient *this, unsigned int *a2);
__int64 __fastcall AppleCamInUserClient::ISP_LoadFullResLensShadingTable(AppleCamInUserClient *this, void *a2);
int __fastcall AppleCamInUserClient::ISP_EnableSensorPower(AppleCamInUserClient *this, unsigned int a2, unsigned __int8 a3);
int __fastcall AppleCamInUserClient::ISP_SetFullStatsMode(AppleCamInUserClient *this, unsigned int a2);
signed __int64 AppleCamInUserClient::ISP_DetectFaces();
__int64 __fastcall AppleCamInUserClient::ISP_StartPerformanceCounters(AppleCamInUserClient *this);
__int64 __fastcall AppleCamInUserClient::ISP_ReadPerformanceCounters(AppleCamInUserClient *__hidden this, unsigned int *, unsigned int *, unsigned int *, unsigned int *); // idb
__int64 __fastcall AppleCamInUserClient::ISP_StopPerformanceCounters(AppleCamInUserClient *__hidden this); // idb
__int64 __fastcall AppleCamInUserClient::ISP_ReadS2Register(AppleCamInUserClient *this, __int64 a2, unsigned int *a3);
__int64 __fastcall AppleCamInUserClient::ISP_WriteS2Register(AppleCamInUserClient *this);
int __fastcall AppleCamInUserClient::ISP_SetISPCPUCommandTimeout(AppleCamInUserClient *this, unsigned int a2);
__int64 __fastcall AppleCamInUserClient::ISP_ReadS2Memory(AppleCamInUserClient *this, __int64 a2, unsigned int *a3);
__int64 __fastcall AppleCamInUserClient::ISP_WriteS2Memory(AppleCamInUserClient *this);
__int64 __fastcall AppleCamInUserClient::ISP_ReadS2MemoryBlock(AppleCamInUserClient *this, void *a2);
__int64 __fastcall AppleCamInUserClient::ISP_WriteS2MemoryBlock(AppleCamInUserClient *this, void *a2);
int __fastcall AppleCamInUserClient::ISP_SetRequiredMaxBusStall(AppleCamInUserClient *this, unsigned int a2);
__int64 __fastcall AppleCamInUserClient::MetaClass::~MetaClass(AppleCamInUserClient::MetaClass *__hidden this); // idb
__int64 `global constructor keyed to'_a_0();
__int64 `global destructor keyed to'_a_0();
__int64 __fastcall IOProcessorInit(__int64 a1, __int64 a2, __int64 a3, __int64 a4, __int64 a5, __int64 a6, __int64 a7);
__int64 __fastcall IOProcessorChannelCreate(int a1, __int64 a2, int a3, __int64 a4, __int64 a5);
int IOProcessorChannelDelete();
char __fastcall IOProcessorChannelStats(__int64 a1, __int64 a2, __int64 a3, __int64 a4, __int64 a5);
__int64 __fastcall IOProcessorChannelMessageAvailable(__int64 a1);
__int64 __fastcall IOProcessorChannelSend(__int64 a1, int a2, int a3, int a4);
__int64 __fastcall IOProcessorChannelReceive(__int64 a1, __int64 a2, __int64 a3, __int64 a4);
__int64 __fastcall IOProcessorChannelUnidirectionalSend(__int64 a1, signed __int64 a2, int a3, int a4);
__int64 __fastcall IOProcessorChannelUnidirectionalReceive(__int64 a1, __int64 a2, __int64 a3, __int64 a4);
__int64 __fastcall IOMMUManager::IOMMUManager(__int64 a1, int a2, int a3);
__int64 __fastcall IOMMUManager::IOMMUManager(IOMMUManager *this, int a2, int a3);
void __fastcall IOMMUManager::~IOMMUManager(IOMMUManager *this);
void __fastcall IOMMUManager::~IOMMUManager(IOMMUManager *this);
__int64 __fastcall IOMMUManager::Allocate(IOMMUManager *this, unsigned int); // idb
int __fastcall IOMMUManager::DebugPrint(IOMMUManager *this);
__int64 __fastcall IOMMUManager::Free(IOMMUManager *this, int a2);
__int64 __fastcall DeviceMemoryManager::DeviceMemoryManager(__int64 a1, int a2, int a3);
__int64 __fastcall DeviceMemoryManager::DeviceMemoryManager(DeviceMemoryManager *this, int a2, int a3);
void __fastcall DeviceMemoryManager::~DeviceMemoryManager(DeviceMemoryManager *this);
void __fastcall DeviceMemoryManager::~DeviceMemoryManager(DeviceMemoryManager *this);
__int64 __fastcall DeviceMemoryManager::Allocate(DeviceMemoryManager *this, int a2);
int __fastcall DeviceMemoryManager::DebugPrint(DeviceMemoryManager *this);
__int64 __fastcall DeviceMemoryManager::Free(DeviceMemoryManager *this, int a2);
__int64 __fastcall tinymt32_init(__int64 a1, int a2);
signed __int64 __fastcall period_certification(__int64 a1);
__int64 __fastcall tinymt32_init_by_array(__int64 a1, __int64 a2, signed int a3);
int _start();
char *OSKextGetCurrentIdentifier();
char *OSKextGetCurrentVersionString();
__int64 OSKextGetCurrentLoadTag();
int _stop();
// int __fastcall IODelay(_QWORD, _QWORD); weak
// int __fastcall IOFree(_QWORD, _QWORD); weak
// int IOLockAlloc(void); weak
// int IOLockFree(void); weak
// int __fastcall IOLog(_QWORD); weak
// int __fastcall IOMalloc(_QWORD, _QWORD); weak
// int __fastcall IOSleep(_QWORD); weak
// int __fastcall PE_parse_boot_argn(_QWORD, _QWORD, _QWORD); weak
// _QWORD IOWorkLoop::workLoop(IOWorkLoop *__hidden this); idb
// _QWORD __cdecl IOPCIDevice::extendedConfigRead32(IOPCIDevice *__hidden this, unsigned __int64); idb
// _QWORD __cdecl IOPCIDevice::extendedConfigWrite32(IOPCIDevice *__hidden this, unsigned __int64, unsigned int); idb
// int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD); weak
// _QWORD __cdecl OSMetaClass::~OSMetaClass(OSMetaClass *__hidden this); idb
// int __fastcall IODMACommand::withSpecification(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD); weak
// _QWORD __cdecl IOUserClient::sendAsyncResult64(IOUserClient *__hidden this, unsigned __int64 *, int, unsigned __int64 *, unsigned int); idb
// int IOUserClient::setAsyncReference64(void); weak
// int __cdecl IOUserClient::IOUserClient(_QWORD); weak
// _QWORD __cdecl IOUserClient::~IOUserClient(IOUserClient *__hidden this); idb
// _QWORD __cdecl OSDictionary::withCapacity(OSDictionary *__hidden this, unsigned int); idb
// _QWORD __cdecl IOCommandGate::commandGate(IOCommandGate *__hidden this, OSObject *, int (__cdecl *)(OSObject *, void *, void *, void *, void *)); idb
// _QWORD __cdecl IOCommandPool::withWorkLoop(IOCommandPool *__hidden this, IOWorkLoop *); idb
// int __fastcall IORegistryEntry::fromPath(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD); weak
// _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *); weak
// _QWORD __cdecl IOMemoryDescriptor::withAddressRange(IOMemoryDescriptor *__hidden this, unsigned __int64, unsigned __int64, unsigned int, task *); idb
// int __fastcall OSCollectionIterator::withCollection(_QWORD); weak
// int __fastcall IOFilterInterruptEventSource::filterInterruptEventSource(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD); weak
// _QWORD __cdecl OSSet::withCapacity(OSSet *__hidden this, unsigned int); idb
// _QWORD __cdecl OSSet::withSet(OSSet *__hidden this, const OSSet *, unsigned int); idb
// _QWORD __cdecl OSData::withCapacity(OSData *__hidden this, unsigned int); idb
// _QWORD __cdecl OSData::withBytes(OSData *__hidden this, const void *, unsigned int); idb
// _QWORD __cdecl OSArray::withCapacity(OSArray *__hidden this, unsigned int); idb
// _QWORD __cdecl OSNumber::withNumber(OSNumber *__hidden this, unsigned __int64, unsigned int); idb
// void __cdecl OSObject::operator delete(void *); idb
// _QWORD __cdecl OSObject::operator new(OSObject *__hidden this, unsigned __int64); idb
// _QWORD __cdecl OSString::withCString(OSString *__hidden this, const char *); idb
// _QWORD __cdecl IOService::nameMatching(IOService *__hidden this, const char *, OSDictionary *); idb
// _QWORD __cdecl IOService::waitForService(IOService *__hidden this, OSDictionary *, mach_timespec *); idb
// _QWORD __cdecl IOService::requireMaxBusStall(IOService *__hidden this, unsigned int); idb
// _QWORD __cdecl IOService::changePowerStateToPriv(IOService *__hidden this, unsigned __int64); idb
// int __cdecl IOService::IOService(_QWORD); weak
// _QWORD __cdecl IOService::~IOService(IOService *__hidden this); idb
// _QWORD OSMetaClass::instanceConstructed(OSMetaClass *__hidden this); idb
// _QWORD __cdecl OSMetaClassBase::metaCast(OSMetaClassBase *__hidden this, const char *); idb
// _QWORD IOService::isInactive(IOService *__hidden this); idb
// void __cdecl operator delete[](void *); idb
// void __cdecl operator delete(void *); idb
// _QWORD __cdecl operator new[](unsigned __int64); idb
// _QWORD __cdecl operator new(unsigned __int64); idb
// int __fastcall absolutetime_to_nanoseconds(_QWORD, _QWORD); weak
// int __cdecl bcmp(const void *, const void *, size_t);
// void __cdecl bcopy(const void *, void *, size_t);
// void __cdecl bzero(void *, size_t);
// int __fastcall clock_get_uptime(_QWORD, _QWORD); weak
// int __fastcall clock_interval_to_deadline(_QWORD, _QWORD, _QWORD); weak
// int __fastcall current_task(_QWORD, _QWORD); weak
// int __cdecl inflate(z_streamp strm, int flush);
// int __cdecl inflateEnd(z_streamp strm);
// int __cdecl inflateInit2_(z_streamp strm, int windowBits, const char *version, int stream_size);
// int __fastcall kernel_thread_start(_QWORD, _QWORD, _QWORD); weak
// uint64_t mach_absolute_time(void);
// void *__cdecl memcpy(void *, const void *, size_t);
// int printf(const char *, ...);
// int __fastcall registerPrioritySleepWakeInterest(_QWORD, _QWORD, _QWORD); weak
// int snprintf(char *, size_t, const char *, ...);
// size_t __cdecl strlen(const char *);
// int __fastcall thread_deallocate(_QWORD); weak

//-------------------------------------------------------------------------
// Data declarations

int dword_0 = 4277009103; // weak
int dword_4 = 16777223; // weak
int dword_10 = 8; // weak
segment_command_64 stru_20 = { 25u, 312u, "__TEXT", 0uLL, 73728uLL, 0uLL, 73728uLL, 7, 5, 3u, 0u }; // weak
section_64 stru_68 =
{
  {
    '_',
    '_',
    't',
    'e',
    'x',
    't',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0'
  },
  "__TEXT",
  1760uLL,
  55649uLL,
  1760u,
  4u,
  0u,
  0u,
  2147484672u,
  0u,
  0u,
  0u
}; // weak
section_64 stru_B8 =
{
  {
    '_',
    '_',
    'c',
    's',
    't',
    'r',
    'i',
    'n',
    'g',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0'
  },
  "__TEXT",
  57409uLL,
  15294uLL,
  57409u,
  0u,
  0u,
  0u,
  2u,
  0u,
  0u,
  0u
}; // weak
section_64 stru_108 =
{
  {
    '_',
    '_',
    'c',
    'o',
    'n',
    's',
    't',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0'
  },
  "__TEXT",
  72704uLL,
  1016uLL,
  72704u,
  4u,
  0u,
  0u,
  0u,
  0u,
  0u,
  0u
}; // weak
section_64 stru_1F0 =
{
  {
    '_',
    '_',
    'm',
    'o',
    'd',
    '_',
    'i',
    'n',
    'i',
    't',
    '_',
    'f',
    'u',
    'n',
    'c',
    '\0'
  },
  "__DATA",
  73824uLL,
  16uLL,
  73824u,
  3u,
  0u,
  0u,
  9u,
  0u,
  0u,
  0u
}; // weak
_UNKNOWN loc_1004; // weak
_UNKNOWN unk_11C00; // weak
_QWORD off_12000[12] =
{
  746424LL,
  746448LL,
  746536LL,
  746552LL,
  747608LL,
  747624LL,
  749224LL,
  749232LL,
  749280LL,
  749368LL,
  749376LL,
  749384LL
}; // weak
_QWORD off_12008[11] =
{
  746448LL,
  746536LL,
  746552LL,
  747608LL,
  747624LL,
  749224LL,
  749232LL,
  749280LL,
  749368LL,
  749376LL,
  749384LL
}; // weak
__int64 off_12010[10] =
{
  746536LL,
  746552LL,
  747608LL,
  747624LL,
  749224LL,
  749232LL,
  749280LL,
  749368LL,
  749376LL,
  749384LL
}; // weak
_QWORD off_12018[9] =
{
  746552LL,
  747608LL,
  747624LL,
  749224LL,
  749232LL,
  749280LL,
  749368LL,
  749376LL,
  749384LL
}; // weak
_QWORD off_12020[8] =
{
  747608LL,
  747624LL,
  749224LL,
  749232LL,
  749280LL,
  749368LL,
  749376LL,
  749384LL
}; // weak
_QWORD off_12028[7] = { 747624LL, 749224LL, 749232LL, 749280LL, 749368LL, 749376LL, 749384LL }; // weak
__int64 off_12030[6] = { 749224LL, 749232LL, 749280LL, 749368LL, 749376LL, 749384LL }; // weak
__int64 off_12038[5] = { 749232LL, 749280LL, 749368LL, 749376LL, 749384LL }; // weak
__int64 off_12040[4] = { 749280LL, 749368LL, 749376LL, 749384LL }; // weak
__int64 off_12048[3] = { 749368LL, 749376LL, 749384LL }; // weak
__int64 off_12050[2] = { 749376LL, 749384LL }; // weak
__int64 off_12058 = 749384LL; // weak
__int64 (__fastcall *off_120A0[2])(AppleCamIn *__hidden this) = { &AppleCamIn::~AppleCamIn, &AppleCamIn::~AppleCamIn }; // weak
__int64 (__fastcall *off_12910[2])(AppleCamIn::MetaClass *__hidden this) = { &AppleCamIn::MetaClass::~MetaClass, &AppleCamIn::MetaClass::~MetaClass }; // weak
_QWORD AppleCamInUserClient::metaClass = 681136LL; // weak
__int64 (__fastcall *off_12A10[2])(AppleCamInUserClient *__hidden this) =
{
  &AppleCamInUserClient::~AppleCamInUserClient,
  &AppleCamInUserClient::~AppleCamInUserClient
}; // weak
__int64 (__fastcall *off_13390[2])(AppleCamInUserClient::MetaClass *__hidden this) =
{
  &AppleCamInUserClient::MetaClass::~MetaClass,
  &AppleCamInUserClient::MetaClass::~MetaClass
}; // weak
_UNKNOWN AppleS2CamInPowerStates; // weak
_DWORD kmod_info[45] =
{
  0,
  0,
  1,
  4294967295,
  778923875,
  1819308129,
  1919168101,
  1919252073,
  1886404910,
  1631806828,
  1634887021,
  1702129225,
  1667327602,
  101,
  0,
  0,
  0,
  0,
  0,
  0,
  858926645,
  12334,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  4294967295,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0
}; // idb
_UNKNOWN S2ISP::s2isp_fw; // weak
int dword_40004 = 3434789811; // weak
int dword_40008 = 2897584817; // weak
int dword_41000 = 2768946602; // weak
int dword_41004 = 3020236631; // weak
int dword_41020 = 77792073; // weak
int dword_41024 = 1245094373; // weak
int dword_42000 = 610108469; // weak
int dword_42008 = 2994798226; // weak
int dword_90068 = 3778423812; // weak
int (__fastcall *IOP_0)(_QWORD, _QWORD); // weak
int (*IOP_1)(void); // weak
int (__fastcall *IOP_2)(_QWORD, _QWORD); // weak
int (__fastcall *IOP_3)(_QWORD, _QWORD); // weak
int (__fastcall *IOP_4)(_QWORD); // weak
int (__fastcall *IOP_5)(_QWORD); // weak
_QWORD IOP_6; // idb
_QWORD AppleCamIn::gMetaClass; // weak
_QWORD AppleCamInUserClient::gMetaClass; // weak
int (*_realmain)(void); // weak
int (*_antimain)(void); // weak


//----- (00000000000006E0) ----------------------------------------------------
__int64 __fastcall AppleCamIn::MetaClass::MetaClass(AppleCamIn::MetaClass *this)
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(this, "AppleCamIn", off_12028[0], 4104LL);
  result = (__int64)off_12910;
  *(_QWORD *)this = off_12910;
  return result;
}
// 12028: using guessed type _QWORD off_12028[7];
// 12910: using guessed type __int64 (__fastcall *off_12910[2])(AppleCamIn::MetaClass *__hidden this);
// B6418: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000000712) ----------------------------------------------------
__int64 __fastcall AppleCamIn::MetaClass::~MetaClass(AppleCamIn::MetaClass *this)
{
  return OSMetaClass::~OSMetaClass(this);
}

//----- (000000000000071C) ----------------------------------------------------
__int64 __fastcall AppleCamIn::AppleCamIn(__int64 a1)
{
  __int64 result; // rax@1

  IOService::IOService(a1);
  *(_QWORD *)a1 = off_120A0;
  *(_QWORD *)(a1 + 168) = "CameraSensorSerialNumber";
  *(_QWORD *)(a1 + 176) = "CameraModuleSerialNumber";
  result = (__int64)"CameraModuleSerialString";
  *(_QWORD *)(a1 + 184) = "CameraModuleSerialString";
  return result;
}
// 120A0: using guessed type __int64 (__fastcall *off_120A0[2])(AppleCamIn *__hidden this);
// B6C90: using guessed type int __cdecl IOService::IOService(_QWORD);

//----- (0000000000000766) ----------------------------------------------------
__int64 __fastcall AppleCamIn::AppleCamIn(__int64 a1)
{
  __int64 result; // rax@1

  IOService::IOService(a1);
  *(_QWORD *)a1 = off_120A0;
  *(_QWORD *)(a1 + 168) = "CameraSensorSerialNumber";
  *(_QWORD *)(a1 + 176) = "CameraModuleSerialNumber";
  result = (__int64)"CameraModuleSerialString";
  *(_QWORD *)(a1 + 184) = "CameraModuleSerialString";
  return result;
}
// 120A0: using guessed type __int64 (__fastcall *off_120A0[2])(AppleCamIn *__hidden this);
// B6C90: using guessed type int __cdecl IOService::IOService(_QWORD);

//----- (00000000000007B0) ----------------------------------------------------
__int64 __fastcall AppleCamIn::~AppleCamIn(AppleCamIn *this)
{
  return IOService::~IOService(this);
}

//----- (00000000000007BA) ----------------------------------------------------
__int64 __fastcall AppleCamIn::~AppleCamIn(AppleCamIn *this)
{
  return IOService::~IOService(this);
}

//----- (00000000000007C4) ----------------------------------------------------
void __fastcall AppleCamIn::~AppleCamIn(AppleCamIn *this)
{
  IOService::~IOService(this);
  OSObject::operator delete((void *)this);
}

//----- (00000000000007E6) ----------------------------------------------------
__int64 __fastcall AppleCamIn::getMetaClass(AppleCamIn *this)
{
  return (__int64)&AppleCamIn::gMetaClass;
}
// A6488: using guessed type _QWORD AppleCamIn::gMetaClass;

//----- (00000000000007F4) ----------------------------------------------------
__int64 __fastcall AppleCamIn::MetaClass::MetaClass(AppleCamIn::MetaClass *this)
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(this, "AppleCamIn", off_12028[0], 4104LL);
  result = (__int64)off_12910;
  *(_QWORD *)this = off_12910;
  return result;
}
// 12028: using guessed type _QWORD off_12028[7];
// 12910: using guessed type __int64 (__fastcall *off_12910[2])(AppleCamIn::MetaClass *__hidden this);
// B6418: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000000826) ----------------------------------------------------
__int64 __fastcall AppleCamIn::MetaClass::alloc(AppleCamIn::MetaClass *this, unsigned __int64 a2)
{
  __int64 v2; // rbx@1

  v2 = OSObject::operator new((OSObject *)((char *)&loc_1004 + 4), a2);
  IOService::IOService(v2);
  *(_QWORD *)v2 = off_120A0;
  *(_QWORD *)(v2 + 168) = "CameraSensorSerialNumber";
  *(_QWORD *)(v2 + 176) = "CameraModuleSerialNumber";
  *(_QWORD *)(v2 + 184) = "CameraModuleSerialString";
  OSMetaClass::instanceConstructed((OSMetaClass *)&AppleCamIn::gMetaClass);
  return v2;
}
// 120A0: using guessed type __int64 (__fastcall *off_120A0[2])(AppleCamIn *__hidden this);
// A6488: using guessed type _QWORD AppleCamIn::gMetaClass;
// B6C90: using guessed type int __cdecl IOService::IOService(_QWORD);

//----- (0000000000000890) ----------------------------------------------------
__int64 __fastcall AppleCamIn::AppleCamIn(__int64 a1)
{
  IOService::IOService(a1);
  *(_QWORD *)a1 = off_120A0;
  *(_QWORD *)(a1 + 168) = "CameraSensorSerialNumber";
  *(_QWORD *)(a1 + 176) = "CameraModuleSerialNumber";
  *(_QWORD *)(a1 + 184) = "CameraModuleSerialString";
  return OSMetaClass::instanceConstructed((OSMetaClass *)&AppleCamIn::gMetaClass);
}
// 120A0: using guessed type __int64 (__fastcall *off_120A0[2])(AppleCamIn *__hidden this);
// A6488: using guessed type _QWORD AppleCamIn::gMetaClass;
// B6C90: using guessed type int __cdecl IOService::IOService(_QWORD);

//----- (00000000000008EA) ----------------------------------------------------
__int64 __fastcall AppleCamIn::AppleCamIn(__int64 a1)
{
  IOService::IOService(a1);
  *(_QWORD *)a1 = off_120A0;
  *(_QWORD *)(a1 + 168) = "CameraSensorSerialNumber";
  *(_QWORD *)(a1 + 176) = "CameraModuleSerialNumber";
  *(_QWORD *)(a1 + 184) = "CameraModuleSerialString";
  return OSMetaClass::instanceConstructed((OSMetaClass *)&AppleCamIn::gMetaClass);
}
// 120A0: using guessed type __int64 (__fastcall *off_120A0[2])(AppleCamIn *__hidden this);
// A6488: using guessed type _QWORD AppleCamIn::gMetaClass;
// B6C90: using guessed type int __cdecl IOService::IOService(_QWORD);

//----- (0000000000000944) ----------------------------------------------------
int __fastcall AppleCamIn::init(AppleCamIn *this, OSDictionary *a2)
{
  IOLog("AppleCamIn::init\n");
  return (*(int (__fastcall **)(AppleCamIn *))(off_12038[0] + 600))(this);
}
// 12038: using guessed type __int64 off_12038[5];
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (0000000000000976) ----------------------------------------------------
__int64 __fastcall AppleCamIn::initACPI(AppleCamIn *this)
{
  OSMetaClassBase *v1; // rax@1
  const OSMetaClass *v2; // rdx@1
  signed int v3; // er14@1
  __int64 v4; // rsi@2
  __int64 v5; // rax@2
  __int64 v6; // rax@3
  OSMetaClassBase *v7; // rax@3
  OSMetaClassBase *v8; // r15@3

  *((_QWORD *)this + 510) = 0LL;
  *((_BYTE *)this + 4088) = 0;
  LODWORD(v1) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 31) + 696LL))(
                  *((_QWORD *)this + 31),
                  "acpi-path");
  v3 = -536870212;
  if ( v1 )
  {
    v4 = *(_QWORD *)off_12020[0];
    v5 = OSMetaClassBase::safeMetaCast(v1, *(const OSMetaClassBase **)off_12020[0], v2);
    if ( v5 )
    {
      LODWORD(v6) = (*(int (__fastcall **)(__int64, __int64))(*(_QWORD *)v5 + 328LL))(v5, v4);
      LODWORD(v7) = IORegistryEntry::fromPath(v6, 0LL, 0LL, 0LL, 0LL);
      v8 = v7;
      if ( v7 )
      {
        if ( OSMetaClassBase::metaCast(v7, "IOACPIPlatformDevice") )
        {
          *((_QWORD *)this + 510) = v8;
        }
        else
        {
          v8 = (OSMetaClassBase *)*((_QWORD *)this + 510);
        }
        if ( v8 )
        {
          *((_BYTE *)this + 4088) = (*(int (__fastcall **)(OSMetaClassBase *, _QWORD))(*(_QWORD *)v8 + 2224LL))(
                                      v8,
                                      "CMPE") == 0;
          v3 = 0;
        }
      }
    }
  }
  return (unsigned int)v3;
}
// 12020: using guessed type _QWORD off_12020[8];
// B6730: using guessed type int __fastcall IORegistryEntry::fromPath(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// B6740: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (0000000000000A4E) ----------------------------------------------------
__int64 __fastcall AppleCamIn::enableASPM(AppleCamIn *this)
{
  AppleCamIn *v1; // r14@1
  IOPCIDevice *v2; // rdi@1
  signed int v3; // ebx@1
  int v4; // eax@3
  int v5; // eax@4
  unsigned __int8 v7; // [sp+Fh] [bp-11h]@3

  v1 = this;
  v2 = (IOPCIDevice *)*((_QWORD *)this + 32);
  v3 = -536870208;
  if ( v2 )
  {
    v3 = -536870210;
    if ( *((_BYTE *)v1 + 266) )
    {
      v4 = IOPCIDevice::extendedConfigRead32(v2, *((_BYTE *)v1 + 266));
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v1 + 32), *((_BYTE *)v1 + 266), v4 | 3);
      v7 = 0;
      (*(void (__fastcall **)(_QWORD, signed __int64, char *))(**((_QWORD **)v1 + 31) + 2272LL))(
        *((_QWORD *)v1 + 31),
        16LL,
        &v7);
      if ( v7 >= 0x40uLL )
      {
        v5 = IOPCIDevice::extendedConfigRead32(*((IOPCIDevice **)v1 + 31), v7 + 16LL);
        IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v1 + 31), v7 + 16LL, v5 | 0x103);
      }
      v3 = 0;
      IOLog("AppleCamIn::enableASPM - ASPM enabled\n");
    }
  }
  return (unsigned int)v3;
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (0000000000000B12) ----------------------------------------------------
__int64 __fastcall AppleCamIn::disableASPM(AppleCamIn *this)
{
  AppleCamIn *v1; // r14@1
  IOPCIDevice *v2; // rdi@1
  signed int v3; // ebx@1
  int v4; // eax@3
  int v5; // eax@4
  unsigned __int8 v7; // [sp+Fh] [bp-11h]@3

  v1 = this;
  v2 = (IOPCIDevice *)*((_QWORD *)this + 32);
  v3 = -536870208;
  if ( v2 )
  {
    v3 = -536870210;
    if ( *((_BYTE *)v1 + 266) )
    {
      v4 = IOPCIDevice::extendedConfigRead32(v2, *((_BYTE *)v1 + 266));
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v1 + 32), *((_BYTE *)v1 + 266), v4 & 0xFFFFFFFC);
      v7 = 0;
      (*(void (__fastcall **)(_QWORD, signed __int64, char *))(**((_QWORD **)v1 + 31) + 2272LL))(
        *((_QWORD *)v1 + 31),
        16LL,
        &v7);
      if ( v7 >= 0x40uLL )
      {
        v5 = IOPCIDevice::extendedConfigRead32(*((IOPCIDevice **)v1 + 31), v7 + 16LL);
        IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v1 + 31), v7 + 16LL, v5 & 0xFFFFFEFC);
      }
      v3 = 0;
      IOLog("AppleCamIn::disableASPM - ASPM disabled\n");
    }
  }
  return (unsigned int)v3;
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (0000000000000BD6) ----------------------------------------------------
__int64 __fastcall AppleCamIn::acpiControlS2ChipPower(AppleCamIn *this, unsigned int a2, unsigned int a3)
{
  unsigned int v3; // er15@1
  AppleCamIn *v4; // r12@1
  __int64 v5; // r13@1
  __int64 v6; // rbx@1
  signed __int64 v7; // rsi@1
  unsigned int v8; // edx@1
  __int64 v9; // rax@1
  int v10; // er14@1
  __int64 v11; // rdi@3
  __int64 result; // rax@11
  __int64 v13; // [sp+0h] [bp-40h]@1
  __int64 v14; // [sp+8h] [bp-38h]@1
  __int64 v15; // [sp+10h] [bp-30h]@1

  v3 = a2;
  v4 = this;
  v5 = off_12040[0];
  v15 = *(_QWORD *)off_12040[0];
  v6 = OSNumber::withNumber((OSNumber *)a2, 0x20uLL, a3);
  v7 = 32LL;
  v9 = OSNumber::withNumber((OSNumber *)((char *)&stru_B8.reserved1 + 3), 0x20uLL, v8);
  v13 = v9;
  v14 = v6;
  v10 = -536870212;
  if ( v6 )
  {
    if ( v9 )
    {
      v11 = *((_QWORD *)this + 510);
      if ( v11 )
      {
        if ( *((_BYTE *)v4 + 4088) )
        {
          v7 = (signed __int64)"CMPE";
          v10 = (*(int (__fastcall **)(__int64, _QWORD, __int64 *, __int64 *, signed __int64, _QWORD))(*(_QWORD *)v11 + 2240LL))(
                  v11,
                  "CMPE",
                  &v13,
                  &v14,
                  1LL,
                  0LL);
          if ( *((_BYTE *)v4 + 4020) & 0x40 )
          {
            (*(void (**)(void))(*(_QWORD *)v13 + 328LL))();
            v7 = v3;
            IOLog("AppleCamIn::acpiControlS2ChipPower - powerState=%d, status = 0x%x, result_value = 0x%x\n");
          }
        }
      }
    }
  }
  if ( v6 )
  {
    (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v6 + 40LL))(v6, v7);
  }
  if ( v13 )
  {
    (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v13 + 40LL))(v13, v7);
    v13 = 0LL;
  }
  result = *(_QWORD *)v5;
  if ( *(_QWORD *)v5 == v15 )
  {
    result = (unsigned int)v10;
  }
  return result;
}
// B8: using guessed type section_64 stru_B8;
// 12040: using guessed type __int64 off_12040[4];
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (0000000000000CE4) ----------------------------------------------------
char __fastcall AppleCamIn::start(AppleCamIn *this, IOService *a2)
{
  IOService *v2; // r14@1
  AppleCamIn *v3; // r12@1
  __int64 v4; // r13@1
  char v5; // bl@1
  const OSMetaClass *v6; // rdx@1
  const OSMetaClassBase *v7; // r15@2
  __int64 v8; // rax@2
  __int64 v9; // rax@3
  __int64 v10; // rax@4
  __int64 v11; // rax@4
  __int64 v12; // rax@5
  __int64 v13; // rax@5
  __int64 v14; // rax@6
  __int64 v15; // rsi@7
  __int64 v16; // rdi@9
  char *v17; // rbx@13
  __int64 v18; // rsi@14
  __int64 v19; // rdi@14
  void *v20; // rax@18
  int v21; // eax@30
  int v22; // ecx@30
  DeviceMemoryManager *v23; // rbx@37
  IOMMUManager *v24; // rbx@38
  OSDictionary *v25; // rdx@38
  IOService *v26; // rax@39
  mach_timespec *v27; // rdx@39
  __int64 v28; // rax@39
  __int64 v29; // ST20_8@40
  unsigned int v30; // edx@40
  __int64 v31; // rbx@40
  unsigned int v32; // edx@40
  __int64 v33; // rbx@40
  unsigned int v34; // edx@40
  __int64 v35; // rbx@40
  unsigned int v36; // edx@40
  __int64 v37; // rbx@40
  __int64 v38; // rbx@40
  __int64 v39; // rax@40
  __int64 v40; // rdi@40
  __int64 v41; // rax@41
  __int64 v42; // rax@41
  void *v43; // rax@41
  void *v44; // rbx@41
  IOWorkLoop *v45; // rdi@41
  __int64 v46; // rax@41
  IOCommandPool *v47; // rax@42
  signed int v48; // ebx@42
  __int64 v49; // rax@43
  int (__cdecl *v50)(OSObject *, void *, void *, void *, void *); // rdx@43
  __int64 v51; // rax@44
  __int64 v52; // rax@45
  unsigned int v53; // ebx@53
  __int64 (__fastcall *v54)(AppleCamIn *); // rsi@53
  __int64 v55; // rdx@53
  __int64 v56; // rcx@53
  signed int v57; // ebx@54
  int v58; // ecx@59
  int v59; // eax@61
  __int64 v60; // rax@63
  __int64 v61; // r8@65
  __int64 v62; // rax@66
  __int64 v63; // rax@67
  __int64 v65; // rbx@73
  OSMetaClassBase *v66; // rax@73
  char *v67; // rsi@73
  const OSMetaClass *v68; // rdx@73
  __int64 v69; // rax@73
  OSMetaClassBase *v70; // rax@74
  const OSMetaClass *v71; // rdx@74
  IOPCIDevice *v72; // rax@74
  __int64 v73; // rax@82
  char v74; // [sp+18h] [bp-458h]@54
  unsigned int v75; // [sp+1Ch] [bp-454h]@57
  int v76; // [sp+20h] [bp-450h]@54
  unsigned __int8 v77; // [sp+2Ah] [bp-446h]@79
  unsigned __int8 v78; // [sp+2Bh] [bp-445h]@77
  int v79; // [sp+2Ch] [bp-444h]@53
  int v80; // [sp+30h] [bp-440h]@33
  int v81; // [sp+34h] [bp-43Ch]@30
  int v82; // [sp+38h] [bp-438h]@26
  int v83; // [sp+3Ch] [bp-434h]@21
  char v84; // [sp+40h] [bp-430h]@18
  __int64 v85; // [sp+440h] [bp-30h]@1

  v2 = a2;
  v3 = this;
  v4 = off_12040[0];
  v85 = *(_QWORD *)off_12040[0];
  v5 = 0;
  IOLog("AppleCamIn::start\n");
  if ( !(unsigned __int8)(*(int (__fastcall **)(AppleCamIn *))(off_12038[0] + 1488))(this) )
  {
    goto LABEL_70;
  }
  v7 = *(const OSMetaClassBase **)off_12008[0];
  v8 = OSMetaClassBase::safeMetaCast(a2, *(const OSMetaClassBase **)off_12008[0], v6);
  *((_QWORD *)this + 31) = v8;
  if ( !v8 )
  {
    v5 = 0;
    goto LABEL_70;
  }
  LODWORD(v9) = (*(int (__fastcall **)(__int64, signed __int64, _QWORD))(*(_QWORD *)v8 + 2312LL))(v8, 16LL, 0LL);
  *((_QWORD *)this + 504) = v9;
  if ( !v9 )
  {
    v16 = (__int64)"%s: Couldn't map S2 device registers\n";
LABEL_69:
    v5 = 0;
    IOLog(v16);
    goto LABEL_70;
  }
  LODWORD(v10) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v9 + 280LL))(v9);
  *((_QWORD *)this + 505) = v10;
  LODWORD(v11) = (*(int (__fastcall **)(_QWORD, signed __int64, signed __int64))(**((_QWORD **)this + 31) + 2312LL))(
                   *((_QWORD *)this + 31),
                   24LL,
                   1024LL);
  *((_QWORD *)this + 506) = v11;
  if ( !v11 )
  {
    v16 = (__int64)"%s: Couldn't map S2 device memory\n";
    goto LABEL_69;
  }
  LODWORD(v12) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v11 + 280LL))(v11);
  *((_QWORD *)this + 507) = v12;
  LODWORD(v13) = (*(int (__fastcall **)(_QWORD, signed __int64, _QWORD))(**((_QWORD **)this + 31) + 2312LL))(
                   *((_QWORD *)this + 31),
                   32LL,
                   0LL);
  *((_QWORD *)this + 508) = v13;
  if ( !v13 )
  {
    v16 = (__int64)"%s: Couldn't map ISP registers\n";
    goto LABEL_69;
  }
  LODWORD(v14) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v13 + 280LL))(v13);
  *((_QWORD *)this + 509) = v14;
  (*(void (__fastcall **)(_QWORD, signed __int64))(**((_QWORD **)this + 31) + 2248LL))(*((_QWORD *)this + 31), 1LL);
  AppleCamIn::init_s2_pcie_link(this);
  IOLog("%s: about to configure DDR\n");
  if ( PE_parse_boot_argn("camDDRmodel", (char *)this + 140, 4LL) )
  {
    v15 = *((_DWORD *)this + 35);
    IOLog("AppleCamIn::start - S2 DDR model set to 0x%08x using boot-arg \n");
  }
  else
  {
    *((_DWORD *)this + 35) = 4;
    *(_DWORD *)(*((_QWORD *)this + 505) + 4352LL) = 515;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 4356LL) = 515;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 4360LL) = 515;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 4364LL) = 515;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 4368LL) = 515;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 4372LL) = 515;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 4376LL) = 515;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 4380LL) = 515;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  }
  v17 = (char *)this + 240;
  if ( PE_parse_boot_argn("camDDRfreq", (char *)this + 240, 4LL) )
  {
    v18 = *(_DWORD *)v17;
    v19 = (__int64)"AppleCamIn::start - S2 DDR Frequency set to %d MHz using boot-arg \n";
  }
  else
  {
    *(_DWORD *)v17 = 450;
    v19 = (__int64)"AppleCamIn::start - S2 DDR Frequency set to %d MHz (default) \n";
  }
  IOLog(v19);
  if ( (unsigned int)AppleCamIn::s2_init_ddr_controller_soc(v3) )
  {
    v16 = (__int64)"%s: S2 DDR Initialization failed\n";
    goto LABEL_69;
  }
  memcpy(&v84, &unk_11C00, 0x3F8uLL);
  *((_QWORD *)v3 + 19) = 127LL;
  LODWORD(v20) = IOMalloc(1016LL, &unk_11C00);
  *((_QWORD *)v3 + 18) = v20;
  if ( !v20 )
  {
    v16 = (__int64)"%s: Couldn't IOMalloc memory for DDR PHY register cache\n";
    goto LABEL_69;
  }
  memcpy(v20, &v84, 0x3F8uLL);
  *((_DWORD *)v3 + 40) = 0;
  if ( !(unsigned int)AppleCamIn::do_shmoo(v3) )
  {
    AppleCamIn::save_ddr_phy_regs(v3);
  }
  *(_DWORD *)(*((_QWORD *)v3 + 505) + 53512LL) = 8;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v3 + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)v3 + 505) + 53508LL) = 12;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v3 + 31), 0LL, 0x12345678u);
  *(int *)((char *)&dword_40004 + *((_QWORD *)v3 + 509)) = 0;
  v83 = 0;
  if ( PE_parse_boot_argn("camLogging", &v83, 4LL) && v83 )
  {
    *((_DWORD *)v3 + 1005) = v83;
    IOLog("AppleCamIn::start - boot-args override of driver logging flags: %d\n");
  }
  else
  {
    *((_DWORD *)v3 + 1005) = 0;
  }
  v82 = 0;
  if ( PE_parse_boot_argn("camFWArg0", &v82, 4LL) && v82 )
  {
    *((_DWORD *)v3 + 1007) = v82;
    IOLog("AppleCamIn::start - FW boot-args 0: %d\n");
  }
  else
  {
    *((_DWORD *)v3 + 1007) = 0;
  }
  v81 = 0;
  v21 = PE_parse_boot_argn("camISPInitFailDebug", &v81, 4LL);
  v22 = v81;
  *((_BYTE *)v3 + 4024) = 1;
  if ( v21 && v22 )
  {
    IOLog("AppleCamIn::start - camISPInitFailDebug enabled\n");
  }
  v80 = 0;
  if ( PE_parse_boot_argn("camFWBufSize", &v80, 4LL) && (unsigned int)(v80 - 8388609) <= 0x77FFFFE )
  {
    *((_DWORD *)v3 + 176) = v80;
    IOLog("AppleCamIn::start - boot-args override of firmware buffer size: %d\n");
  }
  else
  {
    *((_DWORD *)v3 + 176) = 0x800000;
  }
  *((_QWORD *)v3 + 500) = *((_QWORD *)v3 + 507);
  v23 = (DeviceMemoryManager *)operator new(0x10uLL);
  DeviceMemoryManager::DeviceMemoryManager(v23, 0x8000000 - *((_DWORD *)v3 + 176), 0);
  *((_QWORD *)v3 + 499) = v23;
  if ( !v23 )
  {
    v16 = (__int64)"%s: Couldn't create pDeviceMemoryManager\n";
    goto LABEL_69;
  }
  bzero((char *)v3 + 720, 0x588uLL);
  *((_BYTE *)v3 + 738) = 0;
  *((_BYTE *)v3 + 739) = 0;
  *((_DWORD *)v3 + 989) = 0;
  *((_DWORD *)v3 + 990) = 0;
  *((_QWORD *)v3 + 496) = 0LL;
  *((_QWORD *)v3 + 497) = 0LL;
  *((_QWORD *)v3 + 79) = OSSet::withCapacity((OSSet *)((char *)&dword_0 + 1), 0x588u);
  *((_QWORD *)v3 + 80) = OSArray::withCapacity((OSArray *)((char *)&dword_0 + 1), 0x588u);
  *((_QWORD *)v3 + 81) = OSSet::withCapacity((OSSet *)((char *)&dword_0 + 1), 0x588u);
  *((_BYTE *)v3 + 656) = 0;
  *((_BYTE *)v3 + 682) = 0;
  *((_DWORD *)v3 + 40) = 0;
  bzero((char *)v3 + 2168, 0x6F0uLL);
  *((_BYTE *)v3 + 680) = 0;
  *((_BYTE *)v3 + 681) = 0;
  *((_QWORD *)v3 + 39) = 0LL;
  *((_DWORD *)v3 + 80) = 0;
  *((_DWORD *)v3 + 146) = 0;
  *((_QWORD *)v3 + 74) = 0LL;
  *((_DWORD *)v3 + 150) = 0;
  *((_DWORD *)v3 + 151) = 0;
  *((_DWORD *)v3 + 152) = 0;
  *((_DWORD *)v3 + 153) = 0;
  *((_DWORD *)v3 + 154) = 0;
  *((_DWORD *)v3 + 156) = 0;
  *((_DWORD *)v3 + 155) = 0;
  *((_QWORD *)v3 + 83) = 0LL;
  *((_QWORD *)v3 + 84) = 0LL;
  *((_BYTE *)v3 + 204) = 0;
  *((_DWORD *)v3 + 52) = 0;
  *((_QWORD *)v3 + 27) = 0LL;
  *((_QWORD *)v3 + 28) = 0LL;
  *((_QWORD *)v3 + 29) = 0LL;
  *((_BYTE *)v3 + 700) = 0;
  *((_BYTE *)v3 + 701) = 0;
  *((_DWORD *)v3 + 1002) = 0;
  *((_DWORD *)v3 + 1003) = 0;
  *((_BYTE *)v3 + 4016) = 0;
  *((_BYTE *)v3 + 4017) = 0;
  *((_BYTE *)v3 + 192) = 0;
  *((_DWORD *)v3 + 49) = 0;
  *((_DWORD *)v3 + 50) = 0;
  *((_DWORD *)v3 + 171) = 1;
  *((_DWORD *)v3 + 173) = 0;
  *((_DWORD *)v3 + 172) = 1;
  *((_DWORD *)v3 + 174) = 0;
  *((_QWORD *)v3 + 267) = 0LL;
  *((_QWORD *)v3 + 268) = 0LL;
  *((_QWORD *)v3 + 493) = 0LL;
  *((_DWORD *)v3 + 988) = 0;
  *((_QWORD *)v3 + 269) = 0LL;
  *((_QWORD *)v3 + 270) = 0LL;
  v24 = (IOMMUManager *)operator new(0x10uLL);
  IOMMUManager::IOMMUManager(v24, 4096, 0);
  *((_QWORD *)v3 + 498) = v24;
  if ( !v24 )
  {
    v16 = (__int64)"%s: Couldn't create IOMMUMapper\n";
    goto LABEL_69;
  }
  v26 = (IOService *)IOService::nameMatching("IOSurfaceRoot", 0LL, v25);
  v28 = IOService::waitForService(v26, 0LL, v27);
  *((_QWORD *)v3 + 36) = v28;
  if ( !v28 )
  {
    v16 = (__int64)"%s: IOSurfaceRoot not available or of the wrong class\n";
    goto LABEL_69;
  }
  (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v28 + 32LL))(v28, 0LL);
  v29 = OSDictionary::withCapacity((OSDictionary *)((char *)&dword_4 + 3), 0);
  v31 = OSNumber::withNumber((OSNumber *)&stru_68.segname[8], 0x20uLL, v30);
  (*(void (__fastcall **)(__int64, _QWORD, __int64))(*(_QWORD *)v29 + 464LL))(v29, "IOSurfaceWidth", v31);
  (*(void (__fastcall **)(__int64))(*(_QWORD *)v31 + 40LL))(v31);
  v33 = OSNumber::withNumber((OSNumber *)stru_1F0.segname, 0x20uLL, v32);
  (*(void (__fastcall **)(__int64, _QWORD, __int64))(*(_QWORD *)v29 + 464LL))(v29, "IOSurfaceHeight", v33);
  (*(void (__fastcall **)(__int64))(*(_QWORD *)v33 + 40LL))(v33);
  v35 = OSNumber::withNumber((OSNumber *)&stru_68.segname[8], 0x20uLL, v34);
  (*(void (__fastcall **)(__int64, _QWORD, __int64))(*(_QWORD *)v29 + 464LL))(v29, "IOSurfaceBytesPerRow", v35);
  (*(void (__fastcall **)(__int64))(*(_QWORD *)v35 + 40LL))(v35);
  v37 = OSNumber::withNumber((OSNumber *)"dress 0x%08X)\n", 0x20uLL, v36);
  (*(void (__fastcall **)(_QWORD, _QWORD, __int64))(*(_QWORD *)v29 + 464LL))(v29, "IOSurfaceAllocSize", v37);
  (*(void (__fastcall **)(__int64))(*(_QWORD *)v37 + 40LL))(v37);
  v38 = OSString::withCString("yuvs", "IOSurfaceAllocSize");
  (*(void (__fastcall **)(_QWORD, _QWORD, __int64))(*(_QWORD *)v29 + 464LL))(v29, "IOSurfacePixelFormat", v38);
  (*(void (__fastcall **)(__int64))(*(_QWORD *)v38 + 40LL))(v38);
  (*(void (__fastcall **)(__int64, _QWORD, _QWORD))(*(_QWORD *)v29 + 464LL))(
    v29,
    "IOSurfaceIsGlobal",
    **(_QWORD **)off_12050[0]);
  LODWORD(v39) = (*(int (__fastcall **)(_QWORD, _QWORD, __int64))(**((_QWORD **)v3 + 36) + 2152LL))(
                   *((_QWORD *)v3 + 36),
                   *(_QWORD *)off_12058,
                   v29);
  *((_QWORD *)v3 + 89) = v39;
  (*(void (__fastcall **)(__int64))(*(_QWORD *)v29 + 40LL))(v29);
  v40 = *((_QWORD *)v3 + 89);
  if ( !v40 )
  {
    v16 = (__int64)"%s: Could not create IOSurface for ISPCPU firmware logging buffer\n";
    goto LABEL_69;
  }
  LODWORD(v41) = (*(int (**)(void))(*(_QWORD *)v40 + 368LL))();
  LODWORD(v42) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v41 + 512LL))(v41, 0LL);
  LODWORD(v43) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v42 + 280LL))(v42);
  v44 = v43;
  bzero(v43, 0x10000uLL);
  (*(void (__fastcall **)(_QWORD, _QWORD, _QWORD))(**((_QWORD **)v3 + 89) + 320LL))(*((_QWORD *)v3 + 89), 0LL, 0LL);
  *(_QWORD *)v44 = 128LL;
  *((_QWORD *)v44 + 1) = 128LL;
  v45 = (IOWorkLoop *)*((_QWORD *)v3 + 89);
  (*(void (__fastcall **)(IOWorkLoop *, _QWORD, _QWORD))(*(_QWORD *)v45 + 328LL))(v45, 0LL, 0LL);
  v46 = IOWorkLoop::workLoop(v45);
  *((_QWORD *)v3 + 34) = v46;
  if ( !v46 )
  {
    v16 = (__int64)"%s: Could not create camera driver work-loop\n";
    goto LABEL_69;
  }
  LODWORD(v47) = (*(int (__fastcall **)(AppleCamIn *))(*(_QWORD *)v3 + 1672LL))(v3);
  *((_QWORD *)v3 + 38) = IOCommandPool::withWorkLoop(v47, 0LL);
  v48 = 32;
  do
  {
    LODWORD(v49) = IODMACommand::withSpecification(off_12010[0], 44LL, 0LL, 64LL, 0LL, 0LL);
    (*(void (__fastcall **)(_QWORD, __int64))(**((_QWORD **)v3 + 38) + 304LL))(*((_QWORD *)v3 + 38), v49);
    --v48;
  }
  while ( v48 );
  v51 = IOCommandGate::commandGate(v3, 0LL, v50);
  *((_QWORD *)v3 + 35) = v51;
  if ( !v51 )
  {
    v16 = (__int64)"%s: Couldn't create command gate\n";
    goto LABEL_69;
  }
  LODWORD(v52) = (*(int (__fastcall **)(AppleCamIn *, _QWORD))(*(_QWORD *)v3 + 1672LL))(v3, 0LL);
  if ( (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v52 + 320LL))(v52, *((_QWORD *)v3 + 35)) )
  {
    v16 = (__int64)"%s: Couldn't add command gate to work loop.\n";
    goto LABEL_69;
  }
  *((_QWORD *)v3 + 37) = 0LL;
  v79 = 0;
  v53 = 0;
  v54 = 0LL;
  if ( (*(int (__fastcall **)(_QWORD, _QWORD, int *))(**((_QWORD **)v3 + 31) + 1800LL))(*((_QWORD *)v3 + 31), 0LL, &v79) )
  {
    goto LABEL_85;
  }
  v76 = 0;
  v57 = 1;
  v74 = 0;
  LODWORD(v55) = 0;
  do
  {
    if ( !(v79 & 0x10000) )
    {
      LODWORD(v55) = v57 - 1;
    }
    v75 = v55;
    if ( v79 & 0x10000 )
    {
      v74 = 1;
    }
    v58 = v76;
    if ( v79 & 0x10000 )
    {
      v58 = v57 - 1;
    }
    v76 = v58;
    v54 = (__int64 (__fastcall *)(AppleCamIn *))(unsigned int)v57;
    v59 = (*(int (__fastcall **)(_QWORD, _QWORD, int *))(**((_QWORD **)v3 + 31) + 1800LL))(
            *((_QWORD *)v3 + 31),
            (unsigned int)v57++,
            &v79);
    v55 = v75;
  }
  while ( !v59 );
  v53 = v75;
  if ( !(v74 & 1) )
  {
LABEL_85:
    v60 = *((_QWORD *)v3 + 37);
  }
  else
  {
    v54 = AppleCamIn::ispInterruptHandler;
    LODWORD(v60) = IOFilterInterruptEventSource::filterInterruptEventSource(
                     v3,
                     AppleCamIn::ispInterruptHandler,
                     AppleCamIn::ispInterruptHandlerFilter,
                     v2,
                     (unsigned int)v76);
    *((_QWORD *)v3 + 37) = v60;
  }
  v61 = v53;
  if ( !v60 )
  {
    v54 = AppleCamIn::ispInterruptHandler;
    LODWORD(v62) = IOFilterInterruptEventSource::filterInterruptEventSource(
                     v3,
                     AppleCamIn::ispInterruptHandler,
                     AppleCamIn::ispInterruptHandlerFilter,
                     v2,
                     v53);
    *((_QWORD *)v3 + 37) = v62;
    if ( !v62 )
    {
      goto LABEL_72;
    }
  }
  LODWORD(v63) = (*(int (__fastcall **)(AppleCamIn *, __int64 (__fastcall *)(AppleCamIn *), __int64, __int64, __int64))(*(_QWORD *)v3 + 1672LL))(
                   v3,
                   v54,
                   v55,
                   v56,
                   v61);
  if ( (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v63 + 320LL))(v63, *((_QWORD *)v3 + 37)) )
  {
    v16 = (__int64)"%s: Couldn't add interrupt event source to work loop\n";
    goto LABEL_69;
  }
  AppleCamIn::initACPI(v3);
  v65 = *(_QWORD *)off_12048[0];
  (*(void (__fastcall **)(_QWORD, _QWORD, _QWORD))(**((_QWORD **)v3 + 31) + 616LL))(
    *((_QWORD *)v3 + 31),
    "IOPMPCIConfigSpaceVolatile",
    **(_QWORD **)off_12048[0]);
  LODWORD(v66) = (*(int (__fastcall **)(_QWORD))(**((_QWORD **)v3 + 31) + 1664LL))(*((_QWORD *)v3 + 31));
  v67 = *(char **)off_12000[0];
  v69 = OSMetaClassBase::safeMetaCast(v66, *(const OSMetaClassBase **)off_12000[0], v68);
  if ( v69 )
  {
    LODWORD(v70) = (*(int (__fastcall **)(__int64, char *))(*(_QWORD *)v69 + 1664LL))(v69, v67);
    v67 = (char *)v7;
    v72 = (IOPCIDevice *)OSMetaClassBase::safeMetaCast(v70, v7, v71);
    *((_QWORD *)v3 + 32) = v72;
  }
  else
  {
    v72 = (IOPCIDevice *)*((_QWORD *)v3 + 32);
  }
  if ( v72 )
  {
    *((_WORD *)v3 + 132) = IOPCIDevice::extendedConfigRead32(v72, 0LL);
    v78 = 0;
    (*(void (__fastcall **)(_QWORD, signed __int64, char *))(**((_QWORD **)v3 + 32) + 2272LL))(
      *((_QWORD *)v3 + 32),
      16LL,
      &v78);
    if ( v78 >= 0x40u )
    {
      *((_BYTE *)v3 + 266) = v78 + 16;
      IOLog("AppleCamIn::start - link control offset in PCI bridge = 0x%x\n");
    }
    v77 = 0;
    (*(void (__fastcall **)(_QWORD, signed __int64, char *))(**((_QWORD **)v3 + 32) + 2272LL))(
      *((_QWORD *)v3 + 32),
      1LL,
      &v77);
    if ( v77 >= 0x40u )
    {
      *((_BYTE *)v3 + 267) = v77 + 4;
      IOLog("AppleCamIn::start - pmcsr offset in PCI bridge = 0x%x\n");
    }
    v67 = "IOPMPCIConfigSpaceVolatile";
    (*(void (__fastcall **)(_QWORD, _QWORD, _QWORD))(**((_QWORD **)v3 + 32) + 616LL))(
      *((_QWORD *)v3 + 32),
      "IOPMPCIConfigSpaceVolatile",
      *(_QWORD *)v65);
  }
  AppleCamIn::power_off_hardware(v3, v67);
  IOLog("AppleCamIn::initForPM\n");
  (*(void (__fastcall **)(AppleCamIn *))(*(_QWORD *)v3 + 1936LL))(v3);
  (*(void (__fastcall **)(IOService *, AppleCamIn *))(*(_QWORD *)v2 + 1952LL))(v2, v3);
  (*(void (__fastcall **)(AppleCamIn *, AppleCamIn *, _UNKNOWN *, signed __int64))(*(_QWORD *)v3 + 1960LL))(
    v3,
    v3,
    &AppleS2CamInPowerStates,
    2LL);
  LODWORD(v73) = registerPrioritySleepWakeInterest(AppleCamIn::systemWakeCall, v3, 0LL);
  *((_QWORD *)v3 + 512) = v73;
  (*(void (__fastcall **)(_QWORD, AppleCamIn *))(**((_QWORD **)v3 + 35) + 336LL))(*((_QWORD *)v3 + 35), v3);
  (*(void (__fastcall **)(AppleCamIn *, _QWORD))(*(_QWORD *)v3 + 1456LL))(v3, 0LL);
  v5 = 1;
LABEL_70:
  while ( *(_QWORD *)v4 != v85 )
  {
LABEL_72:
    v5 = 0;
    IOLog("%s: Setting up interrupt event source failed\n");
  }
  return v5;
}
// 0: using guessed type int dword_0;
// 4: using guessed type int dword_4;
// 68: using guessed type section_64 stru_68;
// 1F0: using guessed type section_64 stru_1F0;
// 12000: using guessed type _QWORD off_12000[12];
// 12008: using guessed type _QWORD off_12008[11];
// 12010: using guessed type __int64 off_12010[10];
// 12038: using guessed type __int64 off_12038[5];
// 12040: using guessed type __int64 off_12040[4];
// 12048: using guessed type __int64 off_12048[3];
// 12050: using guessed type __int64 off_12050[2];
// 12058: using guessed type __int64 off_12058;
// 40004: using guessed type int dword_40004;
// B6390: using guessed type int __fastcall IOLog(_QWORD);
// B6398: using guessed type int __fastcall IOMalloc(_QWORD, _QWORD);
// B63A8: using guessed type int __fastcall PE_parse_boot_argn(_QWORD, _QWORD, _QWORD);
// B6430: using guessed type int __fastcall IODMACommand::withSpecification(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// B6740: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);
// B6780: using guessed type int __fastcall IOFilterInterruptEventSource::filterInterruptEventSource(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// B6F70: using guessed type int __fastcall registerPrioritySleepWakeInterest(_QWORD, _QWORD, _QWORD);

//----- (0000000000001C12) ----------------------------------------------------
__int64 __fastcall AppleCamIn::init_s2_pcie_link(AppleCamIn *this)
{
  AppleCamIn *v1; // rbx@1
  __int64 v2; // rdi@3

  v1 = this;
  *(_DWORD *)(*((_QWORD *)this + 505) + 53248LL) |= 0x10u;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 505) + 53536LL) = 6148;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 505) + 53540LL) = 11294720;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 505) + 53536LL) = 6148;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  if ( *((_BYTE *)this + 4020) & 0x40 )
  {
    if ( *(_DWORD *)(*((_QWORD *)this + 505) + 53540LL) == 11294720 )
    {
      v2 = (__int64)"%s: SERDES PLL powered-down when S2 PCIe link is in L1 : 0x%08x\n";
    }
    else
    {
      v2 = (__int64)"%s: ERROR: SERDES PLL state is not configured correctly: 0x%08x\n";
    }
    IOLog(v2);
  }
  *(_DWORD *)(*((_QWORD *)v1 + 505) + 53544LL) = 7944;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v1 + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)v1 + 505) + 53548LL) = -2147449328;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v1 + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)v1 + 505) + 53544LL) = 5640;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v1 + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)v1 + 505) + 53548LL) = -2147419136;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v1 + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)v1 + 505) + 53544LL) = 7944;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v1 + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)v1 + 505) + 53548LL) = -2147449328;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v1 + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)v1 + 505) + 53544LL) = 5896;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v1 + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)v1 + 505) + 53548LL) = -2147482177;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v1 + 31), 0LL, 0x12345678u);
  return 0LL;
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (0000000000001E1A) ----------------------------------------------------
__int64 __fastcall AppleCamIn::s2_init_ddr_controller_soc(AppleCamIn *this)
{
  __int64 v1; // rdx@4
  __int64 v2; // rax@5
  int v3; // ebx@5
  unsigned int v4; // ebx@5
  unsigned int v5; // er14@10
  __int64 v6; // rsi@12
  __int64 v7; // rax@14
  int v8; // ebx@14
  __int64 v9; // rdi@16
  unsigned int v10; // ebx@17
  int v11; // eax@18
  unsigned int v12; // ebx@21
  __int64 v13; // rsi@21
  __int64 v14; // rax@23
  signed int v15; // ebx@26
  signed int v16; // ecx@28
  __int64 v17; // rax@30
  unsigned int v18; // ebx@33
  __int64 v19; // rsi@33
  int v21; // ecx@40
  char v22; // r14@42
  uint64_t v23; // rax@42
  __int64 v24; // rdx@45
  unsigned int v25; // er13@46
  signed int v26; // esi@50
  __int64 v27; // rsi@52
  signed int v28; // ebx@55
  int v29; // ecx@56
  int v30; // edx@62
  signed int v31; // ebx@63
  int v32; // eax@64
  unsigned int v33; // er14@71
  bool v34; // bl@71
  unsigned int v35; // er13@71
  signed int v36; // ebx@72
  int v37; // eax@73
  unsigned int v38; // er13@78
  unsigned int v39; // er13@81
  __int64 v40; // rax@81
  unsigned int v41; // ecx@81
  unsigned int v42; // eax@82
  int v43; // eax@89
  uint64_t v44; // rax@94
  unsigned int v45; // ebx@95
  __int64 v46; // rsi@95
  __int64 v47; // rax@100
  __int64 v48; // rcx@100
  signed int v49; // ecx@100
  uint64_t v50; // [sp+8h] [bp-48h]@44
  char v51; // [sp+10h] [bp-40h]@67
  unsigned int v52; // [sp+18h] [bp-38h]@71
  __int64 v53; // [sp+20h] [bp-30h]@94

  if ( *((_BYTE *)this + 4020) & 0x80 )
  {
    IOLog("%s: Initialize S2 SOC DDR Controller for 16 bits memory device and 16-bit bus width\n");
  }
  if ( !(IOPCIDevice::extendedConfigRead32(*((IOPCIDevice **)this + 31), 4uLL) & 7) )
  {
    IOLog("%s: ERROR: S2 PCIe link has illegally transitioned through the DL_INACTIVE state\n");
    IOLog("%s: kIOPCIConfigCommand register  = 0x%08x\n");
    v1 = *(_DWORD *)(*((_QWORD *)this + 509) + 798720LL);
    IOLog("%s: ISP Register Read rISP_IGP0RR = 0x%08x ");
  }
  v2 = *((_QWORD *)this + 505);
  v3 = *(_DWORD *)(v2 + 156);
  *(_DWORD *)(v2 + 156) &= 0xFFFFFCFF;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 505) + 156LL) = v3 | 0x300;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  v4 = AppleCamIn::s2_pll_init(this, *((_DWORD *)this + 60));
  if ( !v4 )
  {
    *(_DWORD *)(*((_QWORD *)this + 505) + 168LL) = 641;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 156LL) = 0xFFFFF;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    IODelay(10000LL, 0LL);
    *(_DWORD *)(*((_QWORD *)this + 505) + 156LL) = 1047551;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    if ( *((_BYTE *)this + 4020) & 0x80 )
    {
      IOLog("%s: DDR PHY Soft Reset done\n");
    }
    *(_DWORD *)(*((_QWORD *)this + 505) + 11172LL) = 2;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 11176LL) = 2;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    if ( *((_BYTE *)this + 4020) & 0x80 )
    {
      IOLog("%s: Disable the HW freq change function\n");
    }
    *(_DWORD *)(*((_QWORD *)this + 505) + 8440LL) = 1012;
    v5 = 0;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    if ( *((_BYTE *)this + 4020) & 0x80 )
    {
      IOLog("%s: Setup the PLL\n");
    }
    *(_DWORD *)(*((_QWORD *)this + 505) + 9268LL) = 64;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 9272LL) = 0x10000000;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 9252LL) = 4;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 9264LL) = 32731649;
    v6 = 0LL;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    if ( *((_BYTE *)this + 4020) & 0x80 )
    {
      v6 = (__int64)"s2_init_ddr_controller_soc";
      v5 = 0;
      IOLog("%s: Polling for DDR PLL lock\n");
    }
    while ( 1 )
    {
      v7 = *((_QWORD *)this + 505);
      v8 = *(_DWORD *)(v7 + 9284);
      if ( BYTE1(v8) & 0x20 )
      {
        break;
      }
      IODelay(10LL, v6);
      ++v5;
      if ( v5 >= 0x2711 )
      {
        v9 = (__int64)"%s:Timeout, PLL DDR_F_PLL_LOCK_MASK. DDR_R_DDR3CTL_PLL_STATUS_MEMADDR == 0x%08x  (looking for 0x%08x)\n";
LABEL_38:
        IOLog(v9);
        return -536870186;
      }
    }
    *(_DWORD *)(v7 + 9264) = 32731653;
    v10 = 0;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    while ( 1 )
    {
      v11 = *(_DWORD *)(*((_QWORD *)this + 505) + 9244LL);
      if ( BYTE1(v11) & 4 )
      {
        break;
      }
      IODelay(10LL, 0LL);
      ++v10;
      if ( v10 >= 0x2711 )
      {
        v9 = (__int64)"%s: Timeout, PLL DDR_F_IOB2MC_PHY_PWRUP_RSB_MASK. DDR_R_DDR3CTL_PHY_STATUS_MEMADDR == 0x%08x  (looking for 0x%08x)\n";
        goto LABEL_38;
      }
    }
    IODelay(10000LL, 0LL);
    *(_DWORD *)(*((_QWORD *)this + 505) + 10268LL) = 3088;
    v12 = 0;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 10260LL) = 16;
    v13 = 0LL;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    if ( *((_BYTE *)this + 4020) & 0x80 )
    {
      v13 = (__int64)"s2_init_ddr_controller_soc";
      v12 = 0;
      IOLog("%s: Wait for PHY PLL lock\n");
    }
    while ( 1 )
    {
      v14 = *((_QWORD *)this + 505);
      if ( *(_DWORD *)(v14 + 10256) & 1 )
      {
        break;
      }
      IODelay(10LL, v13);
      ++v12;
      if ( v12 >= 0x2711 )
      {
        v9 = (__int64)"%s: Timeout waiting for DDR_R_DDR40_PHY_ADDR_CTL_PLL_STATUS_MEMADDR, DDR_R_DDR40_PHY_ADDR_CTL_PLL_STATUS_MEMADDR=0x%08x, looking for %08x \n";
        goto LABEL_38;
      }
    }
    v15 = 69533890;
    if ( *((_DWORD *)this + 35) == 4 )
    {
      v15 = 74055874;
    }
    *(_DWORD *)(v14 + 8352) = 276002117;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 8356LL) = 308556147;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 8360LL) = 65343;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 8368LL) = v15;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 8472LL) = 4127;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 10272LL) = 448;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    v16 = 34952536;
    if ( *((_DWORD *)this + 35) == 4 )
    {
      v16 = 34968856;
    }
    *(_DWORD *)(*((_QWORD *)this + 505) + 10416LL) = v16;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    v17 = *((_QWORD *)this + 505);
    if ( *((_DWORD *)this + 60) == 450 )
    {
      *(_DWORD *)(v17 + 10420) = 1082119;
    }
    else
    {
      *(_DWORD *)(v17 + 10420) = 1081990;
    }
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 10416LL) = 34968921;
    v18 = 0;
    v19 = 0LL;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    if ( *((_BYTE *)this + 4020) & 0x80 )
    {
      v19 = (__int64)"s2_init_ddr_controller_soc";
      v18 = 0;
      IOLog("%s: Polling for STRAP valid\n");
    }
    while ( !(*(_DWORD *)(*((_QWORD *)this + 505) + 10424LL) & 1) )
    {
      IODelay(10LL, v19);
      ++v18;
      if ( v18 >= 0x2711 )
      {
        v9 = (__int64)"%s: Timeout, PLL DDR_F_STRAPS_VALID_1_MASK. DDR_R_DDR40_PHY_ADDR_CTL_STRAP_STATUS_MEMADDR == 0x%08x, looking for 0x%08x\n";
        goto LABEL_38;
      }
    }
    v21 = *((_DWORD *)this + 1005);
    if ( v21 & 0x80 )
    {
      IOLog("%s: Preparing for MANUAL INIT\n");
      v21 = *((_DWORD *)this + 1005);
    }
    v22 = 0;
    v23 = 0LL;
    if ( v21 & 0x88 )
    {
      IOLog("%s: Manual ddr40_phy_init\n");
      v23 = mach_absolute_time();
      v21 = *((_DWORD *)this + 1005);
      v22 = 1;
    }
    v50 = v23;
    if ( v21 & 0x80 )
    {
      v24 = *((_DWORD *)this + 60);
      IOLog("%s: DDR frequency %d MHz\n");
      v21 = *((_DWORD *)this + 1005);
    }
    v25 = *((_DWORD *)this + 60);
    if ( v21 & 0x80 )
    {
      IOLog("%s: Configuring DDR Controller PLLs\n");
      v21 = *((_DWORD *)this + 1005);
    }
    if ( v21 & 0x80 )
    {
      IOLog("%s: ddr_speed=%d offset = 0x%08x\n");
    }
    v26 = 2064;
    if ( (signed int)(2 * v25) >> 1 < 250 )
    {
      v26 = 8256;
    }
    *(_DWORD *)(*((_QWORD *)this + 505) + 10268LL) = *(_DWORD *)(*((_QWORD *)this + 505) + 10268LL) & 0xFFFFC700 | v26;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 10260LL) &= 0xFFFFFFFD;
    v27 = 0LL;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    if ( *((_BYTE *)this + 4020) & 0x80 )
    {
      v27 = (__int64)"ddr40_phy_setup_pll";
      IOLog("%s: DDR Phy PLL polling for lock\n");
    }
    if ( *(_DWORD *)(*((_QWORD *)this + 505) + 10256LL) & 1 )
    {
      goto LABEL_105;
    }
    v28 = 101;
    do
    {
      IODelay(1LL, v27);
      v29 = v28-- - 2;
    }
    while ( v29 > 0 && !(*(_DWORD *)(*((_QWORD *)this + 505) + 10256LL) & 1) );
    if ( v28 >= 2 )
    {
LABEL_105:
      if ( *((_BYTE *)this + 4020) & 0x80 )
      {
        IOLog("%s: DDR Phy PLL locked.\n");
      }
      *(_DWORD *)(*((_QWORD *)this + 505) + 10312LL) = 0;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      *(_DWORD *)(*((_QWORD *)this + 505) + 10312LL) = 259;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      v30 = *(_DWORD *)(*((_QWORD *)this + 505) + 10316LL);
      if ( v30 & 1 )
      {
        goto LABEL_106;
      }
      v31 = 101;
      do
      {
        IODelay(1LL, 0LL);
        v30 = *(_DWORD *)(*((_QWORD *)this + 505) + 10316LL);
        v32 = v31-- - 2;
      }
      while ( v32 > 0 && !(v30 & 1) );
      if ( v31 > 1 )
      {
LABEL_106:
        if ( !(v30 & 2) )
        {
          IOLog("%s: DDR PHY VDL calibration complete but did not lock! Step = %d\n");
        }
        v51 = v22;
        *(_DWORD *)(*((_QWORD *)this + 505) + 10312LL) = 0;
        IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      }
      else
      {
        v51 = v22;
        IOLog("%s: DDR PHY VDL Calibration failed\n");
      }
      v52 = v25;
      v33 = 0xF4240 / v25;
      *(_DWORD *)(*((_QWORD *)this + 505) + 10312LL) = 0;
      v34 = 0;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      *(_DWORD *)(*((_QWORD *)this + 505) + 10312LL) = 512;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      v35 = *(_DWORD *)(*((_QWORD *)this + 505) + 10316LL);
      if ( !(v35 & 1) )
      {
        v36 = 1001;
        do
        {
          IODelay(1LL, 0LL);
          v35 = *(_DWORD *)(*((_QWORD *)this + 505) + 10316LL);
          v37 = v36-- - 2;
        }
        while ( v37 > 0 && !(v35 & 1) );
        v34 = v36 < 2;
      }
      if ( v34 || !(v35 & 2) )
      {
        IOLog("%s: DDR PHY using default calibration step size\n");
        v38 = v33 / 0xD;
        v22 = v51;
      }
      else
      {
        v38 = (v35 >> 2) & 0x3FF;
        v22 = v51;
        if ( *((_BYTE *)this + 4020) & 0x80 )
        {
          IOLog("%s: DDR PHY using %d calibration steps, \n");
        }
      }
      *((_DWORD *)this + 549) = v38;
      v39 = v38 >> 4;
      v40 = *((_QWORD *)this + 505);
      v41 = *(_DWORD *)(v40 + 10324);
      if ( !(v41 & 2) )
      {
        *(_DWORD *)(v40 + 10292) = (v41 >> 8) & 0x3F | 0x10100;
        IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
        v42 = 0x10000;
        if ( 3 * v39 >= 0xB )
        {
          v42 = ((3 * v39 + 118) >> 1) & 0x3F | 0x10000;
        }
        *(_DWORD *)(*((_QWORD *)this + 505) + 10288LL) = v42;
        IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      }
      if ( *((_BYTE *)this + 4020) & 0x80 )
      {
        IOLog("%s: Virtual VttSetup on   connect=0x%08x, override=0x%08x\n");
      }
      *(_DWORD *)(*((_QWORD *)this + 505) + 10340LL) = 30375935;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      *(_DWORD *)(*((_QWORD *)this + 505) + 10344LL) = 491519;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      *(_DWORD *)(*((_QWORD *)this + 505) + 10332LL) = 4;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      if ( *((_BYTE *)this + 4020) & 0x80 )
      {
        IOLog("%s: Virtual Vtt Enabled\n");
      }
      *(_DWORD *)(*((_QWORD *)this + 505) + 10300LL) = 790527;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      *(_DWORD *)(*((_QWORD *)this + 505) + 10304LL) = 2;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      *(_DWORD *)(*((_QWORD *)this + 505) + 11172LL) = 2;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      v43 = 4;
      if ( v52 >= 0x191 )
      {
        v43 = (v52 > 0x384) + 5;
      }
      *(_DWORD *)(*((_QWORD *)this + 505) + 11104LL) = v43;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      *(_DWORD *)(*((_QWORD *)this + 505) + 11108LL) = 2;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      *(_DWORD *)(*((_QWORD *)this + 505) + 11180LL) = 3;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      *(_DWORD *)(*((_QWORD *)this + 505) + 11168LL) &= 0xFF0FFFFF;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      IODelay(500LL, 0LL);
      if ( *((_BYTE *)this + 4020) & 0x80 )
      {
        IOLog("%s: DDR Controller PLL Configuration Complete\n");
      }
    }
    else
    {
      IOLog("%s: Timed out waiting for DDR Phy PLL to lock\n");
    }
    if ( v22 )
    {
      v44 = mach_absolute_time();
      absolutetime_to_nanoseconds(v44 - v50, &v53);
      IOLog("%s: Manual ddr40_phy_init completed - return status = 0x%x, execution time = %llu us\n");
    }
    *(_DWORD *)(*((_QWORD *)this + 505) + 8196LL) = 0;
    v45 = 0;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    IODelay(10000LL, 0LL);
    *(_DWORD *)(*((_QWORD *)this + 505) + 8212LL) = 43786;
    v46 = 0LL;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    if ( *((_BYTE *)this + 4020) & 0x80 )
    {
      v46 = (__int64)"s2_init_ddr_controller_soc";
      v45 = 0;
      IOLog("%s: Polling for BUSY\n");
    }
    while ( *(_DWORD *)(*((_QWORD *)this + 505) + 8216LL) & 1 )
    {
      IODelay(10LL, v46);
      ++v45;
      if ( v45 >= 0x2711 )
      {
        IOLog("%s: Timeout, DDR_R_CSR_DRAM_INIT_RESULT_MEMADDR == 0x%08x\n");
        return -536870186;
      }
    }
    IODelay(10000LL, v46);
    v47 = *((_QWORD *)this + 505);
    v48 = *(_DWORD *)(v47 + 10424);
    *(_DWORD *)(v47 + 12804) = 0;
    v4 = 0;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    v49 = 0xFFFFFFF;
    if ( *((_DWORD *)this + 35) == 4 )
    {
      v49 = 0x1FFFFFFF;
    }
    *(_DWORD *)(*((_QWORD *)this + 505) + 12808LL) = v49;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 12800LL) = 4160;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    AppleCamIn::ddr40_phy_rewrite_mode_registers(this);
    *(_DWORD *)(*((_QWORD *)this + 505) + 8212LL) = 0x20000;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + 8200LL) = 1;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  }
  return v4;
}
// B6370: using guessed type int __fastcall IODelay(_QWORD, _QWORD);
// B6390: using guessed type int __fastcall IOLog(_QWORD);
// B6EE8: using guessed type int __fastcall absolutetime_to_nanoseconds(_QWORD, _QWORD);

//----- (0000000000002D22) ----------------------------------------------------
__int64 __fastcall AppleCamIn::do_shmoo(AppleCamIn *this)
{
  int v1; // ecx@1
  char v2; // r12@1
  uint64_t v3; // rax@1
  signed int v4; // ecx@5
  bool v5; // cf@7
  int v6; // er14@8
  int v7; // er13@8
  int v8; // er15@8
  uint64_t v9; // rax@9
  signed int v10; // er12@10
  __int64 v11; // r8@20
  uint64_t v12; // rax@20
  char v14; // [sp+0h] [bp-50h]@8
  uint64_t v15; // [sp+10h] [bp-40h]@3
  __int64 v16; // [sp+18h] [bp-38h]@20
  __int64 v17; // [sp+20h] [bp-30h]@9

  v1 = *((_DWORD *)this + 1005);
  v2 = 0;
  v3 = 0LL;
  if ( v1 & 0x88 )
  {
    v3 = mach_absolute_time();
    v1 = *((_DWORD *)this + 1005);
    v2 = 1;
  }
  v15 = v3;
  if ( v1 & 0x80 )
  {
    IOLog("%s:\n");
  }
  *(_DWORD *)(*((_QWORD *)this + 505) + 10312LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 505) + 10312LL) = 512;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  v4 = 1;
  do
  {
    if ( *(_DWORD *)(*((_QWORD *)this + 505) + 10316LL) & 1 )
    {
      break;
    }
    v5 = (unsigned int)v4++ < 0x33;
  }
  while ( v5 );
  v6 = AppleCamIn::all_shmoo_rd_data_dly_FIFO(this, 10240, 0);
  AppleCamIn::all_shmoo_RE_byte_FIFO(this, 10240, 0);
  v7 = AppleCamIn::generic_shmoo_calib_rd_dqs(this, 10240, 0LL);
  AppleCamIn::generic_shmoo_calib_wr_dq(this, 10240, 0);
  AppleCamIn::generic_shmoo_calib_wr_dm(this, 10240);
  v8 = (unsigned __int64)AppleCamIn::generic_shmoo_calib_addr(this, 10240) | v6 | v7;
  *(_DWORD *)(*((_QWORD *)this + 505) + 11156LL) = 1;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  v14 = v2;
  if ( v2 )
  {
    v9 = mach_absolute_time();
    absolutetime_to_nanoseconds(v9 - v15, &v17);
    IOLog("%s: %30s status = 0x%08x\n");
    IOLog("%s: %30s status = 0x%08x\n");
    IOLog("%s: %30s status = 0x%08x\n");
    IOLog("%s: %30s status = 0x%08x\n");
    IOLog("%s: %30s status = 0x%08x\n");
    IOLog("%s: %30s status = 0x%08x\n");
    IOLog("%s: Shmoo completed - return status = 0x%x, execution time = %llu us\n");
  }
  v10 = -536870212;
  if ( !v8 )
  {
    if ( v14 )
    {
      v15 = mach_absolute_time();
    }
    if ( *((_BYTE *)this + 4020) & 0x80 )
    {
      IOLog("%s: Performing DDR DRAM check\n");
    }
    **((_DWORD **)this + 507) = 287454020;
    v10 = 0;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    if ( **((_DWORD **)this + 507) == 287454020 )
    {
      if ( *((_BYTE *)this + 4020) & 0x80 )
      {
        v10 = 0;
        IOLog("%s: DDR Memory Initialization PASSED!!!\n");
      }
    }
    else
    {
      IOLog("%s: ERROR: DDR Memory Initialization FAILED!!!\n");
      v10 = -536870212;
    }
    if ( v14 )
    {
      v11 = **((_DWORD **)this + 507);
      IOLog("%s: wrote DDR[0x%08x] <- 0x%08x :  Read back 0x%08x\n");
      v12 = mach_absolute_time();
      absolutetime_to_nanoseconds(v12 - v15, &v16);
      IOLog("%s: DDR DRAM check - return status = 0x%x, execution time = %llu us\n");
    }
  }
  return (unsigned int)v10;
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);
// B6EE8: using guessed type int __fastcall absolutetime_to_nanoseconds(_QWORD, _QWORD);

//----- (0000000000003084) ----------------------------------------------------
__int64 __fastcall AppleCamIn::save_ddr_phy_regs(AppleCamIn *this)
{
  __int64 v1; // rdx@1
  unsigned __int64 v2; // rbx@2
  __int64 v3; // rax@4
  __int64 v4; // rcx@4
  __int64 v5; // r8@4

  v1 = *((_QWORD *)this + 19);
  IOLog("%s: saving %lu DDR PHY shmoo-calibrated registers \n");
  if ( *((_QWORD *)this + 19) )
  {
    v2 = 0LL;
    do
    {
      *(_DWORD *)(*((_QWORD *)this + 18) + 8 * v2 + 4) = *(_DWORD *)(*((_QWORD *)this + 505)
                                                                   + (unsigned int)(*(_DWORD *)(*((_QWORD *)this + 18)
                                                                                              + 8 * v2)
                                                                                  + 10240));
      if ( *((_BYTE *)this + 4020) & 0x80 )
      {
        v3 = *((_QWORD *)this + 18);
        v4 = *(_DWORD *)(v3 + 8 * v2);
        v5 = *(_DWORD *)(v3 + 8 * v2 + 4);
        IOLog("%s: entry %03d:  ddr_phy_reg_offset=0x%08X, reg_value=0x%08X\n");
      }
      ++v2;
    }
    while ( v2 < *((_QWORD *)this + 19) );
  }
  *((_DWORD *)this + 40) = 1;
  return 0LL;
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (0000000000003144) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ispInterruptHandler(AppleCamIn *this)
{
  AppleCamIn *v1; // rbx@1
  int v2; // er14@3
  int v3; // ecx@4
  int v4; // eax@7
  int v5; // eax@9
  unsigned int v6; // eax@11
  __int64 v7; // r14@11
  __int64 v8; // rcx@12
  unsigned __int64 v9; // rdx@12
  int v10; // edi@12
  signed __int64 v11; // r15@13
  __int64 v12; // rdi@15
  __int64 v13; // rax@16
  __int64 v14; // rdx@16
  unsigned int v15; // er8@16
  int v17; // [sp+4h] [bp-3Ch]@6
  int v18; // [sp+8h] [bp-38h]@6
  unsigned int v19; // [sp+Ch] [bp-34h]@16
  unsigned int v20; // [sp+10h] [bp-30h]@14
  unsigned int v21; // [sp+14h] [bp-2Ch]@14

  v1 = this;
  if ( *((_BYTE *)this + 656) || *((_BYTE *)this + 681) )
  {
    v2 = *(int *)((char *)&dword_41000 + *((_QWORD *)this + 509));
    if ( v2 & 0xF0 )
    {
      v3 = 1;
      while ( (unsigned int)v3 < 0x1F5 )
      {
        v17 = v3;
        IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v1 + 31), 0x94uLL, 0);
        v18 = v2;
        *(int *)((char *)&dword_41024 + *((_QWORD *)v1 + 509)) = v2;
        IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v1 + 31), 0LL, 0x12345678u);
        IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v1 + 31), 0x90uLL, 0x200u);
        if ( v2 & 8 )
        {
          v4 = *(int *)((char *)&dword_42000 + *((_QWORD *)v1 + 509));
          if ( v4 & 2 )
          {
            ++*((_DWORD *)v1 + 49);
            *(int *)((char *)&dword_42000 + *((_QWORD *)v1 + 509)) = v4;
            IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v1 + 31), 0LL, 0x12345678u);
          }
          v5 = *(int *)((char *)&dword_42008 + *((_QWORD *)v1 + 509));
          if ( v5 & 2 )
          {
            ++*((_DWORD *)v1 + 50);
            *(int *)((char *)&dword_42008 + *((_QWORD *)v1 + 509)) = v5;
            IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v1 + 31), 0LL, 0x12345678u);
          }
        }
        v6 = *((_DWORD *)v1 + 146);
        LODWORD(v7) = 0;
        if ( v6 )
        {
          do
          {
            v7 = (unsigned int)v7;
            v8 = *((_QWORD *)v1 + 39);
            v9 = (unsigned __int64)(unsigned int)v7 << 8;
            v10 = v18;
            if ( _bittest((const unsigned int *)&v10, *(_DWORD *)(v8 + v9 + 68) + 4) )
            {
              v11 = v8 + v9 + 64;
              while ( 1 )
              {
                v12 = *((_QWORD *)v1 + v7 + 41);
                v13 = *(_DWORD *)v11 == 2 ? IOProcessorChannelUnidirectionalReceive(
                                              v12,
                                              (__int64)&v21,
                                              (__int64)&v20,
                                              (__int64)&v19) : IOProcessorChannelReceive(
                                                                 v12,
                                                                 (__int64)&v21,
                                                                 (__int64)&v20,
                                                                 (__int64)&v19);
                if ( (_DWORD)v13 )
                {
                  break;
                }
                if ( (_DWORD)v7 == *((_DWORD *)v1 + 150) )
                {
                  AppleCamIn::processSharedMallocRequest(v1, v13, v20, v21);
                }
                else if ( (_DWORD)v7 == *((_DWORD *)v1 + 151) )
                {
                  AppleCamIn::processDebugLoggingRequest(v1, v21, v14, v19);
                }
                else if ( (_DWORD)v7 == *((_DWORD *)v1 + 152) )
                {
                  (*(void (__fastcall **)(_QWORD, _QWORD, _QWORD))(**((_QWORD **)v1 + 35) + 488LL))(
                    *((_QWORD *)v1 + 35),
                    v21,
                    0LL);
                }
                else if ( (_DWORD)v7 == *((_DWORD *)v1 + 153) )
                {
                  AppleCamIn::processTargetToHostBufferNotification(v1, v21, v14, v19, v15);
                }
                else if ( (_DWORD)v7 == *((_DWORD *)v1 + 155) )
                {
                  AppleCamIn::processTargetToHostIOCommand(v1, v21, v20, v19);
                }
                else
                {
                  AppleCamIn::processCommandResponse(v1, v21);
                }
              }
              v6 = *((_DWORD *)v1 + 146);
            }
            LODWORD(v7) = v7 + 1;
          }
          while ( (unsigned int)v7 < v6 );
        }
        v3 = v17 + 1;
        v2 = *(int *)((char *)&dword_41000 + *((_QWORD *)v1 + 509));
        if ( !(v2 & 0xF0) )
        {
          goto LABEL_34;
        }
      }
      IOLog("AppleCamIn::ispInterruptHandler - stuck interrupt, bailing out of ISR. pending: 0x%08X\n");
    }
LABEL_34:
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v1 + 31), 0x94uLL, 0x200u);
  }
  else
  {
    IOLog("AppleCamIn::ispInterruptHandler occurred after powering down ISP!\n");
  }
  return 0LL;
}
// 41000: using guessed type int dword_41000;
// 41024: using guessed type int dword_41024;
// 42000: using guessed type int dword_42000;
// 42008: using guessed type int dword_42008;
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (00000000000033E8) ----------------------------------------------------
char AppleCamIn::ispInterruptHandlerFilter()
{
  return 1;
}

//----- (00000000000033F0) ----------------------------------------------------
__int64 __fastcall AppleCamIn::power_off_hardware(AppleCamIn *this, char *a2)
{
  signed __int64 v2; // rsi@3
  __int64 result; // rax@5

  IOLog("AppleCamIn::power_off_hardware\n");
  if ( *((_BYTE *)this + 656) )
  {
    AppleCamIn::ISP_deInit(this, a2);
  }
  v2 = 148LL;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0x94uLL, 0);
  (*(void (__fastcall **)(_QWORD, signed __int64))(**((_QWORD **)this + 37) + 344LL))(*((_QWORD *)this + 37), 148LL);
  AppleCamIn::DisableFHSi(this);
  if ( *((_BYTE *)this + 700) )
  {
    v2 = (signed __int64)"CameraActive";
    (*(void (__fastcall **)(AppleCamIn *, _QWORD, _QWORD))(*(_QWORD *)this + 632LL))(this, "CameraActive", 0LL);
    *((_BYTE *)this + 700) = 0;
  }
  IODelay(10LL, v2);
  result = AppleCamIn::DisableS2Chip(this);
  *((_BYTE *)this + 656) = 0;
  return result;
}
// B6370: using guessed type int __fastcall IODelay(_QWORD, _QWORD);
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (0000000000003488) ----------------------------------------------------
int __fastcall AppleCamIn::initForPM(AppleCamIn *this, IOService *a2)
{
  IOLog("AppleCamIn::initForPM\n");
  (*(void (__fastcall **)(AppleCamIn *))(*(_QWORD *)this + 1936LL))(this);
  (*(void (__fastcall **)(IOService *, AppleCamIn *))(*(_QWORD *)a2 + 1952LL))(a2, this);
  return (*(int (__fastcall **)(AppleCamIn *, AppleCamIn *, _UNKNOWN *, signed __int64))(*(_QWORD *)this + 1960LL))(
           this,
           this,
           &AppleS2CamInPowerStates,
           2LL);
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (00000000000034E0) ----------------------------------------------------
__int64 __fastcall AppleCamIn::systemWakeCall(AppleCamIn *this, void *a2, void *a3, __int64 a4, IOService *a5, void *a6)
{
  IOService *v6; // r12@1
  int v7; // ebx@1
  unsigned int v8; // er14@1
  unsigned __int64 v9; // rsi@1
  const OSMetaClass *v10; // rdx@1
  __int64 v11; // rax@1
  __int64 v12; // r15@1
  __int64 v13; // rdx@5
  __int64 v14; // rcx@5
  __int64 v15; // rdi@15
  __int64 v17; // [sp+8h] [bp-28h]@13

  v6 = a5;
  v7 = (signed int)a3;
  v8 = 0;
  IOLog("AppleCamIn::systemWakeCall - messageType = 0x%08lX\n");
  v9 = (unsigned __int64)&AppleCamIn::gMetaClass;
  v11 = OSMetaClassBase::safeMetaCast(this, (const OSMetaClassBase *)&AppleCamIn::gMetaClass, v10);
  v12 = v11;
  if ( !v11 )
  {
    v15 = (__int64)"AppleCamIn::systemWakeCall: pCamIn is not valid";
LABEL_17:
    IOLog(v15);
    return -536870212;
  }
  if ( v7 != -536870080 )
  {
    return v8;
  }
  if ( !v6 )
  {
    v15 = (__int64)"AppleCamIn::systemWakeCall: IOPMSystemCapabilityChangeParameters message argument is not valid";
    goto LABEL_17;
  }
  if ( *(_BYTE *)(v11 + 4020) & 0x40 )
  {
    v9 = *((_DWORD *)v6 + 2);
    v13 = *((_DWORD *)v6 + 4);
    v14 = *((_DWORD *)v6 + 5);
    IOLog("AppleCamIn::systemWakeCall - changeFlags=0x%08x fromCaps=0x%08x toCaps=0x%08x \n");
  }
  if ( *((_BYTE *)v6 + 8) & 3 && !(*((_BYTE *)v6 + 16) & 1) && *((_BYTE *)v6 + 20) & 1 )
  {
    if ( *(_BYTE *)(v12 + 4020) & 0x40 )
    {
      IOLog("AppleCamIn::systemWakeCall - believed to be a Wake/DarkWake event \n");
    }
    if ( !*(_BYTE *)(v12 + 656) && !*(_BYTE *)(v12 + 681) )
    {
      (*(void (__fastcall **)(__int64, unsigned __int64))(*(_QWORD *)v12 + 32LL))(v12, v9);
      (*(void (**)(void))(**(_QWORD **)(v12 + 280) + 32LL))();
      if ( kernel_thread_start(AppleCamIn::wakeEventHandlerThread, v12, &v17) )
      {
        (*(void (__fastcall **)(_QWORD, __int64))(**(_QWORD **)(v12 + 280) + 40LL))(*(_QWORD *)(v12 + 280), v12);
        (*(void (__fastcall **)(__int64))(*(_QWORD *)v12 + 40LL))(v12);
      }
      else
      {
        thread_deallocate(v17);
      }
    }
  }
  return v8;
}
// A6488: using guessed type _QWORD AppleCamIn::gMetaClass;
// B6390: using guessed type int __fastcall IOLog(_QWORD);
// B6740: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);
// B6F50: using guessed type int __fastcall kernel_thread_start(_QWORD, _QWORD, _QWORD);
// B6F88: using guessed type int __fastcall thread_deallocate(_QWORD);

//----- (000000000000362E) ----------------------------------------------------
int __fastcall AppleCamIn::wakeEventHandlerThread(AppleCamIn *this, void *a2)
{
  AppleCamIn *v2; // rbx@1

  v2 = this;
  IOLog("AppleCamIn::wakeEventHandlerThread\n");
  IOSleep(5000LL);
  (*(void (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleCamIn *), _QWORD, _QWORD, _QWORD, _QWORD))(**((_QWORD **)v2 + 35) + 456LL))(
    *((_QWORD *)v2 + 35),
    AppleCamIn::handleWakeEvent_gated,
    0LL,
    0LL,
    0LL,
    0LL);
  (*(void (__cdecl **)(_QWORD))(**((_QWORD **)v2 + 35) + 40LL))(*((_QWORD *)v2 + 35));
  return (*(int (__fastcall **)(AppleCamIn *))(*(_QWORD *)this + 40LL))(this);
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);
// B63A0: using guessed type int __fastcall IOSleep(_QWORD);

//----- (000000000000368C) ----------------------------------------------------
__int64 __fastcall AppleCamIn::handleWakeEvent_gated(AppleCamIn *this)
{
  unsigned int v1; // edx@1

  IOLog("AppleCamIn::handleWakeEvent_gated\n");
  if ( !*((_BYTE *)this + 656) && !*((_BYTE *)this + 681) )
  {
    AppleCamIn::acpiControlS2ChipPower(this, 0, v1);
    IOSleep(250LL);
  }
  return 0LL;
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);
// B63A0: using guessed type int __fastcall IOSleep(_QWORD);

//----- (00000000000036D2) ----------------------------------------------------
int __fastcall AppleCamIn::free(AppleCamIn *this)
{
  IOLog("AppleCamIn::free\n");
  return (*(int (__fastcall **)(AppleCamIn *))(off_12038[0] + 160))(this);
}
// 12038: using guessed type __int64 off_12038[5];
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (0000000000003700) ----------------------------------------------------
int __fastcall AppleCamIn::probe(AppleCamIn *this, IOService *a2, int *a3)
{
  int *v3; // r14@1

  v3 = a3;
  IOLog("AppleCamIn::probe\n");
  return (*(int (__fastcall **)(AppleCamIn *, IOService *, int *))(off_12038[0] + 1480))(this, a2, v3);
}
// 12038: using guessed type __int64 off_12038[5];
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (0000000000003742) ----------------------------------------------------
int __fastcall AppleCamIn::message(AppleCamIn *this, unsigned int a2, IOService *a3, void *a4)
{
  void *v4; // r14@1
  IOService *v5; // r15@1

  v4 = a4;
  v5 = a3;
  if ( *((_BYTE *)this + 4020) & 0x40 )
  {
    IOLog("AppleCamIn::message\n");
  }
  return (*(int (__fastcall **)(AppleCamIn *, _QWORD, IOService *, void *))(off_12038[0] + 1856))(this, a2, v5, v4);
}
// 12038: using guessed type __int64 off_12038[5];
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (0000000000003792) ----------------------------------------------------
int __fastcall AppleCamIn::finalize(AppleCamIn *this, unsigned int a2)
{
  AppleCamIn *v2; // rbx@1
  __int64 v3; // rdi@1
  __int64 v4; // rax@4
  __int64 v5; // rdi@5
  __int64 v6; // rdi@7
  __int64 v7; // rdi@9
  void *v8; // r15@11
  __int64 v9; // rdi@13
  __int64 v10; // rdi@15
  __int64 v11; // rdi@17
  __int64 v12; // rdi@19
  __int64 v13; // rdi@21
  void *v14; // rdi@23
  void *v15; // rdi@25

  v2 = this;
  IOLog("AppleCamIn::finalize\n");
  (*(void (__fastcall **)(AppleCamIn *))(*(_QWORD *)v2 + 1944LL))(v2);
  v3 = *((_QWORD *)this + 512);
  if ( v3 )
  {
    (*(void (__cdecl **)(__int64))(*(_QWORD *)v3 + 280LL))(v3);
    *((_QWORD *)v2 + 512) = 0LL;
  }
  if ( *((_QWORD *)v2 + 37) )
  {
    LODWORD(v4) = (*(int (__fastcall **)(AppleCamIn *))(*(_QWORD *)v2 + 1672LL))(v2);
    (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v4 + 328LL))(v4, *((_QWORD *)v2 + 37));
    (*(void (__cdecl **)(_QWORD))(**((_QWORD **)v2 + 37) + 40LL))(*((_QWORD *)v2 + 37));
    *((_QWORD *)v2 + 37) = 0LL;
  }
  v5 = *((_QWORD *)v2 + 504);
  if ( v5 )
  {
    (*(void (__cdecl **)(__int64))(*(_QWORD *)v5 + 40LL))(v5);
    *((_QWORD *)v2 + 504) = 0LL;
  }
  v6 = *((_QWORD *)v2 + 506);
  if ( v6 )
  {
    (*(void (__cdecl **)(__int64))(*(_QWORD *)v6 + 40LL))(v6);
    *((_QWORD *)v2 + 506) = 0LL;
  }
  v7 = *((_QWORD *)v2 + 508);
  if ( v7 )
  {
    (*(void (__cdecl **)(__int64))(*(_QWORD *)v7 + 40LL))(v7);
    *((_QWORD *)v2 + 508) = 0LL;
  }
  v8 = (void *)*((_QWORD *)v2 + 498);
  if ( v8 )
  {
    IOMMUManager::~IOMMUManager(*((IOMMUManager **)v2 + 498));
    operator delete(v8);
    *((_QWORD *)v2 + 498) = 0LL;
  }
  v9 = *((_QWORD *)v2 + 38);
  if ( v9 )
  {
    (*(void (__cdecl **)(__int64))(*(_QWORD *)v9 + 40LL))(v9);
    *((_QWORD *)v2 + 38) = 0LL;
  }
  v10 = *((_QWORD *)v2 + 35);
  if ( v10 )
  {
    (*(void (__cdecl **)(__int64))(*(_QWORD *)v10 + 40LL))(v10);
    *((_QWORD *)v2 + 35) = 0LL;
  }
  v11 = *((_QWORD *)v2 + 89);
  if ( v11 )
  {
    (*(void (__cdecl **)(__int64))(*(_QWORD *)v11 + 288LL))(v11);
    *((_QWORD *)v2 + 89) = 0LL;
  }
  v12 = *((_QWORD *)v2 + 36);
  if ( v12 )
  {
    (*(void (__cdecl **)(__int64))(*(_QWORD *)v12 + 40LL))(v12);
    *((_QWORD *)v2 + 36) = 0LL;
  }
  v13 = *((_QWORD *)v2 + 18);
  if ( v13 )
  {
    IOFree(v13, 8LL * *((_QWORD *)v2 + 19));
    *((_QWORD *)v2 + 18) = 0LL;
  }
  v14 = (void *)*((_QWORD *)v2 + 496);
  if ( v14 )
  {
    operator delete[](v14);
    *((_QWORD *)v2 + 496) = 0LL;
  }
  v15 = (void *)*((_QWORD *)v2 + 497);
  if ( v15 )
  {
    operator delete[](v15);
    *((_QWORD *)v2 + 497) = 0LL;
  }
  return (*(int (__fastcall **)(AppleCamIn *, _QWORD))(off_12038[0] + 1560))(v2, a2);
}
// 12038: using guessed type __int64 off_12038[5];
// B6378: using guessed type int __fastcall IOFree(_QWORD, _QWORD);
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (000000000000398E) ----------------------------------------------------
__int64 __fastcall AppleCamIn::getWorkLoop(AppleCamIn *this)
{
  return *((_QWORD *)this + 34);
}

//----- (000000000000399C) ----------------------------------------------------
__int64 __fastcall AppleCamIn::newUserClient(AppleCamIn *this, task *a2, void *a3, __int64 a4, IOUserClient **a5)
{
  IOUserClient **v5; // r12@1
  IOUserClient *v6; // rax@1
  IOUserClient *v7; // rbx@1
  signed int v8; // er15@1

  v5 = a5;
  *a5 = 0LL;
  LODWORD(v6) = (*(int (__fastcall **)(_QWORD, task *, void *, __int64))(*(_QWORD *)AppleCamInUserClient::metaClass
                                                                       + 136LL))(
                  AppleCamInUserClient::metaClass,
                  a2,
                  a3,
                  a4);
  v7 = v6;
  v8 = -536870199;
  if ( (unsigned __int8)(*(int (__fastcall **)(IOUserClient *, task *, _QWORD))(*(_QWORD *)v6 + 2400LL))(v6, a2, 0LL)
    && (unsigned __int8)(*(int (__fastcall **)(IOUserClient *, AppleCamIn *))(*(_QWORD *)v7 + 1648LL))(v7, this) )
  {
    if ( (unsigned __int8)(*(int (__fastcall **)(IOUserClient *, AppleCamIn *))(*(_QWORD *)v7 + 1472LL))(v7, this) )
    {
      *v5 = v7;
      v8 = 0;
    }
    else
    {
      (*(void (__fastcall **)(IOUserClient *, AppleCamIn *))(*(_QWORD *)v7 + 1656LL))(v7, this);
      (*(void (__fastcall **)(IOUserClient *))(*(_QWORD *)v7 + 40LL))(v7);
    }
  }
  return (unsigned int)v8;
}
// 129F0: using guessed type _QWORD AppleCamInUserClient::metaClass;

//----- (0000000000003A3C) ----------------------------------------------------
__int64 __fastcall AppleCamIn::EnableS2Chip(AppleCamIn *this, __int64 a2, unsigned int a3)
{
  AppleCamIn *v3; // r14@1
  signed __int64 v4; // rsi@1
  __int64 v5; // rdi@1
  unsigned int v6; // ebx@4
  bool v7; // cf@4
  bool v8; // zf@4
  char v9; // bl@4
  __int64 result; // rax@9
  __int64 v11; // [sp+8h] [bp-38h]@7
  __int64 v12; // [sp+10h] [bp-30h]@3
  unsigned __int64 v13; // [sp+18h] [bp-28h]@4
  unsigned __int64 v14; // [sp+20h] [bp-20h]@3

  v3 = this;
  v4 = 1LL;
  AppleCamIn::acpiControlS2ChipPower(this, 1u, a3);
  IOSleep(20LL);
  v5 = *((_QWORD *)this + 32);
  if ( v5 )
  {
    v4 = 0LL;
    (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v5 + 2232LL))(v5, 0LL);
  }
  clock_get_uptime(&v12, v4);
  clock_interval_to_deadline(500LL, 1000000LL, &v14);
  while ( 1 )
  {
    v6 = IOPCIDevice::extendedConfigRead32(*((IOPCIDevice **)v3 + 31), 0LL) + 1;
    clock_get_uptime(&v13, 0LL);
    v7 = v6 < 1;
    v8 = v6 == 1;
    v9 = 1;
    if ( !v7 && !v8 )
    {
      break;
    }
    if ( v13 >= v14 )
    {
      v9 = 0;
      break;
    }
  }
  v13 -= v12;
  absolutetime_to_nanoseconds(v13, &v11);
  if ( *((_BYTE *)v3 + 4020) & 8 )
  {
    IOLog("AppleCamIn::EnableS2Chip - power up took %llu us (%s)\n");
  }
  (*(void (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)v3 + 31) + 2232LL))(*((_QWORD *)v3 + 31), 0LL);
  result = 3758097084LL;
  if ( v9 )
  {
    result = 0LL;
  }
  return result;
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);
// B63A0: using guessed type int __fastcall IOSleep(_QWORD);
// B6EE8: using guessed type int __fastcall absolutetime_to_nanoseconds(_QWORD, _QWORD);
// B6F08: using guessed type int __fastcall clock_get_uptime(_QWORD, _QWORD);
// B6F10: using guessed type int __fastcall clock_interval_to_deadline(_QWORD, _QWORD, _QWORD);

//----- (0000000000003B4C) ----------------------------------------------------
__int64 __fastcall AppleCamIn::DisableS2Chip(AppleCamIn *this)
{
  AppleCamIn *v1; // rbx@1
  int v2; // er14@3
  char v3; // al@3
  unsigned int v4; // edx@3
  __int64 v5; // rdi@5
  unsigned int v6; // ebx@7

  v1 = this;
  if ( *((_BYTE *)this + 4020) & 0x40 )
  {
    IOLog("AppleCamIn::DisableS2Chip\n");
  }
  v2 = IOPCIDevice::extendedConfigRead32(*((IOPCIDevice **)this + 31), 0LL);
  v3 = IOPCIDevice::extendedConfigRead32(*((IOPCIDevice **)this + 31), 4uLL);
  if ( v2 != -1 )
  {
    if ( v3 & 7 )
    {
      (*(void (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 31) + 2224LL))(*((_QWORD *)this + 31), 0LL);
      v5 = *((_QWORD *)this + 32);
      if ( v5 )
      {
        (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v5 + 2224LL))(v5, 0LL);
      }
    }
  }
  v6 = AppleCamIn::acpiControlS2ChipPower(v1, 0, v4);
  IOSleep(250LL);
  return v6;
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);
// B63A0: using guessed type int __fastcall IOSleep(_QWORD);

//----- (0000000000003BE0) ----------------------------------------------------
unsigned __int64 __fastcall AppleCamIn::bcopy_with_PCI_throttle(AppleCamIn *this, const void *a2, void *a3, unsigned __int64 a4)
{
  unsigned __int64 v4; // r13@1
  void *v5; // r14@1
  const void *v6; // r15@1
  char v7; // r12@2
  size_t v8; // rbx@3
  unsigned __int64 result; // rax@7

  v4 = a4;
  v5 = a3;
  v6 = a2;
  if ( a4 )
  {
    v7 = 1;
    do
    {
      v8 = v4;
      if ( v4 > 0x40 )
      {
        v8 = 64LL;
      }
      bcopy(v6, v5, v8);
      if ( !(v7 & 3) )
      {
        IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      }
      v6 = (char *)v6 + v8;
      v5 = (char *)v5 + v8;
      result = v4 - v8;
      ++v7;
      v4 -= v8;
    }
    while ( v4 );
  }
  return result;
}

//----- (0000000000003C68) ----------------------------------------------------
unsigned int __usercall AppleCamIn::power_on_hardware@<eax>(AppleCamIn *this@<rdi>, __int64 a2@<rsi>, void *a3@<r12>)
{
  AppleCamIn *v3; // rbx@1
  unsigned int v4; // edx@1
  unsigned int result; // eax@2
  __int64 v6; // rdx@4
  __int64 v7; // rdi@6
  uint64_t v8; // r14@11
  int v9; // er15@12
  int v10; // er15@15
  int v11; // er15@19
  uint64_t v12; // rax@24
  __int64 v13; // rax@30
  int v14; // ecx@30
  int v15; // ecx@37
  char *v16; // rsi@47
  __int64 v17; // [sp+8h] [bp-28h]@24

  v3 = this;
  IOLog("AppleCamIn::power_on_hardware\n");
  if ( (unsigned int)AppleCamIn::EnableS2Chip(this, a2, v4) )
  {
    return IOLog("AppleCamIn::power_on_hardware - Enable Chip failed: 0x%08x\n");
  }
  AppleCamIn::EnableSensor(this);
  AppleCamIn::init_s2_pcie_link(this);
  if ( *((_BYTE *)this + 4020) & 0x80 )
  {
    v6 = *((_DWORD *)this + 60);
    IOLog("%s: DDR frequency %d MHz\n");
  }
  if ( (unsigned int)AppleCamIn::s2_init_ddr_controller_soc(this) )
  {
    v7 = (__int64)"AppleCamIn::power_on_hardware - Camera DDR Initialization failed\n";
LABEL_7:
    IOLog(v7);
    if ( *((_BYTE *)v3 + 700) )
    {
      (*(void (__fastcall **)(AppleCamIn *, _QWORD, _QWORD))(*(_QWORD *)v3 + 632LL))(v3, "CameraActive", 0LL);
      *((_BYTE *)v3 + 700) = 0;
    }
    return AppleCamIn::DisableS2Chip(v3);
  }
  v8 = mach_absolute_time();
  if ( *((_DWORD *)this + 40) )
  {
    v9 = AppleCamIn::restore_ddr_phy_regs(this);
    a3 = (void *)(v9 | (unsigned int)AppleCamIn::ddr40_phy_rewrite_mode_registers(this));
    if ( !((unsigned int)a3 | (unsigned int)AppleCamIn::VerifyMemory(this, 0)) )
    {
      goto LABEL_22;
    }
    IOLog("AppleCamIn::power_on_hardware - Memory check failed after restore_ddr_phy_regs \n");
    if ( (unsigned int)AppleCamIn::s2_init_ddr_controller_soc(this) )
    {
      IOLog("AppleCamIn::power_on_hardware - Reset of DDR Controller has failed.");
    }
    v10 = AppleCamIn::do_shmoo(this);
    if ( v10 | (unsigned int)AppleCamIn::VerifyMemory(this, 0) )
    {
      v7 = (__int64)"AppleCamIn::power_on_hardware - Memory check still failed after re-running shmoo calibration\n";
      goto LABEL_7;
    }
  }
  else
  {
    if ( *((_BYTE *)this + 4020) & 0x80 )
    {
      IOLog("AppleCamIn::power_on_hardware - Calibrating Camera Memory \n");
    }
    v11 = AppleCamIn::do_shmoo(this);
    if ( v11 | (unsigned int)AppleCamIn::VerifyMemory(this, 0) )
    {
      v7 = (__int64)"AppleCamIn::power_on_hardware - Memory ERROR\n";
      goto LABEL_7;
    }
  }
  AppleCamIn::save_ddr_phy_regs(this);
LABEL_22:
  if ( *((_BYTE *)this + 4020) & 0x80 )
  {
    IOLog("AppleCamIn::power_on_hardware - Memory OKAY\n");
  }
  v12 = mach_absolute_time();
  absolutetime_to_nanoseconds(v12 - v8, &v17);
  if ( *((_BYTE *)this + 4020) & 8 )
  {
    IOLog("%s: DDR (re)initialization complete - execution time = %llu us\n");
  }
  *(_DWORD *)(*((_QWORD *)this + 505) + 53512LL) = 8;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 505) + 53508LL) = 12;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(int *)((char *)&dword_40004 + *((_QWORD *)this + 509)) = 0;
  AppleCamIn::bcopy_with_PCI_throttle(
    this,
    *((const void **)this + 493),
    *((void **)this + 507),
    *((_DWORD *)this + 988));
  if ( *((_BYTE *)this + 738) )
  {
    AppleCamIn::bcopy_with_PCI_throttle(
      this,
      *(const void **)(*((_QWORD *)this + 269) + 32LL),
      *(void **)(*((_QWORD *)this + 267) + 8LL),
      **((_DWORD **)this + 269));
  }
  if ( *((_BYTE *)this + 739) )
  {
    AppleCamIn::bcopy_with_PCI_throttle(
      this,
      *(const void **)(*((_QWORD *)this + 270) + 32LL),
      *(void **)(*((_QWORD *)this + 268) + 8LL),
      **((_DWORD **)this + 270));
  }
  (*(void (**)(void))(**((_QWORD **)this + 37) + 336LL))();
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0x94uLL, 0x200u);
  *((_QWORD *)this + 501) = 0LL;
  v13 = *((_QWORD *)this + 507);
  v14 = *(_BYTE *)(v13 + 128);
  if ( v14 == 100 )
  {
    if ( *(_BYTE *)(v13 + 129) == 115 && *(_BYTE *)(v13 + 130) == 99 )
    {
      goto LABEL_44;
    }
  }
  else if ( (unsigned __int8)v14 == 97 && *(_BYTE *)(v13 + 129) == 100 && *(_BYTE *)(v13 + 130) == 99 )
  {
    goto LABEL_44;
  }
  v15 = *(_BYTE *)(v13 + 4160);
  if ( v15 == 100 )
  {
    if ( *(_BYTE *)(v13 + 4161) != 115 || *(_BYTE *)(v13 + 4162) != 99 )
    {
      goto LABEL_45;
    }
  }
  else if ( (unsigned __int8)v15 != 97 || *(_BYTE *)(v13 + 4161) != 100 || *(_BYTE *)(v13 + 4162) != 99 )
  {
LABEL_45:
    IOLog("AppleCamIn::power_on_hardware - Firmware Unit Test Mode!\n");
    *((_BYTE *)this + 4016) = 1;
    *((_BYTE *)this + 4020) |= 1u;
    goto LABEL_46;
  }
LABEL_44:
  *((_BYTE *)this + 4016) = 0;
LABEL_46:
  result = AppleCamIn::ISP_Init(this, a3);
  if ( result
    && (v16 = (char *)result,
        result = IOLog("AppleCamIn::power_on_hardware - ISP_Init failed: 0x%08X\n"),
        !*((_BYTE *)this + 4024)) )
  {
    result = AppleCamIn::ISP_deInit(this, v16);
  }
  else
  {
    *((_BYTE *)this + 656) = 1;
  }
  return result;
}
// 40004: using guessed type int dword_40004;
// B6390: using guessed type int __fastcall IOLog(_QWORD);
// B6EE8: using guessed type int __fastcall absolutetime_to_nanoseconds(_QWORD, _QWORD);

//----- (0000000000004058) ----------------------------------------------------
int __fastcall AppleCamIn::EnableSensor(AppleCamIn *this)
{
  if ( !*((_BYTE *)this + 700) )
  {
    IOSleep(1LL);
    (*(void (__fastcall **)(AppleCamIn *, _QWORD, signed __int64))(*(_QWORD *)this + 632LL))(this, "CameraActive", 1LL);
    *((_BYTE *)this + 700) = 1;
  }
  return IOSleep(5LL);
}
// B63A0: using guessed type int __fastcall IOSleep(_QWORD);

//----- (00000000000040A4) ----------------------------------------------------
int __fastcall AppleCamIn::DisableSensor(AppleCamIn *this)
{
  int result; // eax@2

  if ( *((_BYTE *)this + 700) )
  {
    result = (*(int (__fastcall **)(AppleCamIn *, _QWORD, _QWORD))(*(_QWORD *)this + 632LL))(this, "CameraActive", 0LL);
    *((_BYTE *)this + 700) = 0;
  }
  return result;
}

//----- (00000000000040DA) ----------------------------------------------------
__int64 __fastcall AppleCamIn::VerifyMemory(AppleCamIn *this, int a2)
{
  int v2; // ebx@1
  char v4; // [sp+0h] [bp-40h]@1

  v2 = mach_absolute_time();
  AppleCamIn::PutRandomPatternInMemory(this, a2, 128, v2, &v4);
  return AppleCamIn::GetRandomPatternInMemory(this, a2, 128, v2, &v4);
}

//----- (0000000000004132) ----------------------------------------------------
__int64 __fastcall AppleCamIn::restore_ddr_phy_regs(AppleCamIn *this)
{
  __int64 v1; // rdx@3
  unsigned __int64 v2; // r13@5
  unsigned __int64 v3; // r14@5
  __int64 v4; // rax@6
  signed int v5; // ecx@6
  int v6; // esi@11
  int v7; // er12@15
  unsigned __int64 v8; // rax@24
  signed __int64 v9; // rdx@25
  signed int v10; // ebx@30
  int v11; // er9@31
  bool v12; // zf@32
  bool v13; // sf@32
  __int64 v14; // rcx@37
  signed int v15; // er14@39
  int v17; // [sp+0h] [bp-2Ch]@28

  if ( *((_DWORD *)this + 40) )
  {
    if ( *((_BYTE *)this + 4020) & 0x80 )
    {
      v1 = *((_QWORD *)this + 19);
      IOLog("%s: restoring %lu DDR PHY shmoo-calibrated registers \n");
    }
    if ( *((_QWORD *)this + 19) )
    {
      v2 = 0LL;
      LODWORD(v3) = 0;
      while ( 1 )
      {
        v4 = *((_QWORD *)this + 18);
        v5 = *(_DWORD *)(v4 + 8 * v2);
        if ( v5 != 76
          && (unsigned int)(v5 - 80) >= 9
          && v5 != 96
          && (unsigned int)(v5 - 148) >= 9
          && (unsigned int)(v5 - 880) >= 0x1D )
        {
          break;
        }
LABEL_38:
        v3 = (unsigned int)(v3 + 1);
        v2 = v3;
        if ( v3 >= *((_QWORD *)this + 19) )
        {
          goto LABEL_39;
        }
      }
      v6 = *(_DWORD *)(v4 + 8 * v2 + 4);
      if ( (unsigned int)(v5 - 512) < 0xD
        || (unsigned int)(v5 - 528) < 0x1D
        || (unsigned int)(v5 - 564) < 0x3D
        || (unsigned int)(v5 - 688) < 0x1D
        || (v7 = *(_DWORD *)(v4 + 8 * v2 + 4), (unsigned int)(v5 - 724) <= 0x3C) )
      {
        v7 = *(_DWORD *)(v4 + 8 * v2 + 4) & 0x3F | 0x30000;
      }
      if ( v5 > 787 )
      {
        if ( v5 != 788 )
        {
          goto LABEL_27;
        }
      }
      else if ( v5 > 627 )
      {
        v8 = (unsigned int)(v5 - 628);
        if ( (unsigned int)v8 > 0x38 )
        {
          goto LABEL_27;
        }
        v9 = 76561193665298433LL;
        if ( !_bittest((const unsigned __int64 *)&v9, v8) )
        {
          goto LABEL_27;
        }
      }
      else if ( v5 != 520 && v5 != 524 )
      {
        goto LABEL_27;
      }
      v7 = v7 & 0x3F | 0x30100;
LABEL_27:
      if ( *((_BYTE *)this + 4020) & 0x80 )
      {
        v17 = v6;
        IOLog("%s: entry %03d:  ddr_phy_reg_offset=0x%08X, reg_value=0x%08X\n");
        v5 = *(_DWORD *)(*((_QWORD *)this + 18) + 8 * v2);
      }
      else
      {
        v17 = v6;
      }
      *(_DWORD *)(*((_QWORD *)this + 505) + (unsigned int)(v5 + 10240)) = v7;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      v10 = 1000;
      while ( 1 )
      {
        v11 = *(_DWORD *)(*((_QWORD *)this + 505) + (unsigned int)(*(_DWORD *)(*((_QWORD *)this + 18) + 8 * v2) + 10240));
        if ( v11 >= 0 )
        {
          break;
        }
        IODelay(1LL, 0LL);
        v12 = v10 == 0;
        v13 = v10-- < 0;
        if ( v13 || v12 )
        {
          goto LABEL_42;
        }
      }
      if ( v10 <= 0 )
      {
LABEL_42:
        IOLog("%s: ERROR: timeout reading back register value\n");
        v15 = -536870186;
        return (unsigned int)v15;
      }
      if ( v11 != v17 && *((_BYTE *)this + 4020) & 0x80 )
      {
        v14 = *(_DWORD *)(*((_QWORD *)this + 18) + 8 * v2);
        IOLog("%s: WARNING: entry %03d:  ddr_phy_reg_offset=0x%08X: exp_value=0x%08X does not match rd_value=0x%08X\n");
      }
      goto LABEL_38;
    }
LABEL_39:
    v15 = 0;
    if ( *((_BYTE *)this + 4020) & 0x80 )
    {
      v15 = 0;
      IOLog("%s: Done\n");
    }
  }
  else
  {
    IOLog("%s: DDR PHY is not yet calibrated.\n");
    v15 = -536870184;
  }
  return (unsigned int)v15;
}
// B6370: using guessed type int __fastcall IODelay(_QWORD, _QWORD);
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (00000000000043D0) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ddr40_phy_rewrite_mode_registers(AppleCamIn *this)
{
  unsigned int v1; // ebx@1
  __int64 v2; // rdi@6
  unsigned int v3; // ebx@7
  unsigned int v4; // ebx@13
  __int64 v5; // rax@19
  unsigned int v6; // er14@22
  __int64 result; // rax@26

  *(_DWORD *)(*((_QWORD *)this + 505) + 8212LL) = 33556482;
  v1 = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  while ( *(_DWORD *)(*((_QWORD *)this + 505) + 8216LL) & 1 )
  {
    IODelay(5LL, 0LL);
    ++v1;
    if ( v1 >= 0x1F5 )
    {
      goto LABEL_6;
    }
  }
  if ( v1 >= 0x1F4 )
  {
LABEL_6:
    v2 = (__int64)"ERROR: Timed-out polling for BUSY field of CSR_DRAM_INIT_RESULT register: (Mode 2) DDR_R_CSR_DRAM_INIT_RESULT_MEMADDR = 0x%08X\n";
    goto LABEL_28;
  }
  *(_DWORD *)(*((_QWORD *)this + 505) + 8212LL) = 3;
  v3 = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  while ( *(_DWORD *)(*((_QWORD *)this + 505) + 8216LL) & 1 )
  {
    IODelay(5LL, 0LL);
    ++v3;
    if ( v3 >= 0x1F5 )
    {
      goto LABEL_12;
    }
  }
  if ( v3 >= 0x1F4 )
  {
LABEL_12:
    v2 = (__int64)"ERROR: Timed-out polling for BUSY field of CSR_DRAM_INIT_RESULT register: (Mode 3) DDR_R_CSR_DRAM_INIT_RESULT_MEMADDR = 0x%08X\n";
    goto LABEL_28;
  }
  *(_DWORD *)(*((_QWORD *)this + 505) + 8212LL) = 1;
  v4 = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  while ( *(_DWORD *)(*((_QWORD *)this + 505) + 8216LL) & 1 )
  {
    IODelay(5LL, 0LL);
    ++v4;
    if ( v4 >= 0x1F5 )
    {
      goto LABEL_18;
    }
  }
  if ( v4 >= 0x1F4 )
  {
LABEL_18:
    v2 = (__int64)"ERROR: Timed-out polling for BUSY field of CSR_DRAM_INIT_RESULT register: (Mode 1) DDR_R_CSR_DRAM_INIT_RESULT_MEMADDR = 0x%08X\n";
    goto LABEL_28;
  }
  v5 = *((_QWORD *)this + 505);
  if ( *((_DWORD *)this + 60) == 450 )
  {
    *(_DWORD *)(v5 + 8212) = 369111040;
  }
  else
  {
    *(_DWORD *)(v5 + 8212) = 369106944;
  }
  v6 = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  while ( *(_DWORD *)(*((_QWORD *)this + 505) + 8216LL) & 1 )
  {
    IODelay(5LL, 0LL);
    ++v6;
    if ( v6 >= 0x1F5 )
    {
      goto LABEL_27;
    }
  }
  result = 0LL;
  if ( v6 < 0x1F4 )
  {
    return result;
  }
LABEL_27:
  v2 = (__int64)"ERROR: Timed-out polling for BUSY field of CSR_DRAM_INIT_RESULT register: (Mode 0) DDR_R_CSR_DRAM_INIT_RESULT_MEMADDR = 0x%08X\n";
LABEL_28:
  IOLog(v2);
  return 3758097110LL;
}
// B6370: using guessed type int __fastcall IODelay(_QWORD, _QWORD);
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (0000000000004592) ----------------------------------------------------
__int64 __usercall AppleCamIn::ISP_Init@<rax>(AppleCamIn *this@<rdi>, void *a2@<r12>)
{
  __int64 v2; // r13@1
  __int64 v3; // r14@1
  uint64_t v4; // r15@1
  signed __int64 v5; // rax@1
  unsigned int v6; // ebx@3
  __int64 v7; // rax@4
  __int64 v8; // rdi@6
  __int64 v9; // rsi@9
  __int64 v10; // rsi@13
  __int64 v11; // rdi@13
  __int64 v12; // rsi@15
  int v13; // er15@21
  __int64 v15; // rsi@30
  int v16; // eax@32
  __int64 v17; // rax@33
  __int64 v18; // rcx@33
  unsigned int v19; // ebx@33
  __int64 v20; // rax@34
  __int64 v21; // rsi@37
  __int64 v22; // rdi@39
  __int64 v23; // rdi@41
  void *v24; // rax@41
  __int64 v25; // r14@43
  unsigned __int64 v26; // r15@44
  char *v27; // rbx@44
  __int64 v28; // rdx@45
  __int64 v29; // r8@45
  __int64 v30; // r9@45
  int v31; // edi@46
  int v32; // eax@48
  int v33; // edx@50
  __int64 v34; // rsi@50
  __int64 v35; // rcx@50
  unsigned int v36; // ebx@56
  int v37; // eax@62
  __int64 v38; // rdi@63
  __int64 v39; // rcx@70
  __int64 v40; // rcx@79
  int v41; // ecx@80
  __int64 v42; // rax@84
  uint64_t v43; // rax@92
  uint64_t v44; // [sp+10h] [bp-160h]@19
  __int64 v45; // [sp+18h] [bp-158h]@92
  unsigned int v46; // [sp+24h] [bp-14Ch]@85
  unsigned int v47; // [sp+28h] [bp-148h]@82
  unsigned int v48; // [sp+2Ch] [bp-144h]@80
  __int64 v49; // [sp+30h] [bp-140h]@18
  __int64 v50; // [sp+38h] [bp-138h]@12
  char v51; // [sp+40h] [bp-130h]@80
  __int16 v52; // [sp+44h] [bp-12Ch]@80
  int v53; // [sp+48h] [bp-128h]@82
  int v54; // [sp+4Ch] [bp-124h]@85
  int v55; // [sp+50h] [bp-120h]@85
  __int64 v56; // [sp+140h] [bp-30h]@1

  v2 = (__int64)this;
  v3 = off_12040[0];
  v56 = *(_QWORD *)off_12040[0];
  *((_BYTE *)this + 680) = 0;
  v4 = mach_absolute_time();
  *(_DWORD *)(*((_QWORD *)this + 509) + 798720LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 798724LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 798728LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 798732LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 798736LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 798740LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 798744LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 798748LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(int *)((char *)&dword_41024 + *((_QWORD *)this + 509)) = -1;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  IOProcessorInit((__int64)MyCalloc, (__int64)MyFree, 0LL, 0LL, 0LL, 0LL, 0LL);
  v5 = 41LL;
  do
  {
    *((_QWORD *)this + v5++) = 0xFFFFFFFFLL;
  }
  while ( v5 != 73 );
  *(int *)((char *)&dword_40008 + *((_QWORD *)this + 509)) = 2147483648;
  v6 = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(int *)((char *)&dword_40004 + *((_QWORD *)this + 509)) = 1;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  while ( 1 )
  {
    v7 = *((_QWORD *)this + 509);
    if ( *(int *)((char *)&dword_41000 + v7) & 0xF0 )
    {
      break;
    }
    IOSleep(10LL);
    ++v6;
    if ( v6 >= 0x3E9 )
    {
      v8 = (__int64)"AppleCamIn::ISP_Init - No wake signal from ISPCPU\n";
LABEL_7:
      IOLog(v8);
      v4 = 3758097110LL;
      goto LABEL_26;
    }
  }
  *(int *)((char *)&dword_41024 + v7) = -1;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *((_DWORD *)this + 146) = *(_DWORD *)(*((_QWORD *)this + 509) + 798720LL);
  *((_DWORD *)this + 147) = *(_DWORD *)(*((_QWORD *)this + 509) + 798724LL) + 1;
  if ( *((_BYTE *)this + 4020) & 1 )
  {
    v9 = *((_DWORD *)this + 146);
    IOLog("AppleCamIn::ISP_Init - ISPCPU IPC numIPCChannels=%d, ipcQueueSize=%d\n");
  }
  if ( *((_DWORD *)this + 146) < 0x21u )
  {
    v50 = 0LL;
    if ( (unsigned int)AppleCamIn::AllocateDeviceMemory((__int64)this, *((_DWORD *)this + 147), (__int64)&v50, 0) )
    {
      v10 = *((_DWORD *)this + 147);
      v11 = (__int64)"AppleCamIn::ISP_Init - Could not allocate ipc queue. Size=%d\n";
    }
    else
    {
      if ( *((_BYTE *)this + 4020) & 4 )
      {
        v12 = *(_DWORD *)(v50 + 4);
        IOLog("AppleCamIn::ISP_Init - ipc-queue device address=0x%08X\n");
      }
      a2 = (void *)*(_DWORD *)(*((_QWORD *)this + 509) + 798732LL);
      if ( (unsigned int)a2 < 0x400001 )
      {
        v49 = 0LL;
        if ( !(_DWORD)a2 )
        {
          goto LABEL_28;
        }
        v44 = v4;
        if ( *((_BYTE *)this + 4020) & 4 )
        {
          IOLog("AppleCamIn::ISP_Init - Requested firmware heap size=%d\n");
        }
        v13 = 4096;
        if ( (unsigned int)a2 >= 0x1000 )
        {
          v13 = (signed int)a2;
        }
        if ( !(unsigned int)AppleCamIn::AllocateDeviceMemory((__int64)this, v13, (__int64)&v49, 0) )
        {
          *(_DWORD *)(*((_QWORD *)this + 509) + 798720LL) = 0;
          IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
          *(_DWORD *)(*((_QWORD *)this + 509) + 798724LL) = *(_DWORD *)(v50 + 4);
          IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
          *(_DWORD *)(*((_QWORD *)this + 509) + 798728LL) = *((_DWORD *)this + 176);
          IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
          *(_DWORD *)(*((_QWORD *)this + 509) + 798732LL) = 0x10000000 - *((_DWORD *)this + 176);
          IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
          *(_DWORD *)(*((_QWORD *)this + 509) + 798736LL) = *(_DWORD *)(v49 + 4);
          IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
          if ( *((_BYTE *)this + 4020) & 4 )
          {
            v15 = *(_DWORD *)(v49 + 4);
            IOLog("AppleCamIn::ISP_Init - firmware heap device address=0x%08X\n");
          }
          *(_DWORD *)(*((_QWORD *)this + 509) + 798740LL) = v13;
          goto LABEL_32;
        }
        v11 = (__int64)"AppleCamIn::ISP_Init - Could not allocate firmware heap. Size=%d\n";
      }
      else
      {
        v11 = (__int64)"AppleCamIn::ISP_Init - Firmware requesting too large a heap: %d\n";
      }
    }
    IOLog(v11);
    v4 = 3758097129LL;
  }
  else
  {
    IOLog("AppleCamIn::ISP_Init - Error: Too many IPC channels\n");
    v4 = 3758097084LL;
  }
LABEL_26:
  while ( *(_QWORD *)v3 != v56 )
  {
LABEL_28:
    v44 = v4;
    *(_DWORD *)(*(_QWORD *)(v2 + 4072) + 798720LL) = 0;
    IOPCIDevice::extendedConfigWrite32(*(IOPCIDevice **)(v2 + 248), 0LL, 0x12345678u);
    *(_DWORD *)(*(_QWORD *)(v2 + 4072) + 798724LL) = *(_DWORD *)(v50 + 4);
    IOPCIDevice::extendedConfigWrite32(*(IOPCIDevice **)(v2 + 248), 0LL, 0x12345678u);
    *(_DWORD *)(*(_QWORD *)(v2 + 4072) + 798728LL) = *(_DWORD *)(v2 + 704);
    IOPCIDevice::extendedConfigWrite32(*(IOPCIDevice **)(v2 + 248), 0LL, 0x12345678u);
    *(_DWORD *)(*(_QWORD *)(v2 + 4072) + 798732LL) = 0x10000000 - *(_DWORD *)(v2 + 704);
    IOPCIDevice::extendedConfigWrite32(*(IOPCIDevice **)(v2 + 248), 0LL, 0x12345678u);
    *(_DWORD *)(*(_QWORD *)(v2 + 4072) + 798736LL) = 0;
    IOPCIDevice::extendedConfigWrite32(*(IOPCIDevice **)(v2 + 248), 0LL, 0x12345678u);
    *(_DWORD *)(*(_QWORD *)(v2 + 4072) + 798740LL) = 0;
LABEL_32:
    IOPCIDevice::extendedConfigWrite32(*(IOPCIDevice **)(v2 + 248), 0LL, 0x12345678u);
    *(_DWORD *)(*(_QWORD *)(v2 + 4072) + 798744LL) = *(_DWORD *)(v2 + 720);
    IOPCIDevice::extendedConfigWrite32(*(IOPCIDevice **)(v2 + 248), 0LL, 0x12345678u);
    v16 = DeviceMemoryManager::Allocate(*(DeviceMemoryManager **)(v2 + 3992), 12);
    v4 = 3758097085LL;
    if ( v16 != -1 )
    {
      v17 = (unsigned int)(*(_DWORD *)(v2 + 704) + v16);
      v18 = *(_QWORD *)(v2 + 4000);
      *(_QWORD *)(v2 + 592) = v18 + v17;
      *(_DWORD *)(v18 + v17) = 2;
      *(_DWORD *)(v18 + v17 + 4) = *(_DWORD *)(v2 + 4028);
      *(_DWORD *)(v18 + v17 + 8) = *(_BYTE *)(v2 + 4017);
      *(_DWORD *)(*(_QWORD *)(v2 + 4072) + 798748LL) = v18 + v17 - *(_DWORD *)(v2 + 4056);
      v19 = 0;
      IOPCIDevice::extendedConfigWrite32(*(IOPCIDevice **)(v2 + 248), 0LL, 0x12345678u);
      *(int *)((char *)&dword_41020 + *(_QWORD *)(v2 + 4072)) = 16;
      IOPCIDevice::extendedConfigWrite32(*(IOPCIDevice **)(v2 + 248), 0LL, 0x12345678u);
      while ( 1 )
      {
        v20 = *(_QWORD *)(v2 + 4072);
        if ( *(int *)((char *)&dword_41000 + v20) & 0xF0 )
        {
          break;
        }
        IOSleep(10LL);
        ++v19;
        if ( v19 >= 0x3E9 )
        {
          v8 = (__int64)"AppleCamIn::ISP_Init - No second int from ISPCPU\n";
          goto LABEL_7;
        }
      }
      *(int *)((char *)&dword_41024 + v20) = -1;
      v21 = 0LL;
      IOPCIDevice::extendedConfigWrite32(*(IOPCIDevice **)(v2 + 248), 0LL, 0x12345678u);
      if ( *(_BYTE *)(v2 + 4020) & 1 )
      {
        IOLog("AppleCamIn::ISP_Init - Got second int from ISPCPU (channel description table ready)\n");
      }
      v22 = *(_QWORD *)(v2 + 312);
      if ( v22 )
      {
        v21 = *(_DWORD *)(v2 + 320);
        IOFree(v22, v21);
        *(_DWORD *)(v2 + 320) = 0;
      }
      v23 = *(_DWORD *)(v2 + 584);
      *(_DWORD *)(v2 + 320) = *(_DWORD *)(v2 + 584) << 8;
      LODWORD(v24) = IOMalloc(v23 << 8, v21);
      *(_QWORD *)(v2 + 312) = v24;
      if ( v24 )
      {
        bcopy(
          (const void *)(*(_QWORD *)(v2 + 4056) + *(_DWORD *)(*(_QWORD *)(v2 + 4072) + 798720LL)),
          v24,
          *(_DWORD *)(v2 + 320));
        if ( *(_DWORD *)(v2 + 584) )
        {
          LODWORD(v25) = 0;
          do
          {
            v25 = (unsigned int)v25;
            a2 = *(void **)(v2 + 312);
            v26 = (unsigned __int64)(unsigned int)v25 << 8;
            v27 = (char *)a2 + v26 + 64;
            if ( *(_BYTE *)(v2 + 4020) & 1 )
            {
              v28 = *(_DWORD *)v27;
              v29 = *(_DWORD *)((char *)a2 + v26 + 68);
              v30 = *(_DWORD *)((char *)a2 + v26 + 72);
              IOLog("AppleCamIn::ISP_Init - Found channel %d in the channel table. Type=%d (%s), Source=%d, size: %d\n");
            }
            v31 = 1;
            if ( *(_DWORD *)v27 )
            {
              v31 = 0;
            }
            v32 = *(_DWORD *)((char *)a2 + v26 + 68);
            if ( v32 == 2 )
            {
              v33 = *(_DWORD *)((char *)a2 + v26 + 72);
              v34 = *(_QWORD *)(v2 + 4056) + *(_DWORD *)((char *)a2 + v26 + 76);
              v35 = (__int64)AppleCamIn::doorBellRing2;
            }
            else if ( v32 == 1 )
            {
              v33 = *(_DWORD *)((char *)a2 + v26 + 72);
              v34 = *(_QWORD *)(v2 + 4056) + *(_DWORD *)((char *)a2 + v26 + 76);
              v35 = (__int64)AppleCamIn::doorBellRing1;
            }
            else if ( v32 )
            {
              v33 = *(_DWORD *)((char *)a2 + v26 + 72);
              v34 = *(_QWORD *)(v2 + 4056) + *(_DWORD *)((char *)a2 + v26 + 76);
              v35 = (__int64)AppleCamIn::doorBellRing3;
            }
            else
            {
              v33 = *(_DWORD *)((char *)a2 + v26 + 72);
              v34 = *(_QWORD *)(v2 + 4056) + *(_DWORD *)((char *)a2 + v26 + 76);
              v35 = (__int64)AppleCamIn::doorBellRing0;
            }
            *(_QWORD *)(v2 + 8 * v25 + 328) = IOProcessorChannelCreate(v31, v34, v33, v35, v2);
            LODWORD(v25) = v25 + 1;
          }
          while ( (unsigned int)v25 < *(_DWORD *)(v2 + 584) );
        }
        *(_DWORD *)(*(_QWORD *)(v2 + 4072) + 798732LL) = 134488070;
        v36 = 0;
        IOPCIDevice::extendedConfigWrite32(*(IOPCIDevice **)(v2 + 248), 0LL, 0x12345678u);
        while ( *(_DWORD *)(*(_QWORD *)(v2 + 4072) + 798732LL) )
        {
          IOSleep(10LL);
          ++v36;
          if ( v36 >= 0x3E9 )
          {
            IOLog("AppleCamIn::ISP_Init - No magic nubmer 1 from ISPCPU\n");
            v4 = 3758097110LL;
            v3 = off_12040[0];
            goto LABEL_26;
          }
        }
        if ( (unsigned int)AppleCamIn::channelNameToIndex((AppleCamIn *)v2, "SHAREDMALLOC", (unsigned int *)(v2 + 600)) )
        {
          IOLog("AppleCamIn::ISP_Init - No %s ipc channel found\n");
          v4 = 3758097114LL;
          v3 = off_12040[0];
        }
        else
        {
          v37 = AppleCamIn::channelNameToIndex((AppleCamIn *)v2, "TERMINAL", (unsigned int *)(v2 + 604));
          v3 = off_12040[0];
          if ( v37 )
          {
            v38 = (__int64)"AppleCamIn::ISP_Init - No %s ipc channel found\n";
            goto LABEL_68;
          }
          if ( (unsigned int)AppleCamIn::channelNameToIndex((AppleCamIn *)v2, "BUF_H2T", (unsigned int *)(v2 + 608)) )
          {
            v38 = (__int64)"AppleCamIn::ISP_Init - No %s ipc channel found\n";
            goto LABEL_68;
          }
          if ( (unsigned int)AppleCamIn::channelNameToIndex((AppleCamIn *)v2, "BUF_T2H", (unsigned int *)(v2 + 612)) )
          {
            v38 = (__int64)"AppleCamIn::ISP_Init - No %s ipc channel found\n";
LABEL_68:
            IOLog(v38);
            v4 = 3758097114LL;
          }
          else
          {
            if ( (unsigned int)AppleCamIn::channelNameToIndex((AppleCamIn *)v2, "IO", (unsigned int *)(v2 + 616)) )
            {
              v39 = (__int64)"AppleCamIn::ISP_Init - No %s ipc channel found\n";
              goto LABEL_75;
            }
            if ( (unsigned int)AppleCamIn::channelNameToIndex((AppleCamIn *)v2, "IO_T2H", (unsigned int *)(v2 + 620)) )
            {
              v39 = (__int64)"AppleCamIn::ISP_Init - No %s ipc channel found\n";
              goto LABEL_75;
            }
            if ( (unsigned int)AppleCamIn::channelNameToIndex((AppleCamIn *)v2, "DEBUG", (unsigned int *)(v2 + 624)) )
            {
              v39 = (__int64)"AppleCamIn::ISP_Init - No %s ipc channel found\n";
LABEL_75:
              IOLog(v39);
              v4 = 3758097114LL;
            }
            else
            {
              if ( *(_BYTE *)(v2 + 4020) & 1 )
              {
                IOLog("AppleCamIn::ISP_Init - ISPCPU Ready. About to enable ISP interrupts\n");
              }
              *(_WORD *)(v2 + 680) = 257;
              *(int *)((char *)&dword_41004 + *(_QWORD *)(v2 + 4072)) = 248;
              v4 = 0LL;
              IOPCIDevice::extendedConfigWrite32(*(IOPCIDevice **)(v2 + 248), 0LL, 0x12345678u);
              if ( *(_BYTE *)(v2 + 4016) )
              {
                v40 = (__int64)"AppleCamIn::ISP_Init - Firmware Unit-Test mode!\n";
LABEL_88:
                IOLog(v40);
                goto LABEL_89;
              }
              v52 = 0;
              v48 = 8;
              v41 = AppleCamIn::ispCmdSend((AppleCamIn *)v2, &v51, 8, &v48, 0, 0, 0, 0x7D0u);
              if ( *(_BYTE *)(v2 + 4020) & 2 )
              {
                IOLog("AppleCamIn::ISP_Init - CISP_CMD_START command completed: res=0x%08X\n");
              }
              v52 = 4;
              v53 = 1;
              v47 = 12;
              v4 = (unsigned int)AppleCamIn::ispCmdSend((AppleCamIn *)v2, &v51, 12, &v47, 0, 0, 0, 0x7D0u);
              if ( *(_BYTE *)(v2 + 4020) & 2 )
              {
                IOLog("AppleCamIn::ISP_Init - CISP_CMD_PRINT_ENABLE command completed: res=0x%08X\n");
              }
              v42 = *(_QWORD *)(v2 + 2136);
              if ( !v42 )
              {
                v40 = (__int64)"AppleCamIn::ISP_Init - No set-file loaded for camera\n";
                goto LABEL_88;
              }
              v52 = 273;
              v53 = 0;
              v54 = *(_DWORD *)(v42 + 4);
              v55 = *(_DWORD *)v42;
              v46 = 20;
              v4 = (unsigned int)AppleCamIn::ispCmdSend((AppleCamIn *)v2, &v51, 20, &v46, 0, 0, 0, 0x7D0u);
              if ( *(_BYTE *)(v2 + 4020) & 2 )
              {
                IOLog("AppleCamIn::ISP_Init - CISP_CMD_CH_SET_FILE_LOAD command (chan=%d) completed: res=0x%08X\n");
              }
LABEL_89:
              if ( !*(_BYTE *)(v2 + 724) )
              {
                AppleCamIn::ISP_InitialSensorDetection((AppleCamIn *)v2, a2);
              }
              *(_BYTE *)(v2 + 681) = 0;
              if ( *(_BYTE *)(v2 + 4020) & 8 )
              {
                v43 = mach_absolute_time();
                absolutetime_to_nanoseconds(v43 - v44, &v45);
                IOLog("AppleCamIn::ISP_Init - done (%lld usec)\n");
              }
              if ( !*(_BYTE *)(v2 + 4016) && *(_BYTE *)(v2 + 700) )
              {
                (*(void (__fastcall **)(__int64, _QWORD, _QWORD))(*(_QWORD *)v2 + 632LL))(v2, "CameraActive", 0LL);
                *(_BYTE *)(v2 + 700) = 0;
              }
            }
          }
        }
      }
    }
  }
  return (unsigned int)v4;
}
// 12040: using guessed type __int64 off_12040[4];
// 40004: using guessed type int dword_40004;
// 40008: using guessed type int dword_40008;
// 41000: using guessed type int dword_41000;
// 41004: using guessed type int dword_41004;
// 41020: using guessed type int dword_41020;
// 41024: using guessed type int dword_41024;
// B6378: using guessed type int __fastcall IOFree(_QWORD, _QWORD);
// B6390: using guessed type int __fastcall IOLog(_QWORD);
// B6398: using guessed type int __fastcall IOMalloc(_QWORD, _QWORD);
// B63A0: using guessed type int __fastcall IOSleep(_QWORD);
// B6EE8: using guessed type int __fastcall absolutetime_to_nanoseconds(_QWORD, _QWORD);

//----- (0000000000005286) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_deInit(AppleCamIn *this, char *a2)
{
  AppleCamIn *v2; // r15@1
  __int64 v3; // r13@1
  unsigned int v4; // ebx@3
  unsigned int v5; // ebx@6
  unsigned int v6; // ecx@9
  __int64 v7; // rsi@11
  unsigned int v8; // edx@13
  __int64 v9; // rsi@14
  __int64 v10; // r14@14
  __int64 v11; // rax@18
  __int64 v12; // rbx@18
  __int64 v13; // rax@19
  __int64 v14; // rax@22
  __int64 v15; // rax@22
  __int64 v16; // rax@25
  __int64 v17; // r12@25
  __int64 v18; // rax@26
  __int64 v19; // rbx@26
  __int64 v20; // rsi@27
  int v21; // ecx@27
  __int64 v22; // rax@28
  __int64 v23; // rax@30
  void *v24; // rdi@31
  __int64 v25; // rax@35
  __int64 v26; // rax@35
  unsigned int v27; // eax@37
  unsigned int v28; // ebx@38
  __int64 result; // rax@44
  unsigned int v30; // [sp+1Ch] [bp-134h]@3
  char v31; // [sp+20h] [bp-130h]@3
  __int16 v32; // [sp+24h] [bp-12Ch]@3
  int v33; // [sp+28h] [bp-128h]@3
  __int64 v34; // [sp+120h] [bp-30h]@1

  v2 = this;
  v3 = off_12040[0];
  v34 = *(_QWORD *)off_12040[0];
  if ( *((_BYTE *)this + 680) && !*((_BYTE *)this + 4016) )
  {
    v33 = 0;
    v32 = 257;
    v30 = 12;
    a2 = &v31;
    v4 = AppleCamIn::ispCmdSend(this, &v31, 12, &v30, 0, 0, 0, 0xFAu);
    if ( *((_BYTE *)this + 4020) & 2 )
    {
      a2 = (char *)v4;
      IOLog("AppleCamIn::ISP_deInit - CISP_CMD_CH_STOP command completed: res=0x%08X\n");
    }
    if ( !v4 )
    {
      v33 = 1;
      v32 = 257;
      v30 = 12;
      a2 = &v31;
      v5 = AppleCamIn::ispCmdSend(this, &v31, 12, &v30, 0, 0, 0, 0x7D0u);
      if ( *((_BYTE *)this + 4020) & 2 )
      {
        a2 = (char *)v5;
        IOLog("AppleCamIn::ISP_deInit - CISP_CMD_CH_STOP command completed: res=0x%08X\n");
      }
      if ( !v5 )
      {
        v32 = 1;
        v30 = 8;
        a2 = &v31;
        v6 = AppleCamIn::ispCmdSend(this, &v31, 8, &v30, 0, 0, 0, 0x7D0u);
        if ( *((_BYTE *)this + 4020) & 2 )
        {
          a2 = (char *)v6;
          IOLog("AppleCamIn::ISP_deInit - CISP_CMD_STOP command completed: res=0x%08X\n");
        }
      }
    }
  }
  IODelay(10000LL, a2);
  *(int *)((char *)&dword_40004 + *((_QWORD *)this + 509)) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(int *)((char *)&dword_41004 + *((_QWORD *)this + 509)) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  v7 = *((_QWORD *)this + 74);
  if ( v7 )
  {
    DeviceMemoryManager::Free(
      *((DeviceMemoryManager **)this + 499),
      v7 - (*((_DWORD *)this + 176) + *((_DWORD *)this + 1000)));
  }
  *(_DWORD *)(*((_QWORD *)this + 509) + 786440LL) = -1;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 786444LL) = -1;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 786448LL) = -1;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 790532LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 790540LL) = -1;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 790548LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 790556LL) = -1;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 790564LL) = -1;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  IODelay(10LL, 0LL);
  *(_DWORD *)(*((_QWORD *)this + 509) + 786432LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 786436LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 786440LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 786444LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 786448LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 786452LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 786456LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 786460LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 786464LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 509) + 786468LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  IODelay(10LL, 0LL);
  if ( (*(int (**)(void))(**((_QWORD **)this + 81) + 304LL))() )
  {
    v9 = 0LL;
    v10 = OSSet::withSet(*((OSSet **)this + 81), 0LL, v8);
    if ( v10 )
    {
      while ( (*(int (__fastcall **)(__int64, __int64))(*(_QWORD *)v10 + 304LL))(v10, v9) )
      {
        LODWORD(v11) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v10 + 496LL))(v10);
        v12 = v11;
        if ( v11 )
        {
          LODWORD(v13) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v11 + 376LL))(v11);
          if ( v13 )
          {
            (*(void (__fastcall **)(_QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 488LL))(
              *((_QWORD *)this + 35),
              *(_DWORD *)(v13 + 32),
              0LL);
            v9 = v12;
            (*(void (__fastcall **)(__int64, __int64))(*(_QWORD *)v10 + 472LL))(v10, v12);
          }
        }
      }
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v10 + 40LL))(v10);
    }
  }
  while ( (*(int (**)(void))(**((_QWORD **)this + 80) + 304LL))() )
  {
    LODWORD(v14) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 80) + 488LL))(
                     *((_QWORD *)this + 80),
                     0LL);
    LODWORD(v15) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v14 + 376LL))(v14);
    DeviceMemoryManager::Free(
      *((DeviceMemoryManager **)this + 499),
      *(_DWORD *)(v15 + 8) - (*((_DWORD *)this + 176) + *((_DWORD *)this + 1000)));
    (*(void (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 80) + 472LL))(*((_QWORD *)this + 80), 0LL);
  }
  if ( (*(int (**)(void))(**((_QWORD **)this + 79) + 304LL))() )
  {
    do
    {
      LODWORD(v16) = (*(int (**)(void))(**((_QWORD **)v2 + 79) + 496LL))();
      v17 = v16;
      if ( v16 )
      {
        LODWORD(v18) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v16 + 376LL))(v16);
        v19 = v18;
        if ( v18 )
        {
          v20 = *(_DWORD *)(v18 + 144);
          IOLog("AppleCamIn::ISP_deInit - releasing buffer 0x%08X that was never passed back to the user-space client\n");
          v21 = *(_DWORD *)(v19 + 148);
          if ( v21 )
          {
            v22 = *(_QWORD *)(v19 + 160);
            if ( v22 )
            {
              if ( (v21 & 0xFFFFFFFE) == 2 )
              {
                LODWORD(v23) = (*(int (__fastcall **)(_QWORD, __int64))(**(_QWORD **)(v19 + 96) + 368LL))(
                                 *(_QWORD *)(v19 + 96),
                                 v20);
                (*(void (__fastcall **)(__int64, _QWORD, _QWORD, _QWORD))(*(_QWORD *)v23 + 488LL))(
                  v23,
                  0LL,
                  *(_QWORD *)(*(_QWORD *)(v19 + 160) + 8LL),
                  **(_DWORD **)(v19 + 160));
                v22 = *(_QWORD *)(v19 + 160);
              }
              v20 = (unsigned int)(*(_DWORD *)(v22 + 8) - (*((_DWORD *)v2 + 176) + *((_DWORD *)v2 + 1000)));
              DeviceMemoryManager::Free(*((DeviceMemoryManager **)v2 + 499), v20);
              v24 = *(void **)(v19 + 160);
              if ( v24 )
              {
                operator delete(v24);
              }
              *(_QWORD *)(v19 + 160) = 0LL;
            }
          }
          else
          {
            IOMMUManager::Free(*((IOMMUManager **)v2 + 498), *(_DWORD *)(v19 + 152));
            (*(void (__fastcall **)(_QWORD, signed __int64))(**(_QWORD **)(v19 + 136) + 304LL))(
              *(_QWORD *)(v19 + 136),
              1LL);
            v20 = *(_QWORD *)(v19 + 136);
            (*(void (__fastcall **)(_QWORD, __int64))(**((_QWORD **)v2 + 38) + 304LL))(*((_QWORD *)v2 + 38), v20);
          }
          LODWORD(v25) = (*(int (__fastcall **)(_QWORD, __int64))(**(_QWORD **)(v19 + 96) + 368LL))(
                           *(_QWORD *)(v19 + 96),
                           v20);
          (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v25 + 504LL))(v25, 2LL);
          LODWORD(v26) = (*(int (**)(void))(**(_QWORD **)(v19 + 96) + 368LL))();
          (*(void (__fastcall **)(__int64))(*(_QWORD *)v26 + 40LL))(v26);
          (*(void (__fastcall **)(_QWORD, _QWORD, _QWORD))(**(_QWORD **)(v19 + 96) + 328LL))(
            *(_QWORD *)(v19 + 96),
            0LL,
            0LL);
          (*(void (**)(void))(**(_QWORD **)(v19 + 96) + 288LL))();
          (*(void (__fastcall **)(_QWORD, __int64))(**((_QWORD **)v2 + 79) + 472LL))(*((_QWORD *)v2 + 79), v17);
        }
      }
    }
    while ( (*(int (**)(void))(**((_QWORD **)v2 + 79) + 304LL))() );
  }
  *((_BYTE *)v2 + 204) = 0;
  v27 = *((_DWORD *)v2 + 146);
  if ( v27 )
  {
    v28 = 0;
    do
    {
      if ( *((_QWORD *)v2 + v28 + 41) != 0xFFFFFFFFLL )
      {
        IOProcessorChannelDelete();
        v27 = *((_DWORD *)v2 + 146);
      }
      ++v28;
    }
    while ( v28 < v27 );
  }
  *((_DWORD *)v2 + 146) = 0;
  if ( *((_BYTE *)v2 + 4020) & 1 )
  {
    IOLog("AppleCamIn::ISP_deInit - done\n");
  }
  result = *(_QWORD *)v3;
  if ( *(_QWORD *)v3 == v34 )
  {
    result = 0LL;
  }
  return result;
}
// 12040: using guessed type __int64 off_12040[4];
// 40004: using guessed type int dword_40004;
// 41004: using guessed type int dword_41004;
// B6370: using guessed type int __fastcall IODelay(_QWORD, _QWORD);
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (0000000000005A4C) ----------------------------------------------------
__int64 __fastcall AppleCamIn::DisableFHSi(AppleCamIn *this)
{
  __int64 v1; // rax@1
  __int64 v2; // rax@1
  __int64 v3; // rax@1

  v1 = AppleCamIn::ISP_I2CInit(this, 0);
  v2 = AppleCamIn::ISP_I2CWrite(this, v1, 72, 5, 0, 1u, 2u, 1u);
  v3 = AppleCamIn::ISP_I2CWrite(this, v2, 72, 3, 0, 1u, 0, 1u);
  AppleCamIn::ISP_I2CWrite(this, v3, 72, 4, 0, 1u, 0, 1u);
  return 0LL;
}

//----- (0000000000005ADE) ----------------------------------------------------
__int64 __fastcall AppleCamIn::initialPowerStateForDomainState(AppleCamIn *this)
{
  return 0LL;
}

//----- (0000000000005AE6) ----------------------------------------------------
__int64 __usercall AppleCamIn::setPowerStateGated@<rax>(AppleCamIn *this@<rdi>, IOService *a2@<rdx>, __int64 a3@<rsi>, void *a4@<r12>)
{
  __int64 v4; // rbx@1
  signed int v5; // er14@4

  v4 = a3;
  if ( *((_BYTE *)this + 4020) & 0x40 )
  {
    a3 = (unsigned int)a3;
    IOLog("AppleCamIn::setPowerStateGated: %d\n");
  }
  if ( v4 == 1 )
  {
    v5 = -536870172;
    if ( *((_BYTE *)this + 682) )
    {
      v5 = 0;
      if ( !*((_BYTE *)this + 656) )
      {
        AppleCamIn::power_on_hardware(this, a3, a4);
      }
    }
  }
  else
  {
    v5 = 0;
    if ( *((_BYTE *)this + 656) )
    {
      AppleCamIn::power_off_hardware(this, (char *)a3);
    }
  }
  return (unsigned int)v5;
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (0000000000005B60) ----------------------------------------------------
int __fastcall AppleCamIn::setPowerState(AppleCamIn *this, __int64 a2, IOService *a3)
{
  return (*(int (__fastcall **)(_QWORD, __int64 (__usercall *)@<rax>(AppleCamIn *@<rdi>, IOService *@<rdx>, __int64@<rsi>, void *@<r12>), __int64, IOService *, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
           *((_QWORD *)this + 35),
           AppleCamIn::setPowerStateGated,
           a2,
           a3,
           0LL,
           0LL);
}

//----- (0000000000005B92) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_PowerOnCamera(AppleCamIn *this, unsigned int a2, void *a3)
{
  int result; // eax@2

  if ( *((_BYTE *)this + 682) )
  {
    result = (*(int (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleCamIn *__hidden, unsigned int, void *), _QWORD, void *, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
               *((_QWORD *)this + 35),
               AppleCamIn::ISP_PowerOnCamera_gated,
               a2,
               a3,
               0LL,
               0LL);
  }
  else
  {
    result = -536870172;
  }
  return result;
}

//----- (0000000000005BD0) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_PowerOnCamera_gated(AppleCamIn *this, unsigned int a2, void *a3)
{
  signed int v3; // ebx@1
  void *v4; // rcx@2

  v3 = -536870206;
  if ( a2 <= 1 )
  {
    v4 = (void *)*((_QWORD *)this + a2 + 83);
    if ( !v4 || (v3 = -536870187, v4 == a3) )
    {
      *((_QWORD *)this + a2 + 83) = a3;
      v3 = 0;
      if ( !*((_BYTE *)this + 656) )
      {
        IOService::changePowerStateToPriv(this, 1uLL);
      }
    }
  }
  return (unsigned int)v3;
}

//----- (0000000000005C20) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_PowerOffCamera(AppleCamIn *this, unsigned int a2, void *a3)
{
  return (*(int (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleCamIn *__hidden, unsigned int, void *), _QWORD, void *, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
           *((_QWORD *)this + 35),
           AppleCamIn::ISP_PowerOffCamera_gated,
           a2,
           a3,
           0LL,
           0LL);
}

//----- (0000000000005C4E) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_PowerOffCamera_gated(AppleCamIn *this, unsigned int a2, void *a3)
{
  signed int v3; // ebx@1
  void *v4; // rcx@2

  v3 = -536870206;
  if ( a2 <= 1 )
  {
    v4 = (void *)*((_QWORD *)this + a2 + 83);
    v3 = -536870208;
    if ( v4 )
    {
      v3 = -536870187;
      if ( v4 == a3 )
      {
        *((_QWORD *)this + a2 + 83) = 0LL;
        v3 = 0;
        if ( !*((_QWORD *)this + 83) && !*((_QWORD *)this + 84) )
        {
          v3 = 0;
          IOService::changePowerStateToPriv(this, 0LL);
        }
      }
    }
  }
  return (unsigned int)v3;
}

//----- (0000000000005CB0) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_SendCommand(AppleCamIn *this, unsigned __int8 *a2, int a3, int a4, int a5, task *a6)
{
  unsigned __int8 *v7; // [sp+0h] [bp-20h]@1
  int v8; // [sp+8h] [bp-18h]@1
  int v9; // [sp+Ch] [bp-14h]@1
  int v10; // [sp+10h] [bp-10h]@1
  task *v11; // [sp+18h] [bp-8h]@1

  v7 = a2;
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = a6;
  return (*(int (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleCamIn *, __int64, __int64, __int64, task *), __int64 *, _QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
           *((_QWORD *)this + 35),
           AppleCamIn::ISP_SendCommand_gated,
           &v7,
           0LL,
           0LL,
           0LL);
}

//----- (0000000000005CF4) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_SendCommand_gated(AppleCamIn *this, __int64 a2, __int64 a3, __int64 a4, task *a5)
{
  __int64 v5; // r13@1
  signed int v6; // ebx@1
  __int64 v7; // r14@3
  __int64 v8; // rax@4
  __int64 v9; // r12@4
  void *v10; // rax@5
  void *v11; // rsi@5
  unsigned int v13; // [sp+14h] [bp-2Ch]@5

  v5 = a2;
  v6 = -536870173;
  if ( *((_BYTE *)this + 656) )
  {
    v6 = -536870206;
    if ( a2 )
    {
      v7 = IOMemoryDescriptor::withAddressRange(
             *(IOMemoryDescriptor **)a2,
             *(_DWORD *)(a2 + 8),
             3uLL,
             *(_QWORD *)(a2 + 24),
             a5);
      if ( v7 )
      {
        LODWORD(v8) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v7 + 512LL))(v7, 0LL);
        v9 = v8;
        v6 = -536870211;
        if ( v8 )
        {
          v13 = *(_DWORD *)(a2 + 8);
          LODWORD(v10) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v8 + 280LL))(v8);
          v11 = v10;
          v6 = AppleCamIn::ispCmdSend(
                 this,
                 v10,
                 *(_DWORD *)(v5 + 8),
                 &v13,
                 *(_DWORD *)(v5 + 12),
                 0,
                 0,
                 *(_DWORD *)(v5 + 16));
          (*(void (__fastcall **)(__int64, void *))(*(_QWORD *)v9 + 40LL))(v9, v11);
        }
        (*(void (__fastcall **)(__int64))(*(_QWORD *)v7 + 40LL))(v7);
      }
      else
      {
        IOLog("AppleCamIn::ISP_SendCommand_gated - couldn't create command memory descriptor\n");
        v6 = -536870211;
      }
    }
  }
  return (unsigned int)v6;
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (0000000000005DDE) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ispCmdSend(AppleCamIn *this, void *a2, int a3, unsigned int *a4, int a5, char a6, unsigned int a7, unsigned int a8)
{
  unsigned int v8; // er12@1
  signed int v9; // er14@3
  void *v10; // r13@7
  char v11; // r15@7
  char *v12; // rax@7
  __int64 v13; // rax@11
  int v14; // eax@12
  __int64 v15; // rbx@14
  __int64 v16; // rax@14
  __int64 v17; // r14@14
  void *v18; // rdi@14
  __int64 v19; // r13@15
  AppleCamIn *v20; // rbx@16
  __int64 v21; // rbx@18
  __int64 v22; // rsi@21
  int v23; // esi@26
  __int64 v24; // rsi@29
  __int64 v25; // rdi@30
  __int64 v26; // rdx@33
  __int64 v27; // rcx@33
  int v28; // er13@33
  int v29; // eax@35
  uint64_t v30; // rax@36
  __int64 v31; // rsi@36
  __int64 v32; // r8@36
  bool v33; // sf@37
  void *v34; // rax@37
  __int64 v35; // r14@40
  __int64 v36; // rsi@43
  __int64 v38; // [sp+18h] [bp-98h]@10
  int *v39; // [sp+20h] [bp-90h]@7
  __int64 v40; // [sp+28h] [bp-88h]@10
  void *v41; // [sp+30h] [bp-80h]@25
  AppleCamIn *v42; // [sp+38h] [bp-78h]@11
  int v43; // [sp+44h] [bp-6Ch]@7
  size_t v44; // [sp+48h] [bp-68h]@14
  __int64 v45; // [sp+50h] [bp-60h]@36
  __int64 v46; // [sp+58h] [bp-58h]@33
  __int64 v47; // [sp+60h] [bp-50h]@14
  int v48; // [sp+68h] [bp-48h]@14

  v8 = 2000;
  if ( a8 )
  {
    v8 = a8;
  }
  v9 = -536870184;
  if ( *((_BYTE *)this + 680) )
  {
    if ( !*((_BYTE *)this + 4016) || (v9 = -536870174, a5 == 1) )
    {
      if ( a5 == 1 )
      {
        v39 = (int *)a4;
        v10 = a2;
        v11 = a6;
        v43 = a3;
        v12 = (char *)this + 624;
      }
      else
      {
        v9 = -536870206;
        if ( a5 )
        {
          return (unsigned int)v9;
        }
        v39 = (int *)a4;
        v10 = a2;
        v11 = a6;
        v43 = a3;
        v12 = (char *)this + 616;
      }
      v38 = *(_DWORD *)v12;
      v40 = OSData::withCapacity((OSData *)stru_20.segname, (unsigned int)a2);
      v9 = -536870211;
      if ( v40 )
      {
        v42 = this;
        v13 = (__int64)v10;
        if ( !v11 )
        {
          v14 = DeviceMemoryManager::Allocate(*((DeviceMemoryManager **)this + 499), v43);
          if ( v14 == -1 )
          {
            (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v40 + 40LL))(v40, (unsigned int)v43);
            return (unsigned int)v9;
          }
          v13 = *((_QWORD *)this + 500) + (unsigned int)(*((_DWORD *)this + 176) + v14);
        }
        v44 = v13;
        v48 = v43;
        v47 = v13;
        v15 = v40;
        (*(void (__fastcall **)(__int64, __int64 *, signed __int64))(*(_QWORD *)v40 + 360LL))(v40, &v47, 40LL);
        (*(void (__fastcall **)(_QWORD, __int64))(**((_QWORD **)this + 81) + 448LL))(*((_QWORD *)this + 81), v40);
        (*(void (__fastcall **)(__int64))(*(_QWORD *)v15 + 40LL))(v15);
        LODWORD(v16) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v15 + 376LL))(v15);
        v17 = v16;
        *((_WORD *)v10 + 3) = 0;
        v18 = v10;
        if ( !v11 )
        {
          v19 = v16;
          bcopy(v18, (void *)v44, (unsigned int)v43);
          v17 = v19;
        }
        v20 = v42;
        if ( *((_DWORD *)v42 + 1005) < 0 )
        {
          IOLog("ISPCPU Command Packet Sent:\n");
          if ( v43 )
          {
            v21 = 0LL;
            do
            {
              if ( !(v21 & 0xF) )
              {
                IOLog("    0x%04X:     ");
              }
              v22 = *(_BYTE *)(v44 + v21);
              IOLog("%02X  ");
              if ( (v21 & 0xF) == 15 )
              {
                IOLog("\n");
              }
              ++v21;
            }
            while ( v43 != (_DWORD)v21 );
          }
          IOLog("\n");
          v20 = v42;
        }
        v41 = v18;
        *(_QWORD *)(v17 + 16) = mach_absolute_time();
        if ( v11 )
        {
          v23 = a7;
        }
        else
        {
          v23 = v44 - *((_DWORD *)v20 + 1014);
        }
        *(_DWORD *)(v17 + 32) = v23;
        IOProcessorChannelSend(*((_QWORD *)v20 + v38 + 41), v23, v43, *v39);
        if ( *((_BYTE *)v20 + 4020) & 2 )
        {
          v24 = *((_WORD *)v18 + 2);
          if ( (_DWORD)v38 == *((_DWORD *)v20 + 156) )
          {
            v25 = (__int64)"AppleCamIn::ispCmdSend - sent debug command to isp. opcode: 0x%04X\n";
          }
          else
          {
            v25 = (__int64)"AppleCamIn::ispCmdSend - sent command to isp. opcode: 0x%04X\n";
          }
          IOLog(v25);
        }
        clock_interval_to_deadline(v8, 1000000LL, &v46);
        v28 = (*(int (__fastcall **)(_QWORD, _QWORD, __int64, _QWORD))(**((_QWORD **)v20 + 35) + 496LL))(
                *((_QWORD *)v20 + 35),
                *(_DWORD *)(v17 + 32),
                v46,
                0LL);
        if ( !v11 )
        {
          bcopy((const void *)v44, v41, (unsigned int)v43);
        }
        v29 = *((_DWORD *)v20 + 1005);
        if ( v29 & 8 )
        {
          v30 = mach_absolute_time();
          *(_QWORD *)(v17 + 24) = v30;
          absolutetime_to_nanoseconds(v30 - *(_QWORD *)(v17 + 16), &v45);
          v31 = *((_WORD *)v41 + 2);
          v32 = *((_WORD *)v41 + 3);
          IOLog("AppleCamIn::ispCmdSend - command (opcode: 0x%04X) took %lld usec res=0x%08X ack=0x%08X\n");
          v29 = *((_DWORD *)v20 + 1005);
        }
        LOBYTE(v27) = v28 != 1;
        v33 = v29 < 0;
        v34 = v41;
        if ( v33 && (_BYTE)v27 )
        {
          IOLog("ISPCPU Response Packet Received:\n");
          if ( v43 )
          {
            v35 = 0LL;
            do
            {
              if ( !(v35 & 0xF) )
              {
                IOLog("    0x%04X:     ");
              }
              v36 = *(_BYTE *)(v44 + v35);
              IOLog("%02X  ");
              if ( (v35 & 0xF) == 15 )
              {
                IOLog("\n");
              }
              ++v35;
            }
            while ( v43 != (_DWORD)v35 );
          }
          IOLog("\n");
          v34 = v41;
        }
        v9 = -536870186;
        if ( v28 != 1 )
        {
          v9 = 0;
          if ( *((_WORD *)v34 + 3) )
          {
            v9 = -536870212;
            if ( *((_BYTE *)v42 + 4020) & 2 )
            {
              IOLog("AppleCamIn::ispCmdSend - ack %d error on command\n");
            }
          }
        }
        (*(void (__fastcall **)(_QWORD, __int64, __int64, __int64))(**((_QWORD **)v42 + 81) + 472LL))(
          *((_QWORD *)v42 + 81),
          v40,
          v26,
          v27);
        if ( !v11 )
        {
          DeviceMemoryManager::Free(
            *((DeviceMemoryManager **)v42 + 499),
            v44 - (*((_DWORD *)v42 + 176) + *((_DWORD *)v42 + 1000)));
        }
      }
    }
  }
  return (unsigned int)v9;
}
// 20: using guessed type segment_command_64 stru_20;
// B6390: using guessed type int __fastcall IOLog(_QWORD);
// B6EE8: using guessed type int __fastcall absolutetime_to_nanoseconds(_QWORD, _QWORD);
// B6F10: using guessed type int __fastcall clock_interval_to_deadline(_QWORD, _QWORD, _QWORD);

//----- (000000000000629E) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_I2CInit(AppleCamIn *this, int a2)
{
  signed int v2; // er15@1
  signed int v3; // er14@2

  v2 = 536576;
  if ( !a2 )
  {
    goto LABEL_4;
  }
  v3 = -536870206;
  if ( a2 == 1 )
  {
    v2 = 552960;
LABEL_4:
    *((_DWORD *)this + 34) = 31;
    *(_DWORD *)(*((_QWORD *)this + 509) + (v2 | 0x18u)) = 0;
    v3 = 0;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 509) + (v2 | 0x1Cu)) = *((_DWORD *)this + 34) | 0x100;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 509) + (v2 | 0x30u)) = 260;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 509) + (v2 | 0x3Cu)) = 5000000;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 509) + (v2 | 0x34u)) = 1310730000;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  }
  return (unsigned int)v3;
}

//----- (00000000000063AE) ----------------------------------------------------
__int64 __usercall AppleCamIn::ISP_I2CWrite@<rax>(AppleCamIn *this@<rdi>, __int64 a2@<rax>, int a3@<edx>, int a4@<ecx>, int a5@<esi>, unsigned int a6@<r8d>, unsigned int a7@<r9d>, unsigned int a8)
{
  unsigned int v8; // er14@1
  signed int v9; // ebx@1
  unsigned int v10; // er15@2
  signed __int64 v11; // r12@3
  __int64 v12; // rbx@7
  unsigned int v13; // ebx@10
  __int64 v15; // [sp+0h] [bp-30h]@1

  v15 = a2;
  v8 = a7;
  HIDWORD(v15) = a4;
  v9 = -536870206;
  if ( a6 <= 2 )
  {
    v10 = a8;
    if ( a8 <= 4 )
    {
      LODWORD(v15) = a6;
      v11 = 536576LL;
      if ( a5 )
      {
        if ( a5 != 1 )
        {
          return (unsigned int)v9;
        }
        v11 = 552960LL;
      }
      *(_DWORD *)(*((_QWORD *)this + 509) + v11) = 2 * a3 | 0x100;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      if ( (signed int)v15 - 1 >= 0 )
      {
        v12 = (signed int)v15 - 1;
        do
        {
          *(_DWORD *)(*((_QWORD *)this + 509) + v11) = *((_BYTE *)&v15 + v12 + 4);
          IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
          --v12;
        }
        while ( (signed int)v12 >= 0 );
      }
      if ( a8 >= 2 )
      {
        v13 = 8 * a8 - 8;
        do
        {
          *(_DWORD *)(*((_QWORD *)this + 509) + v11) = (unsigned __int8)(v8 >> v13);
          IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
          --v10;
          v13 -= 8;
        }
        while ( v10 > 1 );
      }
      *(_DWORD *)(*((_QWORD *)this + 509) + v11) = (unsigned __int8)v8 | 0x200;
      v9 = 0;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    }
  }
  return (unsigned int)v9;
}

//----- (00000000000064D6) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_EnableSensorPower(AppleCamIn *this, unsigned int a2, unsigned __int8 a3)
{
  return (*(int (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleCamIn *, unsigned int, char), _QWORD, _QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
           *((_QWORD *)this + 35),
           AppleCamIn::ISP_EnableSensorPower_gated,
           a2,
           a3,
           0LL,
           0LL);
}

//----- (0000000000006504) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_EnableSensorPower_gated(AppleCamIn *this, unsigned int a2, char a3)
{
  signed int v3; // ebx@1

  v3 = -536870173;
  if ( *((_BYTE *)this + 656) )
  {
    v3 = -536870206;
    if ( a2 <= 1 )
    {
      if ( a3 )
      {
        AppleCamIn::EnableSensor(this);
        v3 = 0;
      }
      else
      {
        v3 = 0;
        if ( *((_BYTE *)this + 700) )
        {
          v3 = 0;
          (*(void (__fastcall **)(AppleCamIn *, _QWORD, _QWORD))(*(_QWORD *)this + 632LL))(this, "CameraActive", 0LL);
          *((_BYTE *)this + 700) = 0;
        }
      }
    }
  }
  return (unsigned int)v3;
}

//----- (000000000000656A) ----------------------------------------------------
__int64 __fastcall AppleCamIn::GenerateTagForClientBufferArgsDataPointer(AppleCamIn *this, OSData *a2)
{
  __int64 v2; // rax@1

  LODWORD(v2) = (*(int (__fastcall **)(OSData *))(*(_QWORD *)a2 + 376LL))(a2);
  return *(_DWORD *)(v2 + 128);
}

//----- (0000000000006582) ----------------------------------------------------
__int64 __fastcall AppleCamIn::GenerateClientBufferArgsDataPointerFromTag(AppleCamIn *this, __int64 a2)
{
  __int64 v2; // rax@1
  __int64 v3; // r15@1
  __int64 v4; // r12@1
  __int64 v5; // rax@2
  __int64 v6; // rbx@2
  __int64 v7; // rax@3
  __int64 v8; // rax@5

  LODWORD(v2) = OSCollectionIterator::withCollection(*((_QWORD *)this + 79));
  v3 = v2;
  v4 = 0LL;
  if ( v2 )
  {
    LODWORD(v5) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v2 + 296LL))(v2);
    v6 = v5;
    v4 = 0LL;
    if ( v5 )
    {
      do
      {
        LODWORD(v7) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v6 + 376LL))(v6);
        if ( v7 )
        {
          v4 = v6;
          if ( *(_DWORD *)(v7 + 128) == a2 )
          {
            break;
          }
        }
        LODWORD(v8) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v3 + 296LL))(v3);
        v6 = v8;
        v4 = 0LL;
      }
      while ( v8 );
    }
    (*(void (__fastcall **)(__int64))(*(_QWORD *)v3 + 40LL))(v3);
  }
  return v4;
}
// B6778: using guessed type int __fastcall OSCollectionIterator::withCollection(_QWORD);

//----- (000000000000660C) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_SetFullStatsMode(AppleCamIn *this, unsigned int a2)
{
  return (*(int (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleCamIn *, int), _QWORD, _QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
           *((_QWORD *)this + 35),
           AppleCamIn::ISP_SetFullStatsMode_gated,
           a2,
           0LL,
           0LL,
           0LL);
}

//----- (0000000000006636) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_SetFullStatsMode_gated(AppleCamIn *this, int a2)
{
  *((_BYTE *)this + 4017) = a2 != 0;
  return 0LL;
}

//----- (0000000000006648) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_MapIOSurfaceWithIOMMU(__int64 a1, __int64 a2, __int64 a3, __int64 a4)
{
  __int64 v4; // r13@1
  __int64 v5; // r14@1
  __int64 v6; // rax@1
  __int64 v7; // rbx@1
  __int64 v8; // rax@1
  __int64 v9; // r15@1
  __int64 v10; // rax@2
  signed int v11; // er12@2
  __int64 v12; // rax@3
  __int64 v13; // rbx@3
  __int64 v14; // r12@3
  int v15; // eax@6
  __int64 v16; // rax@7
  __int64 v17; // r13@7
  __int64 v18; // r12@8
  unsigned __int64 v19; // rbx@9
  __int64 v20; // r13@10
  int v21; // er15@10
  __int64 result; // rax@19
  __int64 v23; // [sp+18h] [bp-68h]@3
  __int64 v24; // [sp+20h] [bp-60h]@3
  __int64 v25; // [sp+20h] [bp-60h]@10
  __int64 v26; // [sp+28h] [bp-58h]@1
  int v27; // [sp+28h] [bp-58h]@7
  int v28; // [sp+34h] [bp-4Ch]@3
  __int64 v29; // [sp+38h] [bp-48h]@3
  unsigned __int64 v30; // [sp+40h] [bp-40h]@4
  unsigned __int64 v31; // [sp+48h] [bp-38h]@5
  __int64 v32; // [sp+50h] [bp-30h]@1

  v26 = a4;
  v4 = a3;
  v5 = a1;
  v32 = *(_QWORD *)off_12040[0];
  LODWORD(v6) = (*(int (__fastcall **)(__int64))(*(_QWORD *)a2 + 368LL))(a2);
  v7 = v6;
  LODWORD(v8) = (*(int (__fastcall **)(_QWORD, _QWORD))(**(_QWORD **)(v5 + 304) + 296LL))(*(_QWORD *)(v5 + 304), 0LL);
  v9 = v8;
  if ( v8
    || (IOLog("AppleCamIn::ISP_MapIOSurfaceWithIOMMU: No available IODMACommand in pool. Allocating another.\n"),
        LODWORD(v10) = IODMACommand::withSpecification(off_12010[0], 44LL, 0LL, 64LL, 0LL, 0LL),
        v9 = v10,
        v11 = -536870211,
        v10) )
  {
    v23 = v9;
    (*(void (__fastcall **)(__int64, __int64, signed __int64))(*(_QWORD *)v9 + 296LL))(v9, v7, 1LL);
    *(_QWORD *)v4 = v9;
    v29 = 0LL;
    v28 = 1;
    v24 = v7;
    LODWORD(v12) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v7 + 456LL))(v7);
    v13 = v12;
    v14 = 0LL;
    do
    {
      if ( (*(int (__fastcall **)(__int64, __int64 *, __int64 *, int *))(*(_QWORD *)v9 + 344LL))(v9, &v29, &v30, &v28) )
      {
        break;
      }
      v14 += v31 >> 12;
      v13 -= v31;
      v28 = 1;
    }
    while ( v13 );
    v15 = IOMMUManager::Allocate(*(IOMMUManager **)(a1 + 3984), v14);
    if ( v15 == -1 )
    {
      (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v9 + 304LL))(v9, 1LL);
      (*(void (__fastcall **)(_QWORD, __int64))(**(_QWORD **)(a1 + 304) + 304LL))(*(_QWORD *)(a1 + 304), v9);
      IOLog("Failed to allocate tlb space for this mapped IOSurface (needed %d TLBs)\n");
      v11 = -536870211;
    }
    else
    {
      *(_DWORD *)v26 = v15;
      v27 = v15;
      v29 = 0LL;
      v28 = 1;
      LODWORD(v16) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v24 + 456LL))(v24, (unsigned int)v14);
      v17 = v16;
      while ( 1 )
      {
        v18 = *(_QWORD *)(v5 + 4040);
        if ( (*(int (__fastcall **)(__int64, __int64 *, unsigned __int64 *, int *))(*(_QWORD *)v9 + 344LL))(
               v9,
               &v29,
               &v30,
               &v28) )
        {
          break;
        }
        v19 = (v31 >> 12) & 0xFFFFFFFF;
        if ( v19 )
        {
          v25 = v17;
          v20 = v5;
          v21 = 4 * v27 + 36864;
          LODWORD(v5) = 0;
          do
          {
            *(_DWORD *)(v18 + (unsigned int)v21) = v5 + (v30 >> 12);
            if ( !(v5 & 3) )
            {
              IOPCIDevice::extendedConfigWrite32(*(IOPCIDevice **)(v20 + 248), 0LL, 0x12345678u);
            }
            v5 = (unsigned int)(v5 + 1);
            v21 += 4;
          }
          while ( v5 < v19 );
          v27 += v5;
          v5 = v20;
          v9 = v23;
          v17 = v25;
        }
        v11 = 0;
        IOPCIDevice::extendedConfigWrite32(*(IOPCIDevice **)(v5 + 248), 0LL, 0x12345678u);
        v17 -= v31;
        v28 = 1;
        if ( !v17 )
        {
          goto LABEL_19;
        }
      }
      v11 = 0;
    }
  }
LABEL_19:
  result = *(_QWORD *)off_12040[0];
  if ( *(_QWORD *)off_12040[0] == v32 )
  {
    result = (unsigned int)v11;
  }
  return result;
}
// 12010: using guessed type __int64 off_12010[10];
// 12040: using guessed type __int64 off_12040[4];
// B6390: using guessed type int __fastcall IOLog(_QWORD);
// B6430: using guessed type int __fastcall IODMACommand::withSpecification(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (00000000000068D2) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_SendBuffers(__int64 a1, __int64 a2, unsigned int a3, __int64 a4, __int64 a5)
{
  return (*(int (__fastcall **)(_QWORD, signed __int64 (__fastcall *)(__int64, __int64, unsigned int, __int64, const void *), __int64, _QWORD, __int64, __int64))(**(_QWORD **)(a1 + 280) + 456LL))(
           *(_QWORD *)(a1 + 280),
           AppleCamIn::ISP_SendBuffers_gated,
           a2,
           a3,
           a4,
           a5);
}

//----- (0000000000006900) ----------------------------------------------------
signed __int64 __fastcall AppleCamIn::ISP_SendBuffers_gated(__int64 a1, __int64 a2, unsigned int a3, __int64 a4, const void *a5)
{
  unsigned int v5; // er12@1
  __int64 v6; // r13@1
  signed __int64 result; // rax@1
  int v8; // ebx@2
  __int64 v9; // rbx@3
  __int64 v10; // r14@3
  unsigned int v11; // esi@3
  signed __int64 v12; // rbx@4
  __int64 v13; // rax@5
  signed int v14; // ecx@5
  __int64 v15; // rsi@6
  __int64 v16; // rdx@6
  __int64 v17; // rcx@6
  __int64 v18; // r14@6
  int (__fastcall *v19)(_QWORD, _QWORD, _QWORD); // r13@6
  unsigned int v20; // er12@6
  __int64 v21; // rax@6
  __int64 v22; // rax@6
  __int64 v23; // rax@8
  __int64 v24; // rbx@8
  __int64 v25; // rax@10
  int v26; // eax@10
  __int64 v27; // rsi@10
  signed __int64 v28; // r15@10
  __int64 v29; // rax@12
  signed __int64 v30; // r14@15
  __int64 v31; // rax@15
  __int64 v32; // rdi@15
  signed int v33; // eax@15
  unsigned int v34; // ebx@17
  signed __int64 v35; // rax@19
  signed __int64 v36; // r15@19
  signed __int64 v37; // r12@19
  int v38; // er14@19
  unsigned int v39; // er13@19
  __int64 v40; // ST18_8@21
  int v41; // ST10_4@21
  __int64 v42; // rbx@22
  __int64 v43; // rbx@25
  int v44; // eax@25
  __int64 v45; // rax@31
  __int64 v46; // rax@31
  signed int v47; // ebx@33
  __int64 v48; // [sp+8h] [bp-138h]@3
  signed __int64 v49; // [sp+10h] [bp-130h]@15
  signed __int64 v50; // [sp+18h] [bp-128h]@15
  unsigned int v51; // [sp+24h] [bp-11Ch]@1
  __int64 v52; // [sp+28h] [bp-118h]@1
  __int64 v53; // [sp+30h] [bp-110h]@1
  const void *v54; // [sp+38h] [bp-108h]@1
  signed __int64 v55; // [sp+40h] [bp-100h]@6
  signed __int64 v56; // [sp+48h] [bp-F8h]@6
  __int64 v57; // [sp+50h] [bp-F0h]@1
  signed __int64 v58; // [sp+58h] [bp-E8h]@4
  __int64 v59; // [sp+60h] [bp-E0h]@6
  signed __int64 v60; // [sp+60h] [bp-E0h]@17
  unsigned int v61; // [sp+60h] [bp-E0h]@21
  __int64 v62; // [sp+68h] [bp-D8h]@25
  int v63; // [sp+70h] [bp-D0h]@6
  __int64 v64; // [sp+78h] [bp-C8h]@6
  __int64 v65; // [sp+B8h] [bp-88h]@6
  __int64 v66; // [sp+C0h] [bp-80h]@6
  __int64 v67; // [sp+C8h] [bp-78h]@6
  __int64 v68; // [sp+D0h] [bp-70h]@6
  int v69; // [sp+D8h] [bp-68h]@6
  int v70; // [sp+DCh] [bp-64h]@6
  int v71; // [sp+E0h] [bp-60h]@6
  int v72; // [sp+E8h] [bp-58h]@6
  char v73; // [sp+ECh] [bp-54h]@6
  char v74; // [sp+EDh] [bp-53h]@6
  int v75; // [sp+F0h] [bp-50h]@6
  char v76; // [sp+F8h] [bp-48h]@13
  int v77; // [sp+100h] [bp-40h]@6
  int v78; // [sp+104h] [bp-3Ch]@6
  int v79; // [sp+108h] [bp-38h]@6
  __int64 v80; // [sp+110h] [bp-30h]@6

  v54 = a5;
  v53 = a4;
  v5 = a3;
  v51 = a3;
  v52 = a2;
  v6 = a1;
  v57 = a1;
  result = 3758097123LL;
  if ( *(_BYTE *)(a1 + 656) )
  {
    v8 = DeviceMemoryManager::Allocate(*(DeviceMemoryManager **)(a1 + 3992), 384);
    result = 3758097085LL;
    if ( v8 != -1 )
    {
      v9 = (unsigned int)(*(_DWORD *)(a1 + 704) + v8);
      v10 = *(_QWORD *)(a1 + 4000);
      v48 = v10 + v9;
      v11 = 384;
      bzero((void *)(v10 + v9), 0x180uLL);
      *(_DWORD *)(v10 + v9) = 1;
      *(_DWORD *)(v10 + v9 + 4) = v5;
      if ( v5 )
      {
        v58 = v9 + v10 + 8;
        v12 = 0LL;
        while ( 1 )
        {
          v13 = OSData::withCapacity((OSData *)&stru_68.flags, v11);
          v14 = -536870211;
          if ( !v13 )
          {
            goto LABEL_33;
          }
          v59 = v13;
          bzero(&v63, 0xA8uLL);
          v67 = v53;
          v56 = 5 * v12;
          v55 = v12;
          v65 = *(_QWORD *)(v52 + 40 * v12);
          v66 = *(_QWORD *)(v52 + 40 * v12 + 8);
          v69 = *(_DWORD *)(v52 + 40 * v12 + 20);
          v70 = *(_DWORD *)(v52 + 40 * v12 + 24);
          v71 = *(_DWORD *)(v52 + 40 * v12 + 28);
          v72 = 0;
          v73 = 0;
          v63 = *(_DWORD *)(v52 + 40 * v12 + 32);
          v74 = 0;
          v75 = 0;
          v77 = *(_DWORD *)(v52 + 40 * v12 + 16);
          v78 = *(_DWORD *)(v52 + 40 * v12 + 36);
          v80 = 0LL;
          v79 = -1;
          v64 = 0LL;
          bcopy(v54, &v64, 0x40uLL);
          v15 = *(_QWORD *)v54;
          v16 = *(_QWORD *)(v52 + 40 * v12);
          v17 = *(_QWORD *)(v52 + 40 * v12 + 8);
          AppleCamInUserClient::setAsyncReference64();
          v18 = *(_QWORD *)(v6 + 288);
          v19 = *(int (__fastcall **)(_QWORD, _QWORD, _QWORD))(*(_QWORD *)v18 + 2160LL);
          v20 = *(_DWORD *)(v52 + 40 * v12 + 16);
          LODWORD(v21) = current_task(&v64, v15);
          LODWORD(v22) = v19(v18, v20, v21);
          v68 = v22;
          if ( !v22 )
          {
            break;
          }
          if ( (*(int (__fastcall **)(__int64, _QWORD, _QWORD))(*(_QWORD *)v22 + 320LL))(v22, 0LL, 0LL) )
          {
            (*(void (__fastcall **)(__int64))(*(_QWORD *)v59 + 40LL))(v59);
            (*(void (__cdecl **)(__int64))(*(_QWORD *)v68 + 288LL))(v68);
            goto LABEL_29;
          }
          LODWORD(v23) = (*(int (__cdecl **)(__int64))(*(_QWORD *)v68 + 368LL))(v68);
          v24 = v23;
          v6 = v57;
          if ( !v23 )
          {
            (*(void (__fastcall **)(__int64))(*(_QWORD *)v59 + 40LL))(v59);
            (*(void (__fastcall **)(__int64, _QWORD, _QWORD))(*(_QWORD *)v68 + 328LL))(v68, 0LL, 0LL);
            (*(void (__cdecl **)(__int64))(*(_QWORD *)v68 + 288LL))(v68);
            v14 = -536870206;
            goto LABEL_33;
          }
          (*(void (__fastcall **)(__int64))(*(_QWORD *)v23 + 32LL))(v23);
          (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v24 + 496LL))(v24, 1LL);
          if ( v78 )
          {
            LODWORD(v25) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v68 + 368LL))(v68);
            v26 = (*(int (__fastcall **)(__int64))(*(_QWORD *)v25 + 456LL))(v25);
            v27 = (unsigned int)v26;
            v28 = v56;
            if ( (unsigned int)AppleCamIn::AllocateDeviceMemory(v57, v26, (__int64)&v80, 1) )
            {
              LODWORD(v45) = (*(int (__fastcall **)(__int64, __int64))(*(_QWORD *)v68 + 368LL))(v68, v27);
              (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v45 + 504LL))(v45, 2LL);
              LODWORD(v46) = (*(int (__cdecl **)(__int64))(*(_QWORD *)v68 + 368LL))(v68);
              (*(void (__fastcall **)(__int64))(*(_QWORD *)v46 + 40LL))(v46);
              (*(void (__fastcall **)(__int64, _QWORD, _QWORD))(*(_QWORD *)v68 + 328LL))(v68, 0LL, 0LL);
              (*(void (__cdecl **)(__int64))(*(_QWORD *)v68 + 288LL))(v68);
              (*(void (__fastcall **)(__int64))(*(_QWORD *)v59 + 40LL))(v59);
              IOLog("Failed to allocate bounce buffer for this mapped IOSurface\n");
              v14 = -536870211;
              goto LABEL_33;
            }
            v75 = *(_DWORD *)(v80 + 4);
            if ( (v78 | 2) == 3 )
            {
              LODWORD(v29) = (*(int (__fastcall **)(__int64, __int64))(*(_QWORD *)v68 + 368LL))(v68, v27);
              (*(void (__fastcall **)(__int64, _QWORD, _QWORD, _QWORD))(*(_QWORD *)v29 + 480LL))(
                v29,
                0LL,
                *(_QWORD *)(v80 + 8),
                *(_DWORD *)v80);
            }
          }
          else
          {
            v28 = v56;
            if ( (unsigned int)AppleCamIn::ISP_MapIOSurfaceWithIOMMU(v57, v68, (__int64)&v76, (__int64)&v79) )
            {
              (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v24 + 504LL))(v24, 1LL);
              (*(void (__fastcall **)(__int64))(*(_QWORD *)v24 + 40LL))(v24);
              (*(void (__fastcall **)(__int64, _QWORD, _QWORD))(*(_QWORD *)v68 + 328LL))(v68, 0LL, 0LL);
              (*(void (__cdecl **)(__int64))(*(_QWORD *)v68 + 288LL))(v68);
              (*(void (__fastcall **)(_QWORD))(*(_QWORD *)v59 + 40LL))(v59);
              v14 = -536870211;
              goto LABEL_33;
            }
            v74 = 1;
            v75 = (v79 << 12) - 0x40000000;
          }
          (*(void (__fastcall **)(__int64, int *, signed __int64))(*(_QWORD *)v59 + 360LL))(v59, &v63, 168LL);
          (*(void (__fastcall **)(_QWORD, __int64))(**(_QWORD **)(v57 + 632) + 448LL))(*(_QWORD *)(v57 + 632), v59);
          (*(void (__fastcall **)(_QWORD))(*(_QWORD *)v59 + 40LL))(v59);
          v30 = v58;
          v50 = v58 + 8 * v28 + 28;
          *(_DWORD *)v50 = v63;
          LODWORD(v31) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v59 + 376LL))(v59);
          v49 = v58 + 8 * v28 + 32;
          *(_QWORD *)v49 = *(_DWORD *)(v31 + 128);
          v32 = v68;
          v33 = *(_DWORD *)(v68 + 176);
          if ( !v33 )
          {
            v33 = 1;
          }
          v60 = v58 + 8 * v28 + 24;
          *(_DWORD *)v60 = v33;
          v34 = 0;
          while ( 1 )
          {
            v35 = v28;
            v36 = v30 + 8 * v28;
            v37 = v35;
            *(_DWORD *)(v36 + 4LL * v34 + 12) = 0;
            v38 = v75;
            v11 = v34;
            *(_DWORD *)(v36 + 4LL * v34) = v38
                                         + (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v32 + 384LL))(v32, v34);
            ++v34;
            v39 = *(_DWORD *)v60;
            if ( v34 >= *(_DWORD *)v60 )
            {
              break;
            }
            v32 = v68;
            v30 = v58;
            v28 = v37;
          }
          if ( *(_BYTE *)(v57 + 4020) & 0x10 )
          {
            v61 = *(_DWORD *)v50;
            v40 = *(_QWORD *)v49;
            v41 = *(_DWORD *)(v58 + 8 * v37);
            (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v68 + 440LL))(v68, 0LL);
            if ( v39 < 2 )
            {
              v11 = v61;
              IOLog("h2tBuf: pool=%d, tag=0x%08llX, addr=0x%08X, len=%d\n");
            }
            else
            {
              v42 = *(_DWORD *)(v58 + 8 * v37 + 4);
              (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v68 + 440LL))(v68, 1LL);
              v11 = v61;
              IOLog("h2tBuf: pool=%d, tag=0x%08llX, addr0=0x%08X, len0=%d, addr1=0x%08X, len1=%d\n");
            }
          }
          v12 = v55 + 1;
          v5 = v51;
          v6 = v57;
          if ( (signed int)v55 + 1 >= v51 )
          {
            goto LABEL_25;
          }
        }
        (*(void (__cdecl **)(__int64))(*(_QWORD *)v59 + 40LL))(v59);
LABEL_29:
        v14 = -536870206;
        v6 = v57;
        goto LABEL_33;
      }
LABEL_25:
      v43 = v48 - *(_QWORD *)(v6 + 4056);
      IOProcessorChannelSend(
        *(_QWORD *)(v6 + 8LL * *(_DWORD *)(v6 + 608) + 328),
        v48 - *(_DWORD *)(v6 + 4056),
        384,
        805306368);
      clock_interval_to_deadline(2LL, 1000000000LL, &v62);
      v44 = (*(int (__fastcall **)(_QWORD, _QWORD, __int64, _QWORD))(**(_QWORD **)(v6 + 280) + 496LL))(
              *(_QWORD *)(v6 + 280),
              (unsigned int)v43,
              v62,
              0LL);
      v14 = -536870186;
      if ( v44 != 1 )
      {
        *(_DWORD *)(v6 + 4008) += v5;
        v14 = 0;
      }
LABEL_33:
      v47 = v14;
      DeviceMemoryManager::Free(
        *(DeviceMemoryManager **)(v6 + 3992),
        v48 - (*(_DWORD *)(v6 + 704) + *(_DWORD *)(v6 + 4000)));
      result = (unsigned int)v47;
    }
  }
  return result;
}
// 68: using guessed type section_64 stru_68;
// B6390: using guessed type int __fastcall IOLog(_QWORD);
// B6F10: using guessed type int __fastcall clock_interval_to_deadline(_QWORD, _QWORD, _QWORD);
// B6F18: using guessed type int __fastcall current_task(_QWORD, _QWORD);

//----- (0000000000006F9A) ----------------------------------------------------
__int64 __fastcall AppleCamIn::AllocateDeviceMemory(__int64 a1, int a2, __int64 a3, char a4)
{
  char v4; // r13@1
  void *v5; // r15@2
  signed int v6; // er14@2
  __int64 v7; // rbx@2
  int v8; // eax@5
  __int64 v9; // rax@9
  __int64 v11; // [sp+8h] [bp-48h]@1
  int v12; // [sp+18h] [bp-38h]@1
  int v13; // [sp+1Ch] [bp-34h]@6
  __int64 v14; // [sp+20h] [bp-30h]@6

  v4 = a4;
  v11 = a3;
  bzero(&v12, 0x10uLL);
  if ( v4 )
  {
    v5 = (void *)operator new(0x10uLL);
    v6 = -536870211;
    v7 = 0LL;
    if ( !v5 )
    {
      return (unsigned int)v6;
    }
  }
  else
  {
    v7 = OSData::withCapacity((OSData *)&dword_10, 0x10u);
    v6 = -536870211;
    v5 = 0LL;
    if ( !v7 )
    {
      return (unsigned int)v6;
    }
  }
  v12 = a2;
  v8 = DeviceMemoryManager::Allocate(*(DeviceMemoryManager **)(a1 + 3992), a2);
  if ( v8 == -1 )
  {
    IOLog("AppleCamIn::AllocateDeviceMemory failed to allocate device memory\n");
    v6 = -536870211;
  }
  else
  {
    v14 = *(_QWORD *)(a1 + 4000) + (unsigned int)(*(_DWORD *)(a1 + 704) + v8);
    v13 = v14 - *(_DWORD *)(a1 + 4056);
    if ( v4 )
    {
      bcopy(&v12, v5, 0x10uLL);
      *(_QWORD *)v11 = v5;
    }
    else
    {
      (*(void (__fastcall **)(__int64, int *, signed __int64))(*(_QWORD *)v7 + 360LL))(v7, &v12, 16LL);
      LODWORD(v9) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v7 + 376LL))(v7);
      *(_QWORD *)v11 = v9;
      (*(void (__fastcall **)(_QWORD, __int64))(**(_QWORD **)(a1 + 640) + 440LL))(*(_QWORD *)(a1 + 640), v7);
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v7 + 40LL))(v7);
    }
    v6 = 0;
    if ( *(_BYTE *)(a1 + 4020) & 4 )
    {
      v6 = 0;
      IOLog("AppleCamIn::AllocateDeviceMemory - Successfully allocated surface. size: %d, virtualAddress=%p, ispAddress=%p\n");
    }
  }
  return (unsigned int)v6;
}
// 10: using guessed type int dword_10;
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (00000000000070F6) ----------------------------------------------------
__int64 __fastcall AppleCamIn::S2DeviceMemoryHostVirtualAddressToISPAddress(AppleCamIn *this, void *a2)
{
  return (unsigned int)((_DWORD)a2 - *((_DWORD *)this + 1014));
}

//----- (0000000000007104) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_GetCameraTime(__int64 a1, __int64 a2)
{
  return (*(int (__fastcall **)(_QWORD, signed __int64 (__fastcall *)(__int64, __int64), __int64, _QWORD, _QWORD, _QWORD))(**(_QWORD **)(a1 + 280) + 456LL))(
           *(_QWORD *)(a1 + 280),
           AppleCamIn::ISP_GetCameraTime_gated,
           a2,
           0LL,
           0LL,
           0LL);
}

//----- (000000000000712E) ----------------------------------------------------
signed __int64 __fastcall AppleCamIn::ISP_GetCameraTime_gated(__int64 a1, __int64 a2)
{
  signed __int64 result; // rax@1

  result = 3758097123LL;
  if ( *(_BYTE *)(a1 + 656) )
  {
    *(_QWORD *)a2 = mach_absolute_time();
    *(_DWORD *)(a2 + 8) = *(int *)((char *)&dword_90068 + *(_QWORD *)(a1 + 4072));
    result = 0LL;
  }
  return result;
}
// 90068: using guessed type int dword_90068;

//----- (000000000000716A) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_LoadFirmware(AppleCamIn *this, void *a2, unsigned int a3, unsigned int a4, task *a5)
{
  return (*(int (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleCamIn *, void *, __int64, int, task *), void *, _QWORD, _QWORD, task *))(**((_QWORD **)this + 35) + 456LL))(
           *((_QWORD *)this + 35),
           AppleCamIn::ISP_LoadFirmware_gated,
           a2,
           a3,
           a4,
           a5);
}

//----- (000000000000719C) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_LoadFirmware_gated(AppleCamIn *this, void *a2, __int64 a3, int a4, task *a5)
{
  int v5; // ebx@1
  __int64 result; // rax@1
  Bytef *v7; // rax@5
  Bytef *v8; // r14@5
  int v9; // er13@6
  uInt v10; // ebx@6
  z_stream strm; // [sp+8h] [bp-98h]@3

  v5 = a4;
  IOLog("AppleCamIn::ISP_LoadFirmware_gated: fw len=%d\n");
  result = 3758097122LL;
  if ( !*((_BYTE *)this + 656) )
  {
    result = 3758097131LL;
    if ( !*((_BYTE *)this + 682) )
    {
      *((_DWORD *)this + 180) = v5;
      strm.zalloc = (alloc_func)inflate_alloc;
      strm.zfree = (free_func)inflate_free;
      strm.opaque = 0LL;
      strm.avail_in = 599113;
      strm.next_in = 0LL;
      if ( inflateInit2_(&strm, 47, "1.2.3", 112) )
      {
        IOLog("%s: Cannot initialize decompression.  Invalid input. \n");
      }
      else
      {
        LODWORD(v7) = IOMalloc(1413124LL, 47LL);
        v8 = v7;
        if ( !strm.avail_in
          || (strm.next_in = (Bytef *)&S2ISP::s2isp_fw,
              strm.avail_out = 1413124,
              strm.next_out = v7,
              v9 = inflate(&strm, 0),
              v10 = strm.avail_out,
              inflateEnd(&strm),
              v10)
          || v9 != 1 )
        {
          IOFree(v8, 1413124LL);
        }
        else if ( v8 )
        {
          *((_QWORD *)this + 493) = v8;
          *((_DWORD *)this + 988) = 1413124;
          *((_BYTE *)this + 682) = 1;
          return 0LL;
        }
      }
      IOLog("%s: error: corrupt firmware image \n");
      result = 3758097084LL;
    }
  }
  return result;
}
// B6378: using guessed type int __fastcall IOFree(_QWORD, _QWORD);
// B6390: using guessed type int __fastcall IOLog(_QWORD);
// B6398: using guessed type int __fastcall IOMalloc(_QWORD, _QWORD);

//----- (0000000000007310) ----------------------------------------------------
__int64 __usercall AppleCamIn::ISP_InitialSensorDetection@<rax>(AppleCamIn *this@<rdi>, void *a2@<r12>)
{
  AppleCamIn *v2; // r14@1
  __int64 v3; // r15@1
  unsigned int v4; // ebx@1
  __int64 v5; // rax@4
  void *v6; // rax@4
  int v7; // er12@6
  void *v8; // rax@11
  __int64 v9; // rdi@14
  size_t v10; // r13@15
  int v11; // eax@15
  size_t v12; // r13@16
  void *v13; // rax@16
  char v15; // [sp+1Fh] [bp-141h]@15
  size_t v16; // [sp+20h] [bp-140h]@0
  unsigned int v17; // [sp+28h] [bp-138h]@11
  unsigned int v18; // [sp+2Ch] [bp-134h]@2
  char v19; // [sp+30h] [bp-130h]@2
  __int16 v20; // [sp+34h] [bp-12Ch]@2
  int v21; // [sp+38h] [bp-128h]@2
  int v22; // [sp+3Ch] [bp-124h]@7
  char v23; // [sp+40h] [bp-120h]@10
  __int16 v24; // [sp+44h] [bp-11Ch]@4
  __int16 v25; // [sp+48h] [bp-118h]@4
  __int16 v26; // [sp+4Ch] [bp-114h]@8
  int v27; // [sp+50h] [bp-110h]@4
  unsigned int v28; // [sp+90h] [bp-D0h]@3
  char v29; // [sp+B4h] [bp-ACh]@4
  int v30; // [sp+BCh] [bp-A4h]@4
  char v31; // [sp+C4h] [bp-9Ch]@4
  __int64 v32; // [sp+130h] [bp-30h]@1

  v2 = this;
  v3 = off_12040[0];
  v32 = *(_QWORD *)off_12040[0];
  v4 = 0;
  if ( !*((_BYTE *)this + 4016) )
  {
    v20 = 269;
    v21 = 0;
    v18 = 168;
    v4 = AppleCamIn::ispCmdSend(this, &v19, 168, &v18, 0, 0, 0, 0x7D0u);
    if ( !v4 )
    {
      if ( !v28 )
      {
        v9 = (__int64)"AppleCamIn::ISP_InitialSensorDetection - no sensor found\n";
        v4 = 0;
LABEL_20:
        IOLog(v9);
        goto LABEL_21;
      }
      *((_BYTE *)this + 724) = 1;
      *((_WORD *)this + 363) = v27;
      *((_WORD *)this + 365) = v24;
      *((_WORD *)this + 367) = v25;
      *((_DWORD *)this + 191) = v30;
      bcopy(&v29, (char *)this + 748, 8uLL);
      bcopy(&v31, (char *)this + 772, 0x12uLL);
      v4 = 0;
      IOLog("AppleCamIn::ISP_InitialSensorDetection - found sensor on chan %d: 0x%04X\n");
      (*(void (__fastcall **)(AppleCamIn *, _QWORD, char *, signed __int64))(*(_QWORD *)this + 648LL))(
        this,
        *((_QWORD *)this + 21),
        &v29,
        8LL);
      (*(void (__fastcall **)(AppleCamIn *, _QWORD, int *, signed __int64))(*(_QWORD *)this + 648LL))(
        this,
        *((_QWORD *)this + 22),
        &v30,
        4LL);
      (*(void (__fastcall **)(AppleCamIn *, _QWORD, char *))(*(_QWORD *)this + 624LL))(
        this,
        *((_QWORD *)this + 23),
        &v31);
      v5 = v28;
      *((_DWORD *)this + 989) = v28;
      v6 = (void *)operator new[](80 * v5);
      *((_QWORD *)this + 496) = v6;
      if ( v6 )
      {
        bzero(v6, 80LL * *((_DWORD *)this + 989));
        if ( *((_DWORD *)this + 989) )
        {
          v7 = 0;
          do
          {
            v21 = 0;
            v20 = 262;
            v22 = v7;
            v18 = 96;
            v4 = AppleCamIn::ispCmdSend(this, &v19, 96, &v18, 0, 0, 0, 0x7D0u);
            if ( v4 )
            {
              break;
            }
            if ( (v26 & 0xFEu) >= 0x32 )
            {
              v26 = (v26 + 256) & 0xFF00;
            }
            bcopy(&v23, (void *)(*((_QWORD *)this + 496) + 80LL * (unsigned int)v7++), 0x50uLL);
            v4 = 0;
          }
          while ( (unsigned int)v7 < *((_DWORD *)this + 989) );
        }
      }
      v17 = 16;
      v8 = (void *)operator new[](0x10uLL);
      a2 = v8;
      if ( v8 )
      {
        bzero(v8, 0x10uLL);
        *((_WORD *)a2 + 2) = 1287;
        *((_DWORD *)a2 + 2) = 0;
        v4 = AppleCamIn::ispCmdSend(this, a2, 16, &v17, 0, 0, 0, 0x7D0u);
        if ( v4 )
        {
          IOLog("AppleCamIn::get lsc info failed\n");
          operator delete[](a2);
LABEL_19:
          v9 = (__int64)"AppleCamIn:: NVM LSC data is larger than allocated space\n";
          goto LABEL_20;
        }
        LOBYTE(v16) = *((_BYTE *)a2 + 12);
        v15 = *((_BYTE *)a2 + 13);
        v10 = *((_WORD *)a2 + 7);
        operator delete[](a2);
        v11 = v10;
        if ( (unsigned int)v10 > 0x294 )
        {
          goto LABEL_19;
        }
        *((_BYTE *)this + 808) = v16;
        *((_BYTE *)this + 809) = v15;
        v16 = v10;
        v12 = (unsigned int)(v10 + 16);
        v17 = v11 + 16;
        v13 = (void *)operator new[]((unsigned int)(v11 + 16));
        a2 = v13;
        v4 = 0;
        if ( v13 )
        {
          bzero(v13, v12);
          *((_WORD *)a2 + 2) = 1288;
          *((_DWORD *)a2 + 2) = 0;
          v4 = AppleCamIn::ispCmdSend(this, a2, v12, &v17, 0, 0, 0, 0x7D0u);
          if ( v4 )
          {
            IOLog("AppleCamIn::get lsc failed\n");
            goto LABEL_24;
          }
          goto LABEL_23;
        }
      }
    }
  }
LABEL_21:
  while ( *(_QWORD *)v3 != v32 )
  {
LABEL_23:
    *((_BYTE *)v2 + 2132) = *((_BYTE *)a2 + 12) != 0;
    v2 = (AppleCamIn *)((char *)v2 + 810);
    bcopy((char *)a2 + 13, (void *)v2, v16);
LABEL_24:
    operator delete[](a2);
  }
  return v4;
}
// 12040: using guessed type __int64 off_12040[4];
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (000000000000775E) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_GetModuleParams(__int64 a1, __int64 a2)
{
  return (*(int (__fastcall **)(_QWORD, signed __int64 (__fastcall *)(__int64, void *), __int64, _QWORD, _QWORD, _QWORD))(**(_QWORD **)(a1 + 280) + 456LL))(
           *(_QWORD *)(a1 + 280),
           AppleCamIn::ISP_GetModuleParams_gated,
           a2,
           0LL,
           0LL,
           0LL);
}

//----- (0000000000007788) ----------------------------------------------------
signed __int64 __fastcall AppleCamIn::ISP_GetModuleParams_gated(__int64 a1, void *a2)
{
  signed __int64 result; // rax@2

  if ( *(_BYTE *)(a1 + 724) || (result = 3758097124LL, *(_BYTE *)(a1 + 725)) )
  {
    bcopy((const void *)(a1 + 720), a2, 0x588uLL);
    result = 0LL;
  }
  return result;
}

//----- (00000000000077B8) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_GetSensorConfigInfo(__int64 a1, unsigned int a2, unsigned int a3, __int64 a4)
{
  return (*(int (__fastcall **)(_QWORD, signed __int64 (__fastcall *)(__int64, __int64, unsigned int, void *), _QWORD, _QWORD, __int64, _QWORD))(**(_QWORD **)(a1 + 280) + 456LL))(
           *(_QWORD *)(a1 + 280),
           AppleCamIn::ISP_GetSensorConfigInfo_gated,
           a2,
           a3,
           a4,
           0LL);
}

//----- (00000000000077E6) ----------------------------------------------------
signed __int64 __fastcall AppleCamIn::ISP_GetSensorConfigInfo_gated(__int64 a1, __int64 a2, unsigned int a3, void *a4)
{
  __int64 v4; // r8@1
  signed __int64 result; // rax@1
  __int64 v6; // rdi@2

  v4 = a1;
  result = 3758097090LL;
  if ( (unsigned int)a2 <= 1 )
  {
    a2 = (unsigned int)a2;
    v6 = *(_QWORD *)(a1 + 8LL * (unsigned int)a2 + 3968);
    result = 3758097088LL;
    if ( v6 )
    {
      result = 3758097090LL;
      if ( *(_DWORD *)(v4 + 4 * a2 + 3956) > a3 )
      {
        bcopy((const void *)(80LL * a3 + v6), a4, 0x50uLL);
        result = 0LL;
      }
    }
  }
  return result;
}

//----- (0000000000007838) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_ReadS2MemoryBlock(AppleCamIn *this, void *a2, unsigned int a3, unsigned int a4, task *a5)
{
  return (*(int (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleCamIn *, void *, int, unsigned int, task *), void *, _QWORD, _QWORD, task *))(**((_QWORD **)this + 35) + 456LL))(
           *((_QWORD *)this + 35),
           AppleCamIn::ISP_ReadS2MemoryBlock_gated,
           a2,
           a3,
           a4,
           a5);
}

//----- (000000000000786A) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_ReadS2MemoryBlock_gated(AppleCamIn *this, void *a2, int a3, unsigned int a4, task *a5)
{
  signed int v5; // ebx@1
  size_t v6; // r12@5
  __int64 v7; // r14@5
  __int64 v8; // rax@9
  __int64 v9; // r13@9
  const void *v10; // r15@10
  void *v11; // rax@10
  void *v12; // rsi@10

  v5 = -536870173;
  if ( *((_BYTE *)this + 656) )
  {
    v5 = -536870206;
    if ( !(((unsigned __int8)a3 | (unsigned __int8)a4) & 3) && a4 && a4 + a3 <= 0x10000000 )
    {
      v6 = a4;
      v7 = IOMemoryDescriptor::withAddressRange((IOMemoryDescriptor *)a2, a4, 3uLL, (unsigned int)a5, a5);
      if ( v7 )
      {
        if ( (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v7 + 496LL))(v7, 0LL) )
        {
          IOLog("AppleCamIn::ISP_ReadS2MemoryBlock_gated - couldn't prepare memory descriptor\n");
          (*(void (__fastcall **)(__int64))(*(_QWORD *)v7 + 40LL))(v7);
          v5 = -536870211;
        }
        else
        {
          v5 = 0;
          LODWORD(v8) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v7 + 512LL))(v7, 0LL);
          v9 = v8;
          if ( v8 )
          {
            v10 = (const void *)*((_QWORD *)this + 507);
            LODWORD(v11) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v8 + 280LL))(v8);
            v12 = v11;
            bcopy(v10, v11, v6);
            (*(void (__fastcall **)(__int64, void *))(*(_QWORD *)v9 + 40LL))(v9, v12);
          }
          else
          {
            IOLog("AppleCamIn::ISP_ReadS2MemoryBlock_gated - couldn't create memory map\n");
            v5 = -536870212;
          }
          (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v7 + 504LL))(v7, 3LL);
          (*(void (__fastcall **)(__int64))(*(_QWORD *)v7 + 40LL))(v7);
        }
      }
      else
      {
        IOLog("AppleCamIn::ISP_ReadS2MemoryBlock_gated - couldn't create memory descriptor\n");
        v5 = -536870211;
      }
    }
  }
  return (unsigned int)v5;
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (00000000000079A0) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_WriteS2MemoryBlock(AppleCamIn *this, void *a2, unsigned int a3, unsigned int a4, task *a5)
{
  return (*(int (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleCamIn *, void *, int, unsigned int, task *), void *, _QWORD, _QWORD, task *))(**((_QWORD **)this + 35) + 456LL))(
           *((_QWORD *)this + 35),
           AppleCamIn::ISP_WriteS2MemoryBlock_gated,
           a2,
           a3,
           a4,
           a5);
}

//----- (00000000000079D2) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_WriteS2MemoryBlock_gated(AppleCamIn *this, void *a2, int a3, unsigned int a4, task *a5)
{
  signed int v5; // ebx@1
  size_t v6; // r12@5
  __int64 v7; // r14@5
  __int64 v8; // rax@9
  __int64 v9; // r13@9
  const void *v10; // rax@10

  v5 = -536870173;
  if ( *((_BYTE *)this + 656) )
  {
    v5 = -536870206;
    if ( !(((unsigned __int8)a3 | (unsigned __int8)a4) & 3) && a4 && a4 + a3 <= 0x10000000 )
    {
      v6 = a4;
      v7 = IOMemoryDescriptor::withAddressRange((IOMemoryDescriptor *)a2, a4, 3uLL, (unsigned int)a5, a5);
      if ( v7 )
      {
        if ( (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v7 + 496LL))(v7, 0LL) )
        {
          IOLog("AppleCamIn::ISP_WriteS2MemoryBlock_gated - couldn't prepare memory descriptor\n");
          (*(void (__fastcall **)(__int64))(*(_QWORD *)v7 + 40LL))(v7);
          v5 = -536870211;
        }
        else
        {
          v5 = 0;
          LODWORD(v8) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v7 + 512LL))(v7, 0LL);
          v9 = v8;
          if ( v8 )
          {
            LODWORD(v10) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v8 + 280LL))(v8);
            bcopy(v10, *((void **)this + 507), v6);
            (*(void (__fastcall **)(__int64))(*(_QWORD *)v9 + 40LL))(v9);
          }
          else
          {
            IOLog("AppleCamIn::ISP_WriteS2MemoryBlock_gated - couldn't create memory map\n");
            v5 = -536870212;
          }
          (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v7 + 504LL))(v7, 3LL);
          (*(void (__fastcall **)(__int64))(*(_QWORD *)v7 + 40LL))(v7);
        }
      }
      else
      {
        IOLog("AppleCamIn::ISP_WriteS2MemoryBlock_gated - couldn't create memory descriptor\n");
        v5 = -536870211;
      }
    }
  }
  return (unsigned int)v5;
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (0000000000007B04) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_SetRequiredMaxBusStall(AppleCamIn *this, unsigned int a2)
{
  return (*(int (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleCamIn *, unsigned int), _QWORD, _QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
           *((_QWORD *)this + 35),
           AppleCamIn::ISP_SetRequiredMaxBusStall_gated,
           a2,
           0LL,
           0LL,
           0LL);
}

//----- (0000000000007B2E) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_SetRequiredMaxBusStall_gated(AppleCamIn *this, unsigned int a2)
{
  IOLog("AppleCamIn::ISP_SetRequiredMaxBusStall_gated - requiredMaxBusStall=%d\n");
  IOService::requireMaxBusStall(this, a2);
  return 0LL;
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (0000000000007B5A) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_GetDDRParams(__int64 a1, __int64 a2)
{
  return (*(int (__fastcall **)(_QWORD, __int64 (__fastcall *)(__int64, void *), __int64, _QWORD, _QWORD, _QWORD))(**(_QWORD **)(a1 + 280) + 456LL))(
           *(_QWORD *)(a1 + 280),
           AppleCamIn::ISP_GetDDRParams_gated,
           a2,
           0LL,
           0LL,
           0LL);
}

//----- (0000000000007B84) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_GetDDRParams_gated(__int64 a1, void *a2)
{
  if ( !*(_DWORD *)(a1 + 160) )
  {
    *(_QWORD *)(a1 + 2168) = -536870184LL;
  }
  *(_DWORD *)(a1 + 2176) = *(_DWORD *)(a1 + 140);
  bcopy((const void *)(a1 + 2168), a2, 0x6F0uLL);
  return 0LL;
}

//----- (0000000000007BBE) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_LoadSetfile(AppleCamIn *this, void *a2, unsigned int a3, task *a4, unsigned int a5)
{
  return (*(int (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleCamIn *, IOMemoryDescriptor *, OSNumber *, task *, unsigned int), void *, _QWORD, task *, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
           *((_QWORD *)this + 35),
           AppleCamIn::ISP_LoadSetfile_gated,
           a2,
           a3,
           a4,
           a5);
}

//----- (0000000000007BF0) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_LoadSetfile_gated(AppleCamIn *this, IOMemoryDescriptor *a2, OSNumber *a3, task *a4, unsigned int a5)
{
  unsigned int v5; // ebx@1
  unsigned int v6; // er15@1
  int v7; // er13@1
  AppleCamIn *v8; // r12@1
  unsigned int v9; // eax@1
  signed int v10; // ebx@1
  __int64 v11; // rbx@4
  void *v12; // rdi@6
  size_t v13; // rbx@6
  task *v14; // r8@6
  __int64 v15; // r15@6
  __int64 v16; // rax@10
  __int64 v17; // r14@10
  __int64 v18; // rax@11
  __int64 v19; // r13@12
  unsigned int v20; // edx@12
  __int64 v21; // r14@12
  unsigned int v22; // edx@12
  __int64 v23; // r14@12
  unsigned int v24; // edx@12
  __int64 v25; // r14@12
  unsigned int v26; // edx@12
  __int64 v27; // r14@12
  __int64 v28; // r14@12
  __int64 v29; // rax@12
  __int64 v30; // rax@12
  __int64 v31; // rdi@12
  __int64 v32; // rcx@12
  __int64 v33; // rax@13
  __int64 v34; // rax@13
  __int64 v35; // rdi@13
  __int64 v36; // rdi@14
  __int64 v37; // rdi@14
  __int64 v38; // rax@14
  __int64 v39; // rax@14
  __int64 v40; // rcx@14
  const void *v41; // rax@16
  void *v42; // rdi@21
  AppleCamIn *v43; // rax@21
  __int64 v44; // rcx@21
  __int64 v45; // rax@28
  __int64 result; // rax@30
  __int64 v47; // [sp+18h] [bp-158h]@12
  int v48; // [sp+2Ch] [bp-144h]@4
  __int64 v49; // [sp+30h] [bp-140h]@4
  unsigned int v50; // [sp+3Ch] [bp-134h]@28
  char v51; // [sp+40h] [bp-130h]@28
  __int16 v52; // [sp+44h] [bp-12Ch]@28
  int v53; // [sp+48h] [bp-128h]@28
  int v54; // [sp+4Ch] [bp-124h]@28
  int v55; // [sp+50h] [bp-120h]@28
  __int64 v56; // [sp+140h] [bp-30h]@1

  v5 = a5;
  v6 = (unsigned int)a4;
  v7 = (signed int)a3;
  v8 = this;
  v56 = *(_QWORD *)off_12040[0];
  IOLog("AppleCamIn::ISP_LoadSetfile_gated (camChan=%d)\n");
  v9 = v5;
  v10 = -536870206;
  if ( v9 > 1 )
  {
    goto LABEL_30;
  }
  v10 = -536870165;
  if ( *((_QWORD *)this + v9 + 267) )
  {
    goto LABEL_30;
  }
  v10 = -536870206;
  if ( !v7 )
  {
    goto LABEL_30;
  }
  v48 = v9;
  v11 = (__int64)((char *)this + 8 * v9 + 2136);
  v49 = v9;
  if ( (unsigned int)AppleCamIn::AllocateDeviceMemory((__int64)this, v7, v11, 1) )
  {
    IOLog("%s: Could not create IOSurface for set-file buffer\n");
    v10 = -536870211;
    goto LABEL_30;
  }
  v12 = *(void **)(*(_QWORD *)v11 + 8LL);
  v13 = (unsigned int)v7;
  bzero(v12, (unsigned int)v7);
  v15 = IOMemoryDescriptor::withAddressRange(a2, (unsigned int)v7, 2uLL, v6, v14);
  if ( !v15 )
  {
    IOLog("AppleCamIn::ISP_LoadSetfile_gated - couldn't create memory descriptor\n");
    v10 = -536870211;
    goto LABEL_30;
  }
  if ( (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v15 + 496LL))(v15, 0LL) )
  {
    IOLog("AppleCamIn::ISP_LoadSetfile_gated - couldn't prepare memory descriptor\n");
    (*(void (__fastcall **)(__int64))(*(_QWORD *)v15 + 40LL))(v15);
    v10 = -536870211;
    goto LABEL_30;
  }
  LODWORD(v16) = (*(int (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v15 + 512LL))(v15, 4096LL);
  v17 = v16;
  if ( v16 )
  {
    v18 = operator new(0x28uLL);
    *((_QWORD *)v8 + v49 + 269) = v18;
    if ( v18 )
    {
      v47 = v17;
      *(_DWORD *)v18 = v7;
      v19 = OSDictionary::withCapacity((OSDictionary *)((char *)&dword_4 + 3), 0x1000u);
      v21 = OSNumber::withNumber((OSNumber *)&stru_20.vmsize, 0x20uLL, v20);
      (*(void (__fastcall **)(__int64, _QWORD, __int64))(*(_QWORD *)v19 + 464LL))(v19, "IOSurfaceWidth", v21);
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v21 + 40LL))(v21);
      v23 = OSNumber::withNumber((OSNumber *)&stru_20.vmsize, 0x20uLL, v22);
      (*(void (__fastcall **)(__int64, _QWORD, __int64))(*(_QWORD *)v19 + 464LL))(v19, "IOSurfaceHeight", v23);
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v23 + 40LL))(v23);
      v25 = OSNumber::withNumber((OSNumber *)&stru_20.vmsize, 0x20uLL, v24);
      (*(void (__fastcall **)(_QWORD, _QWORD, __int64))(*(_QWORD *)v19 + 464LL))(v19, "IOSurfaceBytesPerRow", v25);
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v25 + 40LL))(v25);
      v27 = OSNumber::withNumber((OSNumber *)v13, 0x20uLL, v26);
      (*(void (__fastcall **)(_QWORD, _QWORD, __int64))(*(_QWORD *)v19 + 464LL))(v19, "IOSurfaceAllocSize", v27);
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v27 + 40LL))(v27);
      v28 = OSString::withCString("yuvs", "IOSurfaceAllocSize");
      (*(void (__fastcall **)(_QWORD, _QWORD, __int64))(*(_QWORD *)v19 + 464LL))(v19, "IOSurfacePixelFormat", v28);
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v28 + 40LL))(v28);
      (*(void (__fastcall **)(__int64, _QWORD, _QWORD))(*(_QWORD *)v19 + 464LL))(
        v19,
        "IOSurfaceIsGlobal",
        **(_QWORD **)off_12050[0]);
      LODWORD(v29) = (*(int (__fastcall **)(_QWORD, _QWORD, __int64))(**((_QWORD **)v8 + 36) + 2152LL))(
                       *((_QWORD *)v8 + 36),
                       *(_QWORD *)off_12058,
                       v19);
      *(_QWORD *)(*((_QWORD *)v8 + v49 + 269) + 8LL) = v29;
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v19 + 40LL))(v19);
      v30 = *((_QWORD *)v8 + v49 + 269);
      v31 = *(_QWORD *)(v30 + 8);
      v32 = v49;
      if ( !v31 )
      {
        v17 = v47;
        if ( v30 )
        {
          operator delete((void *)v30);
          v32 = v49;
        }
        v49 = v32;
        *((_QWORD *)v8 + v32 + 269) = 0LL;
        goto LABEL_24;
      }
      (*(void (__fastcall **)(__int64, _QWORD, _QWORD))(*(_QWORD *)v31 + 320LL))(v31, 0LL, 0LL);
      LODWORD(v33) = (*(int (**)(void))(**(_QWORD **)(*((_QWORD *)v8 + v49 + 269) + 8LL) + 368LL))();
      *(_QWORD *)(*((_QWORD *)v8 + v49 + 269) + 16LL) = v33;
      v34 = *((_QWORD *)v8 + v49 + 269);
      v35 = *(_QWORD *)(v34 + 16);
      v17 = v47;
      if ( !v35 )
      {
        (*(void (__fastcall **)(_QWORD, _QWORD, _QWORD))(**(_QWORD **)(v34 + 8) + 328LL))(
          *(_QWORD *)(v34 + 8),
          0LL,
          0LL);
        (*(void (**)(void))(**(_QWORD **)(*((_QWORD *)v8 + v49 + 269) + 8LL) + 288LL))();
        v42 = (void *)*((_QWORD *)v8 + v49 + 269);
        v43 = v8;
        v44 = v49;
        if ( v42 )
        {
          operator delete(v42);
          v44 = v49;
          v43 = v8;
        }
        v49 = v44;
        *((_QWORD *)v43 + v44 + 269) = 0LL;
        v8 = v43;
        goto LABEL_24;
      }
      (*(void (**)(void))(*(_QWORD *)v35 + 32LL))();
      v36 = *(_QWORD *)(*((_QWORD *)v8 + v49 + 269) + 16LL);
      (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v36 + 496LL))(v36, 3LL);
      v37 = *(_QWORD *)(*((_QWORD *)v8 + v49 + 269) + 16LL);
      LODWORD(v38) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v37 + 512LL))(v37, 0LL);
      *(_QWORD *)(*((_QWORD *)v8 + v49 + 269) + 24LL) = v38;
      LODWORD(v39) = (*(int (**)(void))(**(_QWORD **)(*((_QWORD *)v8 + v49 + 269) + 24LL) + 280LL))();
      v40 = v39;
      v18 = *((_QWORD *)v8 + v49 + 269);
      *(_QWORD *)(v18 + 32) = v40;
    }
    if ( v18 )
    {
      LODWORD(v41) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v17 + 280LL))(v17);
      bcopy(v41, *(void **)(*((_QWORD *)v8 + v49 + 269) + 32LL), v13);
      *((_BYTE *)v8 + v49 + 738) = 1;
      *((_DWORD *)v8 + v49 + 185) = _byteswap_ulong(**(_DWORD **)(*((_QWORD *)v8 + v49 + 269) + 32LL));
      v10 = 0;
LABEL_25:
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v17 + 40LL))(v17);
      goto LABEL_26;
    }
LABEL_24:
    IOLog("AppleCamIn::ISP_LoadSetfile_gated - couldn't allocate set-file cache surface\n");
    v10 = -536870212;
    goto LABEL_25;
  }
  IOLog("AppleCamIn::ISP_LoadSetfile_gated - couldn't create memory map\n");
  v10 = -536870212;
LABEL_26:
  (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v15 + 504LL))(v15, 2LL);
  (*(void (__fastcall **)(__int64))(*(_QWORD *)v15 + 40LL))(v15);
  if ( !v10 )
  {
    v10 = 0;
    if ( *((_BYTE *)v8 + 656) )
    {
      bcopy(
        *(const void **)(*((_QWORD *)v8 + v49 + 269) + 32LL),
        *(void **)(*((_QWORD *)v8 + v49 + 267) + 8LL),
        **((_DWORD **)v8 + v49 + 269));
      v52 = 273;
      v53 = v48;
      v45 = *((_QWORD *)v8 + v49 + 267);
      v54 = *(_DWORD *)(v45 + 4);
      v55 = *(_DWORD *)v45;
      v50 = 20;
      v10 = AppleCamIn::ispCmdSend(v8, &v51, 20, &v50, 0, 0, 0, 0x7D0u);
      if ( *((_BYTE *)v8 + 4020) & 2 )
      {
        IOLog("AppleCamIn::ISP_LoadSetfile_gated - CISP_CMD_CH_SET_FILE_LOAD command (chan=%d) completed: res=0x%08X\n");
      }
    }
  }
LABEL_30:
  result = *(_QWORD *)off_12040[0];
  if ( *(_QWORD *)off_12040[0] == v56 )
  {
    result = (unsigned int)v10;
  }
  return result;
}
// 4: using guessed type int dword_4;
// 20: using guessed type segment_command_64 stru_20;
// 12040: using guessed type __int64 off_12040[4];
// 12050: using guessed type __int64 off_12050[2];
// 12058: using guessed type __int64 off_12058;
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (0000000000008212) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_GetSetfileSurfaceID(AppleCamIn *this, unsigned int a2, unsigned int *a3)
{
  return (*(int (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleCamIn *__hidden, unsigned int, unsigned int *), _QWORD, unsigned int *, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
           *((_QWORD *)this + 35),
           AppleCamIn::ISP_GetSetfileSurfaceID_gated,
           a2,
           a3,
           0LL,
           0LL);
}

//----- (0000000000008240) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_GetSetfileSurfaceID_gated(AppleCamIn *this, unsigned int a2, unsigned int *a3)
{
  __int64 result; // rax@1
  __int64 v4; // rcx@2

  result = 3758097090LL;
  if ( a2 <= 1 )
  {
    v4 = *((_QWORD *)this + a2 + 269);
    result = 3758097086LL;
    if ( v4 )
    {
      *a3 = *(_DWORD *)(*(_QWORD *)(v4 + 8) + 12LL);
      result = 0LL;
    }
  }
  return result;
}

//----- (0000000000008270) ----------------------------------------------------
__int64 __fastcall AppleCamIn::doorBellRing0(AppleCamIn *this, void *a2)
{
  *(int *)((char *)&dword_41020 + *((_QWORD *)this + 509)) = 16;
  return IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
}
// 41020: using guessed type int dword_41020;

//----- (000000000000829A) ----------------------------------------------------
__int64 __fastcall AppleCamIn::doorBellRing1(AppleCamIn *this, void *a2)
{
  *(int *)((char *)&dword_41020 + *((_QWORD *)this + 509)) = 32;
  return IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
}
// 41020: using guessed type int dword_41020;

//----- (00000000000082C4) ----------------------------------------------------
__int64 __fastcall AppleCamIn::doorBellRing2(AppleCamIn *this, void *a2)
{
  *(int *)((char *)&dword_41020 + *((_QWORD *)this + 509)) = 64;
  return IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
}
// 41020: using guessed type int dword_41020;

//----- (00000000000082EE) ----------------------------------------------------
__int64 __fastcall AppleCamIn::doorBellRing3(AppleCamIn *this, void *a2)
{
  *(int *)((char *)&dword_41020 + *((_QWORD *)this + 509)) = 128;
  return IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
}
// 41020: using guessed type int dword_41020;

//----- (0000000000008318) ----------------------------------------------------
__int64 __fastcall AppleCamIn::channelNameToIndex(AppleCamIn *this, char *a2, unsigned int *a3)
{
  signed int v3; // er15@1
  unsigned int v4; // er14@2
  const void *v5; // rbx@3
  size_t v6; // rax@3
  unsigned int *v8; // [sp+0h] [bp-30h]@2

  v3 = -536870206;
  if ( *((_DWORD *)this + 146) )
  {
    v8 = a3;
    v4 = 0;
    while ( 1 )
    {
      v5 = (const void *)(*((_QWORD *)this + 39) + ((unsigned __int64)v4 << 8));
      v6 = strlen(a2);
      if ( !bcmp(a2, v5, v6) )
      {
        break;
      }
      ++v4;
      if ( v4 >= *((_DWORD *)this + 146) )
      {
        return (unsigned int)v3;
      }
    }
    *v8 = v4;
    v3 = 0;
  }
  return (unsigned int)v3;
}

//----- (0000000000008396) ----------------------------------------------------
__int64 __fastcall AppleCamIn::S2ISPAddressToDeviceMemoryHostVirtualAddress(AppleCamIn *this, unsigned int a2)
{
  return *((_QWORD *)this + 507) + a2;
}

//----- (00000000000083A5) ----------------------------------------------------
__int64 __fastcall MyCalloc(__int64 a1, __int64 a2)
{
  return operator new[](a2 * a1);
}

//----- (00000000000083B3) ----------------------------------------------------
void __fastcall MyFree(void *a1)
{
  if ( a1 )
  {
    operator delete(a1);
  }
}

//----- (00000000000083C4) ----------------------------------------------------
__int64 __fastcall AppleCamIn::FreeDeviceMemoryAllocation(__int64 a1, __int64 a2)
{
  DeviceMemoryManager::Free(
    *(DeviceMemoryManager **)(a1 + 3992),
    *(_DWORD *)(a2 + 8) - (*(_DWORD *)(a1 + 704) + *(_DWORD *)(a1 + 4000)));
  return 0LL;
}

//----- (00000000000083EC) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_ForgetFirmware(AppleCamIn *this)
{
  return (*(int (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleCamIn *__hidden), _QWORD, _QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
           *((_QWORD *)this + 35),
           AppleCamIn::ISP_ForgetFirmware_gated,
           0LL,
           0LL,
           0LL,
           0LL);
}

//----- (0000000000008416) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_ForgetFirmware_gated(AppleCamIn *this)
{
  AppleCamIn *v1; // r14@1
  __int64 result; // rax@1
  signed __int64 v3; // rsi@2
  __int64 v4; // rdi@2
  signed __int64 v5; // rbx@4
  __int64 v6; // rax@5
  void *v7; // rdi@6
  __int64 v8; // rax@9
  __int64 v9; // rdi@10
  __int64 v10; // rdi@10
  void *v11; // rdi@10
  void *v12; // rdi@14
  void *v13; // rdi@16

  v1 = this;
  result = 3758097122LL;
  if ( !*((_BYTE *)this + 656) )
  {
    *((_DWORD *)this + 40) = 0;
    v3 = 1776LL;
    bzero((char *)this + 2168, 0x6F0uLL);
    *((_BYTE *)this + 682) = 0;
    v4 = *((_QWORD *)this + 493);
    if ( v4 )
    {
      v3 = *((_DWORD *)v1 + 988);
      IOFree(v4, v3);
      *((_QWORD *)v1 + 493) = 0LL;
      *((_DWORD *)v1 + 988) = 0;
    }
    v5 = -2LL;
    do
    {
      v6 = *((_QWORD *)v1 + v5 + 269);
      if ( v6 )
      {
        v3 = (unsigned int)(*(_DWORD *)(v6 + 8) - (*((_DWORD *)v1 + 176) + *((_DWORD *)v1 + 1000)));
        DeviceMemoryManager::Free(*((DeviceMemoryManager **)v1 + 499), v3);
        v7 = (void *)*((_QWORD *)v1 + v5 + 269);
        if ( v7 )
        {
          operator delete(v7);
        }
        *((_QWORD *)v1 + v5 + 269) = 0LL;
      }
      *((_BYTE *)v1 + v5 + 740) = 0;
      v8 = *((_QWORD *)v1 + v5 + 271);
      if ( v8 )
      {
        (*(void (__fastcall **)(_QWORD, signed __int64))(**(_QWORD **)(v8 + 24) + 40LL))(*(_QWORD *)(v8 + 24), v3);
        v9 = *(_QWORD *)(*((_QWORD *)v1 + v5 + 271) + 16LL);
        (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v9 + 504LL))(v9, 2LL);
        (*(void (**)(void))(**(_QWORD **)(*((_QWORD *)v1 + v5 + 271) + 16LL) + 40LL))();
        v10 = *(_QWORD *)(*((_QWORD *)v1 + v5 + 271) + 8LL);
        v3 = 0LL;
        (*(void (__fastcall **)(__int64, _QWORD, _QWORD))(*(_QWORD *)v10 + 328LL))(v10, 0LL, 0LL);
        (*(void (**)(void))(**(_QWORD **)(*((_QWORD *)v1 + v5 + 271) + 8LL) + 288LL))();
        v11 = (void *)*((_QWORD *)v1 + v5 + 271);
        if ( v11 )
        {
          operator delete(v11);
        }
        *((_QWORD *)v1 + v5 + 271) = 0LL;
      }
      ++v5;
    }
    while ( v5 );
    bzero((char *)v1 + 720, 0x588uLL);
    v12 = (void *)*((_QWORD *)v1 + 496);
    if ( v12 )
    {
      operator delete[](v12);
      *((_QWORD *)v1 + 496) = 0LL;
    }
    v13 = (void *)*((_QWORD *)v1 + 497);
    if ( v13 )
    {
      operator delete[](v13);
      *((_QWORD *)v1 + 497) = 0LL;
    }
    *(_QWORD *)((char *)v1 + 3956) = 0LL;
    (*(void (__fastcall **)(AppleCamIn *, _QWORD))(*(_QWORD *)v1 + 672LL))(v1, *((_QWORD *)v1 + 21));
    (*(void (__fastcall **)(AppleCamIn *, _QWORD))(*(_QWORD *)v1 + 672LL))(v1, *((_QWORD *)v1 + 22));
    (*(void (__fastcall **)(AppleCamIn *, _QWORD))(*(_QWORD *)v1 + 672LL))(v1, *((_QWORD *)v1 + 23));
    result = 0LL;
  }
  return result;
}
// B6378: using guessed type int __fastcall IOFree(_QWORD, _QWORD);

//----- (0000000000008610) ----------------------------------------------------
__int64 __usercall AppleCamIn::processSharedMallocRequest@<rax>(AppleCamIn *this@<rdi>, __int64 a2@<rax>, int a3@<edx>, int a4@<esi>)
{
  __int64 v4; // rdi@7
  int v5; // esi@7
  __int64 v7; // [sp+0h] [bp-20h]@1

  v7 = a2;
  if ( a4 )
  {
    if ( *((_BYTE *)this + 4020) & 4 )
    {
      IOLog("AppleCamIn::processSharedMallocRequest - ISP Memory free request\n");
    }
    AppleCamIn::FreeDeviceMemoryAllocation(this, a4);
    goto LABEL_7;
  }
  if ( (unsigned int)AppleCamIn::AllocateDeviceMemory((__int64)this, a3, (__int64)&v7, 0) )
  {
    IOLog("AppleCamIn::processSharedMallocRequest - ERROR: ISP requesting more memory than we have left (%d)\n");
LABEL_7:
    v4 = *((_QWORD *)this + *((_DWORD *)this + 150) + 41);
    v5 = 0;
    goto LABEL_8;
  }
  if ( *((_BYTE *)this + 4020) & 4 )
  {
    IOLog("AppleCamIn::processSharedMallocRequest - ISP Memory allocation request, %d bytes\n");
  }
  v4 = *((_QWORD *)this + *((_DWORD *)this + 150) + 41);
  v5 = *(_DWORD *)(v7 + 4);
LABEL_8:
  IOProcessorChannelSend(v4, v5, 0, 0);
  return 0LL;
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (00000000000086CA) ----------------------------------------------------
__int64 __fastcall AppleCamIn::FreeDeviceMemoryAllocation(AppleCamIn *this, int a2)
{
  signed int v2; // er12@1
  unsigned int v3; // er13@2
  __int64 v4; // rax@3
  __int64 v5; // rax@3
  __int64 v6; // rbx@3
  __int64 v7; // rsi@7

  v2 = -536870206;
  if ( (*(int (__cdecl **)(_QWORD))(**((_QWORD **)this + 80) + 304LL))(*((_QWORD *)this + 80)) )
  {
    v3 = 0;
    while ( 1 )
    {
      LODWORD(v4) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 80) + 488LL))(
                      *((_QWORD *)this + 80),
                      v3);
      LODWORD(v5) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v4 + 376LL))(v4);
      v6 = v5;
      if ( *(_DWORD *)(v5 + 4) == a2 )
      {
        break;
      }
      ++v3;
      if ( v3 >= (*(int (__cdecl **)(_QWORD))(**((_QWORD **)this + 80) + 304LL))(*((_QWORD *)this + 80)) )
      {
        return (unsigned int)v2;
      }
    }
    DeviceMemoryManager::Free(
      *((DeviceMemoryManager **)this + 499),
      *(_DWORD *)(v5 + 8) - (*((_DWORD *)this + 176) + *((_DWORD *)this + 1000)));
    if ( *((_BYTE *)this + 4020) & 4 )
    {
      v7 = *(_DWORD *)v6;
      IOLog("AppleCamIn::FreeDeviceMemoryAllocation - freed shared surface with %d bytes (address 0x%08X)\n");
    }
    (*(void (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 80) + 472LL))(*((_QWORD *)this + 80), v3);
    v2 = 0;
  }
  return (unsigned int)v2;
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (00000000000087A6) ----------------------------------------------------
__int64 __fastcall AppleCamIn::processTargetToHostIOCommand(AppleCamIn *this, int a2, int a3, int a4)
{
  int v4; // er14@1
  int v5; // er15@1
  AppleCamIn *v6; // rbx@1

  v4 = a4;
  v5 = a3;
  v6 = this;
  IOLog("AppleCamIn::processTargetToHostIOCommand\n");
  (*(void (__fastcall **)(AppleCamIn *, signed __int64, _QWORD, _QWORD))(*(_QWORD *)v6 + 1856LL))(
    v6,
    3825172481LL,
    0LL,
    0LL);
  IOProcessorChannelSend(*((_QWORD *)v6 + *((_DWORD *)v6 + 155) + 41), a2, v5, v4);
  return 0LL;
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (0000000000008808) ----------------------------------------------------
__int64 __fastcall AppleCamIn::processDebugLoggingRequest(AppleCamIn *this, unsigned int a2, __int64 a3, int a4)
{
  __int64 v4; // r15@2
  int v5; // eax@2
  __int64 v6; // rax@6
  __int64 v7; // rax@6
  __int64 v8; // rax@6
  __int64 v9; // rbx@6
  signed __int64 v10; // rax@6
  signed __int64 v11; // rax@9
  signed __int64 v12; // rcx@9

  if ( a2 )
  {
    v4 = *((_QWORD *)this + 507) + a2;
    v5 = *((_DWORD *)this + 1005);
    if ( ((a4 & 0xFFFFFFFE) == 2 || (v5 & 1) != 0) && v4 != 12245725 )
    {
      printf("ISPCPU: %s", *((_QWORD *)this + 507) + a2);
      v5 = *((_DWORD *)this + 1005);
    }
    if ( BYTE1(v5) & 4 )
    {
      (*(void (__fastcall **)(_QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 89) + 320LL))(
        *((_QWORD *)this + 89),
        0LL,
        0LL);
      LODWORD(v6) = (*(int (**)(void))(**((_QWORD **)this + 89) + 368LL))();
      LODWORD(v7) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v6 + 512LL))(v6, 0LL);
      LODWORD(v8) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v7 + 280LL))(v7);
      v9 = v8;
      snprintf((char *)(v8 + *(_QWORD *)v8), 0x80uLL, "%s", v4);
      v10 = *(_QWORD *)v9 + 128LL;
      if ( (unsigned __int64)v10 > 0xFFFF )
      {
        v10 = 128LL;
      }
      *(_QWORD *)v9 = v10;
      if ( v10 == *(_QWORD *)(v9 + 8) )
      {
        v11 = v10 + 128;
        v12 = 128LL;
        if ( (unsigned __int64)v11 <= 0xFFFF )
        {
          v12 = v11;
        }
        *(_QWORD *)(v9 + 8) = v12;
      }
      (*(void (__fastcall **)(_QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 89) + 328LL))(
        *((_QWORD *)this + 89),
        0LL,
        0LL);
    }
  }
  return 0LL;
}

//----- (000000000000891E) ----------------------------------------------------
__int64 __fastcall AppleCamIn::processCommandResponse(AppleCamIn *this, unsigned int a2)
{
  if ( *((_BYTE *)this + 4020) & 2 )
  {
    IOLog("AppleCamIn::processCommandResponse\n");
  }
  (*(void (__fastcall **)(_QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 488LL))(*((_QWORD *)this + 35), a2, 0LL);
  return 0LL;
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (000000000000895E) ----------------------------------------------------
__int64 __fastcall AppleCamIn::processHostToTargetBufferResponse(AppleCamIn *this, unsigned int a2)
{
  (*(void (__fastcall **)(_QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 488LL))(*((_QWORD *)this + 35), a2, 0LL);
  return 0LL;
}

//----- (000000000000897A) ----------------------------------------------------
__int64 __fastcall AppleCamIn::processTargetToHostBufferNotification(AppleCamIn *this, __int64 a2, __int64 a3, int a4, unsigned int a5)
{
  int v5; // ebx@1
  int v6; // er15@1
  __int64 v7; // r14@1
  __int64 v8; // rdx@1
  AppleCamIn *v9; // r12@1
  int v10; // eax@2
  signed int v11; // ecx@4
  __int64 v12; // rbx@5
  __int64 v13; // r13@5
  AppleCamIn *v14; // r15@5
  __int64 *v15; // r12@6
  __int64 v16; // rsi@7
  __int64 v17; // rdx@7
  __int64 v18; // rbx@8
  int (__fastcall *v19)(_QWORD, _QWORD); // r14@8
  __int64 v20; // rax@8
  __int64 v21; // rax@9
  __int64 v22; // r14@9
  __int64 v23; // rax@9
  __int64 v24; // r12@9
  int v25; // ecx@9
  __int64 v26; // rax@10
  __int64 v27; // rax@12
  __int64 v28; // rax@12
  __int64 v29; // rbx@12
  const void *v30; // ST10_8@12
  void *v31; // rax@12
  void *v32; // rsi@12
  void *v33; // rdi@13
  __int64 v34; // rax@18
  __int64 v35; // rax@18
  char v36; // bl@18
  __int64 v37; // rdi@26
  signed int v38; // ecx@28
  __int64 v39; // rbx@29
  __int64 v40; // r13@29
  AppleCamIn *v41; // r15@29
  __int64 *v42; // r12@30
  __int64 v43; // rsi@31
  __int64 v44; // rdx@31
  __int64 v45; // rbx@32
  int (__fastcall *v46)(_QWORD, _QWORD); // r14@32
  __int64 v47; // rax@32
  __int64 v48; // rax@33
  __int64 v49; // r14@33
  __int64 v50; // rax@33
  __int64 v51; // r12@33
  int v52; // ecx@33
  __int64 v53; // rax@34
  __int64 v54; // rax@36
  __int64 v55; // rax@36
  __int64 v56; // rbx@36
  const void *v57; // ST10_8@36
  void *v58; // rax@36
  void *v59; // rsi@36
  void *v60; // rdi@37
  __int64 v61; // rax@42
  __int64 v62; // rax@42
  char v63; // bl@42
  __int64 result; // rax@62
  int v65; // [sp+8h] [bp-1F8h]@4
  int v66; // [sp+8h] [bp-1F8h]@28
  int v67; // [sp+Ch] [bp-1F4h]@4
  int v68; // [sp+Ch] [bp-1F4h]@28
  __int64 v69; // [sp+18h] [bp-1E8h]@5
  __int64 v70; // [sp+18h] [bp-1E8h]@29
  char v71; // [sp+20h] [bp-1E0h]@5
  char v72; // [sp+20h] [bp-1E0h]@29
  __int64 v73; // [sp+28h] [bp-1D8h]@1
  __int64 v74; // [sp+30h] [bp-1D0h]@1
  __int64 v75; // [sp+38h] [bp-1C8h]@8
  __int64 v76; // [sp+38h] [bp-1C8h]@32
  char v77; // [sp+40h] [bp-1C0h]@20
  int v78; // [sp+80h] [bp-180h]@54
  __int64 v79[14]; // [sp+90h] [bp-170h]@16
  char v80; // [sp+100h] [bp-100h]@44
  int v81; // [sp+140h] [bp-C0h]@58
  __int64 v82[16]; // [sp+150h] [bp-B0h]@40
  __int64 v83; // [sp+1D0h] [bp-30h]@1

  v5 = a4;
  v6 = a2;
  v7 = off_12040[0];
  v83 = *(_QWORD *)off_12040[0];
  v8 = *((_QWORD *)this + 507);
  v74 = v8;
  v9 = this;
  a2 = (unsigned int)a2;
  v73 = a2;
  if ( !((unsigned int)a2 + v8) )
  {
    IOLog("AppleCamIn::processTargetToHostBufferNotification: Invalid buffer return: 0x%08X\n");
    goto LABEL_62;
  }
  v10 = *(_DWORD *)(v8 + a2);
  if ( v10 == 4 )
  {
    v37 = (__int64)"AppleCamIn::processTargetToHostBufferNotification - FFW_INTERPROC_MSG_MSG\n";
  }
  else
  {
    if ( v10 == 2 )
    {
      v65 = a4;
      v67 = a2;
      v11 = *(_DWORD *)(v8 + a2 + 4);
      if ( v11 <= 0 )
      {
        v71 = 0;
        v14 = this;
      }
      else
      {
        v69 = a2 + v8 + 8;
        v12 = a2 + v8 + 40;
        v13 = 0LL;
        v71 = 0;
        v14 = this;
        do
        {
          v15 = (__int64 *)v12;
          if ( *((_BYTE *)v14 + 4020) & 0x20 )
          {
            v16 = *(_DWORD *)(v12 - 4) & 0xFFFFFFF;
            v15 = (__int64 *)(v69 + 40 * v13 + 32);
            v17 = *(_QWORD *)v12;
            IOLog("t2hBuf: pool=%d, tag=0x%08llX\n");
          }
          v75 = v12;
          v18 = *((_QWORD *)v14 + 79);
          v19 = *(int (__fastcall **)(_QWORD, _QWORD))(*(_QWORD *)v18 + 480LL);
          v20 = AppleCamIn::GenerateClientBufferArgsDataPointerFromTag(v14, *v15);
          if ( (unsigned __int8)v19(v18, v20) )
          {
            v21 = AppleCamIn::GenerateClientBufferArgsDataPointerFromTag(v14, *v15);
            v22 = v21;
            LODWORD(v23) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v21 + 376LL))(v21);
            v24 = v23;
            v25 = *(_DWORD *)(v23 + 148);
            if ( v25 )
            {
              v26 = *(_QWORD *)(v23 + 160);
              if ( v26 )
              {
                if ( (v25 & 0xFFFFFFFE) == 2 )
                {
                  LODWORD(v27) = (*(int (**)(void))(**(_QWORD **)(v24 + 96) + 368LL))();
                  LODWORD(v28) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v27 + 512LL))(v27, 0LL);
                  v29 = v28;
                  v30 = *(const void **)(*(_QWORD *)(v24 + 160) + 8LL);
                  LODWORD(v31) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v28 + 280LL))(v28);
                  v32 = v31;
                  S2CamIn_bcopy_WriteCombine(v30, v31, **(_DWORD **)(v24 + 160));
                  (*(void (__fastcall **)(__int64, void *))(*(_QWORD *)v29 + 40LL))(v29, v32);
                  v26 = *(_QWORD *)(v24 + 160);
                }
                DeviceMemoryManager::Free(
                  *((DeviceMemoryManager **)v14 + 499),
                  *(_DWORD *)(v26 + 8) - (*((_DWORD *)v14 + 176) + *((_DWORD *)v14 + 1000)));
                v33 = *(void **)(v24 + 160);
                if ( v33 )
                {
                  operator delete(v33);
                }
                *(_QWORD *)(v24 + 160) = 0LL;
              }
            }
            else
            {
              IOMMUManager::Free(*((IOMMUManager **)v14 + 498), *(_DWORD *)(v23 + 152));
              (*(void (__fastcall **)(_QWORD, signed __int64))(**(_QWORD **)(v24 + 136) + 304LL))(
                *(_QWORD *)(v24 + 136),
                1LL);
              (*(void (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)v14 + 38) + 304LL))(
                *((_QWORD *)v14 + 38),
                *(_QWORD *)(v24 + 136));
            }
            LODWORD(v34) = (*(int (**)(void))(**(_QWORD **)(v24 + 96) + 368LL))();
            (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v34 + 504LL))(v34, 2LL);
            LODWORD(v35) = (*(int (**)(void))(**(_QWORD **)(v24 + 96) + 368LL))();
            (*(void (__fastcall **)(__int64))(*(_QWORD *)v35 + 40LL))(v35);
            (*(void (__fastcall **)(_QWORD, _QWORD, _QWORD))(**(_QWORD **)(v24 + 96) + 328LL))(
              *(_QWORD *)(v24 + 96),
              0LL,
              0LL);
            (*(void (**)(void))(**(_QWORD **)(v24 + 96) + 288LL))();
            v36 = 1;
            if ( *(_QWORD *)(v24 + 88) )
            {
              if ( !(_DWORD)v13 )
              {
                bcopy((const void *)(v24 + 8), &v77, 0x40uLL);
              }
              v79[v13] = *(_DWORD *)(v24 + 144);
              v36 = v71;
            }
            (*(void (__fastcall **)(_QWORD, __int64))(**((_QWORD **)v14 + 79) + 472LL))(*((_QWORD *)v14 + 79), v22);
            v71 = v36;
          }
          else
          {
            IOLog("AppleCamIn::processTargetToHostBufferNotification - firmware passed us a buffer with an invalid tag: 0x%08X\n");
            v79[v13] = 0xFFFFFFFFLL;
          }
          ++v13;
          v11 = *(_DWORD *)(v74 + v73 + 4);
          v12 = v75 + 40;
        }
        while ( (signed int)v13 < v11 );
      }
      v9 = v14;
      v7 = off_12040[0];
      v6 = v67;
      v5 = v65;
      if ( v11 && !(v71 & 1) )
      {
        *((_DWORD *)v9 + 1003) += v11;
        AppleCamInUserClient::sendAsyncResult64(
          (AppleCamInUserClient *)&v77,
          0LL,
          (unsigned __int64)&v78,
          (unsigned __int64 *)(unsigned int)(v11 + 2),
          a5);
      }
      goto LABEL_59;
    }
    if ( v10 == 1 )
    {
      v66 = a4;
      v68 = a2;
      v38 = *(_DWORD *)(v8 + a2 + 4);
      if ( v38 <= 0 )
      {
        v72 = 0;
        v41 = this;
      }
      else
      {
        v70 = a2 + v8 + 8;
        v39 = a2 + v8 + 40;
        v40 = 0LL;
        v72 = 0;
        v41 = this;
        do
        {
          v42 = (__int64 *)v39;
          if ( *((_BYTE *)v41 + 4020) & 0x20 )
          {
            v43 = *(_DWORD *)(v39 - 4) & 0xFFFFFFF;
            v42 = (__int64 *)(v70 + 40 * v40 + 32);
            v44 = *(_QWORD *)v39;
            IOLog("t2hBuf: pool=%d, tag=0x%08llX\n");
          }
          v76 = v39;
          v45 = *((_QWORD *)v41 + 79);
          v46 = *(int (__fastcall **)(_QWORD, _QWORD))(*(_QWORD *)v45 + 480LL);
          v47 = AppleCamIn::GenerateClientBufferArgsDataPointerFromTag(v41, *v42);
          if ( (unsigned __int8)v46(v45, v47) )
          {
            v48 = AppleCamIn::GenerateClientBufferArgsDataPointerFromTag(v41, *v42);
            v49 = v48;
            LODWORD(v50) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v48 + 376LL))(v48);
            v51 = v50;
            v52 = *(_DWORD *)(v50 + 148);
            if ( v52 )
            {
              v53 = *(_QWORD *)(v50 + 160);
              if ( v53 )
              {
                if ( (v52 & 0xFFFFFFFE) == 2 )
                {
                  LODWORD(v54) = (*(int (**)(void))(**(_QWORD **)(v51 + 96) + 368LL))();
                  LODWORD(v55) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v54 + 512LL))(v54, 0LL);
                  v56 = v55;
                  v57 = *(const void **)(*(_QWORD *)(v51 + 160) + 8LL);
                  LODWORD(v58) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v55 + 280LL))(v55);
                  v59 = v58;
                  S2CamIn_bcopy_WriteCombine(v57, v58, **(_DWORD **)(v51 + 160));
                  (*(void (__fastcall **)(__int64, void *))(*(_QWORD *)v56 + 40LL))(v56, v59);
                  v53 = *(_QWORD *)(v51 + 160);
                }
                DeviceMemoryManager::Free(
                  *((DeviceMemoryManager **)v41 + 499),
                  *(_DWORD *)(v53 + 8) - (*((_DWORD *)v41 + 176) + *((_DWORD *)v41 + 1000)));
                v60 = *(void **)(v51 + 160);
                if ( v60 )
                {
                  operator delete(v60);
                }
                *(_QWORD *)(v51 + 160) = 0LL;
              }
            }
            else
            {
              IOMMUManager::Free(*((IOMMUManager **)v41 + 498), *(_DWORD *)(v50 + 152));
              (*(void (__fastcall **)(_QWORD, signed __int64))(**(_QWORD **)(v51 + 136) + 304LL))(
                *(_QWORD *)(v51 + 136),
                1LL);
              (*(void (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)v41 + 38) + 304LL))(
                *((_QWORD *)v41 + 38),
                *(_QWORD *)(v51 + 136));
            }
            LODWORD(v61) = (*(int (**)(void))(**(_QWORD **)(v51 + 96) + 368LL))();
            (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v61 + 504LL))(v61, 2LL);
            LODWORD(v62) = (*(int (**)(void))(**(_QWORD **)(v51 + 96) + 368LL))();
            (*(void (__fastcall **)(__int64))(*(_QWORD *)v62 + 40LL))(v62);
            (*(void (__fastcall **)(_QWORD, _QWORD, _QWORD))(**(_QWORD **)(v51 + 96) + 328LL))(
              *(_QWORD *)(v51 + 96),
              0LL,
              0LL);
            (*(void (**)(void))(**(_QWORD **)(v51 + 96) + 288LL))();
            v63 = 1;
            if ( *(_QWORD *)(v51 + 88) )
            {
              if ( !(_DWORD)v40 )
              {
                bcopy((const void *)(v51 + 8), &v80, 0x40uLL);
              }
              v82[v40] = *(_DWORD *)(v51 + 144);
              v63 = v72;
            }
            (*(void (__fastcall **)(_QWORD, __int64))(**((_QWORD **)v41 + 79) + 472LL))(*((_QWORD *)v41 + 79), v49);
            v72 = v63;
          }
          else
          {
            IOLog("AppleCamIn::processTargetToHostBufferNotification - firmware passed us a buffer with an invalid tag: 0x%08X\n");
            v82[v40] = 0xFFFFFFFFLL;
          }
          ++v40;
          v38 = *(_DWORD *)(v74 + v73 + 4);
          v39 = v76 + 40;
        }
        while ( (signed int)v40 < v38 );
      }
      v9 = v41;
      v7 = off_12040[0];
      v6 = v68;
      v5 = v66;
      if ( v38 && !(v72 & 1) )
      {
        *((_DWORD *)v9 + 1003) += v38;
        AppleCamInUserClient::sendAsyncResult64(
          (AppleCamInUserClient *)&v80,
          (unsigned __int64 *)0xE00002EB,
          (unsigned __int64)&v81,
          (unsigned __int64 *)(unsigned int)(v38 + 2),
          a5);
      }
      goto LABEL_59;
    }
    v37 = (__int64)"AppleCamIn::processTargetToHostBufferNotification - other type of message\n";
  }
  IOLog(v37);
LABEL_59:
  if ( !((v5 & 0x10000000u) >> 28) )
  {
    v6 = 0;
  }
  IOProcessorChannelSend(*((_QWORD *)v9 + *((_DWORD *)v9 + 153) + 41), v6, 0, 2147483648);
LABEL_62:
  result = *(_QWORD *)v7;
  if ( *(_QWORD *)v7 == v83 )
  {
    result = 0LL;
  }
  return result;
}
// 12040: using guessed type __int64 off_12040[4];
// B6390: using guessed type int __fastcall IOLog(_QWORD);
// 897A: using guessed type __int64 var_170[14];
// 897A: using guessed type __int64 var_B0[16];

//----- (00000000000090C3) ----------------------------------------------------
__int64 __fastcall S2CamIn_bcopy_WriteCombine(const void *a1, void *a2, int a3)
{
  __int64 result; // rax@1
  unsigned int v4; // er8@1
  __int64 v5; // r9@4
  char *v6; // rcx@4
  signed __int64 v7; // r9@4
  __int64 v8; // rdx@4
  __int64 v9; // r9@9
  __int64 v10; // rdx@9
  __int64 v11; // r9@13
  __int64 v12; // rdx@13
  unsigned int v13; // er10@17
  __int64 v14; // r9@18
  char *v15; // r8@18
  signed __int64 v16; // r9@18
  __int64 v17; // rcx@18
  __m128i v18; // xmm1@19
  __m128i v19; // xmm2@19
  __m128i v20; // xmm3@19
  int v21; // edx@22
  __int64 v22; // r9@23
  __int64 v23; // rsi@23
  char v24; // dl@27

  result = a3 & 0xF;
  v4 = a3 & 0xFFFFFFF0;
  if ( (unsigned __int8)a2 & 0xF )
  {
    if ( (unsigned __int8)a1 & 0xF )
    {
      if ( v4 )
      {
        v5 = (v4 - 1) & 0xFFFFFFF0;
        v6 = (char *)a2 + v5 + 16;
        v7 = v5 + 16;
        v8 = 0LL;
        do
        {
          _mm_storeu_si128((__m128i *)((char *)a2 + v8), _mm_loadu_si128((const __m128i *)((char *)a1 + v8)));
          v8 += 16LL;
        }
        while ( (unsigned int)v8 < v4 );
LABEL_25:
        a1 = (char *)a1 + v7;
        goto LABEL_26;
      }
    }
    else if ( v4 )
    {
      v11 = (v4 - 1) & 0xFFFFFFF0;
      v6 = (char *)a2 + v11 + 16;
      v7 = v11 + 16;
      v12 = 0LL;
      do
      {
        _mm_storeu_si128((__m128i *)((char *)a2 + v12), _mm_stream_load_si128((__m128i *)((char *)a1 + v12)));
        v12 += 16LL;
      }
      while ( (unsigned int)v12 < v4 );
      goto LABEL_25;
    }
LABEL_16:
    v6 = (char *)a2;
    goto LABEL_26;
  }
  if ( (unsigned __int8)a1 & 0xF )
  {
    if ( v4 )
    {
      v9 = (v4 - 1) & 0xFFFFFFF0;
      v6 = (char *)a2 + v9 + 16;
      v7 = v9 + 16;
      v10 = 0LL;
      do
      {
        _mm_store_si128((__m128i *)((char *)a2 + v10), _mm_loadu_si128((const __m128i *)((char *)a1 + v10)));
        v10 += 16LL;
      }
      while ( (unsigned int)v10 < v4 );
      goto LABEL_25;
    }
    goto LABEL_16;
  }
  v13 = a3 & 0xFFFFFFC0;
  if ( a3 & 0xFFFFFFC0 )
  {
    v14 = (v13 - 1) & 0xFFFFFFC0;
    v15 = (char *)a2 + v14 + 64;
    v16 = v14 + 64;
    v17 = 0LL;
    do
    {
      v18 = _mm_stream_load_si128((__m128i *)((char *)a1 + v17 + 16));
      v19 = _mm_stream_load_si128((__m128i *)((char *)a1 + v17 + 32));
      v20 = _mm_stream_load_si128((__m128i *)((char *)a1 + v17 + 48));
      _mm_store_si128((__m128i *)((char *)a2 + v17), _mm_stream_load_si128((__m128i *)((char *)a1 + v17)));
      _mm_store_si128((__m128i *)((char *)a2 + v17 + 16), v18);
      _mm_store_si128((__m128i *)((char *)a2 + v17 + 32), v19);
      _mm_store_si128((__m128i *)((char *)a2 + v17 + 48), v20);
      v17 += 64LL;
    }
    while ( (unsigned int)v17 < v13 );
    a1 = (char *)a1 + v16;
  }
  else
  {
    v15 = (char *)a2;
  }
  v21 = a3 & 0x30;
  if ( v21 )
  {
    v22 = (v21 - 1) & 0xFFFFFFF0;
    v6 = &v15[v22 + 16];
    v7 = v22 + 16;
    v23 = 0LL;
    do
    {
      _mm_store_si128((__m128i *)&v15[v23], _mm_stream_load_si128((__m128i *)((char *)a1 + v23)));
      v23 += 16LL;
    }
    while ( (unsigned int)v23 < v21 );
    goto LABEL_25;
  }
  v6 = v15;
LABEL_26:
  while ( (_DWORD)result )
  {
    v24 = *(_BYTE *)a1;
    a1 = (char *)a1 + 1;
    *v6++ = v24;
    result = (unsigned int)(result - 1);
  }
  _mm_mfence();
  return result;
}

//----- (0000000000009232) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_ProcessRawImagePrepare(__int64 a1, __int64 a2)
{
  return (*(int (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleCamIn *, unsigned int *), __int64, _QWORD, _QWORD, _QWORD))(**(_QWORD **)(a1 + 280) + 456LL))(
           *(_QWORD *)(a1 + 280),
           AppleCamIn::ISP_ProcessRawImagePrepare_gated,
           a2,
           0LL,
           0LL,
           0LL);
}

//----- (000000000000925C) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_ProcessRawImagePrepare_gated(AppleCamIn *this, unsigned int *a2)
{
  unsigned int *v2; // r14@1
  __int64 v3; // r15@1
  signed int v4; // er13@1
  __int64 v5; // rbx@2
  int (__fastcall *v6)(_QWORD, _QWORD, _QWORD); // r13@2
  unsigned int v7; // er12@2
  __int64 v8; // rax@2
  __int64 v9; // rax@2
  __int64 v10; // r12@2
  int v11; // ebx@3
  __int64 v12; // rax@4
  __int64 v13; // rdi@4
  __int64 v14; // rax@6
  __int64 v15; // rbx@6
  int v16; // eax@7
  __int64 v17; // rsi@7
  __int64 v18; // rax@8
  __int64 v19; // rax@8
  __int64 v20; // rax@8
  __int64 v21; // rdi@8
  __int64 v22; // rdi@11
  __int64 v23; // rbx@11
  int (__fastcall *v24)(_QWORD, _QWORD, _QWORD); // ST30_8@11
  unsigned int v25; // ST28_4@11
  __int64 v26; // rax@11
  __int64 v27; // rax@11
  __int64 v28; // rax@13
  __int64 v29; // rbx@13
  int v30; // eax@14
  __int64 v31; // rsi@14
  __int64 v32; // rbx@15
  __int64 v33; // rax@16
  __int64 v34; // rax@16
  __int64 v35; // rbx@17
  __int64 v36; // rdi@19
  __int64 v37; // rbx@19
  int (__fastcall *v38)(_QWORD, _QWORD, _QWORD); // ST28_8@19
  unsigned int v39; // ST20_4@19
  __int64 v40; // rax@19
  __int64 v41; // rax@19
  __int64 v42; // rax@22
  __int64 v43; // rbx@22
  int v44; // eax@23
  unsigned int v45; // edx@23
  __int64 v46; // rbx@26
  unsigned int v47; // edx@26
  unsigned int v48; // edx@26
  int v49; // er13@26
  __int64 v50; // rax@26
  int v51; // er12@26
  __int64 v52; // rax@26
  int v53; // er12@26
  int v54; // er13@26
  __int64 v55; // rax@26
  int v56; // er12@27
  __int64 v57; // rax@27
  signed int v58; // er12@28
  __int64 v60; // [sp+18h] [bp-298h]@26
  __int64 v61; // [sp+20h] [bp-290h]@26
  __int64 v62; // [sp+30h] [bp-280h]@13
  char v63; // [sp+38h] [bp-278h]@28
  __int16 v64; // [sp+3Ch] [bp-274h]@26
  unsigned int v65; // [sp+40h] [bp-270h]@26
  int v66; // [sp+44h] [bp-26Ch]@26
  unsigned int v67; // [sp+48h] [bp-268h]@26
  unsigned int v68; // [sp+4Ch] [bp-264h]@26
  int v69; // [sp+50h] [bp-260h]@26
  int v70; // [sp+54h] [bp-25Ch]@26
  unsigned int v71; // [sp+58h] [bp-258h]@26
  int v72; // [sp+5Ch] [bp-254h]@26
  int v73; // [sp+60h] [bp-250h]@26
  unsigned int v74; // [sp+64h] [bp-24Ch]@26
  unsigned int v75; // [sp+68h] [bp-248h]@26
  int v76; // [sp+6Ch] [bp-244h]@26
  int v77; // [sp+70h] [bp-240h]@27
  unsigned int v78; // [sp+74h] [bp-23Ch]@27
  unsigned int v79; // [sp+78h] [bp-238h]@27
  int v80; // [sp+7Ch] [bp-234h]@27
  __int16 v81; // [sp+84h] [bp-22Ch]@26
  unsigned int v82; // [sp+8Ch] [bp-224h]@1
  int v83; // [sp+90h] [bp-220h]@26
  __int64 v84; // [sp+98h] [bp-218h]@26
  __int64 v85; // [sp+D8h] [bp-1D8h]@26
  __int64 v86; // [sp+E0h] [bp-1D0h]@26
  __int64 v87; // [sp+E8h] [bp-1C8h]@26
  __int64 v88; // [sp+F0h] [bp-1C0h]@26
  int v89; // [sp+F8h] [bp-1B8h]@26
  int v90; // [sp+FCh] [bp-1B4h]@26
  int v91; // [sp+100h] [bp-1B0h]@26
  int v92; // [sp+104h] [bp-1ACh]@26
  int v93; // [sp+108h] [bp-1A8h]@26
  char v94; // [sp+10Ch] [bp-1A4h]@26
  char v95; // [sp+10Dh] [bp-1A3h]@26
  int v96; // [sp+110h] [bp-1A0h]@26
  __int64 v97; // [sp+118h] [bp-198h]@26
  unsigned int v98; // [sp+120h] [bp-190h]@26
  int v99; // [sp+124h] [bp-18Ch]@26
  __int64 v100; // [sp+130h] [bp-180h]@23
  int v101; // [sp+138h] [bp-178h]@19
  __int64 v102; // [sp+140h] [bp-170h]@19
  __int64 v103; // [sp+180h] [bp-130h]@19
  __int64 v104; // [sp+188h] [bp-128h]@19
  __int64 v105; // [sp+190h] [bp-120h]@19
  __int64 v106; // [sp+198h] [bp-118h]@19
  int v107; // [sp+1A0h] [bp-110h]@19
  int v108; // [sp+1A4h] [bp-10Ch]@19
  int v109; // [sp+1A8h] [bp-108h]@19
  int v110; // [sp+1ACh] [bp-104h]@19
  int v111; // [sp+1B0h] [bp-100h]@19
  char v112; // [sp+1B4h] [bp-FCh]@19
  char v113; // [sp+1B5h] [bp-FBh]@19
  int v114; // [sp+1B8h] [bp-F8h]@19
  __int64 v115; // [sp+1C0h] [bp-F0h]@19
  unsigned int v116; // [sp+1C8h] [bp-E8h]@19
  int v117; // [sp+1CCh] [bp-E4h]@19
  __int64 v118; // [sp+1D8h] [bp-D8h]@14
  int v119; // [sp+1E0h] [bp-D0h]@11
  __int64 v120; // [sp+1E8h] [bp-C8h]@11
  __int64 v121; // [sp+228h] [bp-88h]@11
  __int64 v122; // [sp+230h] [bp-80h]@11
  __int64 v123; // [sp+238h] [bp-78h]@11
  __int64 v124; // [sp+240h] [bp-70h]@11
  int v125; // [sp+248h] [bp-68h]@11
  int v126; // [sp+24Ch] [bp-64h]@11
  int v127; // [sp+250h] [bp-60h]@11
  int v128; // [sp+254h] [bp-5Ch]@11
  int v129; // [sp+258h] [bp-58h]@11
  char v130; // [sp+25Ch] [bp-54h]@11
  char v131; // [sp+25Dh] [bp-53h]@11
  int v132; // [sp+260h] [bp-50h]@11
  __int64 v133; // [sp+268h] [bp-48h]@11
  unsigned int v134; // [sp+270h] [bp-40h]@11
  int v135; // [sp+274h] [bp-3Ch]@11
  __int64 v136; // [sp+280h] [bp-30h]@7

  v2 = a2;
  v3 = (__int64)this;
  v82 = 0;
  v4 = -536870184;
  if ( *((_BYTE *)this + 204) )
  {
    return (unsigned int)v4;
  }
  v5 = *((_QWORD *)this + 36);
  v6 = *(int (__fastcall **)(_QWORD, _QWORD, _QWORD))(*(_QWORD *)v5 + 2160LL);
  v7 = *a2;
  LODWORD(v8) = current_task(this, a2);
  LODWORD(v9) = v6(v5, v7, v8);
  v10 = v9;
  v4 = -536870206;
  if ( !v9 )
  {
    return (unsigned int)v4;
  }
  v11 = (*(int (__fastcall **)(__int64, _QWORD, _QWORD))(*(_QWORD *)v9 + 320LL))(v9, 0LL, 0LL);
  if ( v11 )
  {
    v12 = *(_QWORD *)v10;
    v13 = v10;
LABEL_5:
    (*(void (__fastcall **)(__int64))(v12 + 288))(v13);
    v4 = v11;
    return (unsigned int)v4;
  }
  LODWORD(v14) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v10 + 368LL))(v10);
  v15 = v14;
  if ( !v14 )
  {
    (*(void (__fastcall **)(__int64, _QWORD, _QWORD))(*(_QWORD *)v10 + 328LL))(v10, 0LL, 0LL);
    (*(void (__fastcall **)(__int64))(*(_QWORD *)v10 + 288LL))(v10);
    return (unsigned int)v4;
  }
  (*(void (__fastcall **)(__int64))(*(_QWORD *)v14 + 32LL))(v14);
  (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v15 + 496LL))(v15, 1LL);
  IOLog("AY_DEBUG: using bounce-buffer for raw-reprocessing raw buffer\n");
  v16 = (*(int (__fastcall **)(__int64))(*(_QWORD *)v15 + 456LL))(v15);
  v17 = (unsigned int)v16;
  if ( (unsigned int)AppleCamIn::AllocateDeviceMemory((__int64)this, v16, (__int64)&v136, 1) )
  {
    LODWORD(v18) = (*(int (__fastcall **)(__int64, __int64))(*(_QWORD *)v10 + 368LL))(v10, v17);
    (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v18 + 504LL))(v18, 2LL);
    LODWORD(v19) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v10 + 368LL))(v10);
    (*(void (__fastcall **)(__int64))(*(_QWORD *)v19 + 40LL))(v19);
    (*(void (__fastcall **)(__int64, _QWORD, _QWORD))(*(_QWORD *)v10 + 328LL))(v10, 0LL, 0LL);
    v20 = *(_QWORD *)v10;
    v21 = v10;
LABEL_9:
    (*(void (__fastcall **)(__int64))(v20 + 288))(v21);
    v4 = -536870211;
    return (unsigned int)v4;
  }
  v135 = 1;
  v132 = *(_DWORD *)(v136 + 4);
  v22 = v15;
  (*(void (__fastcall **)(__int64, _QWORD, _QWORD, _QWORD))(*(_QWORD *)v15 + 480LL))(
    v15,
    0LL,
    *(_QWORD *)(v136 + 8),
    *(_DWORD *)v136);
  v119 = -1;
  v120 = 0LL;
  v121 = 0LL;
  v122 = 0LL;
  v123 = 0LL;
  v124 = v10;
  v125 = 0;
  v126 = 0;
  v127 = 0;
  v128 = 0;
  v129 = 0;
  v130 = 0;
  v131 = 1;
  v133 = 0LL;
  v134 = *v2;
  v23 = *(_QWORD *)(v3 + 288);
  v24 = *(int (__fastcall **)(_QWORD, _QWORD, _QWORD))(*(_QWORD *)v23 + 2160LL);
  v25 = v2[3];
  LODWORD(v26) = current_task(v22, 0LL);
  LODWORD(v27) = v24(v23, v25, v26);
  if ( !v27 )
  {
    return (unsigned int)v4;
  }
  v13 = v27;
  v11 = (*(int (__fastcall **)(__int64, _QWORD, _QWORD))(*(_QWORD *)v27 + 320LL))(v27, 0LL, 0LL);
  if ( v11 )
  {
    goto LABEL_21;
  }
  v62 = v13;
  LODWORD(v28) = (*(int (**)(void))(*(_QWORD *)v13 + 368LL))();
  v29 = v28;
  if ( !v28 )
  {
    v35 = v13;
LABEL_18:
    (*(void (__fastcall **)(__int64, _QWORD, _QWORD))(*(_QWORD *)v35 + 328LL))(v35, 0LL, 0LL);
    (*(void (__fastcall **)(__int64))(*(_QWORD *)v35 + 288LL))(v35);
    return (unsigned int)v4;
  }
  (*(void (__fastcall **)(__int64))(*(_QWORD *)v28 + 32LL))(v28);
  (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v29 + 496LL))(v29, 1LL);
  IOLog("AY_DEBUG: using bounce-buffer for raw-reprocessing metadata buffer\n");
  v30 = (*(int (__fastcall **)(__int64))(*(_QWORD *)v29 + 456LL))(v29);
  v31 = (unsigned int)v30;
  if ( (unsigned int)AppleCamIn::AllocateDeviceMemory(v3, v30, (__int64)&v118, 1) )
  {
    v32 = v13;
LABEL_16:
    LODWORD(v33) = (*(int (__fastcall **)(__int64, __int64))(*(_QWORD *)v32 + 368LL))(v32, v31);
    (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v33 + 504LL))(v33, 2LL);
    LODWORD(v34) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v32 + 368LL))(v32);
    (*(void (__fastcall **)(__int64))(*(_QWORD *)v34 + 40LL))(v34);
    (*(void (__fastcall **)(__int64, _QWORD, _QWORD))(*(_QWORD *)v32 + 328LL))(v32, 0LL, 0LL);
    v20 = *(_QWORD *)v32;
    v21 = v32;
    goto LABEL_9;
  }
  v117 = 3;
  v114 = *(_DWORD *)(v118 + 4);
  v36 = v29;
  (*(void (__fastcall **)(__int64, _QWORD, _QWORD, _QWORD))(*(_QWORD *)v29 + 480LL))(
    v29,
    0LL,
    *(_QWORD *)(v118 + 8),
    *(_DWORD *)v118);
  v101 = -1;
  v102 = 0LL;
  v103 = 0LL;
  v104 = 0LL;
  v105 = 0LL;
  v106 = v62;
  v107 = 0;
  v108 = 0;
  v109 = 0;
  v110 = 0;
  v111 = 0;
  v112 = 0;
  v113 = 1;
  v115 = 0LL;
  v116 = v2[3];
  v37 = *(_QWORD *)(v3 + 288);
  v38 = *(int (__fastcall **)(_QWORD, _QWORD, _QWORD))(*(_QWORD *)v37 + 2160LL);
  v39 = v2[5];
  LODWORD(v40) = current_task(v36, 0LL);
  LODWORD(v41) = v38(v37, v39, v40);
  if ( !v41 )
  {
    return (unsigned int)v4;
  }
  v13 = v41;
  v11 = (*(int (__fastcall **)(__int64, _QWORD, _QWORD))(*(_QWORD *)v41 + 320LL))(v41, 0LL, 0LL);
  if ( v11 )
  {
LABEL_21:
    v12 = *(_QWORD *)v13;
    goto LABEL_5;
  }
  LODWORD(v42) = (*(int (**)(void))(*(_QWORD *)v13 + 368LL))();
  v43 = v42;
  if ( !v42 )
  {
    v35 = v13;
    goto LABEL_18;
  }
  (*(void (__fastcall **)(__int64))(*(_QWORD *)v42 + 32LL))(v42);
  (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v43 + 496LL))(v43, 1LL);
  IOLog("AY_DEBUG: using bounce-buffer for raw-reprocessing output buffer\n");
  v44 = (*(int (__fastcall **)(__int64))(*(_QWORD *)v43 + 456LL))(v43);
  v31 = (unsigned int)v44;
  if ( (unsigned int)AppleCamIn::AllocateDeviceMemory(v3, v44, (__int64)&v100, 1) )
  {
    v32 = v13;
    goto LABEL_16;
  }
  v99 = 2;
  v96 = *(_DWORD *)(v100 + 4);
  v83 = -1;
  v84 = 0LL;
  v85 = 0LL;
  v86 = 0LL;
  v87 = 0LL;
  v88 = v13;
  v89 = 0;
  v90 = 0;
  v91 = 0;
  v92 = 0;
  v93 = 0;
  v94 = 0;
  v95 = 1;
  v97 = 0LL;
  v98 = v2[5];
  v46 = OSData::withBytes((OSData *)&v119, &stru_68.flags, v45);
  (*(void (__fastcall **)(_QWORD, __int64))(**(_QWORD **)(v3 + 632) + 448LL))(*(_QWORD *)(v3 + 632), v46);
  (*(void (__fastcall **)(__int64))(*(_QWORD *)v46 + 40LL))(v46);
  v61 = OSData::withBytes((OSData *)&v101, &stru_68.flags, v47);
  (*(void (__fastcall **)(_QWORD, __int64))(**(_QWORD **)(v3 + 632) + 448LL))(*(_QWORD *)(v3 + 632), v61);
  (*(void (__fastcall **)(__int64))(*(_QWORD *)v61 + 40LL))(v61);
  v60 = OSData::withBytes((OSData *)&v83, &stru_68.flags, v48);
  (*(void (__fastcall **)(_QWORD, __int64))(**(_QWORD **)(v3 + 632) + 448LL))(*(_QWORD *)(v3 + 632), v60);
  (*(void (__fastcall **)(__int64))(*(_QWORD *)v60 + 40LL))(v60);
  v64 = 264;
  v65 = v2[10];
  v81 = 1;
  v49 = v132;
  v66 = v49 + (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v10 + 384LL))(v10, 0LL);
  v67 = v2[1];
  v68 = v2[2];
  LODWORD(v50) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v46 + 376LL))(v46);
  v69 = *(_DWORD *)(v50 + 128);
  v51 = v114;
  v70 = v51 + (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v62 + 384LL))(v62, 0LL);
  v71 = v2[4];
  LODWORD(v52) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v61 + 376LL))(v61);
  v72 = *(_DWORD *)(v52 + 128);
  v53 = v2[9] - 1;
  v54 = v96;
  v73 = v54 + (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v13 + 384LL))(v13, 0LL);
  v74 = v2[6];
  v75 = v2[8];
  LODWORD(v55) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v60 + 376LL))(v60);
  v76 = *(_DWORD *)(v55 + 128);
  if ( (unsigned int)v53 >= 2 )
  {
    v56 = v96;
    v77 = v56 + (*(int (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v13 + 384LL))(v13, 1LL);
    v78 = v2[7];
    v79 = v2[8];
    LODWORD(v57) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v60 + 376LL))(v60);
    v80 = *(_DWORD *)(v57 + 128);
  }
  v82 = 80;
  v4 = 0;
  v58 = AppleCamIn::ispCmdSend((AppleCamIn *)v3, &v63, 80, &v82, 0, 0, 0, 0x7D0u);
  if ( v58 )
  {
    if ( v46 )
    {
      (*(void (__fastcall **)(_QWORD, __int64))(**(_QWORD **)(v3 + 632) + 472LL))(*(_QWORD *)(v3 + 632), v46);
    }
    if ( v61 )
    {
      (*(void (__fastcall **)(_QWORD, __int64))(**(_QWORD **)(v3 + 632) + 472LL))(*(_QWORD *)(v3 + 632), v61);
    }
    if ( v60 )
    {
      (*(void (__fastcall **)(_QWORD, __int64))(**(_QWORD **)(v3 + 632) + 472LL))(*(_QWORD *)(v3 + 632), v60);
    }
    v4 = v58;
  }
  else
  {
    *(_BYTE *)(v3 + 204) = 1;
    *(_DWORD *)(v3 + 208) = v2[10];
    *(_QWORD *)(v3 + 216) = v46;
    *(_QWORD *)(v3 + 224) = v61;
    *(_QWORD *)(v3 + 232) = v60;
  }
  return (unsigned int)v4;
}
// 68: using guessed type section_64 stru_68;
// B6390: using guessed type int __fastcall IOLog(_QWORD);
// B6F18: using guessed type int __fastcall current_task(_QWORD, _QWORD);

//----- (0000000000009B5A) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_ProcessRawImageGo(AppleCamIn *this)
{
  return (*(int (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleCamIn *), _QWORD, _QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
           *((_QWORD *)this + 35),
           AppleCamIn::ISP_ProcessRawImageGo_gated,
           0LL,
           0LL,
           0LL,
           0LL);
}

//----- (0000000000009B84) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_ProcessRawImageGo_gated(AppleCamIn *this)
{
  signed int v1; // er14@1
  __int64 v3; // [sp+10h] [bp-30h]@4
  char v4; // [sp+18h] [bp-28h]@2
  __int16 v5; // [sp+1Ch] [bp-24h]@2
  int v6; // [sp+20h] [bp-20h]@2
  unsigned int v7; // [sp+24h] [bp-1Ch]@1

  v7 = 0;
  v1 = -536870184;
  if ( *((_BYTE *)this + 204) )
  {
    v5 = 275;
    v6 = *((_DWORD *)this + 52);
    v7 = 12;
    v1 = AppleCamIn::ispCmdSend(this, &v4, 12, &v7, 0, 0, 0, 0x7D0u);
    if ( !v1 )
    {
      while ( (unsigned __int8)(*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 79) + 480LL))(
                                 *((_QWORD *)this + 79),
                                 *((_QWORD *)this + 27))
           || (unsigned __int8)(*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 79) + 480LL))(
                                 *((_QWORD *)this + 79),
                                 *((_QWORD *)this + 28))
           || (unsigned __int8)(*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 79) + 480LL))(
                                 *((_QWORD *)this + 79),
                                 *((_QWORD *)this + 29)) )
      {
        clock_interval_to_deadline(5LL, 1000000LL, &v3);
        (*(void (__fastcall **)(_QWORD, AppleCamIn *, __int64, _QWORD))(**((_QWORD **)this + 35) + 496LL))(
          *((_QWORD *)this + 35),
          this,
          v3,
          0LL);
      }
    }
    *((_BYTE *)this + 204) = 0;
  }
  return (unsigned int)v1;
}
// B6F10: using guessed type int __fastcall clock_interval_to_deadline(_QWORD, _QWORD, _QWORD);

//----- (0000000000009C92) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_SetDriverLoggingFlags(AppleCamIn *this, unsigned int a2)
{
  return (*(int (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleCamIn *, int), _QWORD, _QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
           *((_QWORD *)this + 35),
           AppleCamIn::ISP_SetDriverLoggingFlags_gated,
           a2,
           0LL,
           0LL,
           0LL);
}

//----- (0000000000009CBC) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_SetDriverLoggingFlags_gated(AppleCamIn *this, int a2)
{
  *((_DWORD *)this + 1005) = a2;
  return 0LL;
}

//----- (0000000000009CCA) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_GetDriverLoggingFlags(AppleCamIn *this, unsigned int *a2)
{
  return (*(int (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleCamIn *__hidden, unsigned int *), unsigned int *, _QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
           *((_QWORD *)this + 35),
           AppleCamIn::ISP_GetDriverLoggingFlags_gated,
           a2,
           0LL,
           0LL,
           0LL);
}

//----- (0000000000009CF4) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_GetDriverLoggingFlags_gated(AppleCamIn *this, unsigned int *a2)
{
  *a2 = *((_DWORD *)this + 1005);
  return 0LL;
}

//----- (0000000000009D04) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_SetISPCPUCommandTimeout(AppleCamIn *this, unsigned int a2)
{
  return (*(int (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleCamIn *), _QWORD, _QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
           *((_QWORD *)this + 35),
           AppleCamIn::ISP_SetISPCPUCommandTimeout_gated,
           a2,
           0LL,
           0LL,
           0LL);
}

//----- (0000000000009D2E) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_SetISPCPUCommandTimeout_gated(AppleCamIn *this)
{
  return 3758097095LL;
}

//----- (0000000000009D3A) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_ShowSharedMemoryAllocations(AppleCamIn *this)
{
  return (*(int (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleCamIn *__hidden), _QWORD, _QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
           *((_QWORD *)this + 35),
           AppleCamIn::ISP_ShowSharedMemoryAllocations_gated,
           0LL,
           0LL,
           0LL,
           0LL);
}

//----- (0000000000009D64) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_ShowSharedMemoryAllocations_gated(AppleCamIn *this)
{
  AppleCamIn *v1; // r14@1
  int v2; // er15@1
  __int64 v3; // rbx@2
  unsigned int v4; // er12@2
  __int64 v5; // rax@2
  __int64 v6; // rax@2
  __int64 v7; // r13@2
  __int64 v8; // rax@2
  __int64 v9; // rax@2
  __int64 v10; // rax@2
  __int64 v11; // rax@4
  __int64 v12; // rdx@4
  __int64 v13; // rsi@4
  __int64 v14; // rcx@4
  __int64 v15; // rax@6
  __int64 v16; // rdx@6
  __int64 v17; // rsi@6
  __int64 v18; // rcx@6
  unsigned int v19; // er13@7
  unsigned int v20; // ebx@8
  __int64 v21; // rax@9
  __int64 v22; // rax@10
  __int64 v23; // r8@10
  __int64 v24; // rcx@10
  __int64 v25; // rsi@12
  __int64 v26; // rax@12
  __int64 v27; // rbx@12
  __int64 v28; // rax@13
  __int64 v29; // rax@14
  __int64 v30; // r9@15
  __int64 v31; // rdx@15
  __int64 v32; // rcx@15
  __int64 v33; // r8@15
  int v34; // ST08_4@15
  int v35; // ST00_4@15
  DeviceMemoryManager *v36; // rdi@18
  IOMMUManager *v37; // rdi@20

  v1 = this;
  v2 = (*(int (**)(void))(**((_QWORD **)this + 80) + 304LL))();
  if ( *((_QWORD *)this + 89) )
  {
    printf("ISPCPU Firmware Logging Memory:\n");
    v3 = *((_QWORD *)this + 89);
    v4 = *(_DWORD *)(v3 + 12);
    LODWORD(v5) = (*(int (__fastcall **)(_QWORD))(*(_QWORD *)v3 + 368LL))(*((_QWORD *)this + 89));
    LODWORD(v6) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v5 + 456LL))(v5);
    v7 = v6;
    LODWORD(v8) = (*(int (**)(void))(**((_QWORD **)this + 89) + 368LL))();
    LODWORD(v9) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v8 + 512LL))(v8, 0LL);
    LODWORD(v10) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v9 + 280LL))(v9);
    printf("  surface:%p, id=0x%08X, length=%-7d, virtualAddress=0x%08X \n\n", v3, v4, v7, v10);
  }
  if ( *((_QWORD *)this + 267) )
  {
    IOLog("Cam 0 Set-file:\n");
    v11 = *((_QWORD *)this + 267);
    v12 = *(_QWORD *)(v11 + 8);
    v13 = *(_DWORD *)v11;
    v14 = *(_DWORD *)(v11 + 4);
    IOLog("  size=%-7d, virtualAddress=%p ispAddress=0x%08X\n\n");
  }
  if ( *((_QWORD *)this + 268) )
  {
    IOLog("Cam 1 Set-file:\n");
    v15 = *((_QWORD *)this + 268);
    v16 = *(_QWORD *)(v15 + 8);
    v17 = *(_DWORD *)v15;
    v18 = *(_DWORD *)(v15 + 4);
    IOLog("  size=%-7d, virtualAddress=%p ispAddress=0x%08X\n\n");
  }
  v19 = 0;
  IOLog("AppleS2CamIn - fSharedMemorySurfaces count: %d\n");
  if ( v2 )
  {
    v20 = 0;
    do
    {
      LODWORD(v21) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 80) + 488LL))(
                       *((_QWORD *)this + 80),
                       v20);
      if ( v21 )
      {
        LODWORD(v22) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v21 + 376LL))(v21);
        v23 = *(_DWORD *)(v22 + 4);
        v19 += *(_DWORD *)v22;
        v24 = *(_QWORD *)(v22 + 8);
        IOLog("  %4d: size=%-7d, virtualAddress=%p, ispAddress=0x%08X\n");
      }
      ++v20;
    }
    while ( v2 != v20 );
  }
  v25 = v19;
  IOLog("AppleS2CamIn - total shared allocation size: %d\n");
  LODWORD(v26) = OSCollectionIterator::withCollection(*((_QWORD *)this + 79));
  v27 = v26;
  if ( v26 )
  {
    for ( LODWORD(v28) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v26 + 296LL))(v26, v19);
          v28;
          LODWORD(v28) = (*(int (__fastcall **)(__int64, __int64))(*(_QWORD *)v27 + 296LL))(v27, v25) )
    {
      LODWORD(v29) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v28 + 376LL))(v28);
      if ( v29 )
      {
        v25 = *(_DWORD *)(v29 + 144);
        v30 = *(_DWORD *)v29;
        v31 = *(_DWORD *)(v29 + 104);
        v32 = *(_DWORD *)(v29 + 108);
        v33 = *(_DWORD *)(v29 + 112);
        v34 = *(_DWORD *)(v29 + 148);
        v35 = *(_DWORD *)(v29 + 128);
        IOLog("AppleS2CamIn - found wired client surface-id:0x%08X, w=%-4d, h=%-4d, fmt=%-3d, poolID=%-4d, ispAddress=0x%08X, bounceBufferType=%d\n");
      }
    }
    (*(void (__fastcall **)(__int64))(*(_QWORD *)v27 + 40LL))(v27);
  }
  v36 = (DeviceMemoryManager *)*((_QWORD *)this + 499);
  if ( v36 )
  {
    DeviceMemoryManager::DebugPrint(v36);
  }
  v37 = (IOMMUManager *)*((_QWORD *)v1 + 498);
  if ( v37 )
  {
    IOMMUManager::DebugPrint(v37);
  }
  return 0LL;
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);
// B6778: using guessed type int __fastcall OSCollectionIterator::withCollection(_QWORD);

//----- (0000000000009FAA) ----------------------------------------------------
int __fastcall AppleCamIn::ISP_GetFirmwareLoggingSurfaceID(AppleCamIn *this, unsigned int *a2)
{
  return (*(int (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleCamIn *__hidden, unsigned int *), unsigned int *, _QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
           *((_QWORD *)this + 35),
           AppleCamIn::ISP_GetFirmwareLoggingSurfaceID_gated,
           a2,
           0LL,
           0LL,
           0LL);
}

//----- (0000000000009FD4) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_GetFirmwareLoggingSurfaceID_gated(AppleCamIn *this, unsigned int *a2)
{
  __int64 v2; // rcx@1
  __int64 result; // rax@1

  v2 = *((_QWORD *)this + 89);
  result = 3758097086LL;
  if ( v2 )
  {
    *a2 = *(_DWORD *)(v2 + 12);
    result = 0LL;
  }
  return result;
}

//----- (0000000000009FF2) ----------------------------------------------------
__int64 __fastcall AppleCamIn::ISP_I2CRead(AppleCamIn *this, int a2, int a3, int a4, unsigned int a5, unsigned int *a6, unsigned int a7)
{
  unsigned int *v7; // r14@1
  unsigned int v8; // ebx@1
  __int64 result; // rax@1
  unsigned int v10; // er15@3
  signed int v11; // ecx@4
  __int64 v12; // r12@7
  __int64 v13; // rbx@7
  unsigned int v14; // er12@10
  signed int v15; // ebx@10
  __int64 v16; // rax@11
  unsigned int v17; // ebx@14
  __int64 v18; // rsi@16
  signed int v19; // er14@18
  int v20; // eax@19
  unsigned int v21; // ebx@19
  char *v22; // rdx@23
  __int64 v23; // [sp+0h] [bp-40h]@10
  int v24; // [sp+8h] [bp-38h]@7
  unsigned int *v25; // [sp+8h] [bp-38h]@16
  int v26; // [sp+14h] [bp-2Ch]@1

  v7 = a6;
  v8 = a5;
  v26 = a4;
  result = 3758097090LL;
  if ( a6 )
  {
    if ( a5 <= 2 )
    {
      v10 = a7;
      if ( a7 <= 4 )
      {
        v11 = 536576;
        if ( a2 )
        {
          if ( a2 != 1 )
          {
            return result;
          }
          v11 = 552960;
        }
        v24 = 2 * a3;
        v12 = (unsigned int)v11;
        *(_DWORD *)(*((_QWORD *)this + 509) + (unsigned int)v11) = 2 * a3 | 0x100;
        IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
        LODWORD(v13) = v8 - 1;
        if ( (signed int)v13 >= 0 )
        {
          v13 = (signed int)v13;
          do
          {
            *(_DWORD *)(*((_QWORD *)this + 509) + v12) = *((_BYTE *)&v26 + v13);
            IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
            --v13;
          }
          while ( (signed int)v13 >= 0 );
        }
        *(_DWORD *)(*((_QWORD *)this + 509) + v12) = v24 | 0x101;
        IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
        *(_DWORD *)(*((_QWORD *)this + 509) + v12) = a7 | 0x600;
        IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
        v23 = v12;
        v14 = v12 | 0x14;
        v15 = 1000;
        while ( 1 )
        {
          v16 = *((_QWORD *)this + 509);
          if ( *(_DWORD *)(v16 + v14) & 0x8000000 )
          {
            break;
          }
          IODelay(10LL, 0LL);
          --v15;
          if ( !v15 )
          {
            printf("AppleS2CamIn::ISP_I2CRead() - Timeout Waiting for SMBSYS_REG_SMSTA__XEN\n", v23);
            return 3758097110LL;
          }
        }
        v17 = *(_DWORD *)(v14 + v16);
        if ( v17 & 0xA20000 )
        {
          *(_DWORD *)(v16 + ((unsigned int)v23 | 0x1C)) = *((_DWORD *)this + 34) | 0x700;
          IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
          printf("AppleS2CamIn::ISP_I2CRead() - I2C slave error, smsta=0x%08x \n", v17, v23);
        }
        v25 = v7;
        *(_DWORD *)(*((_QWORD *)this + 509) + v14) = v17;
        v18 = 0LL;
        IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
        if ( v17 & 0x1000000 )
        {
          v18 = v17;
          printf("AppleS2CamIn::ISP_I2CRead() - I2C bus jam!  smsta=0x%08x \n", v17, v23);
        }
        v19 = 1000;
        while ( 1 )
        {
          v20 = *(_DWORD *)(*((_QWORD *)this + 509) + ((unsigned int)v23 | 8));
          v21 = BYTE1(v20);
          if ( BYTE1(v20) == a7 )
          {
            break;
          }
          IODelay(10LL, v18);
          --v19;
          if ( !v19 )
          {
            printf(
              "AppleS2CamIn::ISP_I2CRead() - Timeout waiting for data to arrive - num_bytes_available = 0x%08x\n",
              v21,
              v23);
            return 3758097110LL;
          }
        }
        result = 0LL;
        if ( a7 )
        {
          v22 = (char *)v25 + a7 - 1;
          do
          {
            --v10;
            *v22-- = *(_DWORD *)(*((_QWORD *)this + 509) + ((unsigned int)v23 | 4));
          }
          while ( v10 );
        }
      }
    }
  }
  return result;
}
// B6370: using guessed type int __fastcall IODelay(_QWORD, _QWORD);

//----- (000000000000A23E) ----------------------------------------------------
int __fastcall AppleCamIn::s2_pll_reset(AppleCamIn *this)
{
  int result; // eax@1

  *(_DWORD *)(*((_QWORD *)this + 505) + 44LL) = 64;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 505) + 44LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 505) + 256LL) = -1128524544;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 505) + 20LL) = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  IODelay(10000LL, 0LL);
  *(_DWORD *)(*((_QWORD *)this + 505) + 20LL) = 3;
  result = IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  if ( *((_BYTE *)this + 4020) & 0x80 )
  {
    result = IOLog("%s: S2 PLL Reset is done!!!\n");
  }
  return result;
}
// B6370: using guessed type int __fastcall IODelay(_QWORD, _QWORD);
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (000000000000A324) ----------------------------------------------------
__int64 __fastcall AppleCamIn::s2_pll_init(AppleCamIn *this, int a2)
{
  AppleCamIn *v2; // r15@1
  int v3; // eax@3
  signed int v4; // ebx@4
  __int64 v5; // rdi@5
  __int64 v6; // rax@11
  __int64 v7; // rax@13
  __int64 v8; // rax@16
  __int64 v9; // rsi@17
  __int64 v10; // rdi@18
  __int64 v11; // rax@21
  unsigned int v12; // ebx@29
  int v13; // eax@31
  unsigned int v14; // er14@33
  __int64 v15; // rdi@38

  v2 = this;
  if ( *((_BYTE *)this + 4020) & 0x80 )
  {
    IOLog("%s: Initialize S2 PLL\n");
  }
  v3 = *((_DWORD *)this + 1005) & 0x80;
  if ( *(_DWORD *)(*((_QWORD *)this + 505) + 4LL) & 8 )
  {
    v4 = 25;
    if ( !v3 )
    {
      goto LABEL_9;
    }
    v5 = (__int64)"%s: Reference Clock is 25 MHz\n";
  }
  else
  {
    v4 = 24;
    if ( !v3 )
    {
      goto LABEL_9;
    }
    v5 = (__int64)"%s: Reference Clock is 24 MHz\n";
  }
  IOLog(v5);
LABEL_9:
  if ( a2 == 400 )
  {
    v7 = *((_QWORD *)v2 + 505);
    if ( v4 == 25 )
    {
      *(_DWORD *)(v7 + 1296) = 4194424;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v2 + 31), 0LL, 0x12345678u);
      *(_DWORD *)(*((_QWORD *)v2 + 505) + 36LL) = 422053892;
    }
    else
    {
      *(_DWORD *)(v7 + 32) = 52428800;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v2 + 31), 0LL, 0x12345678u);
      *(_DWORD *)(*((_QWORD *)v2 + 505) + 36LL) = 338167299;
    }
    goto LABEL_28;
  }
  if ( a2 == 300 )
  {
    v6 = *((_QWORD *)v2 + 505);
    if ( v4 == 25 )
    {
      *(_DWORD *)(v6 + 1296) = 4718712;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v2 + 31), 0LL, 0x12345678u);
      *(_DWORD *)(*((_QWORD *)v2 + 505) + 36LL) = 422054918;
    }
    else
    {
      *(_DWORD *)(v6 + 32) = 52428800;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v2 + 31), 0LL, 0x12345678u);
      *(_DWORD *)(*((_QWORD *)v2 + 505) + 36LL) = 338167812;
    }
    goto LABEL_28;
  }
  if ( a2 == 200 )
  {
    v8 = *((_QWORD *)v2 + 505);
    if ( v4 == 25 )
    {
      *(_DWORD *)(v8 + 1296) = 4194424;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v2 + 31), 0LL, 0x12345678u);
      *(_DWORD *)(*((_QWORD *)v2 + 505) + 36LL) = 422055944;
      v9 = 0LL;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v2 + 31), 0LL, 0x12345678u);
      if ( !(*((_BYTE *)v2 + 4020) & 0x80) )
      {
        goto LABEL_29;
      }
      v10 = (__int64)"%s: Refclk=25 and Set DDR clock to 200 MHz\n";
    }
    else
    {
      *(_DWORD *)(v8 + 32) = 52428800;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v2 + 31), 0LL, 0x12345678u);
      *(_DWORD *)(*((_QWORD *)v2 + 505) + 36LL) = 338168838;
      v9 = 0LL;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v2 + 31), 0LL, 0x12345678u);
      if ( !(*((_BYTE *)v2 + 4020) & 0x80) )
      {
        goto LABEL_29;
      }
      v10 = (__int64)"%s: Refclk=24 and Set DDR clock to 200 MHz\n";
    }
    goto LABEL_26;
  }
  v11 = *((_QWORD *)v2 + 505);
  if ( v4 == 25 )
  {
    *(_DWORD *)(v11 + 1296) = 4718717;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v2 + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)v2 + 505) + 36LL) = 422054148;
    v9 = 0LL;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v2 + 31), 0LL, 0x12345678u);
    if ( !(*((_BYTE *)v2 + 4020) & 0x80) )
    {
      goto LABEL_29;
    }
    v10 = (__int64)"%s: Refclk=25 and Set DDR clock to 450 MHz\n";
LABEL_26:
    v9 = (__int64)"s2_pll_init";
    IOLog(v10);
    goto LABEL_29;
  }
  *(_DWORD *)(v11 + 32) = 78643200;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v2 + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)v2 + 505) + 36LL) = 338168068;
LABEL_28:
  v9 = 0LL;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v2 + 31), 0LL, 0x12345678u);
LABEL_29:
  AppleCamIn::s2_pll_reset(v2);
  v12 = 0;
  if ( *((_BYTE *)v2 + 4020) & 0x80 )
  {
    v9 = (__int64)"s2_pll_init";
    v12 = 0;
    IOLog("%s: Waiting for pll to be locked\n");
  }
  while ( 1 )
  {
    v13 = *(_DWORD *)(*((_QWORD *)v2 + 505) + 12LL);
    if ( BYTE1(v13) & 0x80 )
    {
      break;
    }
    IODelay(10LL, v9);
    ++v12;
    if ( v12 >= 0x2711 )
    {
      IOLog("%s: Timeout, PLL did not lock.  CMU_R_PLL_STS_MEMADDR == 0x%08x (looking for 0x8000)\n");
      return -536870186;
    }
  }
  if ( *((_BYTE *)v2 + 4020) & 0x80 )
  {
    IOLog("%s: S2 PLL is Locked\n");
  }
  *(_DWORD *)(*((_QWORD *)v2 + 505) + 168LL) |= 1u;
  v14 = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v2 + 31), 0LL, 0x12345678u);
  IODelay(10000LL, 0LL);
  if ( *((_BYTE *)v2 + 4020) & 0x80 )
  {
    if ( *(_DWORD *)(*((_QWORD *)v2 + 505) + 168LL) & 1 )
    {
      v15 = (__int64)"%s: S2 PLL switched to non-bypass Mode\n";
    }
    else
    {
      v15 = (__int64)"%s: S2 PLL is in bypass Mode\n";
    }
    v14 = 0;
    IOLog(v15);
  }
  return v14;
}
// B6370: using guessed type int __fastcall IODelay(_QWORD, _QWORD);
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (000000000000A70A) ----------------------------------------------------
__int64 __fastcall AppleCamIn::PutRandomPatternInMemory(AppleCamIn *this, int a2, int a3, int a4, void *a5)
{
  void *v5; // rbx@1
  int v6; // er14@1
  AppleCamIn *v7; // r12@1
  unsigned int v8; // er15@2
  int v9; // eax@3
  int v10; // er8@3
  int v11; // edi@3
  int v12; // ecx@3
  int v13; // edx@3
  int v14; // edi@3
  int v15; // edi@3

  v5 = a5;
  v6 = a3;
  v7 = this;
  tinymt32_init((__int64)a5, a4);
  if ( v6 )
  {
    v8 = a2 & 0xFFFFFFFC;
    do
    {
      v9 = *((_DWORD *)v5 + 1);
      v10 = *((_DWORD *)v5 + 2);
      v11 = v10 ^ v9 ^ *(_DWORD *)v5 & 0x7FFFFFFF ^ 2 * (v10 ^ v9 ^ *(_DWORD *)v5 & 0x7FFFFFFF);
      v12 = v11 ^ *((_DWORD *)v5 + 3) ^ (*((_DWORD *)v5 + 3) >> 1);
      *(_DWORD *)v5 = v9;
      v13 = v11 ^ (v12 << 10);
      *((_DWORD *)v5 + 3) = v12;
      v14 = -(v12 & 1);
      *((_DWORD *)v5 + 1) = v10 ^ v14 & *((_DWORD *)v5 + 4);
      v15 = v13 ^ *((_DWORD *)v5 + 5) & v14;
      *((_DWORD *)v5 + 2) = v15;
      *(_DWORD *)(*((_QWORD *)v7 + 507) + v8) = (v9 + ((unsigned int)v15 >> 8)) ^ v12 ^ *((_DWORD *)v5 + 6) & -((v9 + ((unsigned int)v15 >> 8)) & 1);
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v7 + 31), 0LL, 0x12345678u);
      v8 += 4;
      --v6;
    }
    while ( v6 );
  }
  return 0LL;
}

//----- (000000000000A7DA) ----------------------------------------------------
__int64 __fastcall AppleCamIn::GetRandomPatternInMemory(AppleCamIn *this, int a2, int a3, int a4, void *a5)
{
  void *v5; // rbx@1
  int v6; // er14@1
  unsigned int v7; // eax@1
  unsigned int v8; // er15@2
  __int64 v9; // r9@2
  int v10; // er10@3
  int v11; // er12@3
  int v12; // er11@3
  int v13; // esi@3
  int v14; // edi@3
  int v15; // ecx@3
  int v16; // esi@3
  int v17; // esi@3

  v5 = a5;
  v6 = a3;
  tinymt32_init((__int64)a5, a4);
  v7 = 0;
  if ( v6 )
  {
    v8 = a2 & 0xFFFFFFFC;
    v9 = *((_QWORD *)this + 507);
    v7 = 0;
    do
    {
      v10 = *(_DWORD *)(v9 + v8);
      v11 = *((_DWORD *)v5 + 1);
      v12 = *((_DWORD *)v5 + 2);
      v13 = v12 ^ v11 ^ *(_DWORD *)v5 & 0x7FFFFFFF ^ 2 * (v12 ^ v11 ^ *(_DWORD *)v5 & 0x7FFFFFFF);
      v14 = v13 ^ *((_DWORD *)v5 + 3) ^ (*((_DWORD *)v5 + 3) >> 1);
      *(_DWORD *)v5 = v11;
      v15 = v13 ^ (v14 << 10);
      *((_DWORD *)v5 + 3) = v14;
      v16 = -(v14 & 1);
      *((_DWORD *)v5 + 1) = v12 ^ v16 & *((_DWORD *)v5 + 4);
      v17 = v15 ^ *((_DWORD *)v5 + 5) & v16;
      *((_DWORD *)v5 + 2) = v17;
      v7 |= *((_DWORD *)v5 + 6) & -(((_BYTE)v11 + BYTE1(v17)) & 1) ^ (v11 + ((unsigned int)v17 >> 8)) ^ v10 ^ v14;
      v8 += 4;
      --v6;
    }
    while ( v6 );
  }
  return (unsigned __int16)v7 | (v7 >> 16);
}

//----- (000000000000A89E) ----------------------------------------------------
__int64 __fastcall AppleCamIn::all_shmoo_rd_data_dly_FIFO(AppleCamIn *this, int a2, int a3)
{
  AppleCamIn *v3; // r13@1
  __int64 v4; // rax@1
  __int64 v5; // r15@1
  int v6; // er12@1
  signed int v7; // ecx@1
  unsigned int v8; // er15@1
  int v9; // er14@2
  __int64 v10; // rax@2
  int v11; // ebx@2
  int v12; // er12@2
  signed __int64 v13; // rsi@2
  signed __int64 v14; // rdi@4
  int v15; // eax@6
  int v16; // ecx@6
  int v17; // ebx@12
  signed int v18; // er14@19
  int v19; // ebx@21
  int v20; // eax@24
  signed int v21; // er15@24
  int v22; // ebx@25
  int v23; // er14@27
  int v24; // ebx@27
  int v26; // [sp+4h] [bp-8Ch]@1
  int v27; // [sp+8h] [bp-88h]@1
  int v28; // [sp+Ch] [bp-84h]@1
  __int64 v29; // [sp+10h] [bp-80h]@1
  __int64 v30; // [sp+18h] [bp-78h]@1
  unsigned int v31; // [sp+24h] [bp-6Ch]@1
  __int64 v32; // [sp+28h] [bp-68h]@1
  __int64 v33; // [sp+30h] [bp-60h]@1
  __int64 v34; // [sp+38h] [bp-58h]@1
  __int64 v35; // [sp+40h] [bp-50h]@1
  int v36; // [sp+4Ch] [bp-44h]@2
  int v37; // [sp+50h] [bp-40h]@1
  signed __int64 v38; // [sp+58h] [bp-38h]@1
  signed __int64 v39; // [sp+60h] [bp-30h]@1

  v31 = a3;
  v3 = this;
  v32 = (unsigned int)(a2 + 512);
  v4 = *((_QWORD *)this + 505);
  v26 = *(_DWORD *)(v4 + v32);
  v5 = (unsigned int)(a2 + 628);
  v33 = v5;
  v27 = *(_DWORD *)(v4 + v5);
  v34 = (unsigned int)(a2 + 788);
  v28 = *(_DWORD *)(v4 + v34);
  *(_DWORD *)(v4 + v32) = 196608;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 505) + v5) = 196864;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 505) + v34) = 196864;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  v35 = (unsigned int)(a2 + 864);
  v29 = (unsigned int)(a2 + 912);
  v30 = (unsigned int)(a2 + 916);
  v6 = 1;
  v7 = 1001;
  v37 = 0;
  v8 = 0;
  v38 = 0LL;
  v39 = 0LL;
  do
  {
    v9 = v6;
    v36 = v7 - 1;
    *(_DWORD *)(*((_QWORD *)v3 + 505) + v35) = v6 & 7;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v3 + 31), 0LL, 0x12345678u);
    AppleCamIn::VerifyMemory(v3, v31);
    v10 = *((_QWORD *)v3 + 505);
    v11 = *(_DWORD *)(v10 + v29) & 0xF;
    v12 = *(_DWORD *)(v10 + v29) & 0xF0;
    *(_DWORD *)(v10 + v30) = 1;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v3 + 31), 0LL, 0x12345678u);
    v13 = v39;
    if ( !((unsigned int)v39 | v11) )
    {
      v13 = (unsigned int)v9;
    }
    v14 = v38;
    if ( !((unsigned int)v38 | v12) )
    {
      v14 = (unsigned int)v9;
    }
    v15 = v8 + 7;
    v16 = v37 + 7;
    if ( v8 >= 0x39 )
    {
      v15 = v8;
    }
    if ( v8 < 0x39 )
    {
      v16 = v37;
    }
    v8 = v15;
    if ( (unsigned int)v16 > 0x3F )
    {
      v8 = 0;
    }
    v17 = v16;
    if ( (unsigned int)v16 > 0x3F )
    {
      v17 = 0;
    }
    v6 = v9 + ((unsigned int)v16 > 0x3F);
    if ( (unsigned int)v6 < 8 )
    {
      v38 = v14;
      v39 = v13;
      v18 = (_DWORD)v14 != 0 && (_DWORD)v13 != 0;
    }
    else
    {
      v6 = 7;
      if ( !(_DWORD)v13 )
      {
        v13 = 7LL;
      }
      v39 = v13;
      if ( !(_DWORD)v14 )
      {
        v14 = 7LL;
      }
      v38 = v14;
      v18 = 1;
    }
    *(_DWORD *)(*((_QWORD *)v3 + 505) + v32) = v8 & 0x3F | 0x30000;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v3 + 31), 0LL, 0x12345678u);
    v37 = v17;
    v19 = v17 & 0x3F | 0x30100;
    *(_DWORD *)(*((_QWORD *)v3 + 505) + v33) = v19;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v3 + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)v3 + 505) + v34) = v19;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v3 + 31), 0LL, 0x12345678u);
    v7 = v36;
  }
  while ( v36 > 0 && !v18 );
  if ( v36 > 1 )
  {
    v22 = v39;
    if ( (unsigned int)v38 > (unsigned int)v39 )
    {
      v22 = v38;
    }
    v23 = v22 + 1;
    *(_DWORD *)(*((_QWORD *)v3 + 505) + v32) = v26;
    v21 = 0;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v3 + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)v3 + 505) + v33) = v27;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v3 + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)v3 + 505) + v34) = v28;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v3 + 31), 0LL, 0x12345678u);
    v24 = v22 + 2;
    v20 = 7;
    if ( (unsigned int)v23 < 7 )
    {
      v20 = v24;
    }
  }
  else
  {
    v20 = IOLog("%s: ERROR: timeout checking pass status\n");
    v21 = -536870186;
  }
  *((_DWORD *)v3 + 545) = v20;
  *(_DWORD *)(*((_QWORD *)v3 + 505) + v35) = v20 & 7;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v3 + 31), 0LL, 0x12345678u);
  return (unsigned int)v21;
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (000000000000AC1A) ----------------------------------------------------
__int64 __fastcall AppleCamIn::all_shmoo_RE_byte_FIFO(AppleCamIn *this, int a2, int a3)
{
  __int64 v3; // r15@1
  unsigned int v4; // ecx@1
  __int64 result; // rax@1
  unsigned int v6; // [sp+0h] [bp-40h]@1
  int v7; // [sp+4h] [bp-3Ch]@1
  unsigned int v8; // [sp+18h] [bp-28h]@1
  __int64 v9; // [sp+20h] [bp-20h]@1

  v3 = off_12040[0];
  v9 = *(_QWORD *)off_12040[0];
  AppleCamIn::one_shmoo_RE_FIFO(this, &v8, &v6, a2, a3);
  v4 = v8 & 0x3F | 0x30000;
  *((_DWORD *)this + 546) = v8;
  *(_DWORD *)(*((_QWORD *)this + 505) + (unsigned int)(a2 + 512)) = v4;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 505) + (unsigned int)(a2 + 628)) = v6 & 0x3F | 0x30100;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  *(_DWORD *)(*((_QWORD *)this + 505) + (unsigned int)(a2 + 788)) = v7 & 0x3F | 0x30100;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  result = *(_QWORD *)v3;
  if ( *(_QWORD *)v3 == v9 )
  {
    result = 0LL;
  }
  return result;
}
// 12040: using guessed type __int64 off_12040[4];

//----- (000000000000AD02) ----------------------------------------------------
__int64 __fastcall AppleCamIn::generic_shmoo_calib_rd_dqs(AppleCamIn *this, int a2, __int64 a3)
{
  int v3; // er13@1
  int v4; // ST28_4@1
  unsigned int *v5; // rdx@1
  __int64 v6; // rax@1
  unsigned int *v7; // rdx@1
  int v8; // ST00_4@1
  __int64 v9; // rax@1
  unsigned int *v10; // rdx@1
  int v11; // ST00_4@1
  __int64 v12; // rax@1
  int v13; // ebx@1
  __int64 result; // rax@1
  int v15; // [sp+0h] [bp-5C0h]@0
  int v16; // [sp+1Ch] [bp-5A4h]@1
  unsigned int v17; // [sp+20h] [bp-5A0h]@1
  int v18; // [sp+24h] [bp-59Ch]@1
  char v19; // [sp+30h] [bp-590h]@1
  char v20; // [sp+190h] [bp-430h]@1
  char v21; // [sp+2F0h] [bp-2D0h]@1
  unsigned int v22; // [sp+450h] [bp-170h]@1
  unsigned int v23[64]; // [sp+490h] [bp-130h]@1
  __int64 v24; // [sp+590h] [bp-30h]@1

  v3 = a3;
  v4 = a3;
  v24 = *(_QWORD *)off_12040[0];
  v18 = AppleCamIn::generic_shmoo_rd_dqs(this, (int *)v23, a3, a2, a3);
  v6 = AppleCamIn::wr_dqs_setting(this, (int *)v23, v5, &v22, a2, v3, v15, 3);
  v17 = v6;
  AppleCamIn::create_ddr_calibration_result(
    (AppleCamIn *)&v21,
    (const char *)v23,
    "RDQS",
    v23,
    v6,
    (__int64)&v22,
    16,
    -1);
  memcpy((char *)this + 2548, &v21, 0x15CuLL);
  v9 = AppleCamIn::wr_dqs_setting(this, (int *)v23, v7, &v22, a2, v4, v8, 1);
  v16 = v9;
  AppleCamIn::create_ddr_calibration_result((AppleCamIn *)&v20, (const char *)v23, "P", v23, v9, (__int64)&v22, 16, -1);
  memcpy((char *)this + 2896, &v20, 0x15CuLL);
  v12 = AppleCamIn::wr_dqs_setting(this, (int *)v23, v10, &v22, a2, v4, v11, 2);
  v13 = v12;
  AppleCamIn::create_ddr_calibration_result((AppleCamIn *)&v19, (const char *)v23, "N", v23, v12, (__int64)&v22, 16, -1);
  memcpy((char *)this + 3244, &v19, 0x15CuLL);
  result = *(_QWORD *)off_12040[0];
  if ( *(_QWORD *)off_12040[0] == v24 )
  {
    result = v13 | v16 | v18 | v17;
  }
  return result;
}
// 12040: using guessed type __int64 off_12040[4];

//----- (000000000000AEC0) ----------------------------------------------------
__int64 __fastcall AppleCamIn::generic_shmoo_calib_wr_dq(AppleCamIn *this, int a2, int a3)
{
  AppleCamIn *v3; // rbx@1
  __int64 v4; // rax@1
  int v5; // er8@1
  __int64 v6; // rcx@1
  int v7; // er9@1
  signed __int64 v8; // rdx@2
  int v9; // edi@2
  __int64 v10; // rax@3
  signed __int64 v11; // rax@5
  int v12; // er15@6
  int v13; // eax@6
  int v14; // er14@6
  signed __int64 v15; // r12@7
  int v16; // er13@7
  unsigned int *v17; // rdx@10
  unsigned int *v18; // r14@11
  int v19; // er15@11
  int v20; // er12@11
  signed __int64 v21; // r13@12
  __int64 v22; // rax@13
  __int64 result; // rax@15
  unsigned int v24; // [sp+14h] [bp-2ECh]@1
  signed __int64 v25; // [sp+18h] [bp-2E8h]@6
  int v26; // [sp+20h] [bp-2E0h]@12
  int v27; // [sp+28h] [bp-2D8h]@7
  unsigned int *v28; // [sp+28h] [bp-2D8h]@12
  char v29; // [sp+30h] [bp-2D0h]@15
  unsigned int v30; // [sp+190h] [bp-170h]@11
  int v31[63]; // [sp+1D0h] [bp-130h]@10
  int v32; // [sp+2CCh] [bp-34h]@11
  __int64 v33; // [sp+2D0h] [bp-30h]@1

  v24 = a3;
  v3 = this;
  v33 = *(_QWORD *)off_12040[0];
  v4 = *(_DWORD *)(*((_QWORD *)this + 505) + (unsigned int)(a2 + 84));
  v5 = a2 + 528;
  v6 = *((_QWORD *)this + 505);
  v7 = 0;
  do
  {
    v8 = 8LL;
    v9 = v5;
    do
    {
      v10 = *(_DWORD *)(v6 + (unsigned int)v9);
      v9 += 4;
      --v8;
    }
    while ( v8 );
    ++v7;
    v5 += 160;
  }
  while ( v7 != 2 );
  v11 = 0LL;
  do
  {
    v25 = v11;
    v12 = v11 | 0x30000;
    v13 = a2 + 528;
    v14 = 0;
    do
    {
      v27 = v13;
      v15 = 8LL;
      v16 = v13;
      do
      {
        *(_DWORD *)(*((_QWORD *)v3 + 505) + (unsigned int)v16) = v12;
        IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v3 + 31), 0LL, 0x12345678u);
        v16 += 4;
        --v15;
      }
      while ( v15 );
      ++v14;
      v13 = v27 + 160;
    }
    while ( v14 != 2 );
    v31[v25] = AppleCamIn::VerifyMemory(v3, v24);
    v11 = v25 + 1;
  }
  while ( v25 != 63 );
  v32 = 0xFFFF;
  v18 = &v30;
  AppleCamIn::calib_wr_dq(v3, v31, v17, &v30, a2);
  v19 = a2 + 528;
  v20 = 0;
  do
  {
    v28 = v18;
    v26 = v19;
    v21 = 8LL;
    do
    {
      *(_DWORD *)(*((_QWORD *)v3 + 505) + (unsigned int)v19) = *v18 & 0x3F | 0x30000;
      v22 = IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v3 + 31), 0LL, 0x12345678u);
      v19 += 4;
      ++v18;
      --v21;
    }
    while ( v21 );
    ++v20;
    v19 = v26 + 160;
    v18 = v28 + 8;
  }
  while ( v20 != 2 );
  AppleCamIn::create_ddr_calibration_result(
    (AppleCamIn *)&v29,
    0LL,
    "WRDQ",
    (unsigned int *)v31,
    v22,
    (__int64)&v30,
    16,
    -1);
  memcpy((char *)v3 + 2200, &v29, 0x15CuLL);
  result = *(_QWORD *)off_12040[0];
  if ( *(_QWORD *)off_12040[0] == v33 )
  {
    result = 0LL;
  }
  return result;
}
// 12040: using guessed type __int64 off_12040[4];
// AEC0: using guessed type unsigned int var_130[63];

//----- (000000000000B0EA) ----------------------------------------------------
__int64 __fastcall AppleCamIn::generic_shmoo_calib_wr_dm(AppleCamIn *this, int a2)
{
  AppleCamIn *v2; // r12@1
  __int64 v3; // r15@1
  int v4; // er13@1
  int v5; // er14@1
  __int64 v6; // rbx@1
  __int64 v7; // rdx@2
  signed __int64 v8; // rsi@2
  int v9; // edi@2
  unsigned int v10; // ecx@3
  int v11; // ecx@4
  __int64 result; // rax@5
  __int64 v13; // [sp+0h] [bp-50h]@1
  __int64 v14; // [sp+8h] [bp-48h]@1
  int v15[4]; // [sp+10h] [bp-40h]@4
  __int64 v16; // [sp+20h] [bp-30h]@1

  v2 = this;
  v3 = off_12040[0];
  v16 = *(_QWORD *)off_12040[0];
  v14 = 0LL;
  v13 = 0LL;
  v4 = a2 + 528;
  v5 = a2 + 560;
  v6 = 0LL;
  do
  {
    v7 = *((_QWORD *)v2 + 505);
    v8 = 8LL;
    v9 = v4;
    do
    {
      v10 = *((_DWORD *)&v13 + v6) + (*(_DWORD *)(v7 + (unsigned int)v9) & 0x3F);
      *((_DWORD *)&v13 + v6) = v10;
      v9 += 4;
      --v8;
    }
    while ( v8 );
    v11 = v10 >> 3;
    v15[v6] = v11;
    *(_DWORD *)(*((_QWORD *)v2 + 505) + (unsigned int)(v5 + 160 * v6)) = v11 & 0x3F | 0x30000;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v2 + 31), 0LL, 0x12345678u);
    *((_DWORD *)v2 + v6 + 547) = v15[v6];
    ++v6;
    v4 += 160;
  }
  while ( v6 != 2 );
  result = *(_QWORD *)v3;
  if ( *(_QWORD *)v3 == v16 )
  {
    result = 0LL;
  }
  return result;
}
// 12040: using guessed type __int64 off_12040[4];
// B0EA: using guessed type int var_40[4];

//----- (000000000000B1CA) ----------------------------------------------------
__int64 __fastcall AppleCamIn::generic_shmoo_calib_addr(AppleCamIn *this, int a2)
{
  __int64 v2; // rax@1
  int v3; // ecx@1
  int v4; // edx@1
  int v5; // eax@1
  int v6; // eax@3
  int v7; // er12@4
  unsigned int v8; // er13@4
  int v9; // ebx@5
  int v10; // er12@14
  unsigned int v11; // er14@14
  int v12; // ebx@15
  const char *v13; // rsi@25
  int v14; // er12@25
  __int64 v15; // rax@27
  __int64 result; // rax@31
  __int64 v17; // rcx@34
  int v18; // [sp+14h] [bp-2ACh]@4
  int v19; // [sp+18h] [bp-2A8h]@4
  __int64 v20; // [sp+18h] [bp-2A8h]@14
  __int64 v21; // [sp+20h] [bp-2A0h]@1
  unsigned int v22; // [sp+2Ch] [bp-294h]@3
  char v23; // [sp+30h] [bp-290h]@29
  int v24[64]; // [sp+190h] [bp-130h]@28
  __int64 v25; // [sp+290h] [bp-30h]@1

  v25 = *(_QWORD *)off_12040[0];
  v21 = (unsigned int)(a2 + 52);
  v2 = *((_QWORD *)this + 505);
  v3 = *(_DWORD *)(v2 + v21);
  v4 = *(_DWORD *)(v2 + v21);
  v5 = *(_DWORD *)(v2 + (unsigned int)(a2 + 84)) >> 8;
  if ( v4 & 0x10000 )
  {
    LOBYTE(v5) = v3;
  }
  v6 = v5 & 0x3F;
  v22 = v6;
  if ( v6 )
  {
    v19 = a2;
    v7 = v6;
    v8 = v6;
    v18 = v6;
    do
    {
      --v7;
      *(_DWORD *)(*((_QWORD *)this + 505) + (unsigned int)(a2 + 916)) = 1;
      v9 = 0;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      *(_DWORD *)(*((_QWORD *)this + 505) + v21) = v7 | 0x10000;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      do
      {
        if ( !(unsigned int)AppleCamIn::VerifyMemory(this, v9) )
        {
          v8 = v7;
        }
        v9 += 0x100000;
      }
      while ( v9 != 3145728 );
    }
    while ( v7 > 0 );
  }
  else
  {
    v19 = a2;
    v18 = 0;
    v8 = 0;
  }
  *(_DWORD *)(*((_QWORD *)this + 505) + v21) = v18 | 0x10000;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  if ( (unsigned int)AppleCamIn::ddr40_phy_rewrite_mode_registers(this) )
  {
    IOLog("%s: WARNING - ddr40_phy_rewrite_mode_registers failed after 'DOWN' sweep\n");
  }
  v20 = (unsigned int)(v19 + 916);
  v10 = v18;
  v11 = v18;
  do
  {
    *(_DWORD *)(*((_QWORD *)this + 505) + v21) = v10 | 0x10000;
    v12 = 0;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    *(_DWORD *)(*((_QWORD *)this + 505) + v20) = 1;
    IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
    do
    {
      if ( !(unsigned int)AppleCamIn::VerifyMemory(this, v12) )
      {
        v11 = v10;
      }
      v12 += 0x100000;
    }
    while ( v12 != 3145728 );
    ++v10;
  }
  while ( v10 != 64 );
  *(_DWORD *)(*((_QWORD *)this + 505) + v21) = v18 | 0x10000;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  if ( (unsigned int)AppleCamIn::ddr40_phy_rewrite_mode_registers(this) )
  {
    IOLog("%s: WARNING - ddr40_phy_rewrite_mode_registers failed after 'UP' sweep\n");
  }
  if ( (signed int)v11 <= (signed int)v8 )
  {
    v22 = 0;
    *(_DWORD *)(*((_QWORD *)this + 505) + v21) = 0;
  }
  else
  {
    v22 = v8 + ((signed int)(v11 - v8) >> 1);
    *(_DWORD *)(*((_QWORD *)this + 505) + v21) = v22 | 0x10000;
  }
  v13 = 0LL;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  v14 = AppleCamIn::ddr40_phy_rewrite_mode_registers(this);
  if ( v14 )
  {
    v13 = "generic_shmoo_calib_addr";
    IOLog("%s: WARNING - ddr40_phy_rewrite_mode_registers failed after finishing Word Lane iteration\n");
  }
  v15 = 0LL;
  do
  {
    v24[v15] = (signed int)v11 < (signed int)v8 || (unsigned int)v15 < v8 || v11 < (unsigned int)v15;
    ++v15;
  }
  while ( v15 != 64 );
  AppleCamIn::create_ddr_calibration_result(
    (AppleCamIn *)&v23,
    v13,
    "ADDR",
    (unsigned int *)v24,
    64LL,
    (__int64)&v22,
    1,
    v18);
  memcpy((char *)this + 3592, &v23, 0x15CuLL);
  if ( v14 )
  {
    IOLog("%s: WARNING - Mode Register rewrite failed.\n");
LABEL_33:
    result = 3758097097LL;
    goto LABEL_34;
  }
  result = 0LL;
  if ( !v22 )
  {
    IOLog("%s: ERROR: generic_shmoo_calib_addr failed.  new_vdl_step = %d \n");
    goto LABEL_33;
  }
LABEL_34:
  v17 = *(_QWORD *)off_12040[0];
  return result;
}
// 12040: using guessed type __int64 off_12040[4];
// B6390: using guessed type int __fastcall IOLog(_QWORD);
// B1CA: using guessed type unsigned int var_130[64];

//----- (000000000000B564) ----------------------------------------------------
__int64 __fastcall AppleCamIn::one_shmoo_RE_FIFO(AppleCamIn *this, unsigned int *a2, unsigned int *a3, int a4, int a5)
{
  int v5; // er14@1
  int v6; // ebx@1
  AppleCamIn *v7; // r13@1
  __int64 v8; // rax@1
  __int64 v9; // rcx@1
  signed int v10; // er15@1
  unsigned int v11; // er14@1
  __int64 v12; // rax@4
  int v13; // ebx@4
  int v14; // er12@4
  IOPCIDevice *v15; // rdi@4
  int v16; // er13@4
  signed __int64 v17; // rcx@5
  signed __int64 v18; // rax@9
  bool v19; // zf@9
  int v20; // ebx@14
  __int64 v21; // rdi@15
  __int64 result; // rax@18
  __int64 v23; // rax@20
  int v24; // er13@20
  int v25; // esi@20
  int v26; // er15@21
  int v27; // eax@22
  __int64 v28; // rax@23
  int v29; // et1@23
  int v30; // ebx@23
  int v31; // ecx@26
  int v32; // er14@30
  int v33; // er15@30
  __int64 v34; // rax@32
  int v35; // ebx@32
  int v36; // et1@32
  int v37; // er13@37
  int v38; // eax@38
  int v39; // ecx@38
  unsigned int *v40; // [sp+0h] [bp-90h]@1
  int v41; // [sp+Ch] [bp-84h]@1
  unsigned int *v42; // [sp+10h] [bp-80h]@1
  __int64 v43; // [sp+18h] [bp-78h]@1
  signed __int64 v44; // [sp+20h] [bp-70h]@1
  signed __int64 v45; // [sp+28h] [bp-68h]@1
  AppleCamIn *v46; // [sp+30h] [bp-60h]@1
  unsigned int v47; // [sp+38h] [bp-58h]@1
  int v48; // [sp+38h] [bp-58h]@21
  __int64 v49; // [sp+40h] [bp-50h]@1
  __int64 v50; // [sp+48h] [bp-48h]@1
  int v51; // [sp+48h] [bp-48h]@30
  __int64 v52; // [sp+50h] [bp-40h]@1
  __int64 v53; // [sp+58h] [bp-38h]@1
  unsigned int v54; // [sp+64h] [bp-2Ch]@1

  v5 = a5;
  v54 = a5;
  v6 = a4;
  v40 = a3;
  v42 = a2;
  v7 = this;
  v46 = this;
  v8 = (unsigned int)(a4 + 76);
  v9 = *((_QWORD *)this + 505);
  v41 = (unsigned __int8)(*(_DWORD *)(v9 + v8) >> 4);
  v43 = (unsigned int)(v6 + 512);
  *(_DWORD *)(v9 + v43) = 196608;
  v47 = 0;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  v49 = (unsigned int)(v6 + 628);
  *(_DWORD *)(*((_QWORD *)this + 505) + v49) = 196864;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  v50 = (unsigned int)(v6 + 788);
  *(_DWORD *)(*((_QWORD *)this + 505) + v50) = 196864;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  AppleCamIn::VerifyMemory(this, v5);
  v52 = (unsigned int)(v6 + 916);
  *(_DWORD *)(*((_QWORD *)this + 505) + v52) = 1;
  IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
  v53 = (unsigned int)(v6 + 912);
  v10 = 1000;
  v44 = 0LL;
  v45 = 0LL;
  v11 = 0;
  while ( 1 )
  {
    if ( v10 < 0 )
    {
      goto LABEL_17;
    }
    AppleCamIn::VerifyMemory(v7, v54);
    v12 = *((_QWORD *)v7 + 505);
    v13 = *(_DWORD *)(v12 + v53);
    v14 = *(_DWORD *)(v12 + v53) & 0xF0;
    *(_DWORD *)(v12 + v52) = 1;
    v15 = (IOPCIDevice *)*((_QWORD *)v7 + 31);
    v16 = 0;
    IOPCIDevice::extendedConfigWrite32(v15, 0LL, 0x12345678u);
    if ( !(v13 & 0xF) )
    {
      v17 = v45;
      v16 = v45 != 0;
      if ( !(_DWORD)v45 )
      {
        v17 = 1LL;
      }
      v45 = v17;
    }
    if ( !v14 )
    {
      v18 = v44;
      v19 = (_DWORD)v44 == 0;
      if ( !(_DWORD)v44 )
      {
        v18 = 1LL;
      }
      v44 = v18;
      if ( !v19 )
      {
        break;
      }
    }
    if ( v16 )
    {
      break;
    }
    if ( v47 <= 0x3E )
    {
      ++v47;
      v7 = v46;
      *(_DWORD *)(*((_QWORD *)v46 + 505) + v43) = v47 & 0x3F | 0x30000;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v46 + 31), 0LL, 0x12345678u);
      --v10;
    }
    else
    {
      --v10;
      ++v11;
      v20 = v11 & 0x3F | 0x30100;
      v7 = v46;
      *(_DWORD *)(*((_QWORD *)v46 + 505) + v49) = v20;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v46 + 31), 0LL, 0x12345678u);
      *(_DWORD *)(*((_QWORD *)v46 + 505) + v50) = v20;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v46 + 31), 0LL, 0x12345678u);
      if ( v11 >= 0x41 )
      {
        v21 = (__int64)"%s: ERROR - ERR_RDEN_BYTE_TO timeout";
LABEL_18:
        IOLog(v21);
        return 3758097110LL;
      }
    }
  }
  if ( v10 <= 1 )
  {
LABEL_17:
    v21 = (__int64)"%s: ERROR: Timeout in WL FIFO \n";
    goto LABEL_18;
  }
  v23 = *((_QWORD *)v46 + 505);
  v24 = *(_DWORD *)(v23 + v43);
  v25 = 0;
  if ( (_DWORD)v45 == 1 )
  {
    v48 = *(_DWORD *)(v23 + v49) & 0x3F;
    v26 = 0;
    do
    {
      v27 = v11 + v26 + 1;
      if ( (unsigned int)v27 >= 0x41 )
      {
        v21 = (__int64)"%s: ERROR - ERR_RDEN_BYTE1_TO timeout";
        goto LABEL_18;
      }
      *(_DWORD *)(*((_QWORD *)v46 + 505) + v50) = v27 & 0x3F | 0x30100;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v46 + 31), 0LL, 0x12345678u);
      AppleCamIn::VerifyMemory(v46, v54);
      v28 = *((_QWORD *)v46 + 505);
      v29 = *(_DWORD *)(v28 + v53);
      v30 = *(_DWORD *)(v28 + v53);
      *(_DWORD *)(v28 + v52) = 1;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v46 + 31), 0LL, 0x12345678u);
      ++v26;
    }
    while ( v30 & 0xF0 );
    if ( 1001 - v26 <= 1 )
    {
      v21 = (__int64)"%s: ERROR: timeout_rden_byte1\n";
      goto LABEL_18;
    }
    v11 += v26;
    v25 = *(_DWORD *)(*((_QWORD *)v46 + 505) + v50) & 0x3F;
    v31 = v48;
  }
  else
  {
    v31 = 0;
  }
  if ( (_DWORD)v44 == 1 )
  {
    v51 = *(_DWORD *)(*((_QWORD *)v46 + 505) + v50) & 0x3F;
    v32 = v11 + 1;
    v33 = 0;
    do
    {
      if ( (unsigned int)(v32 + v33) >= 0x41 )
      {
        v21 = (__int64)"%s: ERROR - ERR_RDEN_BYTE0_TO timeout";
        goto LABEL_18;
      }
      *(_DWORD *)(*((_QWORD *)v46 + 505) + v49) = ((_BYTE)v32 + (_BYTE)v33) & 0x3F | 0x30100;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v46 + 31), 0LL, 0x12345678u);
      AppleCamIn::VerifyMemory(v46, v54);
      v34 = *((_QWORD *)v46 + 505);
      v35 = *(_DWORD *)(v34 + v53);
      v36 = *(_DWORD *)(v34 + v53);
      *(_DWORD *)(v34 + v52) = 1;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v46 + 31), 0LL, 0x12345678u);
      ++v33;
    }
    while ( v35 & 0xF );
    if ( 1001 - v33 <= 1 )
    {
      v21 = (__int64)"%s: ERROR: timeout_rden_byte0\n";
      goto LABEL_18;
    }
    v31 = *(_DWORD *)(*((_QWORD *)v46 + 505) + v49) & 0x3F;
    v25 = v51;
  }
  v37 = v41 + (v24 & 0x3F);
  *v42 = v37;
  if ( (unsigned int)v37 <= 0x3F )
  {
    *v40 = v31;
    v40[1] = v25;
    result = 0LL;
  }
  else
  {
    *v42 = 63;
    v38 = v31 + v37 - 63;
    *v40 = v38;
    v39 = v25 + v37 - 63;
    v40[1] = v39;
    if ( (unsigned int)v38 >= 0x40 )
    {
      *v40 = 63;
    }
    result = 0LL;
    if ( (unsigned int)v39 >= 0x40 )
    {
      v40[1] = 63;
    }
  }
  return result;
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (000000000000BA28) ----------------------------------------------------
__int64 __fastcall AppleCamIn::calib_wr_dq(AppleCamIn *this, int *a2, unsigned int *a3, unsigned int *a4, int a5)
{
  signed __int64 v5; // rdi@1
  signed int v6; // er15@1
  __int64 v7; // r13@2
  signed int v8; // er10@2
  int v9; // er11@2
  int v10; // er14@2
  int v11; // er8@2
  signed int v12; // edi@2
  unsigned int v13; // er9@3
  int v14; // er12@3
  int v15; // ebx@3
  bool v16; // r15@5
  bool v17; // bl@5
  bool v18; // r15@5
  bool v19; // r15@7
  __int64 v20; // rax@7
  bool v21; // zf@13
  int v22; // esi@13
  signed int v23; // edx@17
  signed int v24; // ecx@19
  signed __int64 v25; // rbx@27
  signed __int64 v26; // rdi@41
  int v27; // edx@42
  __int64 v28; // rcx@42
  signed int v29; // er13@47
  bool v30; // zf@47
  unsigned int v31; // er13@51
  AppleCamIn *v33; // [sp+0h] [bp-80h]@1
  __int64 v34; // [sp+8h] [bp-78h]@1
  unsigned int *v35; // [sp+10h] [bp-70h]@1
  signed __int64 v36; // [sp+18h] [bp-68h]@2
  int *v37; // [sp+20h] [bp-60h]@1
  signed int v38; // [sp+2Ch] [bp-54h]@2
  signed __int64 v39; // [sp+38h] [bp-48h]@2
  __int64 v40; // [sp+40h] [bp-40h]@1
  signed int v41; // [sp+48h] [bp-38h]@2
  signed int v42; // [sp+4Ch] [bp-34h]@2
  unsigned int v43; // [sp+50h] [bp-30h]@2

  v35 = a4;
  v37 = a2;
  v33 = this;
  v34 = (unsigned int)(a5 + 76);
  v5 = 0LL;
  v40 = 0LL;
  v6 = 1;
  do
  {
    v38 = v6;
    v36 = v5;
    v41 = 255;
    v7 = 0LL;
    v8 = -1;
    v9 = 0;
    v10 = 0;
    v43 = 0;
    v42 = 255;
    v11 = 0;
    v39 = 0LL;
    v12 = 0;
    while ( 1 )
    {
      v13 = v10;
      v14 = v6 & a2[v7];
      v15 = 255;
      if ( (_DWORD)v7 )
      {
        v15 = v6 & a2[v7 - 1];
      }
      v16 = v15 != 0;
      v17 = v15 == 0;
      v18 = v14 == 0 && v16;
      if ( v18 )
      {
        v9 = v7;
      }
      v19 = v11 == 0 && v18;
      v20 = v40;
      if ( v19 )
      {
        v20 = (unsigned int)v7;
      }
      v40 = v20;
      if ( v17 && v14 != 0 )
      {
        v8 = v7;
      }
      v10 = v8 - v9;
      if ( v8 < v9 )
      {
        v10 = v43;
      }
      v21 = ((unsigned int)v10 < 5 || v10 < v13) == 0;
      v22 = 0;
      if ( (unsigned int)v10 < 5 || v10 < v13 )
      {
        v22 = v10;
      }
      if ( (unsigned int)v10 < 5 || v10 < v13 )
      {
        v10 = v13;
      }
      v23 = v42;
      if ( v21 )
      {
        v23 = v9;
      }
      v24 = v41;
      if ( v21 )
      {
        v24 = v8;
      }
      if ( v21 )
      {
        v9 = 0;
      }
      if ( v21 )
      {
        v8 = -1;
      }
      if ( !v14 )
      {
        v12 = 0;
      }
      v25 = v39;
      if ( !v14 )
      {
        v25 = 1LL;
      }
      if ( !v14 || !(_DWORD)v25 )
      {
        v43 = v22;
LABEL_35:
        v39 = v25;
        v42 = v23;
        v41 = v24;
        goto LABEL_36;
      }
      v43 = v22;
      if ( (unsigned int)v10 < 5 )
      {
        goto LABEL_35;
      }
      v42 = v23;
      v41 = v24;
      if ( v12 > 1 )
      {
        break;
      }
      v39 = v25;
      ++v12;
LABEL_36:
      v11 += v19;
      ++v7;
      a2 = v37;
      v6 = v38;
      if ( (signed int)v7 >= 64 )
      {
        goto LABEL_39;
      }
    }
    a2 = v37;
    v6 = v38;
LABEL_39:
    if ( (_DWORD)v7 != 64 || v43 <= 4 )
    {
      v27 = v7 - 2;
      LODWORD(v28) = 0;
      if ( (signed int)v7 - 2 <= 63 )
      {
        v28 = 0LL;
        do
        {
          if ( !(v6 & *(&a2[v27] + v28)) )
          {
            break;
          }
          ++v28;
        }
        while ( v27 + (signed int)v28 < 64 );
      }
      v26 = v36;
      if ( v42 == 255 )
      {
        v29 = v7 - 3;
        v30 = (_DWORD)v28 == 64;
        if ( (_DWORD)v28 == 64 )
        {
          LODWORD(v28) = 0;
        }
        if ( v30 )
        {
          v29 = 63;
        }
        v31 = v29 - (((*(_DWORD *)(*((_QWORD *)v33 + 505) + v34) >> 3) & 0x1FF) - (signed int)v28) / 2;
        v35[v36] = v31;
      }
      else
      {
        v35[v36] = (unsigned int)(v42 + v41) >> 1;
        v31 = (unsigned int)(v42 + v41) >> 1;
      }
      if ( v31 < 0x41 )
      {
        if ( !v31 )
        {
          v35[v36] = 0;
          v31 = 0;
        }
      }
      else
      {
        v35[v36] = 63;
        v31 = 63;
      }
      if ( v6 & a2[v31] )
      {
        v35[v36] = v20;
      }
    }
    else
    {
      v26 = v36;
      v35[v36] = (signed int)(v20 + ((unsigned int)(v20 + 64) >> 31) + 64) >> 1;
    }
    v5 = v26 + 1;
    v6 *= 2;
  }
  while ( v5 != 16 );
  return 0LL;
}

//----- (000000000000BCCE) ----------------------------------------------------
AppleCamIn *__usercall AppleCamIn::create_ddr_calibration_result@<rax>(AppleCamIn *this@<rdi>, const char *a2@<rsi>, int *a3@<rdx>, unsigned int *a4@<rcx>, __int64 a5@<rax>, __int64 a6@<r8>, int a7@<r9d>, int a8)
{
  int v8; // er12@1
  __int64 v9; // rbx@1
  unsigned int *v10; // r14@1
  char *v11; // rax@2
  __int64 v12; // rax@4

  v8 = a7;
  v9 = a6;
  v10 = a4;
  snprintf((char *)this, 0x10uLL, "%s", a3, a5);
  *((_DWORD *)this + 4) = v8;
  *((_DWORD *)this + 5) = a8;
  if ( v8 )
  {
    v11 = (char *)this + 284;
    do
    {
      *(_DWORD *)v11 = *(_DWORD *)v9;
      v9 += 4LL;
      v11 += 4;
      --v8;
    }
    while ( v8 );
  }
  v12 = 0LL;
  do
  {
    *((_DWORD *)this + v12 + 7) = v10[v12];
    ++v12;
  }
  while ( v12 != 64 );
  *((_DWORD *)this + 6) = 1;
  return this;
}

//----- (000000000000BD56) ----------------------------------------------------
__int64 __fastcall AppleCamIn::generic_shmoo_rd_dqs(AppleCamIn *this, int *a2, __int64 a3, int a4, unsigned int a5)
{
  AppleCamIn *v5; // r14@1
  int v6; // eax@1
  __int64 v7; // rdi@1
  __int64 v8; // rdx@1
  int v9; // er15@3
  int v10; // er13@3
  signed __int64 v11; // r12@4
  int v12; // ebx@4
  int v13; // er12@7
  signed int v14; // ebx@7
  signed int v15; // er13@7
  int v16; // er15@7
  int v17; // eax@10
  int v18; // er15@11
  int v19; // er15@11
  __int64 v20; // r12@11
  int v21; // eax@12
  __int64 result; // rax@16
  __int64 v23; // rcx@18
  __int64 v24; // [sp+0h] [bp-70h]@7
  __int64 v25; // [sp+8h] [bp-68h]@7
  __int64 v26; // [sp+10h] [bp-60h]@7
  __int64 v27; // [sp+18h] [bp-58h]@7
  int v28; // [sp+20h] [bp-50h]@7
  unsigned int v29; // [sp+24h] [bp-4Ch]@1
  int v30; // [sp+28h] [bp-48h]@3
  int v31; // [sp+28h] [bp-48h]@7
  int v32[2]; // [sp+38h] [bp-38h]@2
  __int64 v33; // [sp+40h] [bp-30h]@1

  v29 = a5;
  v5 = this;
  v33 = *(_QWORD *)off_12040[0];
  v6 = a4 + 628;
  v7 = *((_QWORD *)this + 505);
  v8 = 0LL;
  do
  {
    v32[v8++] = *(_DWORD *)(v7 + (unsigned int)v6) & 0x3F;
    v6 += 160;
  }
  while ( v8 != 2 );
  v9 = a4 + 568;
  v30 = a4;
  v10 = 0;
  do
  {
    v11 = 8LL;
    v12 = v9;
    do
    {
      *(_DWORD *)(*((_QWORD *)v5 + 505) + (unsigned int)(v12 - 4)) = 196608;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v5 + 31), 0LL, 0x12345678u);
      *(_DWORD *)(*((_QWORD *)v5 + 505) + (unsigned int)v12) = 196608;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v5 + 31), 0LL, 0x12345678u);
      v12 += 8;
      --v11;
    }
    while ( v11 );
    ++v10;
    v9 += 160;
  }
  while ( v10 != 2 );
  v28 = (*(_DWORD *)(*((_QWORD *)v5 + 505) + (unsigned int)(v30 + 80)) >> 20) & 0x3F;
  v27 = (unsigned int)(v30 + 520);
  v26 = (unsigned int)(v30 + 524);
  v25 = (unsigned int)(v30 + 680);
  v24 = (unsigned int)(v30 + 684);
  v13 = v30 + 628;
  v31 = v30 + 628;
  v14 = 1000;
  v15 = 0;
  v16 = v29;
  while ( v14 > 0 && !v15 )
  {
    --v14;
    v17 = AppleCamIn::VerifyMemory(v5, v16);
    *a2 = v17;
    v15 = 1;
    if ( v17 != 0xFFFF )
    {
      ++v28;
      v15 = (unsigned int)v28 > 0x3E;
      v18 = v28 & 0x3F | 0x30100;
      *(_DWORD *)(*((_QWORD *)v5 + 505) + v27) = v18;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v5 + 31), 0LL, 0x12345678u);
      *(_DWORD *)(*((_QWORD *)v5 + 505) + v26) = v18;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v5 + 31), 0LL, 0x12345678u);
      *(_DWORD *)(*((_QWORD *)v5 + 505) + v25) = v18;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v5 + 31), 0LL, 0x12345678u);
      *(_DWORD *)(*((_QWORD *)v5 + 505) + v24) = v18;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v5 + 31), 0LL, 0x12345678u);
      v19 = v13;
      v20 = 0LL;
      do
      {
        v21 = v32[v20] + 1;
        v32[v20] = v21;
        if ( (unsigned int)v21 > 0x3E )
        {
          v15 = 1;
        }
        *(_DWORD *)(*((_QWORD *)v5 + 505) + (unsigned int)v19) = v21 & 0x3F | 0x30100;
        IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)v5 + 31), 0LL, 0x12345678u);
        ++v20;
        v19 += 160;
      }
      while ( v20 != 2 );
      v16 = v29;
      v13 = v31;
    }
  }
  result = 0LL;
  if ( v14 <= 0 )
  {
    IOLog("%s: ERROR: timeout\n");
    result = 3758097110LL;
  }
  v23 = *(_QWORD *)off_12040[0];
  return result;
}
// 12040: using guessed type __int64 off_12040[4];
// B6390: using guessed type int __fastcall IOLog(_QWORD);
// BD56: using guessed type int var_38[2];

//----- (000000000000C004) ----------------------------------------------------
__int64 __fastcall AppleCamIn::calib_rd_dqs(AppleCamIn *this, int *a2, unsigned int *a3, unsigned int *a4)
{
  unsigned int *v4; // r8@1
  __int64 v5; // r14@1
  __int64 v6; // r9@1
  __int64 v7; // rcx@1
  signed int v8; // er10@2
  signed int v9; // er15@2
  signed int v10; // er11@2
  __int64 v11; // rbx@2
  signed __int64 v12; // rdi@4
  int v13; // edx@4
  signed int v14; // edi@6
  signed int v15; // er10@11
  int *v16; // rdx@13
  int v17; // edi@15
  bool v18; // sf@18
  unsigned __int8 v19; // of@18
  int v20; // eax@19
  int v21; // eax@22
  __int64 result; // rax@24
  __int64 v23; // rcx@27
  int v24[16]; // [sp+0h] [bp-E0h]@12
  int v25[16]; // [sp+40h] [bp-A0h]@7
  int v26[16]; // [sp+80h] [bp-60h]@2
  __int64 v27; // [sp+C0h] [bp-20h]@1

  v4 = a4;
  v5 = off_12040[0];
  v27 = *(_QWORD *)off_12040[0];
  v6 = 0LL;
  v7 = 0LL;
  do
  {
    v26[v7] = 0;
    v8 = 1;
    v9 = 1 << v7;
    v10 = 1000;
    v11 = 0LL;
    while ( v8 == 1 )
    {
      v12 = 4611686018427387898LL;
      v13 = 0;
      do
      {
        v13 += v9 & *(&a2[v11 + 6] + v12);
        ++v12;
      }
      while ( v12 * 4 );
      v14 = v11;
      v8 = 1;
      if ( !v13 )
      {
        v25[v7] = v11;
        v8 = 0;
      }
      --v10;
      ++v11;
      if ( v14 >= 62 )
      {
        v25[v7] = 64;
        LODWORD(v11) = v14 + 2;
        break;
      }
    }
    if ( v10 <= 0 )
    {
      IOLog("%s: ERROR: timeout checking for first pass-bit\n");
      result = 3758097110LL;
      goto LABEL_27;
    }
    v15 = 1;
    if ( (signed int)v11 >= 64 )
    {
      v24[v7] = 64;
      v15 = 0;
    }
    v16 = &a2[(signed int)v11];
    while ( v15 == 1 )
    {
      v17 = v11;
      if ( v9 & *v16 || (v15 = 1, v17 = 63, (_DWORD)v11 == 63) )
      {
        v24[v7] = v17;
        v15 = 0;
      }
      ++v16;
      v19 = __OFSUB__((_DWORD)v11, 62);
      v18 = (signed int)v11 - 62 < 0;
      LODWORD(v11) = v11 + 1;
      if ( !(v18 ^ v19) )
      {
        v24[v7] = 64;
        v20 = 64;
        goto LABEL_21;
      }
    }
    v20 = v24[v7];
LABEL_21:
    v26[v7] = v20 - v25[v7];
    ++v7;
  }
  while ( (signed int)v7 < 16 );
  do
  {
    v21 = v25[v6] + (v26[v6] >> 1);
    if ( (unsigned int)v21 > 0x3F )
    {
      v21 = 63;
    }
    v4[v6++] = v21;
    result = 0LL;
  }
  while ( v6 != 16 );
LABEL_27:
  v23 = *(_QWORD *)v5;
  return result;
}
// 12040: using guessed type __int64 off_12040[4];
// B6390: using guessed type int __fastcall IOLog(_QWORD);
// C004: using guessed type int var_60[16];
// C004: using guessed type int var_A0[16];
// C004: using guessed type int var_E0[16];

//----- (000000000000C18C) ----------------------------------------------------
__int64 __fastcall AppleCamIn::wr_dqs_setting(AppleCamIn *this, int *a2, unsigned int *a3, unsigned int *a4, int a5, int a6, int a7, int a8)
{
  signed __int64 v8; // rax@1
  int v9; // er12@2
  int v10; // eax@2
  int v11; // ecx@2
  signed __int64 v12; // r13@3
  int v13; // er15@3
  int v14; // eax@10
  unsigned int *v15; // rdx@10
  signed int v16; // er12@11
  int v17; // er13@11
  signed int v18; // er15@11
  int v19; // ecx@13
  int v20; // edx@13
  int v21; // er14@14
  unsigned int v22; // ecx@15
  __int64 result; // rax@20
  int v24; // [sp+0h] [bp-60h]@1
  int v25; // [sp+8h] [bp-58h]@1
  unsigned int v26; // [sp+Ch] [bp-54h]@1
  unsigned int *v27; // [sp+10h] [bp-50h]@1
  unsigned int *v28; // [sp+20h] [bp-40h]@2
  signed int v29; // [sp+20h] [bp-40h]@13
  int v30; // [sp+28h] [bp-38h]@3
  int v31; // [sp+28h] [bp-38h]@14
  int v32; // [sp+30h] [bp-30h]@3
  int v33; // [sp+30h] [bp-30h]@14

  v26 = a6;
  v24 = a5;
  v27 = a4;
  v25 = a5 + 568;
  v8 = 0LL;
  do
  {
    v28 = (unsigned int *)v8;
    v9 = v8 | 0x30000;
    v10 = v25;
    v11 = 0;
    do
    {
      v30 = v11;
      v32 = v10;
      v12 = 8LL;
      v13 = v10;
      do
      {
        if ( a8 & 1 )
        {
          *(_DWORD *)(*((_QWORD *)this + 505) + (unsigned int)(v13 - 4)) = v9;
          IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
        }
        if ( a8 & 2 )
        {
          *(_DWORD *)(*((_QWORD *)this + 505) + (unsigned int)v13) = v9;
          IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
        }
        v13 += 8;
        --v12;
      }
      while ( v12 );
      v11 = v30 + 1;
      v10 = v32 + 160;
    }
    while ( v30 != 1 );
    v14 = AppleCamIn::VerifyMemory(this, v26);
    v15 = v28;
    a2[(_QWORD)v28] = v14;
    v8 = (signed __int64)((char *)v28 + 1);
  }
  while ( (uint64_t *)((char *)v28 + 1) != &stru_20.vmsize );
  v16 = 1;
  v17 = 0;
  v18 = 0;
  if ( a8 != 3 )
  {
    v18 = a8 != 1;
    v16 = 2;
  }
  v29 = v18;
  AppleCamIn::calib_rd_dqs(this, a2, v15, v27);
  v19 = v24 + 4 * v18 + 564;
  v20 = 0;
  while ( 2 )
  {
    v31 = v20;
    v33 = v19;
    v21 = v19;
    do
    {
      v22 = v27[v17];
      if ( v22 - 1 >= 0x3E )
      {
        IOLog("%s: ERROR: Bad VDL.  new_step[%02d]==0x%08x\n");
        return 3758097097LL;
      }
      *(_DWORD *)(*((_QWORD *)this + 505) + (unsigned int)v21) = v22 & 0x3F | 0x30000;
      IOPCIDevice::extendedConfigWrite32(*((IOPCIDevice **)this + 31), 0LL, 0x12345678u);
      if ( a8 == 3 )
      {
        v17 += v18 & 1;
      }
      else
      {
        ++v17;
      }
      v18 += v16;
      v21 += 4 * v16;
    }
    while ( v18 < 16 );
    v20 = v31 + 1;
    v19 = v33 + 160;
    result = 0LL;
    v18 = v29;
    if ( v31 + 1 < 2 )
    {
      continue;
    }
    break;
  }
  return result;
}
// 20: using guessed type segment_command_64 stru_20;
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (000000000000C380) ----------------------------------------------------
__int64 __fastcall AppleCamIn::MetaClass::~MetaClass(AppleCamIn::MetaClass *this)
{
  return OSMetaClass::~OSMetaClass(this);
}

//----- (000000000000C38A) ----------------------------------------------------
__int64 __fastcall inflate_alloc(void *a1, __int64 a2, __int64 a3)
{
  return operator new[](a3 * a2);
}

//----- (000000000000C39B) ----------------------------------------------------
void __fastcall inflate_free(void *a1, void *a2)
{
  if ( a2 )
  {
    operator delete[](a2);
  }
}

//----- (000000000000C3B0) ----------------------------------------------------
__int64 `global constructor keyed to'_a()
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(&AppleCamIn::gMetaClass, "AppleCamIn", off_12028[0], 4104LL);
  result = (__int64)off_12910;
  AppleCamIn::gMetaClass = off_12910;
  return result;
}
// 12028: using guessed type _QWORD off_12028[7];
// 12910: using guessed type __int64 (__fastcall *off_12910[2])(AppleCamIn::MetaClass *__hidden this);
// A6488: using guessed type _QWORD AppleCamIn::gMetaClass;
// B6418: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (000000000000C3F0) ----------------------------------------------------
__int64 `global destructor keyed to'_a()
{
  return OSMetaClass::~OSMetaClass((OSMetaClass *)&AppleCamIn::gMetaClass);
}
// A6488: using guessed type _QWORD AppleCamIn::gMetaClass;

//----- (000000000000C410) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::MetaClass::MetaClass(AppleCamInUserClient::MetaClass *this)
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(this, "AppleCamInUserClient", off_12018[0], 264LL);
  result = (__int64)off_13390;
  *(_QWORD *)this = off_13390;
  return result;
}
// 12018: using guessed type _QWORD off_12018[9];
// 13390: using guessed type __int64 (__fastcall *off_13390[2])(AppleCamInUserClient::MetaClass *__hidden this);
// B6418: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (000000000000C442) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::MetaClass::~MetaClass(AppleCamInUserClient::MetaClass *this)
{
  return OSMetaClass::~OSMetaClass(this);
}

//----- (000000000000C44C) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::AppleCamInUserClient(__int64 a1)
{
  __int64 result; // rax@1

  IOUserClient::IOUserClient(a1);
  result = (__int64)off_12A10;
  *(_QWORD *)a1 = off_12A10;
  return result;
}
// 12A10: using guessed type __int64 (__fastcall *off_12A10[2])(AppleCamInUserClient *__hidden this);
// B6550: using guessed type int __cdecl IOUserClient::IOUserClient(_QWORD);

//----- (000000000000C46C) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::AppleCamInUserClient(__int64 a1)
{
  __int64 result; // rax@1

  IOUserClient::IOUserClient(a1);
  result = (__int64)off_12A10;
  *(_QWORD *)a1 = off_12A10;
  return result;
}
// 12A10: using guessed type __int64 (__fastcall *off_12A10[2])(AppleCamInUserClient *__hidden this);
// B6550: using guessed type int __cdecl IOUserClient::IOUserClient(_QWORD);

//----- (000000000000C48C) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::~AppleCamInUserClient(AppleCamInUserClient *this)
{
  return IOUserClient::~IOUserClient(this);
}

//----- (000000000000C496) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::~AppleCamInUserClient(AppleCamInUserClient *this)
{
  return IOUserClient::~IOUserClient(this);
}

//----- (000000000000C4A0) ----------------------------------------------------
void __fastcall AppleCamInUserClient::~AppleCamInUserClient(AppleCamInUserClient *this)
{
  IOUserClient::~IOUserClient(this);
  OSObject::operator delete((void *)this);
}

//----- (000000000000C4C2) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::getMetaClass(AppleCamInUserClient *this)
{
  return (__int64)&AppleCamInUserClient::gMetaClass;
}
// A64B0: using guessed type _QWORD AppleCamInUserClient::gMetaClass;

//----- (000000000000C4D0) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::MetaClass::MetaClass(AppleCamInUserClient::MetaClass *this)
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(this, "AppleCamInUserClient", off_12018[0], 264LL);
  result = (__int64)off_13390;
  *(_QWORD *)this = off_13390;
  return result;
}
// 12018: using guessed type _QWORD off_12018[9];
// 13390: using guessed type __int64 (__fastcall *off_13390[2])(AppleCamInUserClient::MetaClass *__hidden this);
// B6418: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (000000000000C502) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::MetaClass::alloc(AppleCamInUserClient::MetaClass *this, unsigned __int64 a2)
{
  __int64 v2; // rbx@1

  v2 = OSObject::operator new((OSObject *)&stru_108, a2);
  IOUserClient::IOUserClient(v2);
  *(_QWORD *)v2 = off_12A10;
  OSMetaClass::instanceConstructed((OSMetaClass *)&AppleCamInUserClient::gMetaClass);
  return v2;
}
// 108: using guessed type section_64 stru_108;
// 12A10: using guessed type __int64 (__fastcall *off_12A10[2])(AppleCamInUserClient *__hidden this);
// A64B0: using guessed type _QWORD AppleCamInUserClient::gMetaClass;
// B6550: using guessed type int __cdecl IOUserClient::IOUserClient(_QWORD);

//----- (000000000000C542) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::AppleCamInUserClient(__int64 a1)
{
  IOUserClient::IOUserClient(a1);
  *(_QWORD *)a1 = off_12A10;
  return OSMetaClass::instanceConstructed((OSMetaClass *)&AppleCamInUserClient::gMetaClass);
}
// 12A10: using guessed type __int64 (__fastcall *off_12A10[2])(AppleCamInUserClient *__hidden this);
// A64B0: using guessed type _QWORD AppleCamInUserClient::gMetaClass;
// B6550: using guessed type int __cdecl IOUserClient::IOUserClient(_QWORD);

//----- (000000000000C572) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::AppleCamInUserClient(__int64 a1)
{
  IOUserClient::IOUserClient(a1);
  *(_QWORD *)a1 = off_12A10;
  return OSMetaClass::instanceConstructed((OSMetaClass *)&AppleCamInUserClient::gMetaClass);
}
// 12A10: using guessed type __int64 (__fastcall *off_12A10[2])(AppleCamInUserClient *__hidden this);
// A64B0: using guessed type _QWORD AppleCamInUserClient::gMetaClass;
// B6550: using guessed type int __cdecl IOUserClient::IOUserClient(_QWORD);

//----- (000000000000C5A2) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::_ISP_DeviceOpen(__int64 a1)
{
  if ( !*(_BYTE *)(a1 + 225) )
  {
    *(_BYTE *)(a1 + 225) = 1;
  }
  return 0LL;
}

//----- (000000000000C5BA) ----------------------------------------------------
signed __int64 __fastcall AppleCamInUserClient::_ISP_DeviceClose(__int64 a1)
{
  signed __int64 result; // rax@1

  result = 3758097122LL;
  if ( *(_BYTE *)(a1 + 225) == 1 )
  {
    *(_BYTE *)(a1 + 225) = 0;
    result = 0LL;
  }
  return result;
}

//----- (000000000000C5DA) ----------------------------------------------------
signed __int64 AppleCamInUserClient::_ISP_ReadISPRegister()
{
  return 3758097122LL;
}

//----- (000000000000C5E6) ----------------------------------------------------
signed __int64 AppleCamInUserClient::_ISP_WriteISPRegister()
{
  return 3758097122LL;
}

//----- (000000000000C5F2) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::_ISP_IsPowered(__int64 a1, __int64 a2, __int64 a3)
{
  **(_QWORD **)(a3 + 72) = *(_BYTE *)(*(_QWORD *)(a1 + 216) + 656LL);
  return 0LL;
}

//----- (000000000000C610) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_SendBuffers(__int64 a1, __int64 a2, __int64 a3)
{
  unsigned __int64 v3; // rcx@1
  int result; // eax@2

  v3 = *(_DWORD *)(a3 + 56) / 0x28uLL;
  if ( 40 * v3 == *(_DWORD *)(a3 + 56) )
  {
    result = AppleCamIn::ISP_SendBuffers(*(_QWORD *)(a1 + 216), *(_QWORD *)(a3 + 48), v3, a1, *(_QWORD *)(a3 + 16));
  }
  else
  {
    result = -536870206;
  }
  return result;
}

//----- (000000000000C65A) ----------------------------------------------------
signed __int64 AppleCamInUserClient::_abort_captures()
{
  return 3758097095LL;
}

//----- (000000000000C666) ----------------------------------------------------
signed __int64 AppleCamInUserClient::_ISP_ResetParams()
{
  return 3758097095LL;
}

//----- (000000000000C672) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_LoadFirmware(__int64 a1, __int64 a2, __int64 a3)
{
  return AppleCamIn::ISP_LoadFirmware(
           *(AppleCamIn **)(a1 + 216),
           **(void ***)(a3 + 32),
           *(_DWORD *)(*(_QWORD *)(a3 + 32) + 8LL),
           *(_DWORD *)(*(_QWORD *)(a3 + 32) + 16LL),
           *(task **)(a1 + 232));
}

//----- (000000000000C69A) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_LoadSetfile(__int64 a1, __int64 a2, __int64 a3)
{
  return AppleCamIn::ISP_LoadSetfile(
           *(AppleCamIn **)(a1 + 216),
           **(void ***)(a3 + 32),
           *(_DWORD *)(*(_QWORD *)(a3 + 32) + 8LL),
           *(task **)(a1 + 232),
           *(_DWORD *)(*(_QWORD *)(a3 + 32) + 16LL));
}

//----- (000000000000C6C4) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_ForgetFirmware(__int64 a1)
{
  return AppleCamIn::ISP_ForgetFirmware(*(AppleCamIn **)(a1 + 216));
}

//----- (000000000000C6D6) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_SendCommand(__int64 a1, __int64 a2, __int64 a3)
{
  return AppleCamIn::ISP_SendCommand(
           *(AppleCamIn **)(a1 + 216),
           **(unsigned __int8 ***)(a3 + 32),
           *(_DWORD *)(*(_QWORD *)(a3 + 32) + 8LL),
           *(_DWORD *)(*(_QWORD *)(a3 + 32) + 16LL),
           *(_DWORD *)(*(_QWORD *)(a3 + 32) + 24LL),
           *(task **)(a1 + 232));
}

//----- (000000000000C702) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_PowerOnCamera(void *a1, __int64 a2, __int64 a3)
{
  return AppleCamIn::ISP_PowerOnCamera(*((AppleCamIn **)a1 + 27), **(_DWORD **)(a3 + 32), a1);
}

//----- (000000000000C720) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_PowerOffCamera(void *a1, __int64 a2, __int64 a3)
{
  return AppleCamIn::ISP_PowerOffCamera(*((AppleCamIn **)a1 + 27), **(_DWORD **)(a3 + 32), a1);
}

//----- (000000000000C73E) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_GetCameraTime(__int64 a1, __int64 a2, __int64 a3)
{
  return AppleCamIn::ISP_GetCameraTime(*(_QWORD *)(a1 + 216), *(_QWORD *)(a3 + 88));
}

//----- (000000000000C754) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_GetModuleParams(__int64 a1, __int64 a2, __int64 a3)
{
  return AppleCamIn::ISP_GetModuleParams(*(_QWORD *)(a1 + 216), *(_QWORD *)(a3 + 88));
}

//----- (000000000000C76A) ----------------------------------------------------
signed __int64 AppleCamInUserClient::_ISP_GetCameraStatus()
{
  return 3758097095LL;
}

//----- (000000000000C776) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_SetDriverLoggingFlags(__int64 a1, __int64 a2, __int64 a3)
{
  return AppleCamIn::ISP_SetDriverLoggingFlags(*(AppleCamIn **)(a1 + 216), **(_DWORD **)(a3 + 32));
}

//----- (000000000000C78E) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_ShowSharedMemoryAllocations(__int64 a1)
{
  return AppleCamIn::ISP_ShowSharedMemoryAllocations(*(AppleCamIn **)(a1 + 216));
}

//----- (000000000000C7A0) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_ProcessRawImagePrepare(__int64 a1, __int64 a2, __int64 a3)
{
  return AppleCamIn::ISP_ProcessRawImagePrepare(*(_QWORD *)(a1 + 216), *(_QWORD *)(a3 + 48));
}

//----- (000000000000C7B6) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_ProcessRawImageGo(__int64 a1)
{
  return AppleCamIn::ISP_ProcessRawImageGo(*(AppleCamIn **)(a1 + 216));
}

//----- (000000000000C7C8) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_GetSetfileSurfaceID(__int64 a1, __int64 a2, __int64 a3)
{
  return AppleCamIn::ISP_GetSetfileSurfaceID(
           *(AppleCamIn **)(a1 + 216),
           **(_DWORD **)(a3 + 32),
           *(unsigned int **)(a3 + 72));
}

//----- (000000000000C7E4) ----------------------------------------------------
signed __int64 AppleCamInUserClient::_ISP_LoadFullResLensShadingTable()
{
  return 3758097095LL;
}

//----- (000000000000C7F0) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_EnableSensorPower(__int64 a1, __int64 a2, __int64 a3)
{
  return AppleCamIn::ISP_EnableSensorPower(
           *(AppleCamIn **)(a1 + 216),
           **(_DWORD **)(a3 + 32),
           *(_QWORD *)(*(_QWORD *)(a3 + 32) + 8LL) != 0LL);
}

//----- (000000000000C812) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_SetFullStatsMode(__int64 a1, __int64 a2, __int64 a3)
{
  return AppleCamIn::ISP_SetFullStatsMode(*(AppleCamIn **)(a1 + 216), **(_DWORD **)(a3 + 32));
}

//----- (000000000000C82A) ----------------------------------------------------
signed __int64 AppleCamInUserClient::_ISP_DetectFaces()
{
  return 3758097095LL;
}

//----- (000000000000C836) ----------------------------------------------------
signed __int64 AppleCamInUserClient::_ISP_StartPerformanceCounters()
{
  return 3758097095LL;
}

//----- (000000000000C842) ----------------------------------------------------
signed __int64 AppleCamInUserClient::_ISP_ReadPerformanceCounters()
{
  return 3758097095LL;
}

//----- (000000000000C84E) ----------------------------------------------------
signed __int64 AppleCamInUserClient::_ISP_StopPerformanceCounters()
{
  return 3758097095LL;
}

//----- (000000000000C85A) ----------------------------------------------------
signed __int64 AppleCamInUserClient::_ISP_ReadS2Register()
{
  return 3758097122LL;
}

//----- (000000000000C866) ----------------------------------------------------
signed __int64 AppleCamInUserClient::_ISP_WriteS2Register()
{
  return 3758097122LL;
}

//----- (000000000000C872) ----------------------------------------------------
signed __int64 AppleCamInUserClient::_ISP_ReadS2Memory()
{
  return 3758097122LL;
}

//----- (000000000000C87E) ----------------------------------------------------
signed __int64 AppleCamInUserClient::_ISP_WriteS2Memory()
{
  return 3758097122LL;
}

//----- (000000000000C88A) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_GetDDRParams(__int64 a1, __int64 a2, __int64 a3)
{
  return AppleCamIn::ISP_GetDDRParams(*(_QWORD *)(a1 + 216), *(_QWORD *)(a3 + 88));
}

//----- (000000000000C8A0) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_SetISPCPUCommandTimeout(__int64 a1, __int64 a2, __int64 a3)
{
  return AppleCamIn::ISP_SetISPCPUCommandTimeout(*(AppleCamIn **)(a1 + 216), **(_DWORD **)(a3 + 32));
}

//----- (000000000000C8B8) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_GetSensorConfigInfo(__int64 a1, __int64 a2, __int64 a3)
{
  return AppleCamIn::ISP_GetSensorConfigInfo(
           *(_QWORD *)(a1 + 216),
           **(_DWORD **)(a3 + 32),
           *(_DWORD *)(*(_QWORD *)(a3 + 32) + 8LL),
           *(_QWORD *)(a3 + 88));
}

//----- (000000000000C8D6) ----------------------------------------------------
signed __int64 AppleCamInUserClient::_ISP_ReadS2MemoryBlock()
{
  return 3758097122LL;
}

//----- (000000000000C8E2) ----------------------------------------------------
signed __int64 AppleCamInUserClient::_ISP_WriteS2MemoryBlock()
{
  return 3758097122LL;
}

//----- (000000000000C8EE) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_GetFirmwareLoggingSurfaceID(__int64 a1, __int64 a2, __int64 a3)
{
  return AppleCamIn::ISP_GetFirmwareLoggingSurfaceID(*(AppleCamIn **)(a1 + 216), *(unsigned int **)(a3 + 72));
}

//----- (000000000000C904) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_GetDriverLoggingFlags(__int64 a1, __int64 a2, __int64 a3)
{
  return AppleCamIn::ISP_GetDriverLoggingFlags(*(AppleCamIn **)(a1 + 216), *(unsigned int **)(a3 + 72));
}

//----- (000000000000C91A) ----------------------------------------------------
int __fastcall AppleCamInUserClient::_ISP_SetRequiredMaxBusStall(__int64 a1, __int64 a2, __int64 a3)
{
  return AppleCamIn::ISP_SetRequiredMaxBusStall(*(AppleCamIn **)(a1 + 216), **(_DWORD **)(a3 + 32));
}

//----- (000000000000C932) ----------------------------------------------------
int __fastcall AppleCamInUserClient::init(AppleCamInUserClient *this, task *a2, OSDictionary *a3)
{
  int result; // eax@1

  result = (*(int (__fastcall **)(AppleCamInUserClient *, OSDictionary *))(off_12030[0] + 600))(this, a3);
  *((_QWORD *)this + 29) = a2;
  return result;
}
// 12030: using guessed type __int64 off_12030[6];

//----- (000000000000C95C) ----------------------------------------------------
int __fastcall AppleCamInUserClient::free(AppleCamInUserClient *this)
{
  return (*(int (__fastcall **)(AppleCamInUserClient *))(off_12030[0] + 160))(this);
}
// 12030: using guessed type __int64 off_12030[6];

//----- (000000000000C96E) ----------------------------------------------------
char __fastcall AppleCamInUserClient::start(AppleCamInUserClient *this, IOService *a2)
{
  __int64 v2; // rax@3
  char v3; // bl@4

  if ( (unsigned __int8)IOService::isInactive(this) || !(unsigned __int8)(*(int (**)(void))(off_12030[0] + 1488))() )
  {
    v3 = 0;
  }
  else
  {
    *((_QWORD *)this + 27) = a2;
    LODWORD(v2) = IOLockAlloc();
    *((_QWORD *)this + 30) = v2;
    if ( v2 )
    {
      *((_WORD *)this + 112) = 1;
      v3 = 1;
    }
    else
    {
      v3 = 0;
      IOLog("%s: Couldn't allocate lock\n");
    }
  }
  return v3;
}
// 12030: using guessed type __int64 off_12030[6];
// B6380: using guessed type int IOLockAlloc(void);
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (000000000000C9E2) ----------------------------------------------------
int __fastcall AppleCamInUserClient::stop(AppleCamInUserClient *this, IOService *a2)
{
  *((_BYTE *)this + 224) = 0;
  if ( *((_QWORD *)this + 30) )
  {
    IOLockFree();
    *((_QWORD *)this + 30) = 0LL;
  }
  return (*(int (__fastcall **)(AppleCamInUserClient *))(off_12030[0] + 1496))(this);
}
// 12030: using guessed type __int64 off_12030[6];
// B6388: using guessed type int IOLockFree(void);

//----- (000000000000CA2A) ----------------------------------------------------
__int64 __usercall AppleCamInUserClient::clientDied@<rax>(AppleCamInUserClient *this@<rdi>, __int64 a2@<rax>)
{
  printf("AppleCamInUserClient::clientDied\n", a2);
  return AppleCamInUserClient::clientClose(this);
}

//----- (000000000000CA50) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::clientClose(AppleCamInUserClient *this)
{
  AppleCamInUserClient *v1; // rbx@1
  AppleCamIn *v2; // rdi@1

  v1 = this;
  v2 = (AppleCamIn *)*((_QWORD *)this + 27);
  if ( v2 )
  {
    AppleCamIn::ISP_PowerOffCamera(v2, 0, (void *)v1);
    AppleCamIn::ISP_PowerOffCamera(*((AppleCamIn **)v1 + 27), 1u, (void *)v1);
  }
  if ( *((_BYTE *)v1 + 225) == 1 )
  {
    *((_BYTE *)v1 + 225) = 0;
  }
  (*(void (__fastcall **)(AppleCamInUserClient *, _QWORD))(*(_QWORD *)v1 + 1536LL))(v1, 0LL);
  return 0LL;
}

//----- (000000000000CAAE) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::ISP_DeviceClose(AppleCamInUserClient *this)
{
  __int64 result; // rax@1

  result = 3758097122LL;
  if ( *((_BYTE *)this + 225) == 1 )
  {
    *((_BYTE *)this + 225) = 0;
    result = 0LL;
  }
  return result;
}

//----- (000000000000CACE) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::registerNotificationPort(__int64 a1, __int64 a2, __int64 a3, int a4)
{
  *(_QWORD *)(a1 + 248) = a2;
  *(_DWORD *)(a1 + 256) = a4;
  return 0LL;
}

//----- (000000000000CAE4) ----------------------------------------------------
int AppleCamInUserClient::externalMethod()
{
  return (*(int (**)(void))(off_12030[0] + 2144))();
}
// 12030: using guessed type __int64 off_12030[6];

//----- (000000000000CB14) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::ISP_DeviceOpen(AppleCamInUserClient *this)
{
  if ( !*((_BYTE *)this + 225) )
  {
    *((_BYTE *)this + 225) = 1;
  }
  return 0LL;
}

//----- (000000000000CB2C) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::ISP_ReadISPRegister(AppleCamInUserClient *this, __int64 a2, unsigned int *a3)
{
  return 3758097122LL;
}

//----- (000000000000CB38) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::ISP_WriteISPRegister(AppleCamInUserClient *this)
{
  return 3758097122LL;
}

//----- (000000000000CB44) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::ISP_IsPowered(AppleCamInUserClient *this, unsigned int *a2)
{
  *a2 = *(_BYTE *)(*((_QWORD *)this + 27) + 656LL);
  return 0LL;
}

//----- (000000000000CB5C) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::ISP_ResetParams(AppleCamInUserClient *this)
{
  return 3758097095LL;
}

//----- (000000000000CB68) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_GetModuleParams(__int64 a1, __int64 a2)
{
  return AppleCamIn::ISP_GetModuleParams(*(_QWORD *)(a1 + 216), a2);
}

//----- (000000000000CB7A) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_GetSensorConfigInfo(__int64 a1, unsigned int a2, unsigned int a3, __int64 a4)
{
  return AppleCamIn::ISP_GetSensorConfigInfo(*(_QWORD *)(a1 + 216), a2, a3, a4);
}

//----- (000000000000CB8C) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_GetDDRParams(__int64 a1, __int64 a2)
{
  return AppleCamIn::ISP_GetDDRParams(*(_QWORD *)(a1 + 216), a2);
}

//----- (000000000000CB9E) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_LoadFirmware(AppleCamInUserClient *this, void *a2, unsigned int a3, unsigned int a4)
{
  return AppleCamIn::ISP_LoadFirmware(*((AppleCamIn **)this + 27), a2, a3, a4, *((task **)this + 29));
}

//----- (000000000000CBBA) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_ForgetFirmware(AppleCamInUserClient *this)
{
  return AppleCamIn::ISP_ForgetFirmware(*((AppleCamIn **)this + 27));
}

//----- (000000000000CBCC) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_LoadSetfile(AppleCamInUserClient *this, void *a2, unsigned int a3, unsigned int a4)
{
  return AppleCamIn::ISP_LoadSetfile(*((AppleCamIn **)this + 27), a2, a3, *((task **)this + 29), a4);
}

//----- (000000000000CBEA) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_SendCommand(AppleCamInUserClient *this, unsigned __int8 *a2, int a3, int a4, int a5)
{
  return AppleCamIn::ISP_SendCommand(*((AppleCamIn **)this + 27), a2, a3, a4, a5, *((task **)this + 29));
}

//----- (000000000000CC06) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::sendAsyncResult64(AppleCamInUserClient *this, unsigned __int64 *a2, int a3, unsigned __int64 *a4, unsigned int a5)
{
  return IOUserClient::sendAsyncResult64(this, a2, a3, a4, a5);
}

//----- (000000000000CC10) ----------------------------------------------------
int AppleCamInUserClient::setAsyncReference64()
{
  return IOUserClient::setAsyncReference64();
}
// B6470: using guessed type int IOUserClient::setAsyncReference64(void);

//----- (000000000000CC1A) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_SendBuffers(__int64 a1, __int64 a2, __int64 a3, __int64 a4, __int64 a5)
{
  __int64 v5; // rcx@1
  unsigned __int64 v6; // rdx@1
  int result; // eax@2

  v5 = a3;
  v6 = (unsigned __int128)(0x0CCCCCCCCCCCCCCCDLL * a3) >> 64;
  if ( 5 * ((v6 >> 2) & 0x7FFFFFFF8LL) == v5 )
  {
    result = AppleCamIn::ISP_SendBuffers(*(_QWORD *)(a1 + 216), a2, v6 >> 5, a1, a5);
  }
  else
  {
    result = -536870206;
  }
  return result;
}

//----- (000000000000CC6C) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_PowerOnCamera(AppleCamInUserClient *this, unsigned int a2)
{
  return AppleCamIn::ISP_PowerOnCamera(*((AppleCamIn **)this + 27), a2, (void *)this);
}

//----- (000000000000CC84) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_PowerOffCamera(AppleCamInUserClient *this, unsigned int a2)
{
  return AppleCamIn::ISP_PowerOffCamera(*((AppleCamIn **)this + 27), a2, (void *)this);
}

//----- (000000000000CC9C) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::abort_captures(AppleCamInUserClient *this)
{
  return 3758097095LL;
}

//----- (000000000000CCA8) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_GetCameraTime(__int64 a1, __int64 a2)
{
  return AppleCamIn::ISP_GetCameraTime(*(_QWORD *)(a1 + 216), a2);
}

//----- (000000000000CCBA) ----------------------------------------------------
signed __int64 AppleCamInUserClient::ISP_GetCameraStatus()
{
  return 3758097095LL;
}

//----- (000000000000CCC6) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_SetDriverLoggingFlags(AppleCamInUserClient *this, unsigned int a2)
{
  return AppleCamIn::ISP_SetDriverLoggingFlags(*((AppleCamIn **)this + 27), a2);
}

//----- (000000000000CCD8) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_GetDriverLoggingFlags(AppleCamInUserClient *this, unsigned int *a2)
{
  return AppleCamIn::ISP_GetDriverLoggingFlags(*((AppleCamIn **)this + 27), a2);
}

//----- (000000000000CCEA) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_ShowSharedMemoryAllocations(AppleCamInUserClient *this)
{
  return AppleCamIn::ISP_ShowSharedMemoryAllocations(*((AppleCamIn **)this + 27));
}

//----- (000000000000CCFC) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_ProcessRawImagePrepare(__int64 a1, __int64 a2)
{
  return AppleCamIn::ISP_ProcessRawImagePrepare(*(_QWORD *)(a1 + 216), a2);
}

//----- (000000000000CD0E) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_ProcessRawImageGo(AppleCamInUserClient *this)
{
  return AppleCamIn::ISP_ProcessRawImageGo(*((AppleCamIn **)this + 27));
}

//----- (000000000000CD20) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_GetSetfileSurfaceID(AppleCamInUserClient *this, unsigned int a2, unsigned int *a3)
{
  return AppleCamIn::ISP_GetSetfileSurfaceID(*((AppleCamIn **)this + 27), a2, a3);
}

//----- (000000000000CD32) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_GetFirmwareLoggingSurfaceID(AppleCamInUserClient *this, unsigned int *a2)
{
  return AppleCamIn::ISP_GetFirmwareLoggingSurfaceID(*((AppleCamIn **)this + 27), a2);
}

//----- (000000000000CD44) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::ISP_LoadFullResLensShadingTable(AppleCamInUserClient *this, void *a2)
{
  return 3758097095LL;
}

//----- (000000000000CD50) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_EnableSensorPower(AppleCamInUserClient *this, unsigned int a2, unsigned __int8 a3)
{
  return AppleCamIn::ISP_EnableSensorPower(*((AppleCamIn **)this + 27), a2, a3);
}

//----- (000000000000CD64) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_SetFullStatsMode(AppleCamInUserClient *this, unsigned int a2)
{
  return AppleCamIn::ISP_SetFullStatsMode(*((AppleCamIn **)this + 27), a2);
}

//----- (000000000000CD76) ----------------------------------------------------
signed __int64 AppleCamInUserClient::ISP_DetectFaces()
{
  return 3758097095LL;
}

//----- (000000000000CD82) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::ISP_StartPerformanceCounters(AppleCamInUserClient *this)
{
  return 3758097095LL;
}

//----- (000000000000CD8E) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::ISP_ReadPerformanceCounters(AppleCamInUserClient *this, unsigned int *a2, unsigned int *a3, unsigned int *a4, unsigned int *a5)
{
  return 3758097095LL;
}

//----- (000000000000CD9A) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::ISP_StopPerformanceCounters(AppleCamInUserClient *this)
{
  return 3758097095LL;
}

//----- (000000000000CDA6) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::ISP_ReadS2Register(AppleCamInUserClient *this, __int64 a2, unsigned int *a3)
{
  return 3758097122LL;
}

//----- (000000000000CDB2) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::ISP_WriteS2Register(AppleCamInUserClient *this)
{
  return 3758097122LL;
}

//----- (000000000000CDBE) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_SetISPCPUCommandTimeout(AppleCamInUserClient *this, unsigned int a2)
{
  return AppleCamIn::ISP_SetISPCPUCommandTimeout(*((AppleCamIn **)this + 27), a2);
}

//----- (000000000000CDD0) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::ISP_ReadS2Memory(AppleCamInUserClient *this, __int64 a2, unsigned int *a3)
{
  return 3758097122LL;
}

//----- (000000000000CDDC) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::ISP_WriteS2Memory(AppleCamInUserClient *this)
{
  return 3758097122LL;
}

//----- (000000000000CDE8) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::ISP_ReadS2MemoryBlock(AppleCamInUserClient *this, void *a2)
{
  return 3758097122LL;
}

//----- (000000000000CDF4) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::ISP_WriteS2MemoryBlock(AppleCamInUserClient *this, void *a2)
{
  return 3758097122LL;
}

//----- (000000000000CE00) ----------------------------------------------------
int __fastcall AppleCamInUserClient::ISP_SetRequiredMaxBusStall(AppleCamInUserClient *this, unsigned int a2)
{
  return AppleCamIn::ISP_SetRequiredMaxBusStall(*((AppleCamIn **)this + 27), a2);
}

//----- (000000000000CE12) ----------------------------------------------------
__int64 __fastcall AppleCamInUserClient::MetaClass::~MetaClass(AppleCamInUserClient::MetaClass *this)
{
  return OSMetaClass::~OSMetaClass(this);
}

//----- (000000000000CE20) ----------------------------------------------------
__int64 `global constructor keyed to'_a_0()
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(&AppleCamInUserClient::gMetaClass, "AppleCamInUserClient", off_12018[0], 264LL);
  result = (__int64)off_13390;
  AppleCamInUserClient::gMetaClass = off_13390;
  return result;
}
// 12018: using guessed type _QWORD off_12018[9];
// 13390: using guessed type __int64 (__fastcall *off_13390[2])(AppleCamInUserClient::MetaClass *__hidden this);
// A64B0: using guessed type _QWORD AppleCamInUserClient::gMetaClass;
// B6418: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (000000000000CE60) ----------------------------------------------------
__int64 `global destructor keyed to'_a_0()
{
  return OSMetaClass::~OSMetaClass((OSMetaClass *)&AppleCamInUserClient::gMetaClass);
}
// A64B0: using guessed type _QWORD AppleCamInUserClient::gMetaClass;

//----- (000000000000CE71) ----------------------------------------------------
__int64 __fastcall IOProcessorInit(__int64 a1, __int64 a2, __int64 a3, __int64 a4, __int64 a5, __int64 a6, __int64 a7)
{
  __int64 result; // rax@1

  result = a7;
  IOP_0 = (int (__fastcall *)(_QWORD, _QWORD))a1;
  IOP_1 = (int (*)(void))a2;
  IOP_4 = (int (__fastcall *)(_QWORD))a3;
  IOP_5 = (int (__fastcall *)(_QWORD))a4;
  IOP_6 = a5;
  IOP_2 = (int (__fastcall *)(_QWORD, _QWORD))a6;
  IOP_3 = (int (__fastcall *)(_QWORD, _QWORD))a7;
  return result;
}
// A6450: using guessed type int (__fastcall *IOP_0)(_QWORD, _QWORD);
// A6458: using guessed type int (*IOP_1)(void);
// A6460: using guessed type int (__fastcall *IOP_2)(_QWORD, _QWORD);
// A6468: using guessed type int (__fastcall *IOP_3)(_QWORD, _QWORD);
// A6470: using guessed type int (__fastcall *IOP_4)(_QWORD);
// A6478: using guessed type int (__fastcall *IOP_5)(_QWORD);

//----- (000000000000CEAC) ----------------------------------------------------
__int64 __fastcall IOProcessorChannelCreate(int a1, __int64 a2, int a3, __int64 a4, __int64 a5)
{
  __int64 v5; // rbx@1
  int v6; // er15@1
  __int64 v7; // r13@1
  int v8; // er12@1
  __int64 v9; // rax@1
  __int64 v10; // r14@1
  int v11; // ebx@4
  signed __int64 v12; // rax@9
  __int64 v14; // [sp+0h] [bp-30h]@1

  v14 = a5;
  v5 = a4;
  v6 = a3;
  v7 = a2;
  v8 = a1;
  LODWORD(v9) = IOP_0(1LL, 48LL);
  v10 = v9;
  if ( v9 )
  {
    *(_QWORD *)v9 = v5;
    *(_QWORD *)(v9 + 8) = v14;
    *(_DWORD *)(v9 + 16) = a1;
    *(_DWORD *)(v9 + 20) = v6;
    *(_QWORD *)(v9 + 24) = a2;
    *(_QWORD *)(v9 + 40) = 0LL;
    if ( a1 & 1 )
    {
      if ( v6 > 0 )
      {
        v11 = 0;
        while ( 1 )
        {
          *(_DWORD *)v7 = v8;
          *(_DWORD *)(v7 + 4) = 0;
          *(_DWORD *)(v7 + 8) = 0;
          if ( IOP_2 )
          {
            IOP_2(v7, 64LL);
            v6 = *(_DWORD *)(v10 + 20);
          }
          ++v11;
          if ( v11 >= v6 )
          {
            break;
          }
          v8 = *(_DWORD *)(v10 + 16);
          v7 += 64LL;
        }
      }
      v12 = 0xFFFFFFFFLL;
    }
    else
    {
      v12 = -4294967296LL;
    }
    *(_QWORD *)(v10 + 32) = v12;
  }
  return v10;
}
// A6450: using guessed type int (__fastcall *IOP_0)(_QWORD, _QWORD);
// A6460: using guessed type int (__fastcall *IOP_2)(_QWORD, _QWORD);

//----- (000000000000CF78) ----------------------------------------------------
int IOProcessorChannelDelete()
{
  return IOP_1();
}
// A6458: using guessed type int (*IOP_1)(void);

//----- (000000000000CF83) ----------------------------------------------------
char __fastcall IOProcessorChannelStats(__int64 a1, __int64 a2, __int64 a3, __int64 a4, __int64 a5)
{
  __int64 v5; // r14@1
  __int64 v6; // r15@1
  __int64 v7; // r12@1
  char result; // al@1

  v5 = a5;
  v6 = a4;
  v7 = a3;
  result = 1;
  if ( IOP_4 )
  {
    IOP_4(IOP_6);
    result = IOP_4 == 0LL;
  }
  *(_DWORD *)a2 = *(_DWORD *)(a1 + 44);
  *(_DWORD *)v7 = *(_DWORD *)(a1 + 40);
  *(_DWORD *)v6 = *(_DWORD *)(a1 + 32);
  *(_DWORD *)v5 = *(_DWORD *)(a1 + 36);
  if ( !result )
  {
    result = IOP_5(IOP_6);
  }
  return result;
}
// A6470: using guessed type int (__fastcall *IOP_4)(_QWORD);
// A6478: using guessed type int (__fastcall *IOP_5)(_QWORD);

//----- (000000000000D00A) ----------------------------------------------------
__int64 __fastcall IOProcessorChannelMessageAvailable(__int64 a1)
{
  __int64 v1; // r15@3
  int v2; // ebx@3
  __int64 v3; // r15@4

  if ( IOP_4 )
  {
    IOP_4(IOP_6);
  }
  v1 = *(_DWORD *)(a1 + 32);
  v2 = 0;
  if ( v1 != -1 )
  {
    v3 = *(_QWORD *)(a1 + 24) + (v1 << 6);
    if ( IOP_3 )
    {
      IOP_3(v3, 64LL);
    }
    v2 = ~(*(_BYTE *)(a1 + 16) ^ *(_BYTE *)v3) & 1;
  }
  if ( IOP_4 )
  {
    IOP_5(IOP_6);
  }
  return (unsigned int)v2;
}
// A6468: using guessed type int (__fastcall *IOP_3)(_QWORD, _QWORD);
// A6470: using guessed type int (__fastcall *IOP_4)(_QWORD);
// A6478: using guessed type int (__fastcall *IOP_5)(_QWORD);

//----- (000000000000D086) ----------------------------------------------------
__int64 __fastcall IOProcessorChannelSend(__int64 a1, int a2, int a3, int a4)
{
  int v4; // er15@1
  int v5; // er12@1
  __int64 v6; // rbx@1
  __int64 v7; // rax@3
  __int64 v8; // rdi@4
  __int64 v9; // rax@4
  int v10; // eax@6
  int v11; // ecx@6
  int v12; // esi@8
  signed int v13; // er14@8
  bool v14; // zf@10
  signed int v15; // eax@10
  signed int v16; // er15@12

  v4 = a4;
  v5 = a3;
  v6 = a1;
  if ( IOP_4 )
  {
    IOP_4(IOP_6);
  }
  v7 = *(_DWORD *)(a1 + 36);
  if ( v7 == -1 )
  {
    v13 = -1;
    v16 = 0;
  }
  else
  {
    v8 = *(_QWORD *)(a1 + 24);
    v9 = v7 << 6;
    *(_DWORD *)(v8 + v9 + 4) = v5;
    *(_DWORD *)(v8 + v9 + 8) = v4;
    *(_DWORD *)(v8 + v9) = a2 | *(_DWORD *)(v6 + 16) ^ 1;
    if ( IOP_2 )
    {
      IOP_2(v9 + v8, 64LL);
    }
    v10 = *(_DWORD *)(v6 + 32);
    v11 = *(_DWORD *)(v6 + 36);
    if ( v10 == -1 )
    {
      *(_DWORD *)(v6 + 32) = v11;
      v10 = v11;
    }
    v12 = v11 + 1;
    v13 = 0;
    if ( v11 == *(_DWORD *)(v6 + 20) - 1 )
    {
      v12 = 0;
    }
    v14 = v10 == v12;
    v15 = -1;
    if ( !v14 )
    {
      v15 = v12;
    }
    *(_DWORD *)(v6 + 36) = v15;
    ++*(_DWORD *)(v6 + 44);
    v16 = 1;
  }
  if ( IOP_4 )
  {
    IOP_5(IOP_6);
  }
  if ( v16 )
  {
    (*(void (__fastcall **)(_QWORD))v6)(*(_QWORD *)(v6 + 8));
  }
  return (unsigned int)v13;
}
// A6460: using guessed type int (__fastcall *IOP_2)(_QWORD, _QWORD);
// A6470: using guessed type int (__fastcall *IOP_4)(_QWORD);
// A6478: using guessed type int (__fastcall *IOP_5)(_QWORD);

//----- (000000000000D160) ----------------------------------------------------
__int64 __fastcall IOProcessorChannelReceive(__int64 a1, __int64 a2, __int64 a3, __int64 a4)
{
  __int64 v4; // r15@1
  __int64 v5; // r13@1
  __int64 v6; // r12@3
  signed int v7; // er14@3
  __int64 v8; // r13@4
  __int64 v9; // r12@4
  __int64 v10; // r15@4
  int v11; // eax@7
  int v12; // ecx@7
  int v13; // esi@9
  signed int v14; // eax@11
  __int64 v16; // [sp+0h] [bp-40h]@4
  __int64 v17; // [sp+8h] [bp-38h]@4

  v4 = a4;
  v5 = a3;
  if ( IOP_4 )
  {
    IOP_4(IOP_6);
  }
  v6 = *(_DWORD *)(a1 + 32);
  v7 = -1;
  if ( v6 != -1 )
  {
    v16 = v5;
    v17 = v4;
    v8 = *(_QWORD *)(a1 + 24);
    v9 = v6 << 6;
    v10 = v8 + v9;
    if ( IOP_3 )
    {
      IOP_3(v8 + v9, 64LL);
    }
    if ( !((*(_BYTE *)(a1 + 16) ^ *(_BYTE *)v10) & 1) )
    {
      *(_DWORD *)a2 = *(_DWORD *)v10 & 0xFFFFFFFC;
      *(_DWORD *)v16 = *(_DWORD *)(v8 + v9 + 4);
      *(_DWORD *)v17 = *(_DWORD *)(v8 + v9 + 8);
      v11 = *(_DWORD *)(a1 + 32);
      v12 = *(_DWORD *)(a1 + 36);
      if ( v12 == -1 )
      {
        *(_DWORD *)(a1 + 36) = v11;
        v12 = v11;
      }
      v13 = v11 + 1;
      v7 = 0;
      if ( v11 == *(_DWORD *)(a1 + 20) - 1 )
      {
        v13 = 0;
      }
      v14 = -1;
      if ( v12 != v13 )
      {
        v14 = v13;
      }
      *(_DWORD *)(a1 + 32) = v14;
      ++*(_DWORD *)(a1 + 40);
    }
  }
  if ( IOP_4 )
  {
    IOP_5(IOP_6);
  }
  return (unsigned int)v7;
}
// A6468: using guessed type int (__fastcall *IOP_3)(_QWORD, _QWORD);
// A6470: using guessed type int (__fastcall *IOP_4)(_QWORD);
// A6478: using guessed type int (__fastcall *IOP_5)(_QWORD);

//----- (000000000000D258) ----------------------------------------------------
__int64 __fastcall IOProcessorChannelUnidirectionalSend(__int64 a1, signed __int64 a2, int a3, int a4)
{
  int v4; // er12@1
  __int64 v5; // r14@3
  signed __int64 v6; // r15@3
  signed __int64 v7; // r13@3
  signed int v8; // er15@6
  signed int v9; // er14@6
  int v10; // ecx@9
  int v11; // edx@9
  int v13; // [sp+0h] [bp-30h]@1
  int v14; // [sp+4h] [bp-2Ch]@1

  v13 = a4;
  v4 = a3;
  v14 = a2;
  if ( IOP_4 )
  {
    IOP_4(IOP_6);
  }
  v5 = *(_QWORD *)(a1 + 24);
  v6 = (signed __int64)*(_DWORD *)(a1 + 36) << 6;
  v7 = v5 + v6;
  if ( IOP_3 )
  {
    a2 = 64LL;
    IOP_3(v5 + v6, 64LL);
  }
  if ( (*(_BYTE *)(a1 + 16) ^ *(_BYTE *)v7) & 1 )
  {
    v8 = 0;
    v9 = -1;
  }
  else
  {
    *(_DWORD *)(v5 + v6 + 4) = v4;
    *(_DWORD *)(v5 + v6 + 8) = v13;
    *(_DWORD *)v7 = v14 | *(_DWORD *)(a1 + 16) ^ 1;
    if ( IOP_2 )
    {
      a2 = 64LL;
      IOP_2(v5 + v6, 64LL);
    }
    v10 = *(_DWORD *)(a1 + 36);
    v11 = v10 + 1;
    v9 = 0;
    if ( v10 == *(_DWORD *)(a1 + 20) - 1 )
    {
      v11 = 0;
    }
    *(_DWORD *)(a1 + 36) = v11;
    ++*(_DWORD *)(a1 + 44);
    v8 = 1;
  }
  if ( IOP_4 )
  {
    IOP_5(IOP_6);
  }
  if ( v8 )
  {
    (*(void (__fastcall **)(_QWORD, signed __int64))a1)(*(_QWORD *)(a1 + 8), a2);
  }
  return (unsigned int)v9;
}
// A6460: using guessed type int (__fastcall *IOP_2)(_QWORD, _QWORD);
// A6468: using guessed type int (__fastcall *IOP_3)(_QWORD, _QWORD);
// A6470: using guessed type int (__fastcall *IOP_4)(_QWORD);
// A6478: using guessed type int (__fastcall *IOP_5)(_QWORD);

//----- (000000000000D347) ----------------------------------------------------
__int64 __fastcall IOProcessorChannelUnidirectionalReceive(__int64 a1, __int64 a2, __int64 a3, __int64 a4)
{
  __int64 v4; // r15@3
  signed __int64 v5; // r13@3
  signed __int64 v6; // r12@3
  signed int v7; // er14@5
  int v8; // ecx@8
  int v9; // edx@8
  __int64 v11; // [sp+8h] [bp-38h]@1
  __int64 v12; // [sp+10h] [bp-30h]@1

  v12 = a4;
  v11 = a3;
  if ( IOP_4 )
  {
    IOP_4(IOP_6);
  }
  v4 = *(_QWORD *)(a1 + 24);
  v5 = (signed __int64)*(_DWORD *)(a1 + 32) << 6;
  v6 = v4 + v5;
  if ( IOP_3 )
  {
    IOP_3(v4 + v5, 64LL);
  }
  v7 = -1;
  if ( !((*(_BYTE *)(a1 + 16) ^ *(_BYTE *)v6) & 1) )
  {
    *(_DWORD *)a2 = *(_DWORD *)v6 & 0xFFFFFFFC;
    *(_DWORD *)v11 = *(_DWORD *)(v4 + v5 + 4);
    *(_DWORD *)v12 = *(_DWORD *)(v4 + v5 + 8);
    *(_DWORD *)v6 = *(_DWORD *)(a1 + 16) ^ 1;
    if ( IOP_2 )
    {
      IOP_2(v4 + v5, 64LL);
    }
    v8 = *(_DWORD *)(a1 + 32);
    v9 = v8 + 1;
    v7 = 0;
    if ( v8 == *(_DWORD *)(a1 + 20) - 1 )
    {
      v9 = 0;
    }
    *(_DWORD *)(a1 + 32) = v9;
    ++*(_DWORD *)(a1 + 40);
  }
  if ( IOP_4 )
  {
    IOP_5(IOP_6);
  }
  return (unsigned int)v7;
}
// A6460: using guessed type int (__fastcall *IOP_2)(_QWORD, _QWORD);
// A6468: using guessed type int (__fastcall *IOP_3)(_QWORD, _QWORD);
// A6470: using guessed type int (__fastcall *IOP_4)(_QWORD);
// A6478: using guessed type int (__fastcall *IOP_5)(_QWORD);

//----- (000000000000D43A) ----------------------------------------------------
__int64 __fastcall IOMMUManager::IOMMUManager(__int64 a1, int a2, int a3)
{
  __int64 result; // rax@1

  *(_DWORD *)(a1 + 8) = a2;
  *(_DWORD *)(a1 + 12) = a3;
  result = operator new(0x20uLL);
  if ( result )
  {
    *(_QWORD *)result = 0LL;
    *(_QWORD *)(result + 8) = 0LL;
    *(_BYTE *)(result + 16) = 1;
    *(_DWORD *)(result + 24) = a2;
    *(_DWORD *)(result + 20) = 0;
    *(_QWORD *)a1 = result;
  }
  else
  {
    *(_QWORD *)a1 = 0LL;
  }
  return result;
}

//----- (000000000000D48C) ----------------------------------------------------
__int64 __fastcall IOMMUManager::IOMMUManager(IOMMUManager *this, int a2, int a3)
{
  return IOMMUManager::IOMMUManager((__int64)this, a2, a3);
}

//----- (000000000000D496) ----------------------------------------------------
void __fastcall IOMMUManager::~IOMMUManager(IOMMUManager *this)
{
  IOMMUManager *v1; // rbx@1
  void *v2; // rdi@3

  v1 = this;
  while ( 1 )
  {
    v2 = *(void **)v1;
    if ( !*(_QWORD *)v1 )
    {
      break;
    }
    *(_QWORD *)v1 = *(_QWORD *)v2;
    operator delete(v2);
  }
}

//----- (000000000000D4BC) ----------------------------------------------------
void __fastcall IOMMUManager::~IOMMUManager(IOMMUManager *this)
{
  IOMMUManager *v1; // rbx@1
  void *v2; // rdi@3

  v1 = this;
  while ( 1 )
  {
    v2 = *(void **)v1;
    if ( !*(_QWORD *)v1 )
    {
      break;
    }
    *(_QWORD *)v1 = *(_QWORD *)v2;
    operator delete(v2);
  }
}

//----- (000000000000D4E2) ----------------------------------------------------
__int64 __fastcall IOMMUManager::Allocate(IOMMUManager *this, unsigned int a2)
{
  signed int v2; // er15@1
  __int64 v3; // rbx@2
  __int64 v4; // rax@8
  __int64 v5; // rcx@10

  v2 = -1;
  if ( a2 )
  {
    v3 = *(_QWORD *)this;
    v2 = -1;
    while ( v3 )
    {
      if ( *(_BYTE *)(v3 + 16) )
      {
        if ( *(_DWORD *)(v3 + 24) == a2 )
        {
          *(_BYTE *)(v3 + 16) = 0;
          v2 = *(_DWORD *)(v3 + 20);
          break;
        }
        if ( *(_DWORD *)(v3 + 24) > a2 )
        {
          v4 = operator new(0x20uLL);
          if ( v4 )
          {
            *(_BYTE *)(v4 + 16) = 0;
            *(_DWORD *)(v4 + 24) = a2;
            *(_DWORD *)(v4 + 20) = *(_DWORD *)(v3 + 20);
            *(_DWORD *)(v3 + 24) -= a2;
            *(_DWORD *)(v3 + 20) += a2;
            if ( *(_QWORD *)this == v3 )
            {
              *(_QWORD *)this = v4;
              v5 = *(_QWORD *)(v3 + 8);
            }
            else
            {
              v5 = *(_QWORD *)(v3 + 8);
              *(_QWORD *)v5 = v4;
            }
            *(_QWORD *)v4 = v3;
            *(_QWORD *)(v4 + 8) = v5;
            *(_QWORD *)(v3 + 8) = v4;
            v2 = *(_DWORD *)(v4 + 20);
          }
          break;
        }
      }
      v3 = *(_QWORD *)v3;
    }
    if ( *((_DWORD *)this + 3) )
    {
      IOMMUManager::DebugPrint(this);
    }
  }
  return (unsigned int)v2;
}

//----- (000000000000D592) ----------------------------------------------------
int __fastcall IOMMUManager::DebugPrint(IOMMUManager *this)
{
  __int64 v1; // rbx@1
  unsigned int v2; // er12@1
  signed int v3; // er14@1
  unsigned int v4; // er13@1
  unsigned int v5; // er15@1
  char v6; // al@3
  unsigned int v7; // edx@3
  int v8; // edi@10
  __int64 v9; // rax@14
  __int64 v11; // [sp+0h] [bp-50h]@0
  __int64 v12; // [sp+8h] [bp-48h]@0
  IOMMUManager *v13; // [sp+10h] [bp-40h]@1
  unsigned int v14; // [sp+1Ch] [bp-34h]@1
  unsigned int v15; // [sp+20h] [bp-30h]@1
  unsigned int v16; // [sp+24h] [bp-2Ch]@1

  v13 = this;
  v1 = *(_QWORD *)this;
  v2 = 0;
  printf("\nIOMMUManager::DebugPrint Begin\n");
  v3 = -1;
  v16 = 0;
  v15 = 0;
  v4 = 0;
  v14 = 0;
  v5 = 0;
  if ( v1 )
  {
    v3 = -1;
    v2 = 0;
    v16 = 0;
    v15 = 0;
    v4 = 0;
    v14 = 0;
    v5 = 0;
    while ( 1 )
    {
      printf(
        "%d (%p): isFree=%d startIndex=%d count=%d pPrev=%p pNext=%p\n",
        v5,
        v1,
        *(_BYTE *)(v1 + 16),
        *(_DWORD *)(v1 + 20),
        *(_DWORD *)(v1 + 24),
        *(_QWORD *)(v1 + 8),
        *(_QWORD *)v1);
      v6 = *(_BYTE *)(v1 + 16);
      v7 = *(_DWORD *)(v1 + 24);
      if ( v6 )
      {
        v16 += v7;
        ++v4;
      }
      else
      {
        v15 += v7;
        ++v14;
      }
      if ( v7 > v2 )
      {
        v2 = *(_DWORD *)(v1 + 24);
      }
      if ( v7 < v3 )
      {
        v3 = *(_DWORD *)(v1 + 24);
      }
      v8 = *(_DWORD *)(v1 + 20) + v7;
      if ( !*(_QWORD *)v1 )
      {
        break;
      }
      if ( v8 != *(_DWORD *)(*(_QWORD *)v1 + 20LL) )
      {
        printf("\nIOMMU SEGMENT LIST INCONSISTENCY: segment-start=%d count=%d next-segment-start=%d\n");
        v6 = *(_BYTE *)(v1 + 16);
      }
      if ( !v6 )
      {
        goto LABEL_18;
      }
      v9 = *(_QWORD *)v1;
      if ( *(_BYTE *)(*(_QWORD *)v1 + 16LL) )
      {
        printf("\nIOMMU SEGMENT LIST INCONSISTENCY: Current and Next segments are both free (should have been coalesced)\n");
LABEL_18:
        v9 = *(_QWORD *)v1;
      }
      ++v5;
      v1 = v9;
      if ( !v9 )
      {
        goto LABEL_20;
      }
    }
    if ( v8 != *((_DWORD *)v13 + 2) )
    {
      printf("\nIOMMU SEGMENT LIST INCONSISTENCY: last-segment-start=%d count=%d initialCount=%d\n");
    }
    goto LABEL_18;
  }
LABEL_20:
  LODWORD(v12) = v2;
  LODWORD(v11) = v3;
  printf(
    "segments=%d allocatedSegmentsCount=%d freeSegmentsCount=%d allocatedBlocksCount=%d freeBlocksCount=%d minBlocksCount=%d maxBlocksCount=%d\n",
    v5,
    v14,
    v4,
    v15,
    v16,
    v11,
    v12);
  return printf("IOMMUManager::DebugPrint End\n\n");
}

//----- (000000000000D71A) ----------------------------------------------------
__int64 __fastcall IOMMUManager::Free(IOMMUManager *this, int a2)
{
  void *v2; // rbx@1
  signed int v3; // er14@1
  __int64 v4; // rax@7
  __int64 v5; // rcx@7
  void *v6; // rcx@9
  int v7; // edx@11
  void *v8; // rdi@11
  __int64 v9; // rcx@11
  void *v10; // rax@19
  __int64 v11; // rcx@21

  v2 = *(void **)this;
  v3 = -1;
  while ( v2 )
  {
    if ( *((_DWORD *)v2 + 5) == a2 )
    {
      *((_BYTE *)v2 + 16) = 1;
      v4 = *((_QWORD *)v2 + 1);
      v3 = 0;
      v5 = 0LL;
      if ( v4 )
      {
        if ( *(_BYTE *)(v4 + 16) )
        {
          v6 = *(void **)v2;
          if ( *(_QWORD *)v2 && *((_BYTE *)v6 + 16) )
          {
            v7 = *((_DWORD *)v2 + 6) + *(_DWORD *)(v4 + 24);
            *(_DWORD *)(v4 + 24) = v7;
            *(_DWORD *)(v4 + 24) = *((_DWORD *)v6 + 6) + v7;
            *(_QWORD *)v4 = *(_QWORD *)v6;
            v8 = *(void **)v2;
            v9 = **(_QWORD **)v2;
            if ( v9 )
            {
              *(_QWORD *)(v9 + 8) = v4;
            }
            if ( v8 )
            {
              operator delete(v8);
            }
          }
          else
          {
            *(_DWORD *)(v4 + 24) += *((_DWORD *)v2 + 6);
            *(_QWORD *)v4 = *(_QWORD *)v2;
            if ( *(_QWORD *)v2 )
            {
              *(_QWORD *)(*(_QWORD *)v2 + 8LL) = v4;
            }
          }
          operator delete(v2);
          v3 = 0;
          return (unsigned int)v3;
        }
        v5 = *((_QWORD *)v2 + 1);
      }
      v10 = *(void **)v2;
      if ( *(_QWORD *)v2 && *((_BYTE *)v10 + 16) )
      {
        *((_DWORD *)v10 + 5) = a2;
        *((_DWORD *)v10 + 6) += *((_DWORD *)v2 + 6);
        *((_QWORD *)v10 + 1) = v5;
        v11 = *((_QWORD *)v2 + 1);
        if ( v11 )
        {
          *(_QWORD *)v11 = v10;
        }
        else
        {
          *(_QWORD *)this = v10;
        }
        operator delete(v2);
      }
      return (unsigned int)v3;
    }
    if ( *((_DWORD *)this + 3) )
    {
      IOMMUManager::DebugPrint(this);
    }
    v2 = *(void **)v2;
  }
  return (unsigned int)v3;
}

//----- (000000000000D81C) ----------------------------------------------------
__int64 __fastcall DeviceMemoryManager::DeviceMemoryManager(__int64 a1, int a2, int a3)
{
  __int64 result; // rax@1

  *(_DWORD *)(a1 + 8) = a2;
  *(_DWORD *)(a1 + 12) = a3;
  result = operator new(0x20uLL);
  if ( result )
  {
    *(_QWORD *)result = 0LL;
    *(_QWORD *)(result + 8) = 0LL;
    *(_BYTE *)(result + 16) = 1;
    *(_DWORD *)(result + 24) = a2;
    *(_DWORD *)(result + 20) = 0;
    *(_QWORD *)a1 = result;
  }
  else
  {
    *(_QWORD *)a1 = 0LL;
  }
  return result;
}

//----- (000000000000D86E) ----------------------------------------------------
__int64 __fastcall DeviceMemoryManager::DeviceMemoryManager(DeviceMemoryManager *this, int a2, int a3)
{
  return DeviceMemoryManager::DeviceMemoryManager((__int64)this, a2, a3);
}

//----- (000000000000D878) ----------------------------------------------------
void __fastcall DeviceMemoryManager::~DeviceMemoryManager(DeviceMemoryManager *this)
{
  DeviceMemoryManager *v1; // rbx@1
  void *v2; // rdi@3

  v1 = this;
  while ( 1 )
  {
    v2 = *(void **)v1;
    if ( !*(_QWORD *)v1 )
    {
      break;
    }
    *(_QWORD *)v1 = *(_QWORD *)v2;
    operator delete(v2);
  }
}

//----- (000000000000D89E) ----------------------------------------------------
void __fastcall DeviceMemoryManager::~DeviceMemoryManager(DeviceMemoryManager *this)
{
  DeviceMemoryManager *v1; // rbx@1
  void *v2; // rdi@3

  v1 = this;
  while ( 1 )
  {
    v2 = *(void **)v1;
    if ( !*(_QWORD *)v1 )
    {
      break;
    }
    *(_QWORD *)v1 = *(_QWORD *)v2;
    operator delete(v2);
  }
}

//----- (000000000000D8C4) ----------------------------------------------------
__int64 __fastcall DeviceMemoryManager::Allocate(DeviceMemoryManager *this, int a2)
{
  unsigned int v2; // er12@1
  signed int v3; // er15@1
  __int64 v4; // rbx@2
  __int64 v5; // rax@8
  __int64 v6; // rcx@10

  v2 = (a2 + 63) & 0xFFFFFFC0;
  v3 = -1;
  if ( v2 )
  {
    v4 = *(_QWORD *)this;
    v3 = -1;
    while ( v4 )
    {
      if ( *(_BYTE *)(v4 + 16) )
      {
        if ( *(_DWORD *)(v4 + 24) == v2 )
        {
          *(_BYTE *)(v4 + 16) = 0;
          v3 = *(_DWORD *)(v4 + 20);
          break;
        }
        if ( *(_DWORD *)(v4 + 24) > v2 )
        {
          v5 = operator new(0x20uLL);
          if ( v5 )
          {
            *(_BYTE *)(v5 + 16) = 0;
            *(_DWORD *)(v5 + 24) = v2;
            *(_DWORD *)(v5 + 20) = *(_DWORD *)(v4 + 20);
            *(_DWORD *)(v4 + 24) -= v2;
            *(_DWORD *)(v4 + 20) += v2;
            if ( *(_QWORD *)this == v4 )
            {
              *(_QWORD *)this = v5;
              v6 = *(_QWORD *)(v4 + 8);
            }
            else
            {
              v6 = *(_QWORD *)(v4 + 8);
              *(_QWORD *)v6 = v5;
            }
            *(_QWORD *)v5 = v4;
            *(_QWORD *)(v5 + 8) = v6;
            *(_QWORD *)(v4 + 8) = v5;
            v3 = *(_DWORD *)(v5 + 20);
          }
          break;
        }
      }
      v4 = *(_QWORD *)v4;
    }
    if ( *((_DWORD *)this + 3) )
    {
      DeviceMemoryManager::DebugPrint(this);
    }
  }
  return (unsigned int)v3;
}

//----- (000000000000D978) ----------------------------------------------------
int __fastcall DeviceMemoryManager::DebugPrint(DeviceMemoryManager *this)
{
  __int64 v1; // rbx@1
  signed int v2; // er14@2
  unsigned int v3; // er12@2
  int v4; // er13@2
  int v5; // er15@2
  __int64 v6; // rcx@3
  __int64 v7; // r8@3
  __int64 v8; // r9@3
  __int64 v9; // ST08_8@3
  __int64 v10; // ST00_8@3
  char v11; // al@3
  unsigned int v12; // edx@3
  int v13; // edi@10
  __int64 v14; // rax@14
  DeviceMemoryManager *v16; // [sp+10h] [bp-40h]@1
  int v17; // [sp+1Ch] [bp-34h]@2
  int v18; // [sp+20h] [bp-30h]@2
  int v19; // [sp+24h] [bp-2Ch]@2

  v16 = this;
  v1 = *(_QWORD *)this;
  IOLog("\nDeviceMemoryManager::DebugPrint Begin\n");
  if ( v1 )
  {
    v2 = -1;
    v3 = 0;
    v19 = 0;
    v18 = 0;
    v4 = 0;
    v17 = 0;
    v5 = 0;
    while ( 1 )
    {
      v6 = *(_BYTE *)(v1 + 16);
      v7 = *(_DWORD *)(v1 + 20);
      v8 = *(_DWORD *)(v1 + 24);
      v9 = *(_QWORD *)v1;
      v10 = *(_QWORD *)(v1 + 8);
      IOLog("%d (%p): isFree=%d startOffset=%d count=%d pPrev=%p pNext=%p\n");
      v11 = *(_BYTE *)(v1 + 16);
      v12 = *(_DWORD *)(v1 + 24);
      if ( v11 )
      {
        v19 += v12;
        ++v4;
      }
      else
      {
        v18 += v12;
        ++v17;
      }
      if ( v12 > v3 )
      {
        v3 = *(_DWORD *)(v1 + 24);
      }
      if ( v12 < v2 )
      {
        v2 = *(_DWORD *)(v1 + 24);
      }
      v13 = *(_DWORD *)(v1 + 20) + v12;
      if ( !*(_QWORD *)v1 )
      {
        break;
      }
      if ( v13 != *(_DWORD *)(*(_QWORD *)v1 + 20LL) )
      {
        IOLog("\nDeviceMemory SEGMENT LIST INCONSISTENCY: segment-start=%d count=%d next-segment-start=%d\n");
        v11 = *(_BYTE *)(v1 + 16);
      }
      if ( !v11 )
      {
        goto LABEL_18;
      }
      v14 = *(_QWORD *)v1;
      if ( *(_BYTE *)(*(_QWORD *)v1 + 16LL) )
      {
        IOLog("\nDeviceMemory SEGMENT LIST INCONSISTENCY: Current and Next segments are both free (should have been coalesced)\n");
LABEL_18:
        v14 = *(_QWORD *)v1;
      }
      ++v5;
      v1 = v14;
      if ( !v14 )
      {
        goto LABEL_20;
      }
    }
    if ( v13 != *((_DWORD *)v16 + 2) )
    {
      IOLog("\nDeviceMemory SEGMENT LIST INCONSISTENCY: last-segment-start=%d count=%d initialCount=%d\n");
    }
    goto LABEL_18;
  }
LABEL_20:
  IOLog("segments=%d allocatedSegmentsCount=%d freeSegmentsCount=%d allocatedBytesCount=%d freeBytesCount=%d minBytesCount=%d maxBytesCount=%d\n");
  return IOLog("DeviceMemoryManager::DebugPrint End\n\n");
}
// B6390: using guessed type int __fastcall IOLog(_QWORD);

//----- (000000000000DB00) ----------------------------------------------------
__int64 __fastcall DeviceMemoryManager::Free(DeviceMemoryManager *this, int a2)
{
  void *v2; // rbx@1
  signed int v3; // er14@1
  __int64 v4; // rax@7
  __int64 v5; // rcx@7
  void *v6; // rcx@9
  int v7; // edx@11
  void *v8; // rdi@11
  __int64 v9; // rcx@11
  void *v10; // rax@19
  __int64 v11; // rcx@21

  v2 = *(void **)this;
  v3 = -1;
  while ( v2 )
  {
    if ( *((_DWORD *)v2 + 5) == a2 )
    {
      *((_BYTE *)v2 + 16) = 1;
      v4 = *((_QWORD *)v2 + 1);
      v3 = 0;
      v5 = 0LL;
      if ( v4 )
      {
        if ( *(_BYTE *)(v4 + 16) )
        {
          v6 = *(void **)v2;
          if ( *(_QWORD *)v2 && *((_BYTE *)v6 + 16) )
          {
            v7 = *((_DWORD *)v2 + 6) + *(_DWORD *)(v4 + 24);
            *(_DWORD *)(v4 + 24) = v7;
            *(_DWORD *)(v4 + 24) = *((_DWORD *)v6 + 6) + v7;
            *(_QWORD *)v4 = *(_QWORD *)v6;
            v8 = *(void **)v2;
            v9 = **(_QWORD **)v2;
            if ( v9 )
            {
              *(_QWORD *)(v9 + 8) = v4;
            }
            if ( v8 )
            {
              operator delete(v8);
            }
          }
          else
          {
            *(_DWORD *)(v4 + 24) += *((_DWORD *)v2 + 6);
            *(_QWORD *)v4 = *(_QWORD *)v2;
            if ( *(_QWORD *)v2 )
            {
              *(_QWORD *)(*(_QWORD *)v2 + 8LL) = v4;
            }
          }
          operator delete(v2);
          v3 = 0;
          return (unsigned int)v3;
        }
        v5 = *((_QWORD *)v2 + 1);
      }
      v10 = *(void **)v2;
      if ( *(_QWORD *)v2 && *((_BYTE *)v10 + 16) )
      {
        *((_DWORD *)v10 + 5) = a2;
        *((_DWORD *)v10 + 6) += *((_DWORD *)v2 + 6);
        *((_QWORD *)v10 + 1) = v5;
        v11 = *((_QWORD *)v2 + 1);
        if ( v11 )
        {
          *(_QWORD *)v11 = v10;
        }
        else
        {
          *(_QWORD *)this = v10;
        }
        operator delete(v2);
      }
      return (unsigned int)v3;
    }
    if ( *((_DWORD *)this + 3) )
    {
      DeviceMemoryManager::DebugPrint(this);
    }
    v2 = *(void **)v2;
  }
  return (unsigned int)v3;
}

//----- (000000000000DC01) ----------------------------------------------------
__int64 __fastcall tinymt32_init(__int64 a1, int a2)
{
  __int64 v2; // r14@1
  signed int v3; // eax@1
  int v4; // er8@3
  int v5; // er9@3
  __int64 result; // rax@3
  int v7; // er10@3
  int v8; // edx@3
  int v9; // edi@3
  signed int v10; // er11@3
  int v11; // ebx@4
  int v12; // edx@4
  int v13; // ecx@4
  int v14; // esi@4

  v2 = a1;
  *(_DWORD *)a1 = a2;
  *(_DWORD *)(a1 + 4) = *(_DWORD *)(a1 + 16);
  *(_DWORD *)(a1 + 8) = *(_DWORD *)(a1 + 20);
  *(_DWORD *)(a1 + 12) = *(_DWORD *)(a1 + 24);
  v3 = 4;
  do
  {
    *(_DWORD *)(a1 + 4LL * (((_BYTE)v3 - 3) & 3)) ^= v3
                                                   + 1812433253
                                                   * (*(_DWORD *)(a1 + 4LL * (v3 & 3)) ^ (*(_DWORD *)(a1 + 4LL * (v3 & 3)) >> 30))
                                                   - 3;
    ++v3;
  }
  while ( v3 != 11 );
  period_certification(a1);
  v4 = *(_DWORD *)(a1 + 16);
  v5 = *(_DWORD *)(a1 + 20);
  LODWORD(result) = *(_DWORD *)(a1 + 12);
  v7 = *(_DWORD *)a1;
  v8 = *(_DWORD *)(a1 + 4);
  v9 = *(_DWORD *)(a1 + 8);
  v10 = 8;
  do
  {
    v11 = v7;
    v7 = v8;
    v12 = v9 ^ v8 ^ v11 & 0x7FFFFFFF ^ 2 * (v9 ^ v8 ^ v11 & 0x7FFFFFFF);
    result = v12 ^ ((unsigned int)result >> 1) ^ (unsigned int)result;
    v13 = v12 ^ ((_DWORD)result << 10);
    v14 = -(result & 1);
    v8 = v9 ^ v14 & v4;
    v9 = v13 ^ v5 & v14;
    --v10;
  }
  while ( v10 );
  *(_DWORD *)(v2 + 12) = result;
  *(_DWORD *)v2 = v7;
  *(_DWORD *)(v2 + 4) = v8;
  *(_DWORD *)(v2 + 8) = v9;
  return result;
}

//----- (000000000000DCCE) ----------------------------------------------------
signed __int64 __fastcall period_certification(__int64 a1)
{
  signed __int64 result; // rax@4

  if ( !(*(_DWORD *)a1 & 0x7FFFFFFF) && !__PAIR__(*(_DWORD *)(a1 + 8), *(_DWORD *)(a1 + 4)) && !*(_DWORD *)(a1 + 12) )
  {
    *(_QWORD *)a1 = 313532612692LL;
    result = 382252089422LL;
    *(_QWORD *)(a1 + 8) = 382252089422LL;
  }
  return result;
}

//----- (000000000000DD09) ----------------------------------------------------
__int64 __fastcall tinymt32_init_by_array(__int64 a1, __int64 a2, signed int a3)
{
  __int64 v3; // r12@1
  int v4; // er14@1
  int v5; // er9@1
  unsigned int v6; // eax@1
  signed int v7; // er8@1
  unsigned int v8; // ecx@3
  int v9; // er14@3
  int v10; // eax@3
  int v11; // er10@3
  unsigned int v12; // eax@3
  int v13; // er10@5
  signed int v14; // er9@7
  int v15; // er9@9
  int v16; // er9@11
  __int64 v17; // r15@13
  unsigned int v18; // er11@13
  unsigned int v19; // edi@13
  int v20; // edx@13
  int v21; // er14@13
  int v22; // ebx@13
  int v23; // edx@13
  signed int v24; // er14@15
  __int64 v25; // rsi@16
  unsigned int v26; // er9@16
  unsigned int v27; // er11@16
  unsigned int v28; // edi@16
  unsigned int v29; // edx@16
  __int64 v30; // rcx@18
  unsigned int v31; // er8@18
  unsigned int v32; // er9@18
  int v33; // ebx@18
  unsigned int v34; // edi@18
  int v35; // edx@18
  __int64 result; // rax@19
  int v37; // er10@19
  int v38; // edx@19
  int v39; // edi@19
  signed int v40; // er11@19
  int v41; // ebx@20
  int v42; // edx@20
  int v43; // ecx@20
  int v44; // esi@20

  v3 = a1;
  v4 = *(_DWORD *)(a1 + 16);
  v5 = *(_DWORD *)(a1 + 20);
  v6 = *(_DWORD *)(a1 + 24);
  *(_DWORD *)(a1 + 12) = v6;
  v7 = 7;
  if ( a3 > 6 )
  {
    v7 = a3;
  }
  v8 = v4 ^ v6 ^ ((v4 ^ v6) >> 27);
  v9 = 1664525 * v8 + v4;
  *(_DWORD *)(a1 + 4) = v9;
  v10 = a3 + 1664525 * v8;
  *(_DWORD *)(a1 + 8) = v10 + v5;
  *(_DWORD *)a1 = v10;
  v11 = 0;
  v12 = 1;
  if ( v7 > 0 && a3 > 0 )
  {
    v13 = -v7;
    if ( -a3 > (unsigned int)-v7 )
    {
      v13 = -a3;
    }
    v14 = 7;
    if ( a3 > 6 )
    {
      v14 = a3;
    }
    v15 = -v14;
    if ( -a3 > (unsigned int)v15 )
    {
      v15 = -a3;
    }
    v16 = ~v15;
    v12 = 1;
    while ( 1 )
    {
      v17 = (signed int)v12;
      v18 = v12 - ((v12 + ((unsigned int)((signed int)(v12 + 3) >> 31) >> 30) + 3) & 0xFFFFFFFC) + 3;
      v19 = v12 - ((v12 + ((unsigned int)((signed int)(v12 + 2) >> 31) >> 30) + 2) & 0xFFFFFFFC) + 2;
      v12 = v12 - ((v12 + ((unsigned int)((signed int)(v12 + 1) >> 31) >> 30) + 1) & 0xFFFFFFFC) + 1;
      v20 = *(_DWORD *)(v3 + 4LL * (signed int)v12);
      v21 = *(_DWORD *)(v3 + 4LL * (signed int)v18) ^ v20 ^ v9;
      v22 = 1664525 * (v21 ^ ((unsigned int)v21 >> 27));
      *(_DWORD *)(v3 + 4LL * (signed int)v12) = v22 + v20;
      v23 = v22 + v17 + *(_DWORD *)a2;
      *(_DWORD *)(v3 + 4LL * (signed int)v19) += v23;
      *(_DWORD *)(v3 + 4 * v17) = v23;
      if ( !v16 )
      {
        break;
      }
      v9 = *(_DWORD *)(v3 + 4LL * (signed int)v12);
      a2 += 4LL;
      --v16;
    }
    v11 = -v13;
  }
  v24 = 4;
  while ( v11 < v7 )
  {
    v25 = (signed int)v12;
    v26 = v12 - ((v12 + ((unsigned int)((signed int)(v12 + 3) >> 31) >> 30) + 3) & 0xFFFFFFFC) + 3;
    v27 = v12 - ((v12 + ((unsigned int)((signed int)(v12 + 2) >> 31) >> 30) + 2) & 0xFFFFFFFC) + 2;
    v12 = v12 - ((v12 + ((unsigned int)((signed int)(v12 + 1) >> 31) >> 30) + 1) & 0xFFFFFFFC) + 1;
    v28 = *(_DWORD *)(v3 + 4LL * (signed int)v12);
    v29 = 1664525
        * (*(_DWORD *)(v3 + 4LL * (signed int)v26) ^ v28 ^ *(_DWORD *)(v3 + 4 * v25) ^ ((*(_DWORD *)(v3 + 4LL * (signed int)v26) ^ v28 ^ *(_DWORD *)(v3 + 4 * v25)) >> 27));
    *(_DWORD *)(v3 + 4LL * (signed int)v12) = v29 + v28;
    *(_DWORD *)(v3 + 4LL * (signed int)v27) += v29 + v25;
    *(_DWORD *)(v3 + 4 * v25) = v29 + v25;
    ++v11;
  }
  do
  {
    v30 = (signed int)v12;
    v31 = v12 - ((v12 + ((unsigned int)((signed int)(v12 + 3) >> 31) >> 30) + 3) & 0xFFFFFFFC) + 3;
    v32 = v12 - ((v12 + ((unsigned int)((signed int)(v12 + 2) >> 31) >> 30) + 2) & 0xFFFFFFFC) + 2;
    v12 = v12 - ((v12 + ((unsigned int)((signed int)(v12 + 1) >> 31) >> 30) + 1) & 0xFFFFFFFC) + 1;
    v33 = *(_DWORD *)(v3 + 4LL * (signed int)v12);
    v34 = (*(_DWORD *)(v3 + 4LL * (signed int)v31) + v33 + *(_DWORD *)(v3 + 4 * v30)) ^ ((unsigned int)(*(_DWORD *)(v3 + 4LL * (signed int)v31) + v33 + *(_DWORD *)(v3 + 4 * v30)) >> 27);
    *(_DWORD *)(v3 + 4LL * (signed int)v12) = 1566083941 * v34 ^ v33;
    v35 = 1566083941 * v34 - v30;
    *(_DWORD *)(v3 + 4LL * (signed int)v32) ^= v35;
    *(_DWORD *)(v3 + 4 * v30) = v35;
    --v24;
  }
  while ( v24 );
  period_certification(v3);
  LODWORD(result) = *(_DWORD *)(v3 + 12);
  v37 = *(_DWORD *)v3;
  v38 = *(_DWORD *)(v3 + 4);
  v39 = *(_DWORD *)(v3 + 8);
  v40 = 8;
  do
  {
    v41 = v37;
    v37 = v38;
    v42 = v39 ^ v38 ^ v41 & 0x7FFFFFFF ^ 2 * (v39 ^ v38 ^ v41 & 0x7FFFFFFF);
    result = v42 ^ ((unsigned int)result >> 1) ^ (unsigned int)result;
    v43 = v42 ^ ((_DWORD)result << 10);
    v44 = -(result & 1);
    v38 = v39 ^ v44 & *(_DWORD *)(v3 + 16);
    v39 = v43 ^ *(_DWORD *)(v3 + 20) & v44;
    --v40;
  }
  while ( v40 );
  *(_DWORD *)(v3 + 12) = result;
  *(_DWORD *)v3 = v37;
  *(_DWORD *)(v3 + 4) = v38;
  *(_DWORD *)(v3 + 8) = v39;
  return result;
}

//----- (000000000000DFDB) ----------------------------------------------------
int _start()
{
  int result; // eax@2

  if ( _realmain )
  {
    result = _realmain();
  }
  else
  {
    result = 0;
  }
  return result;
}
// A64D8: using guessed type int (*_realmain)(void);

//----- (000000000000DFF5) ----------------------------------------------------
char *OSKextGetCurrentIdentifier()
{
  return (char *)&kmod_info[4];
}

//----- (000000000000E006) ----------------------------------------------------
char *OSKextGetCurrentVersionString()
{
  return (char *)&kmod_info[20];
}

//----- (000000000000E017) ----------------------------------------------------
__int64 OSKextGetCurrentLoadTag()
{
  return kmod_info[3];
}

//----- (000000000000E027) ----------------------------------------------------
int _stop()
{
  int result; // eax@2

  if ( _antimain )
  {
    result = _antimain();
  }
  else
  {
    result = 0;
  }
  return result;
}
// A64E0: using guessed type int (*_antimain)(void);

// ALL OK, 284 function(s) have been successfully decompiled
